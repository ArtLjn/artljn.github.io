<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title>AOPåˆ‡é¢ç¼–ç¨‹åŸºç¡€ä½¿ç”¨</title>
    <url>/2024/07/21/web/AOP%E5%88%87%E9%9D%A2%E7%BC%96%E7%A8%8B%E5%9F%BA%E7%A1%80%E4%BD%BF%E7%94%A8/</url>
    <content><![CDATA[<h3 id="AOP-åˆ‡é¢ç¼–ç¨‹åŸºç¡€ä½¿ç”¨"><a href="#AOP-åˆ‡é¢ç¼–ç¨‹åŸºç¡€ä½¿ç”¨" class="headerlink" title="AOP åˆ‡é¢ç¼–ç¨‹åŸºç¡€ä½¿ç”¨"></a>AOP åˆ‡é¢ç¼–ç¨‹åŸºç¡€ä½¿ç”¨</h3><blockquote>
<p>Spring AOPï¼ˆAspect-Oriented Programmingï¼‰åˆ‡é¢ç¼–ç¨‹æ˜¯Springæ¡†æ¶æä¾›çš„ä¸€ç§ç¼–ç¨‹èŒƒå¼ï¼Œç”¨äºå¢å¼ºç°æœ‰çš„Javaä»£ç åŠŸèƒ½è€Œæ— éœ€ä¿®æ”¹åŸå§‹ä»£ç ã€‚å®ƒæ˜¯é¢å‘åˆ‡é¢çš„ç¼–ç¨‹æ–¹æ³•ï¼Œé€šè¿‡åœ¨åº”ç”¨ç¨‹åºçš„å…³é”®ä½ç½®æ’å…¥ä»£ç ç‰‡æ®µï¼Œå®ç°å¯¹äºç‰¹å®šè¡Œä¸ºçš„æ‹¦æˆªå’Œæ§åˆ¶ã€‚</p>
</blockquote>
<h2 id="SpringBootå¦‚ä½•ä½¿ç”¨AOPåˆ‡é¢ç¼–ç¨‹"><a href="#SpringBootå¦‚ä½•ä½¿ç”¨AOPåˆ‡é¢ç¼–ç¨‹" class="headerlink" title="SpringBootå¦‚ä½•ä½¿ç”¨AOPåˆ‡é¢ç¼–ç¨‹?"></a>SpringBootå¦‚ä½•ä½¿ç”¨AOPåˆ‡é¢ç¼–ç¨‹?</h2><p>1.åœ¨pom.xmlä¸­å¼•å…¥AOPä¾èµ–</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!--aop åˆ‡é¢--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-aop<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>2.æ–°å»ºä¸€ä¸ªAopAdviceç±»,å¹¶åœ¨ç±»çš„å¼€å¤´åŠ å…¥@Aspectæ³¨è§£</p>
<ul>
<li>å®šä¹‰ä¸€ä¸ªåˆ‡é¢<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@dev</span> execution (* com.personapi.controller.BlogController.getId(..))</span></span><br><span class="line"><span class="comment"> *  * controlleråŒ…å.å®šä¹‰åˆ‡é¢çš„ç±».å®šä¹‰åˆ‡é¢çš„æ–¹æ³•(ä»»ä½•å‚æ•°)</span></span><br><span class="line"><span class="comment"> *  * com.personapi.controller.*.*(..)) è¡¨ç¤ºå®šä¹‰controlleråŒ…ä¸‹æ‰€æœ‰ç±»ï¼Œæ‰€æœ‰æ–¹æ³•ï¼Œä»»ä½•å‚æ•°</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Pointcut(&quot;execution (* com.personapi.controller.BlogController.getId(..))&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">myPointCut</span><span class="params">()</span> &#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
3.@Beforeæ³¨è§£<br>@Beforeè¡¨ç¤ºåœ¨æ–¹æ³•æ‰§è¡Œä¹‹å‰è°ƒç”¨<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@dev</span> è°ƒç”¨ä¹‹å‰æ‰§è¡Œ</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Before(&quot;myPointCut()&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">beforeAdvice</span><span class="params">(JoinPoint jp)</span> <span class="keyword">throws</span> JsonProcessingException &#123;</span><br><span class="line">    <span class="type">String</span> <span class="variable">className</span> <span class="operator">=</span> jp.getTarget().getClass().toString();</span><br><span class="line">    <span class="type">String</span> <span class="variable">methodName</span> <span class="operator">=</span> jp.getSignature().getName();</span><br><span class="line">    Object[] args = jp.getArgs();</span><br><span class="line"></span><br><span class="line">    <span class="type">ObjectMapper</span> <span class="variable">mapper</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectMapper</span>();</span><br><span class="line">    log.info(<span class="string">&quot;è°ƒç”¨å‰:&quot;</span> + className + <span class="string">&quot;:&quot;</span> + methodName + <span class="string">&quot;ä¼ é€’çš„å‚æ•°ä¸º:&quot;</span> + mapper.writeValueAsString(args));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
4.@AfterReturningæ³¨è§£<br>è¯¥æ–¹æ³•è¡¨ç¤ºåç½®é€šçŸ¥ï¼Œæ–¹æ³•æ‰§è¡Œä¹‹åæ‰§è¡Œ<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@dev</span> è°ƒç”¨ä¹‹åæ‰§è¡Œ</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@AfterReturning(pointcut = &quot;myPointCut()&quot;, returning = &quot;result&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">afterAdvice</span><span class="params">(JoinPoint jp, Object result)</span> <span class="keyword">throws</span> JsonProcessingException &#123;</span><br><span class="line">    <span class="type">String</span> <span class="variable">className</span> <span class="operator">=</span> jp.getTarget().getClass().toString();</span><br><span class="line">    <span class="type">String</span> <span class="variable">methodName</span> <span class="operator">=</span> jp.getSignature().getName();</span><br><span class="line"></span><br><span class="line">    <span class="type">ObjectMapper</span> <span class="variable">mapper</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectMapper</span>();</span><br><span class="line">    log.info(<span class="string">&quot;è°ƒç”¨å:&quot;</span> + className + <span class="string">&quot;:&quot;</span> + methodName + <span class="string">&quot;è¿”å›å€¼:&quot;</span> + mapper.writeValueAsString(result));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<p>5.@Aroundæ³¨è§£<br>@Aroundæ³¨è§£å¯ä»¥ç”¨æ¥åœ¨è°ƒç”¨ä¸€ä¸ªå…·ä½“æ–¹æ³•å‰å’Œè°ƒç”¨åæ¥å®Œæˆä¸€äº›å…·ä½“çš„ä»»åŠ¡ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@dev</span> ç¯ç»•æ‰§è¡Œ</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> pjp</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Around(&quot;myPointCut()&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">aroundAdvice</span><span class="params">(ProceedingJoinPoint pjp)</span> <span class="keyword">throws</span> Throwable &#123;</span><br><span class="line">    <span class="type">String</span> <span class="variable">className</span> <span class="operator">=</span> pjp.getTarget().getClass().toString();</span><br><span class="line">    <span class="type">String</span> <span class="variable">methodName</span> <span class="operator">=</span> pjp.getSignature().getName();</span><br><span class="line">    Object[] args = pjp.getArgs();</span><br><span class="line"></span><br><span class="line">    <span class="type">ObjectMapper</span> <span class="variable">mapper</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectMapper</span>();</span><br><span class="line">    log.info(<span class="string">&quot;è°ƒç”¨å‰:&quot;</span> + className + <span class="string">&quot;:&quot;</span> + methodName + <span class="string">&quot;ä¼ é€’çš„å‚æ•°ä¸º:&quot;</span> + mapper.writeValueAsString(args));</span><br><span class="line"></span><br><span class="line">    <span class="type">Object</span> <span class="variable">obj</span> <span class="operator">=</span> pjp.proceed();</span><br><span class="line"></span><br><span class="line">    log.info(<span class="string">&quot;è°ƒç”¨å‰:&quot;</span> + className + <span class="string">&quot;:&quot;</span> + methodName + <span class="string">&quot;è¿”å›å€¼:&quot;</span> + mapper.writeValueAsString(obj));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>6.AopAdviceå®Œæ•´ä»£ç </p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@Aspect</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AopAdvice</span> &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@dev</span> execution (* com.personapi.controller.BlogController.getId(..))</span></span><br><span class="line"><span class="comment">     *  * controlleråŒ…å.å®šä¹‰åˆ‡é¢çš„ç±».å®šä¹‰åˆ‡é¢çš„æ–¹æ³•(ä»»ä½•å‚æ•°)</span></span><br><span class="line"><span class="comment">     *  * com.personapi.controller.*.*(..)) è¡¨ç¤ºå®šä¹‰controlleråŒ…ä¸‹æ‰€æœ‰ç±»ï¼Œæ‰€æœ‰æ–¹æ³•ï¼Œä»»ä½•å‚æ•°</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Pointcut(&quot;execution (* com.personapi.controller.BlogController.getId(..))&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">myPointCut</span><span class="params">()</span> &#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@dev</span> è°ƒç”¨ä¹‹å‰æ‰§è¡Œ</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Before(&quot;myPointCut()&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">beforeAdvice</span><span class="params">(JoinPoint jp)</span> <span class="keyword">throws</span> JsonProcessingException &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">className</span> <span class="operator">=</span> jp.getTarget().getClass().toString();</span><br><span class="line">        <span class="type">String</span> <span class="variable">methodName</span> <span class="operator">=</span> jp.getSignature().getName();</span><br><span class="line">        Object[] args = jp.getArgs();</span><br><span class="line"></span><br><span class="line">        <span class="type">ObjectMapper</span> <span class="variable">mapper</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectMapper</span>();</span><br><span class="line">        log.info(<span class="string">&quot;è°ƒç”¨å‰:&quot;</span> + className + <span class="string">&quot;:&quot;</span> + methodName + <span class="string">&quot;ä¼ é€’çš„å‚æ•°ä¸º:&quot;</span> + mapper.writeValueAsString(args));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@dev</span> è°ƒç”¨ä¹‹åæ‰§è¡Œ</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@AfterReturning(pointcut = &quot;myPointCut()&quot;, returning = &quot;result&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">afterAdvice</span><span class="params">(JoinPoint jp, Object result)</span> <span class="keyword">throws</span> JsonProcessingException &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">className</span> <span class="operator">=</span> jp.getTarget().getClass().toString();</span><br><span class="line">        <span class="type">String</span> <span class="variable">methodName</span> <span class="operator">=</span> jp.getSignature().getName();</span><br><span class="line"></span><br><span class="line">        <span class="type">ObjectMapper</span> <span class="variable">mapper</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectMapper</span>();</span><br><span class="line">        log.info(<span class="string">&quot;è°ƒç”¨å:&quot;</span> + className + <span class="string">&quot;:&quot;</span> + methodName + <span class="string">&quot;è¿”å›å€¼:&quot;</span> + mapper.writeValueAsString(result));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@dev</span> ç¯ç»•æ‰§è¡Œ</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> pjp</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Around(&quot;myPointCut()&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">aroundAdvice</span><span class="params">(ProceedingJoinPoint pjp)</span> <span class="keyword">throws</span> Throwable &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">className</span> <span class="operator">=</span> pjp.getTarget().getClass().toString();</span><br><span class="line">        <span class="type">String</span> <span class="variable">methodName</span> <span class="operator">=</span> pjp.getSignature().getName();</span><br><span class="line">        Object[] args = pjp.getArgs();</span><br><span class="line"></span><br><span class="line">        <span class="type">ObjectMapper</span> <span class="variable">mapper</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectMapper</span>();</span><br><span class="line">        log.info(<span class="string">&quot;è°ƒç”¨å‰:&quot;</span> + className + <span class="string">&quot;:&quot;</span> + methodName + <span class="string">&quot;ä¼ é€’çš„å‚æ•°ä¸º:&quot;</span> + mapper.writeValueAsString(args));</span><br><span class="line"></span><br><span class="line">        <span class="type">Object</span> <span class="variable">obj</span> <span class="operator">=</span> pjp.proceed();</span><br><span class="line"></span><br><span class="line">        log.info(<span class="string">&quot;è°ƒç”¨å‰:&quot;</span> + className + <span class="string">&quot;:&quot;</span> + methodName + <span class="string">&quot;è¿”å›å€¼:&quot;</span> + mapper.writeValueAsString(obj));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>web</category>
      </categories>
      <tags>
        <tag>springboot</tag>
      </tags>
  </entry>
  <entry>
    <title>Golangæ¥å…¥Oauth2</title>
    <url>/2024/12/22/web/Golang%E6%8E%A5%E5%85%A5Oauth2/</url>
    <content><![CDATA[<h1 id="1-GitHub-OAuth2"><a href="#1-GitHub-OAuth2" class="headerlink" title="1. GitHub OAuth2"></a>1. GitHub OAuth2</h1><h2 id="1-1-GitHub-OAuth2-æ¥å…¥æµç¨‹"><a href="#1-1-GitHub-OAuth2-æ¥å…¥æµç¨‹" class="headerlink" title="1.1 GitHub OAuth2 æ¥å…¥æµç¨‹"></a>1.1 GitHub OAuth2 æ¥å…¥æµç¨‹</h2><p>åœ¨â€Authorization callback URLâ€è¿™é‡Œå¡«å†™ä½ çš„å›è°ƒåœ°å€ï¼Œå¯ä»¥æ˜¯ä½ çš„åŸŸåï¼Œä¹Ÿå¯ä»¥æ˜¯ä½ æœ¬åœ°çš„å›è°ƒåœ°å€ï¼Œæ¯”å¦‚ <code>http://localhost:8080/callback</code>ã€‚ç›¸å…³é…ç½®å¡«å†™ä¹‹åï¼Œç‚¹å‡»â€Register applicationâ€åˆ›å»ºå³å¯ã€‚</p>
<p><img  
                       lazyload
                       alt="image"
                       data-src="/images/2024-12-22-21-04-49.png"
                       
                 ><br>åº”ç”¨åˆ›å»ºå®Œæ¯•ï¼Œä¼šç”Ÿæˆå®¢æˆ·ç«¯ ID å’Œå®¢æˆ·ç«¯å¯†é’¥ã€‚å®¢æˆ·ç«¯å¯†é’¥éœ€è¦å•ç‹¬ç”Ÿæˆï¼Œç‚¹å‡»â€Generate  a new client secretâ€ç”Ÿæˆä¸€ä¸ªå¯†é’¥å³å¯ã€‚<br><img  
                       lazyload
                       alt="image"
                       data-src="/images/2024-12-22-20-34-15.png"
                       
                 ></p>
<h2 id="1-2-GitHub-OAuth2-æ¥å…¥ä»£ç "><a href="#1-2-GitHub-OAuth2-æ¥å…¥ä»£ç " class="headerlink" title="1.2 GitHub OAuth2 æ¥å…¥ä»£ç "></a>1.2 GitHub OAuth2 æ¥å…¥ä»£ç </h2><figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">&quot;context&quot;</span></span><br><span class="line">	<span class="string">&quot;encoding/json&quot;</span></span><br><span class="line">	<span class="string">&quot;fmt&quot;</span></span><br><span class="line">	<span class="string">&quot;io&quot;</span></span><br><span class="line">	<span class="string">&quot;log&quot;</span></span><br><span class="line">	<span class="string">&quot;net/http&quot;</span></span><br><span class="line"></span><br><span class="line">	<span class="string">&quot;golang.org/x/oauth2&quot;</span></span><br><span class="line">	<span class="string">&quot;golang.org/x/oauth2/github&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> (</span><br><span class="line">	githubOauthConfig = &amp;oauth2.Config&#123;</span><br><span class="line">		ClientID:     <span class="string">&quot;Ov23liHgJhetSUt45V9r&quot;</span>,</span><br><span class="line">		ClientSecret: <span class="string">&quot;ClientSecret&quot;</span>, <span class="comment">// è¯·æ›¿æ¢ä¸ºè‡ªå·±çš„ClientSecret</span></span><br><span class="line">		RedirectURL:  <span class="string">&quot;http://localhost:8080/callback&quot;</span>,</span><br><span class="line">		Endpoint:     github.Endpoint,</span><br><span class="line">		Scopes:       []<span class="type">string</span>&#123;<span class="string">&quot;user:email&quot;</span>&#125;,</span><br><span class="line">	&#125;</span><br><span class="line">	oauthStateString = <span class="string">&quot;random&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	http.HandleFunc(<span class="string">&quot;/&quot;</span>, handleMain)</span><br><span class="line">	http.HandleFunc(<span class="string">&quot;/login&quot;</span>, handleGitHubLogin)</span><br><span class="line">	http.HandleFunc(<span class="string">&quot;/callback&quot;</span>, handleGitHubCallback)</span><br><span class="line">	http.HandleFunc(<span class="string">&quot;/logout&quot;</span>, handleLogout)</span><br><span class="line">	log.Println(<span class="string">&quot;Started running on http://localhost:8080&quot;</span>)</span><br><span class="line">	log.Fatal(http.ListenAndServe(<span class="string">&quot;:8080&quot;</span>, <span class="literal">nil</span>))</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">handleMain</span><span class="params">(w http.ResponseWriter, r *http.Request)</span></span> &#123;</span><br><span class="line">	<span class="keyword">var</span> htmlIndex = <span class="string">`&lt;html&gt;&lt;body&gt;&lt;a href=&quot;/login&quot;&gt;Log in with GitHub&lt;/a&gt;&lt;/body&gt;&lt;/html&gt;`</span></span><br><span class="line">	io.WriteString(w, htmlIndex)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">handleGitHubLogin</span><span class="params">(w http.ResponseWriter, r *http.Request)</span></span> &#123;</span><br><span class="line">	url := githubOauthConfig.AuthCodeURL(oauthStateString)</span><br><span class="line">	http.Redirect(w, r, url, http.StatusTemporaryRedirect)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> GitHubUser <span class="keyword">struct</span> &#123;</span><br><span class="line">	Login     <span class="type">string</span> <span class="string">`json:&quot;login&quot;`</span></span><br><span class="line">	ID        <span class="type">int</span>    <span class="string">`json:&quot;id&quot;`</span></span><br><span class="line">	AvatarURL <span class="type">string</span> <span class="string">`json:&quot;avatar_url&quot;`</span></span><br><span class="line">	HTMLURL   <span class="type">string</span> <span class="string">`json:&quot;html_url&quot;`</span></span><br><span class="line">	Name      <span class="type">string</span> <span class="string">`json:&quot;name&quot;`</span></span><br><span class="line">	Company   <span class="type">string</span> <span class="string">`json:&quot;company&quot;`</span></span><br><span class="line">	Blog      <span class="type">string</span> <span class="string">`json:&quot;blog&quot;`</span></span><br><span class="line">	Location  <span class="type">string</span> <span class="string">`json:&quot;location&quot;`</span></span><br><span class="line">	Email     <span class="type">string</span> <span class="string">`json:&quot;email&quot;`</span></span><br><span class="line">	Bio       <span class="type">string</span> <span class="string">`json:&quot;bio&quot;`</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">handleGitHubCallback</span><span class="params">(w http.ResponseWriter, r *http.Request)</span></span> &#123;</span><br><span class="line">	<span class="keyword">if</span> r.FormValue(<span class="string">&quot;state&quot;</span>) != oauthStateString &#123;</span><br><span class="line">		log.Println(<span class="string">&quot;invalid oauth state&quot;</span>)</span><br><span class="line">		http.Redirect(w, r, <span class="string">&quot;/&quot;</span>, http.StatusTemporaryRedirect)</span><br><span class="line">		<span class="keyword">return</span></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	token, err := githubOauthConfig.Exchange(context.Background(), r.FormValue(<span class="string">&quot;code&quot;</span>))</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		log.Println(<span class="string">&quot;code exchange failed: &quot;</span>, err)</span><br><span class="line">		http.Redirect(w, r, <span class="string">&quot;/&quot;</span>, http.StatusTemporaryRedirect)</span><br><span class="line">		<span class="keyword">return</span></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	client := githubOauthConfig.Client(context.Background(), token)</span><br><span class="line">	resp, err := client.Get(<span class="string">&quot;https://api.github.com/user&quot;</span>)</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		log.Println(<span class="string">&quot;failed getting user info: &quot;</span>, err)</span><br><span class="line">		http.Redirect(w, r, <span class="string">&quot;/&quot;</span>, http.StatusTemporaryRedirect)</span><br><span class="line">		<span class="keyword">return</span></span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">defer</span> resp.Body.Close()</span><br><span class="line"></span><br><span class="line">	<span class="keyword">var</span> user GitHubUser</span><br><span class="line">	<span class="keyword">if</span> err := json.NewDecoder(resp.Body).Decode(&amp;user); err != <span class="literal">nil</span> &#123;</span><br><span class="line">		log.Println(<span class="string">&quot;failed decoding response body: &quot;</span>, err)</span><br><span class="line">		http.Redirect(w, r, <span class="string">&quot;/&quot;</span>, http.StatusTemporaryRedirect)</span><br><span class="line">		<span class="keyword">return</span></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// æ ¼å¼åŒ–è¾“å‡ºç”¨æˆ·ä¿¡æ¯</span></span><br><span class="line">	fmt.Fprintf(w, <span class="string">`&lt;html&gt;&lt;body&gt;</span></span><br><span class="line"><span class="string">        &lt;h1&gt;User Info&lt;/h1&gt;</span></span><br><span class="line"><span class="string">        &lt;p&gt;&lt;strong&gt;Login:&lt;/strong&gt; %s&lt;/p&gt;</span></span><br><span class="line"><span class="string">        &lt;p&gt;&lt;strong&gt;ID:&lt;/strong&gt; %d&lt;/p&gt;</span></span><br><span class="line"><span class="string">        &lt;p&gt;&lt;strong&gt;Avatar URL:&lt;/strong&gt; &lt;img   src=&quot;%s&quot;  alt=&quot;avatar&quot; &gt;&lt;/p&gt;</span></span><br><span class="line"><span class="string">        &lt;p&gt;&lt;strong&gt;Profile URL:&lt;/strong&gt; &lt;a href=&quot;%s&quot;&gt;%s&lt;/a&gt;&lt;/p&gt;</span></span><br><span class="line"><span class="string">        &lt;p&gt;&lt;strong&gt;Name:&lt;/strong&gt; %s&lt;/p&gt;</span></span><br><span class="line"><span class="string">        &lt;p&gt;&lt;strong&gt;Company:&lt;/strong&gt; %s&lt;/p&gt;</span></span><br><span class="line"><span class="string">        &lt;p&gt;&lt;strong&gt;Blog:&lt;/strong&gt; %s&lt;/p&gt;</span></span><br><span class="line"><span class="string">        &lt;p&gt;&lt;strong&gt;Location:&lt;/strong&gt; %s&lt;/p&gt;</span></span><br><span class="line"><span class="string">        &lt;p&gt;&lt;strong&gt;Email:&lt;/strong&gt; %s&lt;/p&gt;</span></span><br><span class="line"><span class="string">        &lt;p&gt;&lt;strong&gt;Bio:&lt;/strong&gt; %s&lt;/p&gt;</span></span><br><span class="line"><span class="string">    &lt;/body&gt;&lt;/html&gt;`</span>,</span><br><span class="line">		user.Login,</span><br><span class="line">		user.ID,</span><br><span class="line">		user.AvatarURL,</span><br><span class="line">		user.HTMLURL, user.HTMLURL,</span><br><span class="line">		user.Name,</span><br><span class="line">		user.Company,</span><br><span class="line">		user.Blog,</span><br><span class="line">		user.Location,</span><br><span class="line">		user.Email,</span><br><span class="line">		user.Bio)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">handleLogout</span><span class="params">(w http.ResponseWriter, r *http.Request)</span></span> &#123;</span><br><span class="line">	<span class="comment">// æ¸…é™¤ä¼šè¯cookie</span></span><br><span class="line">	http.SetCookie(w, &amp;http.Cookie&#123;</span><br><span class="line">		Name:   <span class="string">&quot;github_oauth_token&quot;</span>,</span><br><span class="line">		Value:  <span class="string">&quot;&quot;</span>,</span><br><span class="line">		Path:   <span class="string">&quot;/&quot;</span>,</span><br><span class="line">		MaxAge: <span class="number">-1</span>,</span><br><span class="line">	&#125;)</span><br><span class="line">	http.Redirect(w, r, <span class="string">&quot;/&quot;</span>, http.StatusTemporaryRedirect)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="1-3-æˆæƒç™»å½•"><a href="#1-3-æˆæƒç™»å½•" class="headerlink" title="1.3 æˆæƒç™»å½•"></a>1.3 æˆæƒç™»å½•</h2><p><img  
                       lazyload
                       alt="image"
                       data-src="/images/2024-12-22-21-14-56.png"
                       
                 ><br>æˆæƒæˆåŠŸåï¼Œä¼šè·³è½¬åˆ°å›è°ƒåœ°å€ï¼Œå¹¶è¿”å›æˆæƒç ï¼Œç„¶åé€šè¿‡æˆæƒç è·å–access_tokenï¼Œæœ€åé€šè¿‡access_tokenè·å–ç”¨æˆ·ä¿¡æ¯ã€‚</p>
<p><img  
                       lazyload
                       alt="image"
                       data-src="/images/2024-12-22-21-16-13.png"
                       
                 ></p>
]]></content>
      <categories>
        <category>web</category>
      </categories>
      <tags>
        <tag>Golang</tag>
      </tags>
  </entry>
  <entry>
    <title>SpringBootJWTè®¤è¯å®Œæ•´å®ç°æŒ‡å—</title>
    <url>/2025/09/22/web/SpringBootJWT%E8%AE%A4%E8%AF%81%E5%AE%8C%E6%95%B4%E5%AE%9E%E7%8E%B0%E6%8C%87%E5%8D%97/</url>
    <content><![CDATA[<blockquote>
<p>åœ¨ç°ä»£Webåº”ç”¨å¼€å‘ä¸­ï¼ŒJWTï¼ˆJSON Web Tokenï¼‰å·²ç»æˆä¸ºæœ€æµè¡Œçš„èº«ä»½è®¤è¯è§£å†³æ–¹æ¡ˆä¹‹ä¸€ã€‚æœ¬æ–‡å°†åŸºäºSpring Booté¡¹ç›®å®æˆ˜ï¼Œè¯¦ç»†ä»‹ç»å¦‚ä½•å®ç°ä¸€å¥—å®Œæ•´çš„JWTè®¤è¯ç³»ç»Ÿï¼ŒåŒ…æ‹¬åŒTokenæœºåˆ¶ã€å®‰å…¨é…ç½®ã€æœ€ä½³å®è·µç­‰å†…å®¹ã€‚</p>
</blockquote>
<h2 id="ğŸ“‹-ç›®å½•"><a href="#ğŸ“‹-ç›®å½•" class="headerlink" title="ğŸ“‹ ç›®å½•"></a>ğŸ“‹ ç›®å½•</h2><ul>
<li><a href="#1-jwt%E6%A6%82%E8%BF%B0">1. JWTæ¦‚è¿°</a></li>
<li><a href="#2-%E6%8A%80%E6%9C%AF%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1">2. æŠ€æœ¯æ¶æ„è®¾è®¡</a></li>
<li><a href="#3-%E4%BE%9D%E8%B5%96%E9%85%8D%E7%BD%AE">3. ä¾èµ–é…ç½®</a></li>
<li><a href="#4-%E6%A0%B8%E5%BF%83%E7%BB%84%E4%BB%B6%E5%AE%9E%E7%8E%B0">4. æ ¸å¿ƒç»„ä»¶å®ç°</a></li>
<li><a href="#5-%E5%AE%89%E5%85%A8%E9%85%8D%E7%BD%AE">5. å®‰å…¨é…ç½®</a></li>
<li><a href="#6-api%E6%8E%A5%E5%8F%A3%E5%AE%9E%E7%8E%B0">6. APIæ¥å£å®ç°</a></li>
<li><a href="#7-%E5%AE%A2%E6%88%B7%E7%AB%AF%E4%BD%BF%E7%94%A8">7. å®¢æˆ·ç«¯ä½¿ç”¨</a></li>
<li><a href="#8-%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5">8. æœ€ä½³å®è·µ</a></li>
<li><a href="#9-%E5%B8%B8%E8%A7%81%E9%97%AE%E9%A2%98">9. å¸¸è§é—®é¢˜</a></li>
<li><a href="#10-%E6%80%BB%E7%BB%93">10. æ€»ç»“</a></li>
</ul>
<h2 id="1-JWTæ¦‚è¿°"><a href="#1-JWTæ¦‚è¿°" class="headerlink" title="1. JWTæ¦‚è¿°"></a>1. JWTæ¦‚è¿°</h2><h3 id="1-1-ä»€ä¹ˆæ˜¯JWT"><a href="#1-1-ä»€ä¹ˆæ˜¯JWT" class="headerlink" title="1.1 ä»€ä¹ˆæ˜¯JWT"></a>1.1 ä»€ä¹ˆæ˜¯JWT</h3><p>JWTï¼ˆJSON Web Tokenï¼‰æ˜¯ä¸€ç§å¼€æ”¾æ ‡å‡†ï¼ˆRFC 7519ï¼‰ï¼Œå®ƒå®šä¹‰äº†ä¸€ç§ç´§å‡‘ä¸”è‡ªåŒ…å«çš„æ–¹å¼ï¼Œç”¨äºåœ¨å„æ–¹ä¹‹é—´ä»¥JSONå¯¹è±¡çš„å½¢å¼å®‰å…¨åœ°ä¼ è¾“ä¿¡æ¯ã€‚</p>
<h3 id="1-2-JWTç»“æ„"><a href="#1-2-JWTç»“æ„" class="headerlink" title="1.2 JWTç»“æ„"></a>1.2 JWTç»“æ„</h3><p>JWTç”±ä¸‰éƒ¨åˆ†ç»„æˆï¼Œç”¨ç‚¹ï¼ˆ.ï¼‰åˆ†éš”ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">Header.Payload.Signature</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>Headerï¼ˆå¤´éƒ¨ï¼‰</strong>ï¼šåŒ…å«ä»¤ç‰Œç±»å‹å’ŒåŠ å¯†ç®—æ³•</li>
<li><strong>Payloadï¼ˆè½½è·ï¼‰</strong>ï¼šåŒ…å«å£°æ˜ï¼ˆclaimsï¼‰</li>
<li><strong>Signatureï¼ˆç­¾åï¼‰</strong>ï¼šç”¨äºéªŒè¯ä»¤ç‰Œçš„å®Œæ•´æ€§</li>
</ul>
<h3 id="1-3-JWTä¼˜åŠ¿"><a href="#1-3-JWTä¼˜åŠ¿" class="headerlink" title="1.3 JWTä¼˜åŠ¿"></a>1.3 JWTä¼˜åŠ¿</h3><p>âœ… <strong>æ— çŠ¶æ€</strong>ï¼šæœåŠ¡å™¨ä¸éœ€è¦å­˜å‚¨ä¼šè¯ä¿¡æ¯<br>âœ… <strong>è·¨åŸŸæ”¯æŒ</strong>ï¼šæ”¯æŒè·¨åŸŸè®¤è¯<br>âœ… <strong>æ‰©å±•æ€§å¼º</strong>ï¼šæ˜“äºæ°´å¹³æ‰©å±•<br>âœ… <strong>æ€§èƒ½ä¼˜è‰¯</strong>ï¼šå‡å°‘æ•°æ®åº“æŸ¥è¯¢<br>âœ… <strong>ç§»åŠ¨å‹å¥½</strong>ï¼šé€‚åˆç§»åŠ¨åº”ç”¨å¼€å‘</p>
<h3 id="1-4-åŒTokenæœºåˆ¶"><a href="#1-4-åŒTokenæœºåˆ¶" class="headerlink" title="1.4 åŒTokenæœºåˆ¶"></a>1.4 åŒTokenæœºåˆ¶</h3><p>ä¸ºäº†å¹³è¡¡å®‰å…¨æ€§å’Œç”¨æˆ·ä½“éªŒï¼Œæˆ‘ä»¬é‡‡ç”¨åŒTokenæœºåˆ¶ï¼š</p>
<ul>
<li><strong>Access Tokenï¼ˆè®¿é—®ä»¤ç‰Œï¼‰</strong>ï¼šçŸ­æœŸæœ‰æ•ˆï¼ˆ2å°æ—¶ï¼‰</li>
<li><strong>Refresh Tokenï¼ˆåˆ·æ–°ä»¤ç‰Œï¼‰</strong>ï¼šé•¿æœŸæœ‰æ•ˆï¼ˆ7å¤©ï¼‰</li>
</ul>
<h2 id="2-æŠ€æœ¯æ¶æ„è®¾è®¡"><a href="#2-æŠ€æœ¯æ¶æ„è®¾è®¡" class="headerlink" title="2. æŠ€æœ¯æ¶æ„è®¾è®¡"></a>2. æŠ€æœ¯æ¶æ„è®¾è®¡</h2><h3 id="2-1-æ•´ä½“æ¶æ„å›¾"><a href="#2-1-æ•´ä½“æ¶æ„å›¾" class="headerlink" title="2.1 æ•´ä½“æ¶æ„å›¾"></a>2.1 æ•´ä½“æ¶æ„å›¾</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span><br><span class="line">â”‚                    JWTè®¤è¯ç³»ç»Ÿæ¶æ„                            â”‚</span><br><span class="line">â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤</span><br><span class="line">â”‚                                                             â”‚</span><br><span class="line">â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚</span><br><span class="line">â”‚  â”‚  å‰ç«¯åº”ç”¨    â”‚    â”‚  ç§»åŠ¨åº”ç”¨    â”‚    â”‚  ç¬¬ä¸‰æ–¹åº”ç”¨  â”‚      â”‚</span><br><span class="line">â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚</span><br><span class="line">â”‚         â”‚                   â”‚                   â”‚           â”‚</span><br><span class="line">â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚</span><br><span class="line">â”‚                             â”‚                               â”‚</span><br><span class="line">â”‚                             â–¼                               â”‚</span><br><span class="line">â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚</span><br><span class="line">â”‚  â”‚                    APIç½‘å…³å±‚                            â”‚ â”‚</span><br><span class="line">â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚ â”‚</span><br><span class="line">â”‚  â”‚  â”‚ JWTæ‹¦æˆªå™¨   â”‚  â”‚ å¼‚å¸¸å¤„ç†å™¨  â”‚  â”‚ è·¨åŸŸé…ç½®    â”‚     â”‚ â”‚</span><br><span class="line">â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚ â”‚</span><br><span class="line">â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚</span><br><span class="line">â”‚                             â”‚                               â”‚</span><br><span class="line">â”‚                             â–¼                               â”‚</span><br><span class="line">â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚</span><br><span class="line">â”‚  â”‚                    ä¸šåŠ¡æœåŠ¡å±‚                            â”‚ â”‚</span><br><span class="line">â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚ â”‚</span><br><span class="line">â”‚  â”‚  â”‚ ç”¨æˆ·æœåŠ¡    â”‚  â”‚ JWTå·¥å…·ç±»   â”‚  â”‚ è®¤è¯æœåŠ¡    â”‚     â”‚ â”‚</span><br><span class="line">â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚ â”‚</span><br><span class="line">â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚</span><br><span class="line">â”‚                             â”‚                               â”‚</span><br><span class="line">â”‚                             â–¼                               â”‚</span><br><span class="line">â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚</span><br><span class="line">â”‚  â”‚                    æ•°æ®å­˜å‚¨å±‚                            â”‚ â”‚</span><br><span class="line">â”‚  â”‚       MySQLæ•°æ®åº“        Redisç¼“å­˜        é…ç½®æ–‡ä»¶      â”‚ â”‚</span><br><span class="line">â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚</span><br><span class="line">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span><br></pre></td></tr></table></figure>

<h3 id="2-2-æ ¸å¿ƒç»„ä»¶è¯´æ˜"><a href="#2-2-æ ¸å¿ƒç»„ä»¶è¯´æ˜" class="headerlink" title="2.2 æ ¸å¿ƒç»„ä»¶è¯´æ˜"></a>2.2 æ ¸å¿ƒç»„ä»¶è¯´æ˜</h3><table>
<thead>
<tr>
<th>ç»„ä»¶</th>
<th>åŠŸèƒ½</th>
<th>ä½œç”¨</th>
</tr>
</thead>
<tbody><tr>
<td><strong>JwtUtil</strong></td>
<td>JWTå·¥å…·ç±»</td>
<td>Tokenç”Ÿæˆã€è§£æã€éªŒè¯</td>
</tr>
<tr>
<td><strong>JwtConfig</strong></td>
<td>JWTé…ç½®ç±»</td>
<td>é…ç½®å‚æ•°ç®¡ç†</td>
</tr>
<tr>
<td><strong>JwtInterceptor</strong></td>
<td>JWTæ‹¦æˆªå™¨</td>
<td>è‡ªåŠ¨éªŒè¯Token</td>
</tr>
<tr>
<td><strong>WebMvcConfig</strong></td>
<td>Webé…ç½®ç±»</td>
<td>æ³¨å†Œæ‹¦æˆªå™¨</td>
</tr>
<tr>
<td><strong>UserService</strong></td>
<td>ç”¨æˆ·æœåŠ¡</td>
<td>è®¤è¯ä¸šåŠ¡é€»è¾‘</td>
</tr>
</tbody></table>
<h2 id="3-ä¾èµ–é…ç½®"><a href="#3-ä¾èµ–é…ç½®" class="headerlink" title="3. ä¾èµ–é…ç½®"></a>3. ä¾èµ–é…ç½®</h2><h3 id="3-1-Mavenä¾èµ–"><a href="#3-1-Mavenä¾èµ–" class="headerlink" title="3.1 Mavenä¾èµ–"></a>3.1 Mavenä¾èµ–</h3><p>åœ¨<code>pom.xml</code>ä¸­æ·»åŠ JWTç›¸å…³ä¾èµ–ï¼š</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!-- JWT ä¾èµ– --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>io.jsonwebtoken<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jjwt-api<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>0.11.5<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>io.jsonwebtoken<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jjwt-impl<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>0.11.5<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">scope</span>&gt;</span>runtime<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>io.jsonwebtoken<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jjwt-jackson<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>0.11.5<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">scope</span>&gt;</span>runtime<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- Jackson JSR310 æ¨¡å—ï¼Œæ”¯æŒ Java 8 æ—¶é—´ç±»å‹ --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.fasterxml.jackson.datatype<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jackson-datatype-jsr310<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="3-2-é…ç½®æ–‡ä»¶"><a href="#3-2-é…ç½®æ–‡ä»¶" class="headerlink" title="3.2 é…ç½®æ–‡ä»¶"></a>3.2 é…ç½®æ–‡ä»¶</h3><p>åœ¨<code>application.yml</code>ä¸­æ·»åŠ JWTé…ç½®ï¼š</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="comment"># JWTé…ç½®</span></span><br><span class="line"><span class="attr">jwt:</span></span><br><span class="line">  <span class="attr">secret:</span> <span class="string">surveymaster-jwt-secret-key-for-authentication-very-secure-2025</span></span><br><span class="line">  <span class="attr">access-token-expiration:</span> <span class="number">7200000</span>      <span class="comment"># è®¿é—®ä»¤ç‰Œè¿‡æœŸæ—¶é—´ï¼ˆæ¯«ç§’ï¼‰- 2å°æ—¶</span></span><br><span class="line">  <span class="attr">refresh-token-expiration:</span> <span class="number">604800000</span>   <span class="comment"># åˆ·æ–°ä»¤ç‰Œè¿‡æœŸæ—¶é—´ï¼ˆæ¯«ç§’ï¼‰- 7å¤©</span></span><br><span class="line">  <span class="attr">token-header:</span> <span class="string">Authorization</span>           <span class="comment"># tokenè¯·æ±‚å¤´åç§°</span></span><br><span class="line">  <span class="attr">token-prefix:</span> <span class="string">&quot;Bearer &quot;</span>               <span class="comment"># tokenå‰ç¼€</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Jackson é…ç½®ï¼ˆæ”¯æŒ Java 8 æ—¶é—´ç±»å‹ï¼‰</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">jackson:</span></span><br><span class="line">    <span class="attr">date-format:</span> <span class="string">yyyy-MM-dd</span> <span class="string">HH:mm:ss</span></span><br><span class="line">    <span class="attr">time-zone:</span> <span class="string">GMT+8</span></span><br><span class="line">    <span class="attr">serialization:</span></span><br><span class="line">      <span class="attr">write-dates-as-timestamps:</span> <span class="literal">false</span></span><br><span class="line">    <span class="attr">deserialization:</span></span><br><span class="line">      <span class="attr">fail-on-unknown-properties:</span> <span class="literal">false</span></span><br></pre></td></tr></table></figure>

<h2 id="4-æ ¸å¿ƒç»„ä»¶å®ç°"><a href="#4-æ ¸å¿ƒç»„ä»¶å®ç°" class="headerlink" title="4. æ ¸å¿ƒç»„ä»¶å®ç°"></a>4. æ ¸å¿ƒç»„ä»¶å®ç°</h2><h3 id="4-1-JWTå·¥å…·ç±»"><a href="#4-1-JWTå·¥å…·ç±»" class="headerlink" title="4.1 JWTå·¥å…·ç±»"></a>4.1 JWTå·¥å…·ç±»</h3><p>åˆ›å»ºåŠŸèƒ½å®Œå–„çš„JWTå·¥å…·ç±»ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">JwtUtil</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;jwt.secret:surveymaster-jwt-secret-key-for-authentication-very-secure&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String secret;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;jwt.access-token-expiration:7200000&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Long accessTokenExpiration;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;jwt.refresh-token-expiration:604800000&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Long refreshTokenExpiration;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è·å–ç­¾åå¯†é’¥</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> SecretKey <span class="title function_">getSigningKey</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> Keys.hmacShaKeyFor(secret.getBytes());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ç”Ÿæˆè®¿é—®ä»¤ç‰Œ</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">generateAccessToken</span><span class="params">(Long userId, String username)</span> &#123;</span><br><span class="line">        Map&lt;String, Object&gt; claims = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">        claims.put(<span class="string">&quot;userId&quot;</span>, userId);</span><br><span class="line">        claims.put(<span class="string">&quot;username&quot;</span>, username);</span><br><span class="line">        claims.put(<span class="string">&quot;tokenType&quot;</span>, <span class="string">&quot;access&quot;</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> createToken(claims, username, accessTokenExpiration);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ç”Ÿæˆåˆ·æ–°ä»¤ç‰Œ</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">generateRefreshToken</span><span class="params">(Long userId, String username)</span> &#123;</span><br><span class="line">        Map&lt;String, Object&gt; claims = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">        claims.put(<span class="string">&quot;userId&quot;</span>, userId);</span><br><span class="line">        claims.put(<span class="string">&quot;username&quot;</span>, username);</span><br><span class="line">        claims.put(<span class="string">&quot;tokenType&quot;</span>, <span class="string">&quot;refresh&quot;</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> createToken(claims, username, refreshTokenExpiration);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * åˆ›å»ºToken</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String <span class="title function_">createToken</span><span class="params">(Map&lt;String, Object&gt; claims, String subject, Long expiration)</span> &#123;</span><br><span class="line">        <span class="type">Date</span> <span class="variable">now</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Date</span>();</span><br><span class="line">        <span class="type">Date</span> <span class="variable">expiryDate</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Date</span>(now.getTime() + expiration);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> Jwts.builder()</span><br><span class="line">                .setClaims(claims)</span><br><span class="line">                .setSubject(subject)</span><br><span class="line">                .setIssuedAt(now)</span><br><span class="line">                .setExpiration(expiryDate)</span><br><span class="line">                .signWith(getSigningKey(), SignatureAlgorithm.HS256)</span><br><span class="line">                .compact();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ä»tokenä¸­è·å–ç”¨æˆ·å</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getUsernameFromToken</span><span class="params">(String token)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> getClaimFromToken(token, Claims::getSubject);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ä»tokenä¸­è·å–ç”¨æˆ·ID</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> Long <span class="title function_">getUserIdFromToken</span><span class="params">(String token)</span> &#123;</span><br><span class="line">        <span class="type">Claims</span> <span class="variable">claims</span> <span class="operator">=</span> getAllClaimsFromToken(token);</span><br><span class="line">        <span class="keyword">return</span> Long.valueOf(claims.get(<span class="string">&quot;userId&quot;</span>).toString());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * éªŒè¯è®¿é—®ä»¤ç‰Œ</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> Boolean <span class="title function_">validateAccessToken</span><span class="params">(String token)</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="type">String</span> <span class="variable">tokenType</span> <span class="operator">=</span> getTokenTypeFromToken(token);</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;access&quot;</span>.equals(tokenType) &amp;&amp; !isTokenExpired(token);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * éªŒè¯åˆ·æ–°ä»¤ç‰Œ</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> Boolean <span class="title function_">validateRefreshToken</span><span class="params">(String token)</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="type">String</span> <span class="variable">tokenType</span> <span class="operator">=</span> getTokenTypeFromToken(token);</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;refresh&quot;</span>.equals(tokenType) &amp;&amp; !isTokenExpired(token);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ... å…¶ä»–è¾…åŠ©æ–¹æ³•</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="4-2-JWTé…ç½®ç±»"><a href="#4-2-JWTé…ç½®ç±»" class="headerlink" title="4.2 JWTé…ç½®ç±»"></a>4.2 JWTé…ç½®ç±»</h3><p>åˆ›å»ºé…ç½®ç±»ç®¡ç†JWTå‚æ•°ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@ConfigurationProperties(prefix = &quot;jwt&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">JwtConfig</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="type">String</span> <span class="variable">secret</span> <span class="operator">=</span> <span class="string">&quot;surveymaster-jwt-secret-key-for-authentication-very-secure&quot;</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">Long</span> <span class="variable">accessTokenExpiration</span> <span class="operator">=</span> <span class="number">7200000L</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">Long</span> <span class="variable">refreshTokenExpiration</span> <span class="operator">=</span> <span class="number">604800000L</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">String</span> <span class="variable">tokenHeader</span> <span class="operator">=</span> <span class="string">&quot;Authorization&quot;</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">String</span> <span class="variable">tokenPrefix</span> <span class="operator">=</span> <span class="string">&quot;Bearer &quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// getters and setters...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="4-3-JWTæ‹¦æˆªå™¨"><a href="#4-3-JWTæ‹¦æˆªå™¨" class="headerlink" title="4.3 JWTæ‹¦æˆªå™¨"></a>4.3 JWTæ‹¦æˆªå™¨</h3><p>å®ç°è‡ªåŠ¨éªŒè¯Tokençš„æ‹¦æˆªå™¨ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">JwtInterceptor</span> <span class="keyword">implements</span> <span class="title class_">HandlerInterceptor</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> JwtUtil jwtUtil;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> JwtConfig jwtConfig;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> ObjectMapper objectMapper;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">JwtInterceptor</span><span class="params">(JwtUtil jwtUtil, JwtConfig jwtConfig, ObjectMapper objectMapper)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.jwtUtil = jwtUtil;</span><br><span class="line">        <span class="built_in">this</span>.jwtConfig = jwtConfig;</span><br><span class="line">        <span class="built_in">this</span>.objectMapper = objectMapper;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">preHandle</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="comment">// è·å–è¯·æ±‚å¤´ä¸­çš„token</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">token</span> <span class="operator">=</span> getTokenFromRequest(request);</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> (!StringUtils.hasText(token)) &#123;</span><br><span class="line">            <span class="keyword">return</span> handleUnauthorized(response, <span class="string">&quot;ç¼ºå°‘è®¤è¯token&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// éªŒè¯tokenæ˜¯å¦ä¸ºæœ‰æ•ˆçš„è®¿é—®ä»¤ç‰Œ</span></span><br><span class="line">            <span class="keyword">if</span> (!jwtUtil.validateAccessToken(token)) &#123;</span><br><span class="line">                <span class="keyword">return</span> handleUnauthorized(response, <span class="string">&quot;æ— æ•ˆçš„è®¿é—®ä»¤ç‰Œ&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// ä»tokenä¸­è·å–ç”¨æˆ·ä¿¡æ¯å¹¶è®¾ç½®åˆ°è¯·æ±‚å±æ€§ä¸­</span></span><br><span class="line">            <span class="type">String</span> <span class="variable">username</span> <span class="operator">=</span> jwtUtil.getUsernameFromToken(token);</span><br><span class="line">            <span class="type">Long</span> <span class="variable">userId</span> <span class="operator">=</span> jwtUtil.getUserIdFromToken(token);</span><br><span class="line">            </span><br><span class="line">            request.setAttribute(<span class="string">&quot;currentUsername&quot;</span>, username);</span><br><span class="line">            request.setAttribute(<span class="string">&quot;currentUserId&quot;</span>, userId);</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            <span class="keyword">return</span> handleUnauthorized(response, <span class="string">&quot;tokenéªŒè¯å¤±è´¥ï¼š&quot;</span> + e.getMessage());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ä»è¯·æ±‚ä¸­è·å–token</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String <span class="title function_">getTokenFromRequest</span><span class="params">(HttpServletRequest request)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">bearerToken</span> <span class="operator">=</span> request.getHeader(jwtConfig.getTokenHeader());</span><br><span class="line">        <span class="keyword">if</span> (StringUtils.hasText(bearerToken) &amp;&amp; bearerToken.startsWith(jwtConfig.getTokenPrefix())) &#123;</span><br><span class="line">            <span class="keyword">return</span> bearerToken.substring(jwtConfig.getTokenPrefix().length());</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å¤„ç†æœªæˆæƒçš„è¯·æ±‚</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">boolean</span> <span class="title function_">handleUnauthorized</span><span class="params">(HttpServletResponse response, String message)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        response.setStatus(HttpServletResponse.SC_UNAUTHORIZED);</span><br><span class="line">        response.setContentType(<span class="string">&quot;application/json;charset=UTF-8&quot;</span>);</span><br><span class="line">        </span><br><span class="line">        ApiResponse&lt;Object&gt; apiResponse = ApiResponse.error(ErrorCode.UNAUTHORIZED, message);</span><br><span class="line">        <span class="type">String</span> <span class="variable">jsonResponse</span> <span class="operator">=</span> objectMapper.writeValueAsString(apiResponse);</span><br><span class="line">        </span><br><span class="line">        response.getWriter().write(jsonResponse);</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="4-4-Webé…ç½®ç±»"><a href="#4-4-Webé…ç½®ç±»" class="headerlink" title="4.4 Webé…ç½®ç±»"></a>4.4 Webé…ç½®ç±»</h3><p>æ³¨å†ŒJWTæ‹¦æˆªå™¨ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">WebMvcConfig</span> <span class="keyword">implements</span> <span class="title class_">WebMvcConfigurer</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> JwtInterceptor jwtInterceptor;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">WebMvcConfig</span><span class="params">(JwtInterceptor jwtInterceptor)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.jwtInterceptor = jwtInterceptor;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addInterceptors</span><span class="params">(InterceptorRegistry registry)</span> &#123;</span><br><span class="line">        registry.addInterceptor(jwtInterceptor)</span><br><span class="line">                .addPathPatterns(<span class="string">&quot;/api/**&quot;</span>)                    <span class="comment">// æ‹¦æˆªæ‰€æœ‰APIè·¯å¾„</span></span><br><span class="line">                .excludePathPatterns(</span><br><span class="line">                        <span class="string">&quot;/api/user/login&quot;</span>,                     <span class="comment">// æ’é™¤ç™»å½•æ¥å£</span></span><br><span class="line">                        <span class="string">&quot;/api/user/register&quot;</span>,                  <span class="comment">// æ’é™¤æ³¨å†Œæ¥å£</span></span><br><span class="line">                        <span class="string">&quot;/api/user/refresh-token&quot;</span>,            <span class="comment">// æ’é™¤åˆ·æ–°tokenæ¥å£</span></span><br><span class="line">                        <span class="string">&quot;/api/health/**&quot;</span>,                     <span class="comment">// æ’é™¤å¥åº·æ£€æŸ¥æ¥å£</span></span><br><span class="line">                        <span class="string">&quot;/api/public/**&quot;</span>                      <span class="comment">// æ’é™¤å…¬å…±æ¥å£</span></span><br><span class="line">                );</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="5-å®‰å…¨é…ç½®"><a href="#5-å®‰å…¨é…ç½®" class="headerlink" title="5. å®‰å…¨é…ç½®"></a>5. å®‰å…¨é…ç½®</h2><h3 id="5-1-ç™»å½•å“åº”å¯¹è±¡"><a href="#5-1-ç™»å½•å“åº”å¯¹è±¡" class="headerlink" title="5.1 ç™»å½•å“åº”å¯¹è±¡"></a>5.1 ç™»å½•å“åº”å¯¹è±¡</h3><p>è®¾è®¡åŒ…å«Tokenä¿¡æ¯çš„å“åº”å¯¹è±¡ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LoginResponse</span> &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ç”¨æˆ·ä¿¡æ¯</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> User user;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è®¿é—®ä»¤ç‰Œ</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String accessToken;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * åˆ·æ–°ä»¤ç‰Œ</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String refreshToken;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è®¿é—®ä»¤ç‰Œç±»å‹</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">String</span> <span class="variable">tokenType</span> <span class="operator">=</span> <span class="string">&quot;Bearer&quot;</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è®¿é—®ä»¤ç‰Œè¿‡æœŸæ—¶é—´ï¼ˆæ¯«ç§’æ—¶é—´æˆ³ï¼‰</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> Long expiresIn;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">LoginResponse</span><span class="params">()</span> &#123;&#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">LoginResponse</span><span class="params">(User user, String accessToken, String refreshToken, Long expiresIn)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.user = user;</span><br><span class="line">        <span class="built_in">this</span>.accessToken = accessToken;</span><br><span class="line">        <span class="built_in">this</span>.refreshToken = refreshToken;</span><br><span class="line">        <span class="built_in">this</span>.expiresIn = expiresIn;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="5-2-ç”¨æˆ·æœåŠ¡å®ç°"><a href="#5-2-ç”¨æˆ·æœåŠ¡å®ç°" class="headerlink" title="5.2 ç”¨æˆ·æœåŠ¡å®ç°"></a>5.2 ç”¨æˆ·æœåŠ¡å®ç°</h3><p>å®ç°åŒ…å«JWTåŠŸèƒ½çš„ç”¨æˆ·æœåŠ¡ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">UserService</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> UserMapper userMapper;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> JwtUtil jwtUtil;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> JwtConfig jwtConfig;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">UserServiceImpl</span><span class="params">(UserMapper userMapper, JwtUtil jwtUtil, JwtConfig jwtConfig)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.userMapper = userMapper;</span><br><span class="line">        <span class="built_in">this</span>.jwtUtil = jwtUtil;</span><br><span class="line">        <span class="built_in">this</span>.jwtConfig = jwtConfig;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> LoginResponse <span class="title function_">login</span><span class="params">(String username, String password)</span> &#123;</span><br><span class="line">        <span class="comment">// 1. éªŒè¯ç”¨æˆ·å‡­æ®</span></span><br><span class="line">        <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> userMapper.selectByUsernameAndPassword(username, MD5Util.md5(password));</span><br><span class="line">        <span class="keyword">if</span> (user == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">BusinessException</span>(ErrorCode.USER_PASSWORD_ERROR);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 2. ç”ŸæˆJWT token</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">accessToken</span> <span class="operator">=</span> jwtUtil.generateAccessToken((<span class="type">long</span>) user.getId(), user.getUsername());</span><br><span class="line">        <span class="type">String</span> <span class="variable">refreshToken</span> <span class="operator">=</span> jwtUtil.generateRefreshToken((<span class="type">long</span>) user.getId(), user.getUsername());</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 3. è¿”å›ç™»å½•å“åº”ä¿¡æ¯</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">LoginResponse</span>(user, accessToken, refreshToken, jwtConfig.getAccessTokenExpiration());</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> LoginResponse <span class="title function_">refreshAccessToken</span><span class="params">(String refreshToken)</span> &#123;</span><br><span class="line">        <span class="comment">// 1. éªŒè¯åˆ·æ–°ä»¤ç‰Œçš„æœ‰æ•ˆæ€§</span></span><br><span class="line">        <span class="keyword">if</span> (!jwtUtil.validateRefreshToken(refreshToken)) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">BusinessException</span>(ErrorCode.TOKEN_INVALID);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// 2. ä»åˆ·æ–°ä»¤ç‰Œä¸­è·å–ç”¨æˆ·ä¿¡æ¯</span></span><br><span class="line">            <span class="type">String</span> <span class="variable">username</span> <span class="operator">=</span> jwtUtil.getUsernameFromToken(refreshToken);</span><br><span class="line">            <span class="type">Long</span> <span class="variable">userId</span> <span class="operator">=</span> jwtUtil.getUserIdFromToken(refreshToken);</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// 3. ç”Ÿæˆæ–°çš„è®¿é—®ä»¤ç‰Œå’Œåˆ·æ–°ä»¤ç‰Œ</span></span><br><span class="line">            <span class="type">String</span> <span class="variable">newAccessToken</span> <span class="operator">=</span> jwtUtil.generateAccessToken(userId, username);</span><br><span class="line">            <span class="type">String</span> <span class="variable">newRefreshToken</span> <span class="operator">=</span> jwtUtil.generateRefreshToken(userId, username);</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// 4. æŸ¥æ‰¾ç”¨æˆ·ä¿¡æ¯</span></span><br><span class="line">            <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> userMapper.selectByUsername(username);</span><br><span class="line">            <span class="keyword">if</span> (user == <span class="literal">null</span>) &#123;</span><br><span class="line">                <span class="comment">// å¦‚æœæŸ¥ä¸åˆ°ç”¨æˆ·ï¼Œåˆ›å»ºä¸€ä¸ªç®€å•çš„ç”¨æˆ·å¯¹è±¡ç”¨äºå“åº”</span></span><br><span class="line">                user = <span class="keyword">new</span> <span class="title class_">User</span>();</span><br><span class="line">                user.setId(userId.intValue());</span><br><span class="line">                user.setUsername(username);</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// 5. è¿”å›æ–°çš„ç™»å½•å“åº”</span></span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">LoginResponse</span>(user, newAccessToken, newRefreshToken, jwtConfig.getAccessTokenExpiration());</span><br><span class="line">            </span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">BusinessException</span>(ErrorCode.TOKEN_INVALID);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="6-APIæ¥å£å®ç°"><a href="#6-APIæ¥å£å®ç°" class="headerlink" title="6. APIæ¥å£å®ç°"></a>6. APIæ¥å£å®ç°</h2><h3 id="6-1-ç”¨æˆ·æ§åˆ¶å™¨"><a href="#6-1-ç”¨æˆ·æ§åˆ¶å™¨" class="headerlink" title="6.1 ç”¨æˆ·æ§åˆ¶å™¨"></a>6.1 ç”¨æˆ·æ§åˆ¶å™¨</h3><p>å®ç°JWTç›¸å…³çš„APIæ¥å£ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/api/user&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> UserService userService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">UserController</span><span class="params">(UserService userService)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.userService = userService;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ç”¨æˆ·ç™»å½•</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@PostMapping(&quot;/login&quot;)</span></span><br><span class="line">    <span class="meta">@LogBusiness(&quot;ç”¨æˆ·ç™»å½•&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> ApiResponse&lt;LoginResponse&gt; <span class="title function_">login</span><span class="params">(<span class="meta">@Valid</span> <span class="meta">@RequestBody</span> UserLogin userLogin)</span> &#123;</span><br><span class="line">        <span class="type">LoginResponse</span> <span class="variable">loginResponse</span> <span class="operator">=</span> userService.login(userLogin.getUsername(), userLogin.getPassword());</span><br><span class="line">        <span class="keyword">return</span> ApiResponse.success(<span class="string">&quot;ç™»å½•æˆåŠŸ&quot;</span>, loginResponse);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * åˆ·æ–°è®¿é—®ä»¤ç‰Œ</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@PostMapping(&quot;/refresh-token&quot;)</span></span><br><span class="line">    <span class="meta">@LogBusiness(&quot;åˆ·æ–°ä»¤ç‰Œ&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> ApiResponse&lt;LoginResponse&gt; <span class="title function_">refreshToken</span><span class="params">(<span class="meta">@RequestParam(&quot;refreshToken&quot;)</span> String refreshToken)</span> &#123;</span><br><span class="line">        <span class="type">LoginResponse</span> <span class="variable">loginResponse</span> <span class="operator">=</span> userService.refreshAccessToken(refreshToken);</span><br><span class="line">        <span class="keyword">return</span> ApiResponse.success(<span class="string">&quot;ä»¤ç‰Œåˆ·æ–°æˆåŠŸ&quot;</span>, loginResponse);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ç”¨æˆ·æ³¨å†Œ</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@PostMapping(&quot;/register&quot;)</span></span><br><span class="line">    <span class="meta">@LogBusiness(&quot;ç”¨æˆ·æ³¨å†Œ&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> ApiResponse&lt;String&gt; <span class="title function_">register</span><span class="params">(<span class="meta">@Valid</span> <span class="meta">@RequestBody</span> UserRegister userRegister)</span> &#123;</span><br><span class="line">        userService.register(userRegister);</span><br><span class="line">        <span class="keyword">return</span> ApiResponse.success(<span class="string">&quot;æ³¨å†ŒæˆåŠŸ&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="6-2-æµ‹è¯•æ§åˆ¶å™¨"><a href="#6-2-æµ‹è¯•æ§åˆ¶å™¨" class="headerlink" title="6.2 æµ‹è¯•æ§åˆ¶å™¨"></a>6.2 æµ‹è¯•æ§åˆ¶å™¨</h3><p>åˆ›å»ºæµ‹è¯•JWTåŠŸèƒ½çš„æ§åˆ¶å™¨ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/api/jwt&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">JwtTestController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/protected&quot;)</span></span><br><span class="line">    <span class="meta">@LogBusiness(&quot;è®¿é—®å—ä¿æŠ¤èµ„æº&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> ApiResponse&lt;String&gt; <span class="title function_">protectedEndpoint</span><span class="params">(HttpServletRequest request)</span> &#123;</span><br><span class="line">        <span class="comment">// ä»è¯·æ±‚å±æ€§ä¸­è·å–å½“å‰ç”¨æˆ·ä¿¡æ¯ï¼ˆç”±JWTæ‹¦æˆªå™¨è®¾ç½®ï¼‰</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">currentUsername</span> <span class="operator">=</span> (String) request.getAttribute(<span class="string">&quot;currentUsername&quot;</span>);</span><br><span class="line">        <span class="type">Long</span> <span class="variable">currentUserId</span> <span class="operator">=</span> (Long) request.getAttribute(<span class="string">&quot;currentUserId&quot;</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="type">String</span> <span class="variable">message</span> <span class="operator">=</span> String.format(<span class="string">&quot;æ¬¢è¿ï¼Œ%s (ç”¨æˆ·ID: %d)ï¼è¿™æ˜¯ä¸€ä¸ªå—JWTä¿æŠ¤çš„èµ„æºã€‚&quot;</span>, </span><br><span class="line">                                      currentUsername, currentUserId);</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> ApiResponse.success(<span class="string">&quot;è®¿é—®æˆåŠŸ&quot;</span>, message);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/user-info&quot;)</span></span><br><span class="line">    <span class="meta">@LogBusiness(&quot;è·å–å½“å‰ç”¨æˆ·ä¿¡æ¯&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> ApiResponse&lt;Object&gt; <span class="title function_">getCurrentUserInfo</span><span class="params">(HttpServletRequest request)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">currentUsername</span> <span class="operator">=</span> (String) request.getAttribute(<span class="string">&quot;currentUsername&quot;</span>);</span><br><span class="line">        <span class="type">Long</span> <span class="variable">currentUserId</span> <span class="operator">=</span> (Long) request.getAttribute(<span class="string">&quot;currentUserId&quot;</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="type">Object</span> <span class="variable">userInfo</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Object</span>() &#123;</span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">username</span> <span class="operator">=</span> currentUsername;</span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">final</span> <span class="type">Long</span> <span class="variable">userId</span> <span class="operator">=</span> currentUserId;</span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">message</span> <span class="operator">=</span> <span class="string">&quot;é€šè¿‡JWTè®¤è¯è·å–çš„ç”¨æˆ·ä¿¡æ¯&quot;</span>;</span><br><span class="line">        &#125;;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> ApiResponse.success(<span class="string">&quot;è·å–ç”¨æˆ·ä¿¡æ¯æˆåŠŸ&quot;</span>, userInfo);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="7-å®¢æˆ·ç«¯ä½¿ç”¨"><a href="#7-å®¢æˆ·ç«¯ä½¿ç”¨" class="headerlink" title="7. å®¢æˆ·ç«¯ä½¿ç”¨"></a>7. å®¢æˆ·ç«¯ä½¿ç”¨</h2><h3 id="7-1-ç™»å½•è·å–Token"><a href="#7-1-ç™»å½•è·å–Token" class="headerlink" title="7.1 ç™»å½•è·å–Token"></a>7.1 ç™»å½•è·å–Token</h3><p><strong>è¯·æ±‚ç¤ºä¾‹ï¼š</strong></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">curl -X POST http://localhost:8080/api/user/login \</span><br><span class="line">  -H <span class="string">&quot;Content-Type: application/json&quot;</span> \</span><br><span class="line">  -d <span class="string">&#x27;&#123;</span></span><br><span class="line"><span class="string">    &quot;username&quot;: &quot;admin&quot;,</span></span><br><span class="line"><span class="string">    &quot;password&quot;: &quot;123456&quot;</span></span><br><span class="line"><span class="string">  &#125;&#x27;</span></span><br></pre></td></tr></table></figure>

<p><strong>å“åº”ç¤ºä¾‹ï¼š</strong></p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;success&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;message&quot;</span><span class="punctuation">:</span> <span class="string">&quot;ç™»å½•æˆåŠŸ&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;data&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;user&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="number">1</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;username&quot;</span><span class="punctuation">:</span> <span class="string">&quot;admin&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;email&quot;</span><span class="punctuation">:</span> <span class="string">&quot;admin@example.com&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;createdAt&quot;</span><span class="punctuation">:</span> <span class="string">&quot;2025-09-22 10:30:00&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;accessToken&quot;</span><span class="punctuation">:</span> <span class="string">&quot;eyJhbGciOiJIUzI1NiJ9.eyJ1c2VySWQiOjEsInVzZXJuYW1lIjoidGVzdCIsInRva2VuVHlwZSI6ImFjY2VzcyIsInN1YiI6InRlc3QiLCJpYXQiOjE2OTU0MjcyMDAsImV4cCI6MTY5NTQzNDQwMH0.abc123...&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;refreshToken&quot;</span><span class="punctuation">:</span> <span class="string">&quot;eyJhbGciOiJIUzI1NiJ9.eyJ1c2VySWQiOjEsInVzZXJuYW1lIjoidGVzdCIsInRva2VuVHlwZSI6InJlZnJlc2giLCJzdWIiOiJ0ZXN0IiwiaWF0IjoxNjk1NDI3MjAwLCJleHAiOjE2OTYwMzIwMDB9.def456...&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;tokenType&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Bearer&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;expiresIn&quot;</span><span class="punctuation">:</span> <span class="number">7200000</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<h3 id="7-2-ä½¿ç”¨Tokenè®¿é—®å—ä¿æŠ¤API"><a href="#7-2-ä½¿ç”¨Tokenè®¿é—®å—ä¿æŠ¤API" class="headerlink" title="7.2 ä½¿ç”¨Tokenè®¿é—®å—ä¿æŠ¤API"></a>7.2 ä½¿ç”¨Tokenè®¿é—®å—ä¿æŠ¤API</h3><p><strong>è¯·æ±‚ç¤ºä¾‹ï¼š</strong></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">curl -X GET http://localhost:8080/api/jwt/protected \</span><br><span class="line">  -H <span class="string">&quot;Authorization: Bearer eyJhbGciOiJIUzI1NiJ9.eyJ1c2VySWQiOjEsInVzZXJuYW1lIjoidGVzdCIsInRva2VuVHlwZSI6ImFjY2VzcyIsInN1YiI6InRlc3QiLCJpYXQiOjE2OTU0MjcyMDAsImV4cCI6MTY5NTQzNDQwMH0.abc123...&quot;</span></span><br></pre></td></tr></table></figure>

<p><strong>æˆåŠŸå“åº”ï¼š</strong></p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;success&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;message&quot;</span><span class="punctuation">:</span> <span class="string">&quot;è®¿é—®æˆåŠŸ&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;data&quot;</span><span class="punctuation">:</span> <span class="string">&quot;æ¬¢è¿ï¼Œadmin (ç”¨æˆ·ID: 1)ï¼è¿™æ˜¯ä¸€ä¸ªå—JWTä¿æŠ¤çš„èµ„æºã€‚&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<p><strong>æœªæˆæƒå“åº”ï¼š</strong></p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;success&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;code&quot;</span><span class="punctuation">:</span> <span class="string">&quot;COMM-0201&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;message&quot;</span><span class="punctuation">:</span> <span class="string">&quot;ç¼ºå°‘è®¤è¯token&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;data&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">null</span></span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<h3 id="7-3-åˆ·æ–°Token"><a href="#7-3-åˆ·æ–°Token" class="headerlink" title="7.3 åˆ·æ–°Token"></a>7.3 åˆ·æ–°Token</h3><p><strong>è¯·æ±‚ç¤ºä¾‹ï¼š</strong></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">curl -X POST http://localhost:8080/api/user/refresh-token \</span><br><span class="line">  -H <span class="string">&quot;Content-Type: application/x-www-form-urlencoded&quot;</span> \</span><br><span class="line">  -d <span class="string">&quot;refreshToken=eyJhbGciOiJIUzI1NiJ9.eyJ1c2VySWQiOjEsInVzZXJuYW1lIjoidGVzdCIsInRva2VuVHlwZSI6InJlZnJlc2giLCJzdWIiOiJ0ZXN0IiwiaWF0IjoxNjk1NDI3MjAwLCJleHAiOjE2OTYwMzIwMDB9.def456...&quot;</span></span><br></pre></td></tr></table></figure>

<p><strong>æˆåŠŸå“åº”ï¼š</strong></p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;success&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;message&quot;</span><span class="punctuation">:</span> <span class="string">&quot;ä»¤ç‰Œåˆ·æ–°æˆåŠŸ&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;data&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;user&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="number">1</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;username&quot;</span><span class="punctuation">:</span> <span class="string">&quot;admin&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;accessToken&quot;</span><span class="punctuation">:</span> <span class="string">&quot;eyJhbGciOiJIUzI1NiJ9.new_access_token...&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;refreshToken&quot;</span><span class="punctuation">:</span> <span class="string">&quot;eyJhbGciOiJIUzI1NiJ9.new_refresh_token...&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;tokenType&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Bearer&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;expiresIn&quot;</span><span class="punctuation">:</span> <span class="number">7200000</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<h3 id="7-4-å‰ç«¯é›†æˆç¤ºä¾‹"><a href="#7-4-å‰ç«¯é›†æˆç¤ºä¾‹" class="headerlink" title="7.4 å‰ç«¯é›†æˆç¤ºä¾‹"></a>7.4 å‰ç«¯é›†æˆç¤ºä¾‹</h3><p><strong>JavaScript&#x2F;Vue.jsç¤ºä¾‹ï¼š</strong></p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// APIé…ç½®</span></span><br><span class="line"><span class="keyword">const</span> <span class="variable constant_">API_BASE_URL</span> = <span class="string">&#x27;http://localhost:8080/api&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Tokenç®¡ç†</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">TokenManager</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="title function_">setTokens</span>(<span class="params">accessToken, refreshToken</span>) &#123;</span><br><span class="line">        <span class="variable language_">localStorage</span>.<span class="title function_">setItem</span>(<span class="string">&#x27;accessToken&#x27;</span>, accessToken);</span><br><span class="line">        <span class="variable language_">localStorage</span>.<span class="title function_">setItem</span>(<span class="string">&#x27;refreshToken&#x27;</span>, refreshToken);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">static</span> <span class="title function_">getAccessToken</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">localStorage</span>.<span class="title function_">getItem</span>(<span class="string">&#x27;accessToken&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">static</span> <span class="title function_">getRefreshToken</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">localStorage</span>.<span class="title function_">getItem</span>(<span class="string">&#x27;refreshToken&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">static</span> <span class="title function_">clearTokens</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="variable language_">localStorage</span>.<span class="title function_">removeItem</span>(<span class="string">&#x27;accessToken&#x27;</span>);</span><br><span class="line">        <span class="variable language_">localStorage</span>.<span class="title function_">removeItem</span>(<span class="string">&#x27;refreshToken&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// HTTPè¯·æ±‚æ‹¦æˆªå™¨</span></span><br><span class="line">axios.<span class="property">interceptors</span>.<span class="property">request</span>.<span class="title function_">use</span>(<span class="function"><span class="params">config</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> token = <span class="title class_">TokenManager</span>.<span class="title function_">getAccessToken</span>();</span><br><span class="line">    <span class="keyword">if</span> (token) &#123;</span><br><span class="line">        config.<span class="property">headers</span>.<span class="property">Authorization</span> = <span class="string">`Bearer <span class="subst">$&#123;token&#125;</span>`</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> config;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// HTTPå“åº”æ‹¦æˆªå™¨</span></span><br><span class="line">axios.<span class="property">interceptors</span>.<span class="property">response</span>.<span class="title function_">use</span>(</span><br><span class="line">    <span class="function"><span class="params">response</span> =&gt;</span> response,</span><br><span class="line">    <span class="keyword">async</span> error =&gt; &#123;</span><br><span class="line">        <span class="keyword">if</span> (error.<span class="property">response</span>?.<span class="property">status</span> === <span class="number">401</span>) &#123;</span><br><span class="line">            <span class="comment">// Tokenè¿‡æœŸï¼Œå°è¯•åˆ·æ–°</span></span><br><span class="line">            <span class="keyword">const</span> refreshToken = <span class="title class_">TokenManager</span>.<span class="title function_">getRefreshToken</span>();</span><br><span class="line">            <span class="keyword">if</span> (refreshToken) &#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    <span class="keyword">const</span> response = <span class="keyword">await</span> axios.<span class="title function_">post</span>(<span class="string">`<span class="subst">$&#123;API_BASE_URL&#125;</span>/user/refresh-token`</span>, </span><br><span class="line">                        <span class="string">`refreshToken=<span class="subst">$&#123;refreshToken&#125;</span>`</span>, </span><br><span class="line">                        &#123; <span class="attr">headers</span>: &#123; <span class="string">&#x27;Content-Type&#x27;</span>: <span class="string">&#x27;application/x-www-form-urlencoded&#x27;</span> &#125;&#125;</span><br><span class="line">                    );</span><br><span class="line">                    </span><br><span class="line">                    <span class="keyword">const</span> &#123; accessToken, <span class="attr">refreshToken</span>: newRefreshToken &#125; = response.<span class="property">data</span>.<span class="property">data</span>;</span><br><span class="line">                    <span class="title class_">TokenManager</span>.<span class="title function_">setTokens</span>(accessToken, newRefreshToken);</span><br><span class="line">                    </span><br><span class="line">                    <span class="comment">// é‡è¯•åŸè¯·æ±‚</span></span><br><span class="line">                    error.<span class="property">config</span>.<span class="property">headers</span>.<span class="property">Authorization</span> = <span class="string">`Bearer <span class="subst">$&#123;accessToken&#125;</span>`</span>;</span><br><span class="line">                    <span class="keyword">return</span> axios.<span class="title function_">request</span>(error.<span class="property">config</span>);</span><br><span class="line">                &#125; <span class="keyword">catch</span> (refreshError) &#123;</span><br><span class="line">                    <span class="comment">// åˆ·æ–°å¤±è´¥ï¼Œè·³è½¬åˆ°ç™»å½•é¡µ</span></span><br><span class="line">                    <span class="title class_">TokenManager</span>.<span class="title function_">clearTokens</span>();</span><br><span class="line">                    <span class="variable language_">window</span>.<span class="property">location</span>.<span class="property">href</span> = <span class="string">&#x27;/login&#x27;</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="comment">// æ²¡æœ‰åˆ·æ–°Tokenï¼Œè·³è½¬åˆ°ç™»å½•é¡µ</span></span><br><span class="line">                <span class="variable language_">window</span>.<span class="property">location</span>.<span class="property">href</span> = <span class="string">&#x27;/login&#x27;</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="title class_">Promise</span>.<span class="title function_">reject</span>(error);</span><br><span class="line">    &#125;</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç™»å½•æ–¹æ³•</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">login</span>(<span class="params">username, password</span>) &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">const</span> response = <span class="keyword">await</span> axios.<span class="title function_">post</span>(<span class="string">`<span class="subst">$&#123;API_BASE_URL&#125;</span>/user/login`</span>, &#123;</span><br><span class="line">            username,</span><br><span class="line">            password</span><br><span class="line">        &#125;);</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">const</span> &#123; accessToken, refreshToken &#125; = response.<span class="property">data</span>.<span class="property">data</span>;</span><br><span class="line">        <span class="title class_">TokenManager</span>.<span class="title function_">setTokens</span>(accessToken, refreshToken);</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> response.<span class="property">data</span>;</span><br><span class="line">    &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">        <span class="keyword">throw</span> error;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// é€€å‡ºç™»å½•</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">logout</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="title class_">TokenManager</span>.<span class="title function_">clearTokens</span>();</span><br><span class="line">    <span class="variable language_">window</span>.<span class="property">location</span>.<span class="property">href</span> = <span class="string">&#x27;/login&#x27;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>Reactç¤ºä¾‹ï¼š</strong></p>
<figure class="highlight jsx"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; createContext, useContext, useState, useEffect &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> axios <span class="keyword">from</span> <span class="string">&#x27;axios&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// è®¤è¯ä¸Šä¸‹æ–‡</span></span><br><span class="line"><span class="keyword">const</span> <span class="title class_">AuthContext</span> = <span class="title function_">createContext</span>();</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title function_">useAuth</span> = (<span class="params"></span>) =&gt; <span class="title function_">useContext</span>(<span class="title class_">AuthContext</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title function_">AuthProvider</span> = (<span class="params">&#123; children &#125;</span>) =&gt; &#123;</span><br><span class="line">    <span class="keyword">const</span> [user, setUser] = <span class="title function_">useState</span>(<span class="literal">null</span>);</span><br><span class="line">    <span class="keyword">const</span> [loading, setLoading] = <span class="title function_">useState</span>(<span class="literal">true</span>);</span><br><span class="line"></span><br><span class="line">    <span class="title function_">useEffect</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">const</span> token = <span class="variable language_">localStorage</span>.<span class="title function_">getItem</span>(<span class="string">&#x27;accessToken&#x27;</span>);</span><br><span class="line">        <span class="keyword">if</span> (token) &#123;</span><br><span class="line">            <span class="comment">// éªŒè¯tokenæœ‰æ•ˆæ€§</span></span><br><span class="line">            <span class="title function_">validateToken</span>();</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="title function_">setLoading</span>(<span class="literal">false</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;, []);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> <span class="title function_">validateToken</span> = <span class="keyword">async</span> (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">const</span> response = <span class="keyword">await</span> axios.<span class="title function_">get</span>(<span class="string">&#x27;/api/jwt/user-info&#x27;</span>);</span><br><span class="line">            <span class="title function_">setUser</span>(response.<span class="property">data</span>.<span class="property">data</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">            <span class="variable language_">localStorage</span>.<span class="title function_">removeItem</span>(<span class="string">&#x27;accessToken&#x27;</span>);</span><br><span class="line">            <span class="variable language_">localStorage</span>.<span class="title function_">removeItem</span>(<span class="string">&#x27;refreshToken&#x27;</span>);</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            <span class="title function_">setLoading</span>(<span class="literal">false</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> <span class="title function_">login</span> = <span class="keyword">async</span> (<span class="params">username, password</span>) =&gt; &#123;</span><br><span class="line">        <span class="keyword">const</span> response = <span class="keyword">await</span> axios.<span class="title function_">post</span>(<span class="string">&#x27;/api/user/login&#x27;</span>, &#123;</span><br><span class="line">            username,</span><br><span class="line">            password</span><br><span class="line">        &#125;);</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">const</span> &#123; user, accessToken, refreshToken &#125; = response.<span class="property">data</span>.<span class="property">data</span>;</span><br><span class="line">        <span class="variable language_">localStorage</span>.<span class="title function_">setItem</span>(<span class="string">&#x27;accessToken&#x27;</span>, accessToken);</span><br><span class="line">        <span class="variable language_">localStorage</span>.<span class="title function_">setItem</span>(<span class="string">&#x27;refreshToken&#x27;</span>, refreshToken);</span><br><span class="line">        <span class="title function_">setUser</span>(user);</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> response.<span class="property">data</span>;</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> <span class="title function_">logout</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">        <span class="variable language_">localStorage</span>.<span class="title function_">removeItem</span>(<span class="string">&#x27;accessToken&#x27;</span>);</span><br><span class="line">        <span class="variable language_">localStorage</span>.<span class="title function_">removeItem</span>(<span class="string">&#x27;refreshToken&#x27;</span>);</span><br><span class="line">        <span class="title function_">setUser</span>(<span class="literal">null</span>);</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> value = &#123;</span><br><span class="line">        user,</span><br><span class="line">        login,</span><br><span class="line">        logout,</span><br><span class="line">        loading</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">        <span class="language-xml"><span class="tag">&lt;<span class="name">AuthContext.Provider</span> <span class="attr">value</span>=<span class="string">&#123;value&#125;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            &#123;children&#125;</span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">AuthContext.Provider</span>&gt;</span></span></span><br><span class="line">    );</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h2 id="8-æœ€ä½³å®è·µ"><a href="#8-æœ€ä½³å®è·µ" class="headerlink" title="8. æœ€ä½³å®è·µ"></a>8. æœ€ä½³å®è·µ</h2><h3 id="8-1-å®‰å…¨é…ç½®å»ºè®®"><a href="#8-1-å®‰å…¨é…ç½®å»ºè®®" class="headerlink" title="8.1 å®‰å…¨é…ç½®å»ºè®®"></a>8.1 å®‰å…¨é…ç½®å»ºè®®</h3><h4 id="å¯†é’¥ç®¡ç†"><a href="#å¯†é’¥ç®¡ç†" class="headerlink" title="å¯†é’¥ç®¡ç†"></a>å¯†é’¥ç®¡ç†</h4><figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="comment"># ç”Ÿäº§ç¯å¢ƒé…ç½®</span></span><br><span class="line"><span class="attr">jwt:</span></span><br><span class="line">  <span class="attr">secret:</span> <span class="string">$&#123;JWT_SECRET:your-very-secure-secret-key-here&#125;</span></span><br><span class="line">  <span class="attr">access-token-expiration:</span> <span class="string">$&#123;JWT_ACCESS_EXPIRATION:7200000&#125;</span></span><br><span class="line">  <span class="attr">refresh-token-expiration:</span> <span class="string">$&#123;JWT_REFRESH_EXPIRATION:604800000&#125;</span></span><br></pre></td></tr></table></figure>

<h4 id="å¯†é’¥è¦æ±‚"><a href="#å¯†é’¥è¦æ±‚" class="headerlink" title="å¯†é’¥è¦æ±‚"></a>å¯†é’¥è¦æ±‚</h4><ul>
<li><strong>é•¿åº¦</strong>ï¼šè‡³å°‘256ä½ï¼ˆ32å­—ç¬¦ï¼‰</li>
<li><strong>å¤æ‚æ€§</strong>ï¼šåŒ…å«å­—æ¯ã€æ•°å­—ã€ç‰¹æ®Šå­—ç¬¦</li>
<li><strong>å”¯ä¸€æ€§</strong>ï¼šæ¯ä¸ªç¯å¢ƒä½¿ç”¨ä¸åŒå¯†é’¥</li>
<li><strong>å®šæœŸæ›´æ¢</strong>ï¼šå»ºè®®æ¯å­£åº¦æ›´æ¢ä¸€æ¬¡</li>
</ul>
<h4 id="ç¯å¢ƒå˜é‡é…ç½®"><a href="#ç¯å¢ƒå˜é‡é…ç½®" class="headerlink" title="ç¯å¢ƒå˜é‡é…ç½®"></a>ç¯å¢ƒå˜é‡é…ç½®</h4><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># ç”Ÿäº§ç¯å¢ƒç¯å¢ƒå˜é‡</span></span><br><span class="line"><span class="built_in">export</span> JWT_SECRET=<span class="string">&quot;your-production-secret-key-very-secure-2025&quot;</span></span><br><span class="line"><span class="built_in">export</span> JWT_ACCESS_EXPIRATION=7200000</span><br><span class="line"><span class="built_in">export</span> JWT_REFRESH_EXPIRATION=604800000</span><br></pre></td></tr></table></figure>

<h3 id="8-2-Tokenè¿‡æœŸæ—¶é—´ç­–ç•¥"><a href="#8-2-Tokenè¿‡æœŸæ—¶é—´ç­–ç•¥" class="headerlink" title="8.2 Tokenè¿‡æœŸæ—¶é—´ç­–ç•¥"></a>8.2 Tokenè¿‡æœŸæ—¶é—´ç­–ç•¥</h3><table>
<thead>
<tr>
<th>åœºæ™¯</th>
<th>è®¿é—®ä»¤ç‰Œ</th>
<th>åˆ·æ–°ä»¤ç‰Œ</th>
<th>è¯´æ˜</th>
</tr>
</thead>
<tbody><tr>
<td><strong>Webåº”ç”¨</strong></td>
<td>2å°æ—¶</td>
<td>7å¤©</td>
<td>å¹³è¡¡å®‰å…¨æ€§å’Œç”¨æˆ·ä½“éªŒ</td>
</tr>
<tr>
<td><strong>ç§»åŠ¨åº”ç”¨</strong></td>
<td>4å°æ—¶</td>
<td>30å¤©</td>
<td>å‡å°‘ç”¨æˆ·ç™»å½•é¢‘ç‡</td>
</tr>
<tr>
<td><strong>APIæœåŠ¡</strong></td>
<td>1å°æ—¶</td>
<td>24å°æ—¶</td>
<td>é«˜å®‰å…¨è¦æ±‚</td>
</tr>
<tr>
<td><strong>å†…éƒ¨ç³»ç»Ÿ</strong></td>
<td>8å°æ—¶</td>
<td>7å¤©</td>
<td>åŠå…¬æ—¶é—´å†…å…ç™»å½•</td>
</tr>
</tbody></table>
<h3 id="8-3-é”™è¯¯å¤„ç†æœ€ä½³å®è·µ"><a href="#8-3-é”™è¯¯å¤„ç†æœ€ä½³å®è·µ" class="headerlink" title="8.3 é”™è¯¯å¤„ç†æœ€ä½³å®è·µ"></a>8.3 é”™è¯¯å¤„ç†æœ€ä½³å®è·µ</h3><h4 id="ç»Ÿä¸€é”™è¯¯ç "><a href="#ç»Ÿä¸€é”™è¯¯ç " class="headerlink" title="ç»Ÿä¸€é”™è¯¯ç "></a>ç»Ÿä¸€é”™è¯¯ç </h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">enum</span> <span class="title class_">JwtErrorCode</span> &#123;</span><br><span class="line">    TOKEN_MISSING(<span class="string">&quot;JWT001&quot;</span>, <span class="string">&quot;ç¼ºå°‘è®¤è¯ä»¤ç‰Œ&quot;</span>),</span><br><span class="line">    TOKEN_EXPIRED(<span class="string">&quot;JWT002&quot;</span>, <span class="string">&quot;ä»¤ç‰Œå·²è¿‡æœŸ&quot;</span>),</span><br><span class="line">    TOKEN_INVALID(<span class="string">&quot;JWT003&quot;</span>, <span class="string">&quot;æ— æ•ˆçš„ä»¤ç‰Œ&quot;</span>),</span><br><span class="line">    TOKEN_MALFORMED(<span class="string">&quot;JWT004&quot;</span>, <span class="string">&quot;ä»¤ç‰Œæ ¼å¼é”™è¯¯&quot;</span>),</span><br><span class="line">    ACCESS_DENIED(<span class="string">&quot;JWT005&quot;</span>, <span class="string">&quot;è®¿é—®è¢«æ‹’ç»&quot;</span>),</span><br><span class="line">    REFRESH_TOKEN_EXPIRED(<span class="string">&quot;JWT006&quot;</span>, <span class="string">&quot;åˆ·æ–°ä»¤ç‰Œå·²è¿‡æœŸ&quot;</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> String code;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> String message;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// constructor, getters...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="å¼‚å¸¸å¤„ç†å™¨"><a href="#å¼‚å¸¸å¤„ç†å™¨" class="headerlink" title="å¼‚å¸¸å¤„ç†å™¨"></a>å¼‚å¸¸å¤„ç†å™¨</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@ControllerAdvice</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">JwtExceptionHandler</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@ExceptionHandler(ExpiredJwtException.class)</span></span><br><span class="line">    <span class="keyword">public</span> ResponseEntity&lt;ApiResponse&lt;Object&gt;&gt; <span class="title function_">handleExpiredJwt</span><span class="params">(ExpiredJwtException e)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> ResponseEntity.status(HttpStatus.UNAUTHORIZED)</span><br><span class="line">                .body(ApiResponse.error(JwtErrorCode.TOKEN_EXPIRED));</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@ExceptionHandler(MalformedJwtException.class)</span></span><br><span class="line">    <span class="keyword">public</span> ResponseEntity&lt;ApiResponse&lt;Object&gt;&gt; <span class="title function_">handleMalformedJwt</span><span class="params">(MalformedJwtException e)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> ResponseEntity.status(HttpStatus.UNAUTHORIZED)</span><br><span class="line">                .body(ApiResponse.error(JwtErrorCode.TOKEN_MALFORMED));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="8-4-æ€§èƒ½ä¼˜åŒ–å»ºè®®"><a href="#8-4-æ€§èƒ½ä¼˜åŒ–å»ºè®®" class="headerlink" title="8.4 æ€§èƒ½ä¼˜åŒ–å»ºè®®"></a>8.4 æ€§èƒ½ä¼˜åŒ–å»ºè®®</h3><h4 id="ç¼“å­˜ç”¨æˆ·ä¿¡æ¯"><a href="#ç¼“å­˜ç”¨æˆ·ä¿¡æ¯" class="headerlink" title="ç¼“å­˜ç”¨æˆ·ä¿¡æ¯"></a>ç¼“å­˜ç”¨æˆ·ä¿¡æ¯</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserCacheService</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> RedisTemplate&lt;String, Object&gt; redisTemplate;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">USER_CACHE_KEY</span> <span class="operator">=</span> <span class="string">&quot;user:info:&quot;</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">Duration</span> <span class="variable">CACHE_DURATION</span> <span class="operator">=</span> Duration.ofMinutes(<span class="number">30</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> User <span class="title function_">getUserFromCache</span><span class="params">(Long userId)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">key</span> <span class="operator">=</span> USER_CACHE_KEY + userId;</span><br><span class="line">        <span class="keyword">return</span> (User) redisTemplate.opsForValue().get(key);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">cacheUser</span><span class="params">(User user)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">key</span> <span class="operator">=</span> USER_CACHE_KEY + user.getId();</span><br><span class="line">        redisTemplate.opsForValue().set(key, user, CACHE_DURATION);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="Tokené»‘åå•"><a href="#Tokené»‘åå•" class="headerlink" title="Tokené»‘åå•"></a>Tokené»‘åå•</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TokenBlacklistService</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> RedisTemplate&lt;String, String&gt; redisTemplate;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">BLACKLIST_KEY</span> <span class="operator">=</span> <span class="string">&quot;jwt:blacklist:&quot;</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addToBlacklist</span><span class="params">(String token, <span class="type">long</span> expiration)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">key</span> <span class="operator">=</span> BLACKLIST_KEY + DigestUtils.md5Hex(token);</span><br><span class="line">        redisTemplate.opsForValue().set(key, <span class="string">&quot;true&quot;</span>, </span><br><span class="line">                Duration.ofMillis(expiration - System.currentTimeMillis()));</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">isBlacklisted</span><span class="params">(String token)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">key</span> <span class="operator">=</span> BLACKLIST_KEY + DigestUtils.md5Hex(token);</span><br><span class="line">        <span class="keyword">return</span> redisTemplate.hasKey(key);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="8-5-ç›‘æ§å’Œæ—¥å¿—"><a href="#8-5-ç›‘æ§å’Œæ—¥å¿—" class="headerlink" title="8.5 ç›‘æ§å’Œæ—¥å¿—"></a>8.5 ç›‘æ§å’Œæ—¥å¿—</h3><h4 id="JWTç›‘æ§æŒ‡æ ‡"><a href="#JWTç›‘æ§æŒ‡æ ‡" class="headerlink" title="JWTç›‘æ§æŒ‡æ ‡"></a>JWTç›‘æ§æŒ‡æ ‡</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">JwtMetrics</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">Counter</span> <span class="variable">tokenGeneratedCounter</span> <span class="operator">=</span> Counter.builder(<span class="string">&quot;jwt.token.generated&quot;</span>)</span><br><span class="line">            .description(<span class="string">&quot;ç”Ÿæˆçš„JWTä»¤ç‰Œæ•°é‡&quot;</span>)</span><br><span class="line">            .register(Metrics.globalRegistry);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">Counter</span> <span class="variable">tokenValidatedCounter</span> <span class="operator">=</span> Counter.builder(<span class="string">&quot;jwt.token.validated&quot;</span>)</span><br><span class="line">            .description(<span class="string">&quot;éªŒè¯çš„JWTä»¤ç‰Œæ•°é‡&quot;</span>)</span><br><span class="line">            .tag(<span class="string">&quot;result&quot;</span>, <span class="string">&quot;success&quot;</span>)</span><br><span class="line">            .register(Metrics.globalRegistry);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">Timer</span> <span class="variable">tokenValidationTimer</span> <span class="operator">=</span> Timer.builder(<span class="string">&quot;jwt.token.validation.duration&quot;</span>)</span><br><span class="line">            .description(<span class="string">&quot;JWTä»¤ç‰ŒéªŒè¯è€—æ—¶&quot;</span>)</span><br><span class="line">            .register(Metrics.globalRegistry);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">recordTokenGenerated</span><span class="params">()</span> &#123;</span><br><span class="line">        tokenGeneratedCounter.increment();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">recordTokenValidation</span><span class="params">(<span class="type">boolean</span> success, Duration duration)</span> &#123;</span><br><span class="line">        tokenValidatedCounter.increment(Tags.of(<span class="string">&quot;result&quot;</span>, success ? <span class="string">&quot;success&quot;</span> : <span class="string">&quot;failure&quot;</span>));</span><br><span class="line">        tokenValidationTimer.record(duration);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="å®‰å…¨æ—¥å¿—"><a href="#å®‰å…¨æ—¥å¿—" class="headerlink" title="å®‰å…¨æ—¥å¿—"></a>å®‰å…¨æ—¥å¿—</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">JwtSecurityLogger</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">Logger</span> <span class="variable">securityLogger</span> <span class="operator">=</span> LoggerFactory.getLogger(<span class="string">&quot;SECURITY&quot;</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">logTokenGenerated</span><span class="params">(String username, String clientIp)</span> &#123;</span><br><span class="line">        securityLogger.info(<span class="string">&quot;JWTä»¤ç‰Œç”Ÿæˆ - ç”¨æˆ·: &#123;&#125;, IP: &#123;&#125;, æ—¶é—´: &#123;&#125;&quot;</span>, </span><br><span class="line">                username, clientIp, LocalDateTime.now());</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">logTokenValidationFailure</span><span class="params">(String token, String reason, String clientIp)</span> &#123;</span><br><span class="line">        securityLogger.warn(<span class="string">&quot;JWTä»¤ç‰ŒéªŒè¯å¤±è´¥ - Token: &#123;&#125;, åŸå› : &#123;&#125;, IP: &#123;&#125;, æ—¶é—´: &#123;&#125;&quot;</span>, </span><br><span class="line">                maskToken(token), reason, clientIp, LocalDateTime.now());</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> String <span class="title function_">maskToken</span><span class="params">(String token)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (token == <span class="literal">null</span> || token.length() &lt; <span class="number">20</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;[INVALID_TOKEN]&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> token.substring(<span class="number">0</span>, <span class="number">10</span>) + <span class="string">&quot;***&quot;</span> + token.substring(token.length() - <span class="number">10</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="9-å¸¸è§é—®é¢˜"><a href="#9-å¸¸è§é—®é¢˜" class="headerlink" title="9. å¸¸è§é—®é¢˜"></a>9. å¸¸è§é—®é¢˜</h2><h3 id="9-1-Tokenç›¸å…³é—®é¢˜"><a href="#9-1-Tokenç›¸å…³é—®é¢˜" class="headerlink" title="9.1 Tokenç›¸å…³é—®é¢˜"></a>9.1 Tokenç›¸å…³é—®é¢˜</h3><h4 id="Q1-Tokenè¿‡æœŸåå¦‚ä½•å¤„ç†ï¼Ÿ"><a href="#Q1-Tokenè¿‡æœŸåå¦‚ä½•å¤„ç†ï¼Ÿ" class="headerlink" title="Q1: Tokenè¿‡æœŸåå¦‚ä½•å¤„ç†ï¼Ÿ"></a>Q1: Tokenè¿‡æœŸåå¦‚ä½•å¤„ç†ï¼Ÿ</h4><p><strong>A</strong>: å®ç°è‡ªåŠ¨åˆ·æ–°æœºåˆ¶ï¼š</p>
<ol>
<li>å‰ç«¯æ‹¦æˆª401å“åº”</li>
<li>ä½¿ç”¨refresh tokenè·å–æ–°çš„access token</li>
<li>é‡è¯•åŸè¯·æ±‚</li>
<li>å¦‚æœrefresh tokenä¹Ÿè¿‡æœŸï¼Œè·³è½¬ç™»å½•é¡µ</li>
</ol>
<h4 id="Q2-å¦‚ä½•å®ç°å•ç‚¹ç™»å½•ï¼ˆSSOï¼‰ï¼Ÿ"><a href="#Q2-å¦‚ä½•å®ç°å•ç‚¹ç™»å½•ï¼ˆSSOï¼‰ï¼Ÿ" class="headerlink" title="Q2: å¦‚ä½•å®ç°å•ç‚¹ç™»å½•ï¼ˆSSOï¼‰ï¼Ÿ"></a>Q2: å¦‚ä½•å®ç°å•ç‚¹ç™»å½•ï¼ˆSSOï¼‰ï¼Ÿ</h4><p><strong>A</strong>: </p>
<ol>
<li>ä½¿ç”¨ç»Ÿä¸€çš„JWTç­¾åå¯†é’¥</li>
<li>åœ¨å¤šä¸ªåº”ç”¨é—´å…±äº«ç”¨æˆ·ä¿¡æ¯</li>
<li>å®ç°ç»Ÿä¸€çš„è®¤è¯ä¸­å¿ƒ</li>
<li>é…ç½®è·¨åŸŸæ”¯æŒ</li>
</ol>
<h4 id="Q3-å¦‚ä½•å®ç°å¼ºåˆ¶ä¸‹çº¿ï¼Ÿ"><a href="#Q3-å¦‚ä½•å®ç°å¼ºåˆ¶ä¸‹çº¿ï¼Ÿ" class="headerlink" title="Q3: å¦‚ä½•å®ç°å¼ºåˆ¶ä¸‹çº¿ï¼Ÿ"></a>Q3: å¦‚ä½•å®ç°å¼ºåˆ¶ä¸‹çº¿ï¼Ÿ</h4><p><strong>A</strong>:</p>
<ol>
<li>ç»´æŠ¤Tokené»‘åå•ï¼ˆRedisï¼‰</li>
<li>åœ¨éªŒè¯Tokenæ—¶æ£€æŸ¥é»‘åå•</li>
<li>ç®¡ç†å‘˜å¯ä»¥å°†ç‰¹å®šTokenåŠ å…¥é»‘åå•</li>
</ol>
<h3 id="9-2-å®‰å…¨é—®é¢˜"><a href="#9-2-å®‰å…¨é—®é¢˜" class="headerlink" title="9.2 å®‰å…¨é—®é¢˜"></a>9.2 å®‰å…¨é—®é¢˜</h3><h4 id="Q1-JWTè¢«ç›—ç”¨æ€ä¹ˆåŠï¼Ÿ"><a href="#Q1-JWTè¢«ç›—ç”¨æ€ä¹ˆåŠï¼Ÿ" class="headerlink" title="Q1: JWTè¢«ç›—ç”¨æ€ä¹ˆåŠï¼Ÿ"></a>Q1: JWTè¢«ç›—ç”¨æ€ä¹ˆåŠï¼Ÿ</h4><p><strong>A</strong>: å¤šå±‚é˜²æŠ¤ï¼š</p>
<ol>
<li>ä½¿ç”¨HTTPSä¼ è¾“</li>
<li>è®¾ç½®åˆç†çš„è¿‡æœŸæ—¶é—´</li>
<li>å®ç°Tokené»‘åå•æœºåˆ¶</li>
<li>ç›‘æ§å¼‚å¸¸ç™»å½•è¡Œä¸º</li>
<li>ç»‘å®šè®¾å¤‡æŒ‡çº¹</li>
</ol>
<h4 id="Q2-å¦‚ä½•é˜²æ­¢CSRFæ”»å‡»ï¼Ÿ"><a href="#Q2-å¦‚ä½•é˜²æ­¢CSRFæ”»å‡»ï¼Ÿ" class="headerlink" title="Q2: å¦‚ä½•é˜²æ­¢CSRFæ”»å‡»ï¼Ÿ"></a>Q2: å¦‚ä½•é˜²æ­¢CSRFæ”»å‡»ï¼Ÿ</h4><p><strong>A</strong>:</p>
<ol>
<li>JWTå­˜å‚¨åœ¨localStorageè€ŒéCookie</li>
<li>ä½¿ç”¨è‡ªå®šä¹‰è¯·æ±‚å¤´ä¼ é€’Token</li>
<li>éªŒè¯è¯·æ±‚æ¥æº</li>
<li>å®ç°åŒTokenéªŒè¯</li>
</ol>
<h4 id="Q3-å¯†é’¥æ³„éœ²å¦‚ä½•åº”å¯¹ï¼Ÿ"><a href="#Q3-å¯†é’¥æ³„éœ²å¦‚ä½•åº”å¯¹ï¼Ÿ" class="headerlink" title="Q3: å¯†é’¥æ³„éœ²å¦‚ä½•åº”å¯¹ï¼Ÿ"></a>Q3: å¯†é’¥æ³„éœ²å¦‚ä½•åº”å¯¹ï¼Ÿ</h4><p><strong>A</strong>:</p>
<ol>
<li>ç«‹å³æ›´æ¢å¯†é’¥</li>
<li>ä½¿æ‰€æœ‰ç°æœ‰Tokenå¤±æ•ˆ</li>
<li>å¼ºåˆ¶ç”¨æˆ·é‡æ–°ç™»å½•</li>
<li>å®¡è®¡ç›¸å…³è®¿é—®æ—¥å¿—</li>
</ol>
<h3 id="9-3-æ€§èƒ½é—®é¢˜"><a href="#9-3-æ€§èƒ½é—®é¢˜" class="headerlink" title="9.3 æ€§èƒ½é—®é¢˜"></a>9.3 æ€§èƒ½é—®é¢˜</h3><h4 id="Q1-JWTéªŒè¯æ€§èƒ½å¦‚ä½•ä¼˜åŒ–ï¼Ÿ"><a href="#Q1-JWTéªŒè¯æ€§èƒ½å¦‚ä½•ä¼˜åŒ–ï¼Ÿ" class="headerlink" title="Q1: JWTéªŒè¯æ€§èƒ½å¦‚ä½•ä¼˜åŒ–ï¼Ÿ"></a>Q1: JWTéªŒè¯æ€§èƒ½å¦‚ä½•ä¼˜åŒ–ï¼Ÿ</h4><p><strong>A</strong>:</p>
<ol>
<li>ç¼“å­˜ç”¨æˆ·ä¿¡æ¯å‡å°‘æ•°æ®åº“æŸ¥è¯¢</li>
<li>ä½¿ç”¨å¼‚æ­¥éªŒè¯</li>
<li>åˆç†è®¾ç½®Tokenè¿‡æœŸæ—¶é—´</li>
<li>ä½¿ç”¨æ›´é«˜æ•ˆçš„åŠ å¯†ç®—æ³•</li>
</ol>
<h4 id="Q2-å¤§é‡å¹¶å‘æ—¶å¦‚ä½•å¤„ç†ï¼Ÿ"><a href="#Q2-å¤§é‡å¹¶å‘æ—¶å¦‚ä½•å¤„ç†ï¼Ÿ" class="headerlink" title="Q2: å¤§é‡å¹¶å‘æ—¶å¦‚ä½•å¤„ç†ï¼Ÿ"></a>Q2: å¤§é‡å¹¶å‘æ—¶å¦‚ä½•å¤„ç†ï¼Ÿ</h4><p><strong>A</strong>:</p>
<ol>
<li>ä½¿ç”¨è¿æ¥æ± </li>
<li>å®ç°é™æµæœºåˆ¶</li>
<li>ç¼“å­˜çƒ­ç‚¹æ•°æ®</li>
<li>ä½¿ç”¨è´Ÿè½½å‡è¡¡</li>
</ol>
<h3 id="9-4-éƒ¨ç½²é—®é¢˜"><a href="#9-4-éƒ¨ç½²é—®é¢˜" class="headerlink" title="9.4 éƒ¨ç½²é—®é¢˜"></a>9.4 éƒ¨ç½²é—®é¢˜</h3><h4 id="Q1-å¤šå®ä¾‹éƒ¨ç½²æ³¨æ„äº‹é¡¹ï¼Ÿ"><a href="#Q1-å¤šå®ä¾‹éƒ¨ç½²æ³¨æ„äº‹é¡¹ï¼Ÿ" class="headerlink" title="Q1: å¤šå®ä¾‹éƒ¨ç½²æ³¨æ„äº‹é¡¹ï¼Ÿ"></a>Q1: å¤šå®ä¾‹éƒ¨ç½²æ³¨æ„äº‹é¡¹ï¼Ÿ</h4><p><strong>A</strong>:</p>
<ol>
<li>ä½¿ç”¨ç›¸åŒçš„JWTå¯†é’¥</li>
<li>å…±äº«Redisç¼“å­˜</li>
<li>åŒæ­¥æ—¶é’Ÿ</li>
<li>ç»Ÿä¸€é…ç½®ç®¡ç†</li>
</ol>
<h4 id="Q2-å®¹å™¨åŒ–éƒ¨ç½²é…ç½®ï¼Ÿ"><a href="#Q2-å®¹å™¨åŒ–éƒ¨ç½²é…ç½®ï¼Ÿ" class="headerlink" title="Q2: å®¹å™¨åŒ–éƒ¨ç½²é…ç½®ï¼Ÿ"></a>Q2: å®¹å™¨åŒ–éƒ¨ç½²é…ç½®ï¼Ÿ</h4><p><strong>A</strong>:</p>
<figure class="highlight dockerfile"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Dockerfile</span></span><br><span class="line"><span class="keyword">FROM</span> openjdk:<span class="number">8</span>-jre-alpine</span><br><span class="line"></span><br><span class="line"><span class="comment"># è®¾ç½®JWTç¯å¢ƒå˜é‡</span></span><br><span class="line"><span class="keyword">ENV</span> JWT_SECRET=$&#123;JWT_SECRET&#125;</span><br><span class="line"><span class="keyword">ENV</span> JWT_ACCESS_EXPIRATION=$&#123;JWT_ACCESS_EXPIRATION&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">COPY</span><span class="language-bash"> target/app.jar app.jar</span></span><br><span class="line"><span class="keyword">EXPOSE</span> <span class="number">8080</span></span><br><span class="line"><span class="keyword">ENTRYPOINT</span><span class="language-bash"> [<span class="string">&quot;java&quot;</span>, <span class="string">&quot;-jar&quot;</span>, <span class="string">&quot;/app.jar&quot;</span>]</span></span><br></pre></td></tr></table></figure>

<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="comment"># docker-compose.yml</span></span><br><span class="line"><span class="attr">version:</span> <span class="string">&#x27;3.8&#x27;</span></span><br><span class="line"><span class="attr">services:</span></span><br><span class="line">  <span class="attr">app:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">myapp:latest</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">JWT_SECRET=your-production-secret-key</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">JWT_ACCESS_EXPIRATION=7200000</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">JWT_REFRESH_EXPIRATION=604800000</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;8080:8080&quot;</span></span><br></pre></td></tr></table></figure>

<h2 id="10-æ€»ç»“"><a href="#10-æ€»ç»“" class="headerlink" title="10. æ€»ç»“"></a>10. æ€»ç»“</h2><h3 id="10-1-å®ç°è¦ç‚¹å›é¡¾"><a href="#10-1-å®ç°è¦ç‚¹å›é¡¾" class="headerlink" title="10.1 å®ç°è¦ç‚¹å›é¡¾"></a>10.1 å®ç°è¦ç‚¹å›é¡¾</h3><p>âœ… <strong>åŒTokenæœºåˆ¶</strong>ï¼šè®¿é—®ä»¤ç‰Œ+åˆ·æ–°ä»¤ç‰Œï¼Œå¹³è¡¡å®‰å…¨æ€§å’Œç”¨æˆ·ä½“éªŒ<br>âœ… <strong>è‡ªåŠ¨æ‹¦æˆªéªŒè¯</strong>ï¼šä½¿ç”¨Spring MVCæ‹¦æˆªå™¨è‡ªåŠ¨éªŒè¯æ‰€æœ‰APIè¯·æ±‚<br>âœ… <strong>çµæ´»é…ç½®</strong>ï¼šæ”¯æŒå¤šç¯å¢ƒé…ç½®ï¼Œå¯†é’¥å’Œè¿‡æœŸæ—¶é—´å¯é…ç½®<br>âœ… <strong>å¼‚å¸¸å¤„ç†</strong>ï¼šå®Œå–„çš„å¼‚å¸¸å¤„ç†æœºåˆ¶ï¼Œç»Ÿä¸€é”™è¯¯å“åº”æ ¼å¼<br>âœ… <strong>å®‰å…¨æœ€ä½³å®è·µ</strong>ï¼šHTTPSä¼ è¾“ã€åˆç†è¿‡æœŸæ—¶é—´ã€é»‘åå•æœºåˆ¶</p>
<h3 id="10-2-æ¶æ„ä¼˜åŠ¿"><a href="#10-2-æ¶æ„ä¼˜åŠ¿" class="headerlink" title="10.2 æ¶æ„ä¼˜åŠ¿"></a>10.2 æ¶æ„ä¼˜åŠ¿</h3><ul>
<li><strong>æ— çŠ¶æ€è®¾è®¡</strong>ï¼šæœåŠ¡å™¨ä¸éœ€è¦å­˜å‚¨ä¼šè¯ï¼Œä¾¿äºæ°´å¹³æ‰©å±•</li>
<li><strong>é«˜æ€§èƒ½</strong>ï¼šå‡å°‘æ•°æ®åº“æŸ¥è¯¢ï¼Œæå‡ç³»ç»Ÿå“åº”é€Ÿåº¦</li>
<li><strong>å®‰å…¨å¯æ§</strong>ï¼šå¤šå±‚å®‰å…¨é˜²æŠ¤ï¼Œæ”¯æŒç»†ç²’åº¦æƒé™æ§åˆ¶</li>
<li><strong>æ˜“äºç»´æŠ¤</strong>ï¼šæ¨¡å—åŒ–è®¾è®¡ï¼Œé…ç½®é›†ä¸­ç®¡ç†</li>
<li><strong>æ‰©å±•æ€§å¼º</strong>ï¼šæ”¯æŒå¾®æœåŠ¡æ¶æ„ï¼Œä¾¿äºç³»ç»Ÿæ‹†åˆ†</li>
</ul>
<h3 id="10-3-ä¸‹ä¸€æ­¥ä¼˜åŒ–æ–¹å‘"><a href="#10-3-ä¸‹ä¸€æ­¥ä¼˜åŒ–æ–¹å‘" class="headerlink" title="10.3 ä¸‹ä¸€æ­¥ä¼˜åŒ–æ–¹å‘"></a>10.3 ä¸‹ä¸€æ­¥ä¼˜åŒ–æ–¹å‘</h3><ol>
<li><strong>å¼•å…¥OAuth2</strong>ï¼šæ”¯æŒç¬¬ä¸‰æ–¹ç™»å½•</li>
<li><strong>å®ç°RBAC</strong>ï¼šåŸºäºè§’è‰²çš„æƒé™æ§åˆ¶</li>
<li><strong>æ·»åŠ é™æµ</strong>ï¼šé˜²æ­¢æš´åŠ›ç ´è§£</li>
<li><strong>é›†æˆç›‘æ§</strong>ï¼šå®Œå–„ç›‘æ§å’Œå‘Šè­¦</li>
<li><strong>å¤šç§Ÿæˆ·æ”¯æŒ</strong>ï¼šæ”¯æŒSaaSæ¶æ„</li>
</ol>
<p>é€šè¿‡æœ¬æ–‡çš„è¯¦ç»†ä»‹ç»ï¼Œç›¸ä¿¡æ‚¨å·²ç»æŒæ¡äº†åœ¨Spring Bootä¸­å®ç°JWTè®¤è¯çš„å®Œæ•´æ–¹æ¡ˆã€‚è¿™å¥—å®ç°ä¸ä»…æ»¡è¶³äº†åŸºæœ¬çš„è®¤è¯éœ€æ±‚ï¼Œè¿˜è€ƒè™‘äº†å®‰å…¨æ€§ã€æ€§èƒ½ã€å¯ç»´æŠ¤æ€§ç­‰å¤šä¸ªæ–¹é¢ã€‚åœ¨å®é™…é¡¹ç›®ä¸­ï¼Œæ‚¨å¯ä»¥æ ¹æ®å…·ä½“éœ€æ±‚è¿›è¡Œè°ƒæ•´å’Œä¼˜åŒ–ã€‚</p>
<p><strong>å…³é”®æé†’</strong>ï¼š</p>
<ul>
<li>ç”Ÿäº§ç¯å¢ƒåŠ¡å¿…ä½¿ç”¨HTTPS</li>
<li>å®šæœŸæ›´æ¢JWTå¯†é’¥</li>
<li>ç›‘æ§å¼‚å¸¸ç™»å½•è¡Œä¸º</li>
<li>ä¿æŒä¾èµ–åº“ç‰ˆæœ¬æ›´æ–°</li>
</ul>
<p>å¸Œæœ›è¿™ç¯‡æŒ‡å—å¯¹æ‚¨çš„é¡¹ç›®å¼€å‘æœ‰æ‰€å¸®åŠ©ï¼</p>
]]></content>
      <categories>
        <category>web</category>
      </categories>
      <tags>
        <tag>springboot</tag>
      </tags>
  </entry>
  <entry>
    <title>SpringBootæ•°æ®è„±æ•å®Œæ•´å®ç°æŒ‡å—</title>
    <url>/2025/09/22/web/SpringBoot%E6%95%B0%E6%8D%AE%E8%84%B1%E6%95%8F%E5%AE%8C%E6%95%B4%E5%AE%9E%E7%8E%B0%E6%8C%87%E5%8D%97/</url>
    <content><![CDATA[<blockquote>
<p>åœ¨ç°ä»£ä¼ä¸šçº§åº”ç”¨å¼€å‘ä¸­ï¼Œæ•°æ®å®‰å…¨å’Œéšç§ä¿æŠ¤è¶Šæ¥è¶Šé‡è¦ã€‚æœ¬æ–‡å°†è¯¦ç»†ä»‹ç»å¦‚ä½•åœ¨Spring Booté¡¹ç›®ä¸­å®ç°ä¸€å¥—å®Œæ•´çš„æ•°æ®è„±æ•ç³»ç»Ÿï¼Œä¿æŠ¤ç”¨æˆ·éšç§æ•°æ®çš„å®‰å…¨ã€‚</p>
</blockquote>
<h2 id="ğŸ“‹-ç›®å½•"><a href="#ğŸ“‹-ç›®å½•" class="headerlink" title="ğŸ“‹ ç›®å½•"></a>ğŸ“‹ ç›®å½•</h2><ul>
<li><a href="#1-%E6%A6%82%E8%BF%B0">1. æ¦‚è¿°</a></li>
<li><a href="#2-%E6%8A%80%E6%9C%AF%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1">2. æŠ€æœ¯æ¶æ„è®¾è®¡</a></li>
<li><a href="#3-%E6%A0%B8%E5%BF%83%E7%BB%84%E4%BB%B6%E5%AE%9E%E7%8E%B0">3. æ ¸å¿ƒç»„ä»¶å®ç°</a></li>
<li><a href="#4-%E9%85%8D%E7%BD%AE%E5%92%8C%E4%BD%BF%E7%94%A8">4. é…ç½®å’Œä½¿ç”¨</a></li>
<li><a href="#5-%E9%AB%98%E7%BA%A7%E7%89%B9%E6%80%A7">5. é«˜çº§ç‰¹æ€§</a></li>
<li><a href="#6-%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5">6. æœ€ä½³å®è·µ</a></li>
<li><a href="#7-%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96">7. æ€§èƒ½ä¼˜åŒ–</a></li>
<li><a href="#8-%E6%95%85%E9%9A%9C%E6%8E%92%E6%9F%A5">8. æ•…éšœæ’æŸ¥</a></li>
<li><a href="#9-%E6%80%BB%E7%BB%93">9. æ€»ç»“</a></li>
</ul>
<h2 id="1-æ¦‚è¿°"><a href="#1-æ¦‚è¿°" class="headerlink" title="1. æ¦‚è¿°"></a>1. æ¦‚è¿°</h2><h3 id="1-1-ä»€ä¹ˆæ˜¯æ•°æ®è„±æ•"><a href="#1-1-ä»€ä¹ˆæ˜¯æ•°æ®è„±æ•" class="headerlink" title="1.1 ä»€ä¹ˆæ˜¯æ•°æ®è„±æ•"></a>1.1 ä»€ä¹ˆæ˜¯æ•°æ®è„±æ•</h3><p>æ•°æ®è„±æ•ï¼ˆData Maskingï¼‰æ˜¯æŒ‡å¯¹æ•æ„Ÿæ•°æ®è¿›è¡Œå˜å½¢ã€é®è”½æˆ–æ›¿æ¢å¤„ç†ï¼Œä½¿å…¶åœ¨ä¿æŒæ•°æ®æ ¼å¼å’Œä¸šåŠ¡é€»è¾‘æ­£ç¡®çš„å‰æä¸‹ï¼Œæ— æ³•è¢«ç›´æ¥è¯†åˆ«å’Œåˆ©ç”¨ï¼Œä»è€Œä¿æŠ¤æ•°æ®éšç§å’Œå®‰å…¨ã€‚</p>
<h3 id="1-2-ä¸ºä»€ä¹ˆéœ€è¦æ•°æ®è„±æ•"><a href="#1-2-ä¸ºä»€ä¹ˆéœ€è¦æ•°æ®è„±æ•" class="headerlink" title="1.2 ä¸ºä»€ä¹ˆéœ€è¦æ•°æ®è„±æ•"></a>1.2 ä¸ºä»€ä¹ˆéœ€è¦æ•°æ®è„±æ•</h3><ul>
<li><strong>æ³•å¾‹åˆè§„</strong>ï¼šæ»¡è¶³ã€Šä¸ªäººä¿¡æ¯ä¿æŠ¤æ³•ã€‹ã€GDPRç­‰æ³•è§„è¦æ±‚</li>
<li><strong>å®‰å…¨é˜²æŠ¤</strong>ï¼šé˜²æ­¢æ•æ„Ÿæ•°æ®æ³„éœ²é€ æˆçš„å®‰å…¨é£é™©</li>
<li><strong>å¼€å‘æµ‹è¯•</strong>ï¼šä¸ºå¼€å‘å’Œæµ‹è¯•ç¯å¢ƒæä¾›å®‰å…¨çš„æ•°æ®</li>
<li><strong>æ—¥å¿—å®‰å…¨</strong>ï¼šé¿å…æ•æ„Ÿä¿¡æ¯åœ¨æ—¥å¿—ä¸­æ˜æ–‡æ˜¾ç¤º</li>
<li><strong>ç¬¬ä¸‰æ–¹å¯¹æ¥</strong>ï¼šå¯¹å¤–æä¾›æ•°æ®æ—¶ä¿æŠ¤ç”¨æˆ·éšç§</li>
</ul>
<h3 id="1-3-å®ç°ç›®æ ‡"><a href="#1-3-å®ç°ç›®æ ‡" class="headerlink" title="1.3 å®ç°ç›®æ ‡"></a>1.3 å®ç°ç›®æ ‡</h3><p>âœ… <strong>å¤šåœºæ™¯æ”¯æŒ</strong>ï¼šJSONåºåˆ—åŒ–ã€æ—¥å¿—è¾“å‡ºã€AOPæ‹¦æˆª<br>âœ… <strong>ä¸°å¯Œçš„è„±æ•ç±»å‹</strong>ï¼šæ‰‹æœºå·ã€é‚®ç®±ã€èº«ä»½è¯ã€é“¶è¡Œå¡ç­‰<br>âœ… <strong>çµæ´»é…ç½®</strong>ï¼šæ”¯æŒå…¨å±€é…ç½®å’Œæ³¨è§£çº§åˆ«æ§åˆ¶<br>âœ… <strong>é«˜æ€§èƒ½</strong>ï¼šä¼˜åŒ–ç®—æ³•ï¼Œæ”¯æŒæ‰¹é‡å¤„ç†<br>âœ… <strong>æ˜“æ‰©å±•</strong>ï¼šæ¨¡å—åŒ–è®¾è®¡ï¼Œä¾¿äºæ·»åŠ æ–°çš„è„±æ•è§„åˆ™</p>
<h2 id="2-æŠ€æœ¯æ¶æ„è®¾è®¡"><a href="#2-æŠ€æœ¯æ¶æ„è®¾è®¡" class="headerlink" title="2. æŠ€æœ¯æ¶æ„è®¾è®¡"></a>2. æŠ€æœ¯æ¶æ„è®¾è®¡</h2><h3 id="2-1-æ•´ä½“æ¶æ„å›¾"><a href="#2-1-æ•´ä½“æ¶æ„å›¾" class="headerlink" title="2.1 æ•´ä½“æ¶æ„å›¾"></a>2.1 æ•´ä½“æ¶æ„å›¾</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span><br><span class="line">â”‚                    æ•°æ®è„±æ•ç³»ç»Ÿæ¶æ„                           â”‚</span><br><span class="line">â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤</span><br><span class="line">â”‚                                                             â”‚</span><br><span class="line">â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚</span><br><span class="line">â”‚  â”‚  æ³¨è§£å±‚      â”‚    â”‚  é…ç½®å±‚      â”‚    â”‚  å·¥å…·å±‚      â”‚      â”‚</span><br><span class="line">â”‚  â”‚ @Sensitive  â”‚    â”‚SensitiveConfigâ”‚   â”‚SensitiveUtil â”‚      â”‚</span><br><span class="line">â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚</span><br><span class="line">â”‚         â”‚                   â”‚                   â”‚           â”‚</span><br><span class="line">â”‚         â–¼                   â–¼                   â–¼           â”‚</span><br><span class="line">â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚</span><br><span class="line">â”‚  â”‚                    å¤„ç†å±‚                                â”‚ â”‚</span><br><span class="line">â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚ â”‚</span><br><span class="line">â”‚  â”‚  â”‚ AOP åˆ‡é¢    â”‚  â”‚ JSONåºåˆ—åŒ–  â”‚  â”‚ æ—¥å¿—å¤„ç†    â”‚     â”‚ â”‚</span><br><span class="line">â”‚  â”‚  â”‚SensitiveAspectâ”‚ â”‚JsonSerializerâ”‚ â”‚ LogUtil     â”‚     â”‚ â”‚</span><br><span class="line">â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚ â”‚</span><br><span class="line">â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚</span><br><span class="line">â”‚                               â”‚                               â”‚</span><br><span class="line">â”‚                               â–¼                               â”‚</span><br><span class="line">â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚</span><br><span class="line">â”‚  â”‚                    è¾“å‡ºå±‚                                â”‚ â”‚</span><br><span class="line">â”‚  â”‚       APIå“åº”        æ—¥å¿—æ–‡ä»¶        æ§åˆ¶å°è¾“å‡º          â”‚ â”‚</span><br><span class="line">â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚</span><br><span class="line">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span><br></pre></td></tr></table></figure>

<h3 id="2-2-æ ¸å¿ƒæ¨¡å—è¯´æ˜"><a href="#2-2-æ ¸å¿ƒæ¨¡å—è¯´æ˜" class="headerlink" title="2.2 æ ¸å¿ƒæ¨¡å—è¯´æ˜"></a>2.2 æ ¸å¿ƒæ¨¡å—è¯´æ˜</h3><table>
<thead>
<tr>
<th>æ¨¡å—</th>
<th>åŠŸèƒ½</th>
<th>ä½œç”¨</th>
</tr>
</thead>
<tbody><tr>
<td><strong>æ³¨è§£å±‚</strong></td>
<td>æ ‡è®°æ•æ„Ÿå­—æ®µ</td>
<td>é€šè¿‡æ³¨è§£å£°æ˜è„±æ•è§„åˆ™</td>
</tr>
<tr>
<td><strong>é…ç½®å±‚</strong></td>
<td>å…¨å±€é…ç½®ç®¡ç†</td>
<td>ç»Ÿä¸€ç®¡ç†è„±æ•å¼€å…³å’Œå‚æ•°</td>
</tr>
<tr>
<td><strong>å·¥å…·å±‚</strong></td>
<td>è„±æ•ç®—æ³•å®ç°</td>
<td>æä¾›å„ç§è„±æ•å¤„ç†æ–¹æ³•</td>
</tr>
<tr>
<td><strong>å¤„ç†å±‚</strong></td>
<td>è‡ªåŠ¨è„±æ•å¤„ç†</td>
<td>åœ¨ä¸åŒåœºæ™¯ä¸‹è‡ªåŠ¨åº”ç”¨è„±æ•</td>
</tr>
</tbody></table>
<h3 id="2-3-æ”¯æŒçš„è„±æ•åœºæ™¯"><a href="#2-3-æ”¯æŒçš„è„±æ•åœºæ™¯" class="headerlink" title="2.3 æ”¯æŒçš„è„±æ•åœºæ™¯"></a>2.3 æ”¯æŒçš„è„±æ•åœºæ™¯</h3><ul>
<li><strong>JSON åºåˆ—åŒ–</strong>ï¼šAPI å“åº”è‡ªåŠ¨è„±æ•</li>
<li><strong>æ—¥å¿—è¾“å‡º</strong>ï¼šæ—¥å¿—è®°å½•æ—¶è‡ªåŠ¨è„±æ•</li>
<li><strong>AOP æ‹¦æˆª</strong>ï¼šæ–¹æ³•è¿”å›å€¼è‡ªåŠ¨è„±æ•</li>
<li><strong>æ‰‹åŠ¨è°ƒç”¨</strong>ï¼šç¨‹åºä¸­æ‰‹åŠ¨è„±æ•å¤„ç†</li>
</ul>
<h2 id="3-æ ¸å¿ƒç»„ä»¶å®ç°"><a href="#3-æ ¸å¿ƒç»„ä»¶å®ç°" class="headerlink" title="3. æ ¸å¿ƒç»„ä»¶å®ç°"></a>3. æ ¸å¿ƒç»„ä»¶å®ç°</h2><h3 id="3-1-è„±æ•ç±»å‹æšä¸¾"><a href="#3-1-è„±æ•ç±»å‹æšä¸¾" class="headerlink" title="3.1 è„±æ•ç±»å‹æšä¸¾"></a>3.1 è„±æ•ç±»å‹æšä¸¾</h3><p>é¦–å…ˆå®šä¹‰æ”¯æŒçš„è„±æ•ç±»å‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">enum</span> <span class="title class_">SensitiveType</span> &#123;</span><br><span class="line">    <span class="comment">/** æ‰‹æœºå·è„±æ•ï¼šä¿ç•™å‰3ä½å’Œå4ä½ï¼Œä¸­é—´ç”¨*æ›¿æ¢ */</span></span><br><span class="line">    MOBILE,</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/** å§“åè„±æ•ï¼šä¿ç•™å§“æ°ï¼Œåå­—ç”¨*æ›¿æ¢ */</span></span><br><span class="line">    NAME,</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/** é‚®ç®±è„±æ•ï¼šä¿ç•™å‰3ä½å’Œ@åçš„åŸŸåï¼Œç”¨æˆ·åéƒ¨åˆ†ç”¨*æ›¿æ¢ */</span></span><br><span class="line">    EMAIL,</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/** å¯†ç è„±æ•ï¼šå®Œå…¨ç”¨*æ›¿æ¢ */</span></span><br><span class="line">    PASSWORD,</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/** èº«ä»½è¯å·è„±æ•ï¼šä¿ç•™å‰4ä½å’Œå4ä½ï¼Œä¸­é—´ç”¨*æ›¿æ¢ */</span></span><br><span class="line">    ID_CARD,</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/** é“¶è¡Œå¡å·è„±æ•ï¼šä¿ç•™å‰4ä½å’Œå4ä½ï¼Œä¸­é—´ç”¨*æ›¿æ¢ */</span></span><br><span class="line">    BANK_CARD,</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/** åœ°å€è„±æ•ï¼šä¿ç•™çœå¸‚åŒºä¿¡æ¯ï¼Œè¯¦ç»†åœ°å€ç”¨*æ›¿æ¢ */</span></span><br><span class="line">    ADDRESS,</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/** è½¦ç‰Œå·è„±æ•ï¼šä¿ç•™å‰2ä½å’Œå1ä½ï¼Œä¸­é—´ç”¨*æ›¿æ¢ */</span></span><br><span class="line">    CAR_LICENSE,</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/** å›ºå®šç”µè¯è„±æ•ï¼šä¿ç•™åŒºå·å’Œå4ä½ï¼Œä¸­é—´ç”¨*æ›¿æ¢ */</span></span><br><span class="line">    FIXED_PHONE,</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/** è‡ªå®šä¹‰è„±æ•ï¼šæ ¹æ®é…ç½®è¿›è¡Œè„±æ• */</span></span><br><span class="line">    CUSTOM</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="3-2-æ•æ„Ÿæ•°æ®æ³¨è§£"><a href="#3-2-æ•æ„Ÿæ•°æ®æ³¨è§£" class="headerlink" title="3.2 æ•æ„Ÿæ•°æ®æ³¨è§£"></a>3.2 æ•æ„Ÿæ•°æ®æ³¨è§£</h3><p>è®¾è®¡ä¸€ä¸ªåŠŸèƒ½ä¸°å¯Œçš„æ³¨è§£ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Target(&#123;ElementType.FIELD, ElementType.METHOD&#125;)</span></span><br><span class="line"><span class="meta">@Retention(RetentionPolicy.RUNTIME)</span></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> Sensitive &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è„±æ•ç±»å‹</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    SensitiveType <span class="title function_">value</span><span class="params">()</span> <span class="keyword">default</span> SensitiveType.CUSTOM;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è‡ªå®šä¹‰è„±æ•æ—¶ä¿ç•™å¼€å§‹ä½æ•°ï¼ˆä»…åœ¨ type = CUSTOM æ—¶ç”Ÿæ•ˆï¼‰</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="type">int</span> <span class="title function_">keepStart</span><span class="params">()</span> <span class="keyword">default</span> <span class="number">2</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è‡ªå®šä¹‰è„±æ•æ—¶ä¿ç•™ç»“æŸä½æ•°ï¼ˆä»…åœ¨ type = CUSTOM æ—¶ç”Ÿæ•ˆï¼‰</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="type">int</span> <span class="title function_">keepEnd</span><span class="params">()</span> <span class="keyword">default</span> <span class="number">2</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è‡ªå®šä¹‰è„±æ•æ—¶çš„æ›¿æ¢å­—ç¬¦ï¼ˆä»…åœ¨ type = CUSTOM æ—¶ç”Ÿæ•ˆï¼‰</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    String <span class="title function_">maskChar</span><span class="params">()</span> <span class="keyword">default</span> <span class="string">&quot;*&quot;</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ˜¯å¦åœ¨æ—¥å¿—ä¸­è„±æ•ï¼ˆé»˜è®¤ä¸ºtrueï¼‰</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="type">boolean</span> <span class="title function_">enableLog</span><span class="params">()</span> <span class="keyword">default</span> <span class="literal">true</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ˜¯å¦åœ¨JSONåºåˆ—åŒ–æ—¶è„±æ•ï¼ˆé»˜è®¤ä¸ºtrueï¼‰</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="type">boolean</span> <span class="title function_">enableJson</span><span class="params">()</span> <span class="keyword">default</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="3-3-è„±æ•å·¥å…·ç±»æ ¸å¿ƒå®ç°"><a href="#3-3-è„±æ•å·¥å…·ç±»æ ¸å¿ƒå®ç°" class="headerlink" title="3.3 è„±æ•å·¥å…·ç±»æ ¸å¿ƒå®ç°"></a>3.3 è„±æ•å·¥å…·ç±»æ ¸å¿ƒå®ç°</h3><p>å®ç°å„ç§è„±æ•ç®—æ³•ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SensitiveUtil</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/** é»˜è®¤æ›¿æ¢å­—ç¬¦ */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">DEFAULT_MASK_CHAR</span> <span class="operator">=</span> <span class="string">&quot;*&quot;</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/** æ‰‹æœºå·æ­£åˆ™è¡¨è¾¾å¼ */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">Pattern</span> <span class="variable">MOBILE_PATTERN</span> <span class="operator">=</span> Pattern.compile(<span class="string">&quot;^1[3-9]\\d&#123;9&#125;$&quot;</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ ¹æ®è„±æ•ç±»å‹å¯¹æ•°æ®è¿›è¡Œè„±æ•å¤„ç†</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">desensitize</span><span class="params">(String data, SensitiveType type)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (!StringUtils.hasText(data) || type == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> data;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">switch</span> (type) &#123;</span><br><span class="line">            <span class="keyword">case</span> MOBILE:</span><br><span class="line">                <span class="keyword">return</span> desensitizeMobile(data);</span><br><span class="line">            <span class="keyword">case</span> NAME:</span><br><span class="line">                <span class="keyword">return</span> desensitizeName(data);</span><br><span class="line">            <span class="keyword">case</span> EMAIL:</span><br><span class="line">                <span class="keyword">return</span> desensitizeEmail(data);</span><br><span class="line">            <span class="keyword">case</span> PASSWORD:</span><br><span class="line">                <span class="keyword">return</span> desensitizePassword(data);</span><br><span class="line">            <span class="keyword">case</span> ID_CARD:</span><br><span class="line">                <span class="keyword">return</span> desensitizeIdCard(data);</span><br><span class="line">            <span class="keyword">case</span> BANK_CARD:</span><br><span class="line">                <span class="keyword">return</span> desensitizeBankCard(data);</span><br><span class="line">            <span class="keyword">case</span> ADDRESS:</span><br><span class="line">                <span class="keyword">return</span> desensitizeAddress(data);</span><br><span class="line">            <span class="keyword">case</span> CAR_LICENSE:</span><br><span class="line">                <span class="keyword">return</span> desensitizeCarLicense(data);</span><br><span class="line">            <span class="keyword">case</span> FIXED_PHONE:</span><br><span class="line">                <span class="keyword">return</span> desensitizeFixedPhone(data);</span><br><span class="line">            <span class="keyword">case</span> CUSTOM:</span><br><span class="line">            <span class="keyword">default</span>:</span><br><span class="line">                <span class="keyword">return</span> desensitizeDefault(data);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ‰‹æœºå·è„±æ•å¤„ç†</span></span><br><span class="line"><span class="comment">     * ç¤ºä¾‹ï¼š13812345678 -&gt; 138****5678</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">desensitizeMobile</span><span class="params">(String mobile)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (!StringUtils.hasText(mobile)) &#123;</span><br><span class="line">            <span class="keyword">return</span> mobile;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// æ ¡éªŒæ‰‹æœºå·æ ¼å¼</span></span><br><span class="line">        <span class="keyword">if</span> (!MOBILE_PATTERN.matcher(mobile).matches()) &#123;</span><br><span class="line">            <span class="keyword">return</span> mobile; <span class="comment">// æ ¼å¼ä¸æ­£ç¡®ï¼Œç›´æ¥è¿”å›</span></span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> mobile.substring(<span class="number">0</span>, <span class="number">3</span>) + <span class="string">&quot;****&quot;</span> + mobile.substring(<span class="number">7</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å§“åè„±æ•å¤„ç†</span></span><br><span class="line"><span class="comment">     * ç¤ºä¾‹ï¼šå¼ ä¸‰ -&gt; å¼ *ï¼›æ¬§é˜³ä¿® -&gt; æ¬§é˜³*</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">desensitizeName</span><span class="params">(String name)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (!StringUtils.hasText(name)) &#123;</span><br><span class="line">            <span class="keyword">return</span> name;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="type">int</span> <span class="variable">length</span> <span class="operator">=</span> name.length();</span><br><span class="line">        <span class="keyword">if</span> (length &lt;= <span class="number">1</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> name;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// ä¸­æ–‡å§“åå¤„ç†</span></span><br><span class="line">        <span class="keyword">if</span> (length == <span class="number">2</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> name.charAt(<span class="number">0</span>) + <span class="string">&quot;*&quot;</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (length == <span class="number">3</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> name.substring(<span class="number">0</span>, <span class="number">2</span>) + <span class="string">&quot;*&quot;</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">// å¤å§“æˆ–è¾ƒé•¿å§“åï¼Œä¿ç•™å‰é¢éƒ¨åˆ†</span></span><br><span class="line">            <span class="keyword">return</span> name.substring(<span class="number">0</span>, <span class="number">2</span>) + repeatChar(<span class="string">&quot;*&quot;</span>, length - <span class="number">2</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è‡ªå®šä¹‰è„±æ•å¤„ç†</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">desensitizeCustom</span><span class="params">(String data, <span class="type">int</span> keepStart, <span class="type">int</span> keepEnd, String maskChar)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (!StringUtils.hasText(data)) &#123;</span><br><span class="line">            <span class="keyword">return</span> data;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> (keepStart &lt; <span class="number">0</span>) keepStart = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">if</span> (keepEnd &lt; <span class="number">0</span>) keepEnd = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">if</span> (!StringUtils.hasText(maskChar)) maskChar = DEFAULT_MASK_CHAR;</span><br><span class="line">        </span><br><span class="line">        <span class="type">int</span> <span class="variable">length</span> <span class="operator">=</span> data.length();</span><br><span class="line">        <span class="keyword">if</span> (keepStart + keepEnd &gt;= length) &#123;</span><br><span class="line">            <span class="keyword">return</span> data; <span class="comment">// ä¿ç•™ä½æ•°è¶…è¿‡æ€»é•¿åº¦</span></span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="type">String</span> <span class="variable">start</span> <span class="operator">=</span> data.substring(<span class="number">0</span>, keepStart);</span><br><span class="line">        <span class="type">String</span> <span class="variable">end</span> <span class="operator">=</span> data.substring(length - keepEnd);</span><br><span class="line">        <span class="type">String</span> <span class="variable">middle</span> <span class="operator">=</span> repeatChar(maskChar, length - keepStart - keepEnd);</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> start + middle + end;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * é‡å¤å­—ç¬¦ä¸²è¾…åŠ©æ–¹æ³•ï¼ˆç”¨äºå…¼å®¹ Java 8ï¼‰</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> String <span class="title function_">repeatChar</span><span class="params">(String str, <span class="type">int</span> count)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (count &lt;= <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">StringBuilder</span> <span class="variable">sb</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringBuilder</span>();</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; count; i++) &#123;</span><br><span class="line">            sb.append(str);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> sb.toString();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// ... å…¶ä»–è„±æ•æ–¹æ³•å®ç°</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="3-4-JSON-åºåˆ—åŒ–è„±æ•å¤„ç†å™¨"><a href="#3-4-JSON-åºåˆ—åŒ–è„±æ•å¤„ç†å™¨" class="headerlink" title="3.4 JSON åºåˆ—åŒ–è„±æ•å¤„ç†å™¨"></a>3.4 JSON åºåˆ—åŒ–è„±æ•å¤„ç†å™¨</h3><p>å®ç°Jacksonè‡ªå®šä¹‰åºåˆ—åŒ–å™¨ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SensitiveJsonSerializer</span> <span class="keyword">extends</span> <span class="title class_">JsonSerializer</span>&lt;String&gt; <span class="keyword">implements</span> <span class="title class_">ContextualSerializer</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> SensitiveType sensitiveType;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> keepStart;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> keepEnd;</span><br><span class="line">    <span class="keyword">private</span> String maskChar;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">boolean</span> enableJson;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">SensitiveJsonSerializer</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// é»˜è®¤æ„é€ å‡½æ•°</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">SensitiveJsonSerializer</span><span class="params">(SensitiveType sensitiveType, <span class="type">int</span> keepStart, <span class="type">int</span> keepEnd, String maskChar, <span class="type">boolean</span> enableJson)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.sensitiveType = sensitiveType;</span><br><span class="line">        <span class="built_in">this</span>.keepStart = keepStart;</span><br><span class="line">        <span class="built_in">this</span>.keepEnd = keepEnd;</span><br><span class="line">        <span class="built_in">this</span>.maskChar = maskChar;</span><br><span class="line">        <span class="built_in">this</span>.enableJson = enableJson;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">serialize</span><span class="params">(String value, JsonGenerator gen, SerializerProvider serializers)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="comment">// å¦‚æœç¦ç”¨äº† JSON è„±æ•ï¼Œç›´æ¥è¾“å‡ºåŸå€¼</span></span><br><span class="line">        <span class="keyword">if</span> (!enableJson) &#123;</span><br><span class="line">            gen.writeString(value);</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// è¿›è¡Œè„±æ•å¤„ç†</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">maskedValue</span> <span class="operator">=</span> desensitizeValue(value);</span><br><span class="line">        gen.writeString(maskedValue);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> JsonSerializer&lt;?&gt; createContextual(SerializerProvider prov, BeanProperty property) <span class="keyword">throws</span> JsonMappingException &#123;</span><br><span class="line">        <span class="keyword">if</span> (property != <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="type">Sensitive</span> <span class="variable">sensitive</span> <span class="operator">=</span> property.getAnnotation(Sensitive.class);</span><br><span class="line">            <span class="keyword">if</span> (sensitive != <span class="literal">null</span>) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">SensitiveJsonSerializer</span>(</span><br><span class="line">                        sensitive.value(),</span><br><span class="line">                        sensitive.keepStart(),</span><br><span class="line">                        sensitive.keepEnd(),</span><br><span class="line">                        sensitive.maskChar(),</span><br><span class="line">                        sensitive.enableJson()</span><br><span class="line">                );</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ ¹æ®é…ç½®å¯¹æ•°æ®è¿›è¡Œè„±æ•å¤„ç†</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String <span class="title function_">desensitizeValue</span><span class="params">(String value)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (sensitiveType == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> value;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// å¦‚æœæ˜¯è‡ªå®šä¹‰ç±»å‹ï¼Œä½¿ç”¨è‡ªå®šä¹‰å‚æ•°</span></span><br><span class="line">        <span class="keyword">if</span> (sensitiveType == SensitiveType.CUSTOM) &#123;</span><br><span class="line">            <span class="keyword">return</span> SensitiveUtil.desensitizeCustom(value, keepStart, keepEnd, maskChar);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// ä½¿ç”¨é¢„å®šä¹‰çš„è„±æ•ç±»å‹</span></span><br><span class="line">        <span class="keyword">return</span> SensitiveUtil.desensitize(value, sensitiveType);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="3-5-AOP-åˆ‡é¢è„±æ•å¤„ç†å™¨"><a href="#3-5-AOP-åˆ‡é¢è„±æ•å¤„ç†å™¨" class="headerlink" title="3.5 AOP åˆ‡é¢è„±æ•å¤„ç†å™¨"></a>3.5 AOP åˆ‡é¢è„±æ•å¤„ç†å™¨</h3><p>å®ç°è‡ªåŠ¨è„±æ•çš„AOPåˆ‡é¢ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Aspect</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SensitiveAspect</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">Logger</span> <span class="variable">logger</span> <span class="operator">=</span> LoggerFactory.getLogger(SensitiveAspect.class);</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> SensitiveConfig.SensitiveProperties sensitiveProperties;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å®šä¹‰åˆ‡ç‚¹ï¼šæ‹¦æˆªæ‰€æœ‰ Controller å±‚çš„æ–¹æ³•</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Pointcut(&quot;execution(public * org.practice.surveymaster.controller..*(..))&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">controllerMethods</span><span class="params">()</span> &#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ç¯ç»•é€šçŸ¥ï¼šå¯¹æ–¹æ³•è¿”å›å€¼è¿›è¡Œè„±æ•å¤„ç†</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Around(&quot;controllerMethods()&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">aroundController</span><span class="params">(ProceedingJoinPoint joinPoint)</span> <span class="keyword">throws</span> Throwable &#123;</span><br><span class="line">        <span class="comment">// å¦‚æœè„±æ•åŠŸèƒ½æœªå¯ç”¨ï¼Œç›´æ¥æ‰§è¡ŒåŸæ–¹æ³•</span></span><br><span class="line">        <span class="keyword">if</span> (!sensitiveProperties.isEnabled()) &#123;</span><br><span class="line">            <span class="keyword">return</span> joinPoint.proceed();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// æ‰§è¡ŒåŸæ–¹æ³•</span></span><br><span class="line">        <span class="type">Object</span> <span class="variable">result</span> <span class="operator">=</span> joinPoint.proceed();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// å¯¹è¿”å›å€¼è¿›è¡Œè„±æ•å¤„ç†</span></span><br><span class="line">        <span class="keyword">return</span> desensitizeResult(result);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å¯¹ç»“æœè¿›è¡Œè„±æ•å¤„ç†</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> Object <span class="title function_">desensitizeResult</span><span class="params">(Object result)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (result == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// å¤„ç†ä¸åŒç±»å‹çš„è¿”å›å€¼</span></span><br><span class="line">            <span class="keyword">if</span> (result <span class="keyword">instanceof</span> List) &#123;</span><br><span class="line">                <span class="keyword">return</span> desensitizeList((List&lt;?&gt;) result);</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> (result.getClass().getPackage() != <span class="literal">null</span> &amp;&amp; </span><br><span class="line">                       result.getClass().getPackage().getName().startsWith(<span class="string">&quot;org.practice.surveymaster&quot;</span>)) &#123;</span><br><span class="line">                <span class="comment">// åªå¤„ç†é¡¹ç›®å†…çš„ç±»</span></span><br><span class="line">                <span class="keyword">return</span> desensitizeObject(result);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            logger.warn(<span class="string">&quot;è„±æ•å¤„ç†å¤±è´¥: &#123;&#125;&quot;</span>, e.getMessage(), e);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å¯¹å•ä¸ªå¯¹è±¡è¿›è¡Œè„±æ•å¤„ç†</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> Object <span class="title function_">desensitizeObject</span><span class="params">(Object obj)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (obj == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        Class&lt;?&gt; clazz = obj.getClass();</span><br><span class="line">        Field[] fields = clazz.getDeclaredFields();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (Field field : fields) &#123;</span><br><span class="line">            <span class="type">Sensitive</span> <span class="variable">sensitive</span> <span class="operator">=</span> field.getAnnotation(Sensitive.class);</span><br><span class="line">            <span class="keyword">if</span> (sensitive != <span class="literal">null</span> &amp;&amp; field.getType() == String.class) &#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    field.setAccessible(<span class="literal">true</span>);</span><br><span class="line">                    <span class="type">String</span> <span class="variable">originalValue</span> <span class="operator">=</span> (String) field.get(obj);</span><br><span class="line">                    </span><br><span class="line">                    <span class="comment">// æ ¹æ®æ³¨è§£é…ç½®è¿›è¡Œè„±æ•</span></span><br><span class="line">                    <span class="type">String</span> <span class="variable">desensitizedValue</span> <span class="operator">=</span> desensitizeFieldValue(originalValue, sensitive);</span><br><span class="line">                    field.set(obj, desensitizedValue);</span><br><span class="line">                    </span><br><span class="line">                    logger.debug(<span class="string">&quot;å­—æ®µ &#123;&#125; è„±æ•å¤„ç†å®Œæˆ&quot;</span>, field.getName());</span><br><span class="line">                &#125; <span class="keyword">catch</span> (IllegalAccessException e) &#123;</span><br><span class="line">                    logger.warn(<span class="string">&quot;æ— æ³•è®¿é—®å­—æ®µ &#123;&#125;: &#123;&#125;&quot;</span>, field.getName(), e.getMessage());</span><br><span class="line">                &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">                    logger.error(<span class="string">&quot;å­—æ®µ &#123;&#125; è„±æ•å¤„ç†å¼‚å¸¸: &#123;&#125;&quot;</span>, field.getName(), e.getMessage(), e);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> obj;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// ... å…¶ä»–è¾…åŠ©æ–¹æ³•</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="4-é…ç½®å’Œä½¿ç”¨"><a href="#4-é…ç½®å’Œä½¿ç”¨" class="headerlink" title="4. é…ç½®å’Œä½¿ç”¨"></a>4. é…ç½®å’Œä½¿ç”¨</h2><h3 id="4-1-é…ç½®ç±»å®ç°"><a href="#4-1-é…ç½®ç±»å®ç°" class="headerlink" title="4.1 é…ç½®ç±»å®ç°"></a>4.1 é…ç½®ç±»å®ç°</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@ConfigurationProperties(prefix = &quot;sensitive&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SensitiveConfig</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ˜¯å¦å¯ç”¨æ•°æ®è„±æ•åŠŸèƒ½</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">boolean</span> <span class="variable">enabled</span> <span class="operator">=</span> <span class="literal">true</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ˜¯å¦åœ¨æ—¥å¿—ä¸­å¯ç”¨è„±æ•</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">boolean</span> <span class="variable">enableLog</span> <span class="operator">=</span> <span class="literal">true</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ˜¯å¦åœ¨ JSON åºåˆ—åŒ–æ—¶å¯ç”¨è„±æ•</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">boolean</span> <span class="variable">enableJson</span> <span class="operator">=</span> <span class="literal">true</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * é»˜è®¤çš„è„±æ•å­—ç¬¦</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">String</span> <span class="variable">defaultMaskChar</span> <span class="operator">=</span> <span class="string">&quot;*&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ³¨å†Œå¸¦æœ‰è„±æ•åŠŸèƒ½çš„ ObjectMapper</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="meta">@Primary</span></span><br><span class="line">    <span class="keyword">public</span> ObjectMapper <span class="title function_">sensitiveObjectMapper</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">ObjectMapper</span> <span class="variable">objectMapper</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectMapper</span>();</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// æ³¨å†Œ JSR310 æ¨¡å—æ”¯æŒ Java 8 æ—¶é—´ç±»å‹</span></span><br><span class="line">        objectMapper.registerModule(<span class="keyword">new</span> <span class="title class_">JavaTimeModule</span>());</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// é…ç½®æ—¶é—´åºåˆ—åŒ–æ ¼å¼</span></span><br><span class="line">        objectMapper.disable(SerializationFeature.WRITE_DATES_AS_TIMESTAMPS);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// å…¶ä»–é€šç”¨é…ç½®</span></span><br><span class="line">        objectMapper.setSerializationInclusion(JsonInclude.Include.NON_NULL);</span><br><span class="line">        objectMapper.configure(DeserializationFeature.FAIL_ON_UNKNOWN_PROPERTIES, <span class="literal">false</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// åˆ›å»ºç®€å•æ¨¡å—å¹¶æ³¨å†Œè„±æ•åºåˆ—åŒ–å™¨</span></span><br><span class="line">        <span class="type">SimpleModule</span> <span class="variable">sensitiveModule</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SimpleModule</span>(<span class="string">&quot;SensitiveModule&quot;</span>);</span><br><span class="line">        sensitiveModule.addSerializer(String.class, <span class="keyword">new</span> <span class="title class_">SensitiveJsonSerializer</span>());</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// æ³¨å†Œæ¨¡å—åˆ° ObjectMapper</span></span><br><span class="line">        objectMapper.registerModule(sensitiveModule);</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> objectMapper;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// ... getters and setters</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="4-2-åº”ç”¨é…ç½®æ–‡ä»¶"><a href="#4-2-åº”ç”¨é…ç½®æ–‡ä»¶" class="headerlink" title="4.2 åº”ç”¨é…ç½®æ–‡ä»¶"></a>4.2 åº”ç”¨é…ç½®æ–‡ä»¶</h3><p>åœ¨ <code>application.yml</code> ä¸­æ·»åŠ è„±æ•é…ç½®ï¼š</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="comment"># æ•°æ®è„±æ•é…ç½®</span></span><br><span class="line"><span class="attr">sensitive:</span></span><br><span class="line">  <span class="attr">enabled:</span> <span class="literal">true</span>              <span class="comment"># æ˜¯å¦å¯ç”¨æ•°æ®è„±æ•åŠŸèƒ½</span></span><br><span class="line">  <span class="attr">enable-log:</span> <span class="literal">true</span>           <span class="comment"># æ˜¯å¦åœ¨æ—¥å¿—ä¸­å¯ç”¨è„±æ•</span></span><br><span class="line">  <span class="attr">enable-json:</span> <span class="literal">true</span>          <span class="comment"># æ˜¯å¦åœ¨ JSON åºåˆ—åŒ–æ—¶å¯ç”¨è„±æ•</span></span><br><span class="line">  <span class="attr">default-mask-char:</span> <span class="string">&quot;*&quot;</span>     <span class="comment"># é»˜è®¤çš„è„±æ•å­—ç¬¦</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Jackson é…ç½®ï¼ˆæ”¯æŒ Java 8 æ—¶é—´ç±»å‹ï¼‰</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">jackson:</span></span><br><span class="line">    <span class="attr">date-format:</span> <span class="string">yyyy-MM-dd</span> <span class="string">HH:mm:ss</span></span><br><span class="line">    <span class="attr">time-zone:</span> <span class="string">GMT+8</span></span><br><span class="line">    <span class="attr">serialization:</span></span><br><span class="line">      <span class="attr">write-dates-as-timestamps:</span> <span class="literal">false</span></span><br><span class="line">    <span class="attr">deserialization:</span></span><br><span class="line">      <span class="attr">fail-on-unknown-properties:</span> <span class="literal">false</span></span><br></pre></td></tr></table></figure>

<h3 id="4-3-å®ä½“ç±»ä½¿ç”¨ç¤ºä¾‹"><a href="#4-3-å®ä½“ç±»ä½¿ç”¨ç¤ºä¾‹" class="headerlink" title="4.3 å®ä½“ç±»ä½¿ç”¨ç¤ºä¾‹"></a>4.3 å®ä½“ç±»ä½¿ç”¨ç¤ºä¾‹</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@JsonIgnoreProperties(ignoreUnknown = true)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">User</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> id;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Sensitive(SensitiveType.NAME)</span></span><br><span class="line">    <span class="meta">@JsonSerialize(using = SensitiveJsonSerializer.class)</span></span><br><span class="line">    <span class="keyword">private</span> String username;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Sensitive(SensitiveType.PASSWORD)</span></span><br><span class="line">    <span class="meta">@JsonSerialize(using = SensitiveJsonSerializer.class)</span></span><br><span class="line">    <span class="keyword">private</span> String password;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Sensitive(SensitiveType.EMAIL)</span></span><br><span class="line">    <span class="meta">@JsonSerialize(using = SensitiveJsonSerializer.class)</span></span><br><span class="line">    <span class="keyword">private</span> String email;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@JsonFormat(pattern = &quot;yyyy-MM-dd HH:mm:ss&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> LocalDateTime createdAt;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="4-4-æ§åˆ¶å™¨ä½¿ç”¨ç¤ºä¾‹"><a href="#4-4-æ§åˆ¶å™¨ä½¿ç”¨ç¤ºä¾‹" class="headerlink" title="4.4 æ§åˆ¶å™¨ä½¿ç”¨ç¤ºä¾‹"></a>4.4 æ§åˆ¶å™¨ä½¿ç”¨ç¤ºä¾‹</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/api/demo/sensitive&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SensitiveDemoController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ¼”ç¤ºç”¨æˆ·ä¿¡æ¯è„±æ•</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/user&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> ApiResponse&lt;User&gt; <span class="title function_">getUserInfo</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">User</span>();</span><br><span class="line">        user.setId(<span class="number">1</span>);</span><br><span class="line">        user.setUsername(<span class="string">&quot;å¼ ä¸‰ä¸°&quot;</span>);</span><br><span class="line">        user.setPassword(<span class="string">&quot;mySecretPassword123&quot;</span>);</span><br><span class="line">        user.setEmail(<span class="string">&quot;zhangsan@example.com&quot;</span>);</span><br><span class="line">        user.setCreatedAt(LocalDateTime.now());</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> ApiResponse.success(user);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ¼”ç¤ºæ•æ„Ÿä¿¡æ¯å¯¹è±¡</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/sensitive-info&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> ApiResponse&lt;SensitiveInfoDemo&gt; <span class="title function_">getSensitiveInfo</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">SensitiveInfoDemo</span> <span class="variable">info</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SensitiveInfoDemo</span>();</span><br><span class="line">        info.setMobile(<span class="string">&quot;13812345678&quot;</span>);</span><br><span class="line">        info.setIdCard(<span class="string">&quot;110101199001011234&quot;</span>);</span><br><span class="line">        info.setBankCard(<span class="string">&quot;6217000123456789012&quot;</span>);</span><br><span class="line">        info.setAddress(<span class="string">&quot;åŒ—äº¬å¸‚æœé˜³åŒºä¸‰é‡Œå±¯è¡—é“1å·&quot;</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> ApiResponse.success(info);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ¼”ç¤ºæ•æ„Ÿä¿¡æ¯ç±»</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">SensitiveInfoDemo</span> &#123;</span><br><span class="line">        <span class="meta">@Sensitive(SensitiveType.MOBILE)</span></span><br><span class="line">        <span class="keyword">private</span> String mobile;</span><br><span class="line">        </span><br><span class="line">        <span class="meta">@Sensitive(SensitiveType.ID_CARD)</span></span><br><span class="line">        <span class="keyword">private</span> String idCard;</span><br><span class="line">        </span><br><span class="line">        <span class="meta">@Sensitive(SensitiveType.BANK_CARD)</span></span><br><span class="line">        <span class="keyword">private</span> String bankCard;</span><br><span class="line">        </span><br><span class="line">        <span class="meta">@Sensitive(SensitiveType.ADDRESS)</span></span><br><span class="line">        <span class="keyword">private</span> String address;</span><br><span class="line">        </span><br><span class="line">        <span class="meta">@Sensitive(value = SensitiveType.CUSTOM, keepStart = 3, keepEnd = 3, maskChar = &quot;#&quot;)</span></span><br><span class="line">        <span class="keyword">private</span> <span class="type">String</span> <span class="variable">customField</span> <span class="operator">=</span> <span class="string">&quot;ThisIsACustomSensitiveField&quot;</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// getters and setters...</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="5-é«˜çº§ç‰¹æ€§"><a href="#5-é«˜çº§ç‰¹æ€§" class="headerlink" title="5. é«˜çº§ç‰¹æ€§"></a>5. é«˜çº§ç‰¹æ€§</h2><h3 id="5-1-æ‰¹é‡è„±æ•å¤„ç†"><a href="#5-1-æ‰¹é‡è„±æ•å¤„ç†" class="headerlink" title="5.1 æ‰¹é‡è„±æ•å¤„ç†"></a>5.1 æ‰¹é‡è„±æ•å¤„ç†</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æ‰¹é‡è„±æ•å¤„ç†</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> dataArray æ•°æ®æ•°ç»„</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> type è„±æ•ç±»å‹</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> è„±æ•åçš„æ•°æ®æ•°ç»„</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> String[] desensitizeBatch(String[] dataArray, SensitiveType type) &#123;</span><br><span class="line">    <span class="keyword">if</span> (dataArray == <span class="literal">null</span> || dataArray.length == <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> dataArray;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    String[] result = <span class="keyword">new</span> <span class="title class_">String</span>[dataArray.length];</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; dataArray.length; i++) &#123;</span><br><span class="line">        result[i] = desensitize(dataArray[i], type);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="5-2-æ¡ä»¶è„±æ•"><a href="#5-2-æ¡ä»¶è„±æ•" class="headerlink" title="5.2 æ¡ä»¶è„±æ•"></a>5.2 æ¡ä»¶è„±æ•</h3><p>æ ¹æ®ç”¨æˆ·è§’è‰²æˆ–æƒé™çº§åˆ«è¿›è¡Œæ¡ä»¶è„±æ•ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æ ¹æ®ç”¨æˆ·è§’è‰²è¿›è¡Œæ¡ä»¶è„±æ•</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">desensitizeByRole</span><span class="params">(String data, SensitiveType type, String userRole)</span> &#123;</span><br><span class="line">    <span class="comment">// ç®¡ç†å‘˜è§’è‰²ä¸è„±æ•</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="string">&quot;ADMIN&quot;</span>.equals(userRole)) &#123;</span><br><span class="line">        <span class="keyword">return</span> data;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// æ™®é€šç”¨æˆ·è¿›è¡Œè„±æ•</span></span><br><span class="line">    <span class="keyword">return</span> desensitize(data, type);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="5-3-è„±æ•è§„åˆ™åŠ¨æ€é…ç½®"><a href="#5-3-è„±æ•è§„åˆ™åŠ¨æ€é…ç½®" class="headerlink" title="5.3 è„±æ•è§„åˆ™åŠ¨æ€é…ç½®"></a>5.3 è„±æ•è§„åˆ™åŠ¨æ€é…ç½®</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DynamicSensitiveRuleManager</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Map&lt;String, SensitiveRule&gt; ruleCache = <span class="keyword">new</span> <span class="title class_">ConcurrentHashMap</span>&lt;&gt;();</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * åŠ¨æ€æ·»åŠ è„±æ•è§„åˆ™</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addRule</span><span class="params">(String fieldName, SensitiveType type, <span class="type">int</span> keepStart, <span class="type">int</span> keepEnd)</span> &#123;</span><br><span class="line">        <span class="type">SensitiveRule</span> <span class="variable">rule</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SensitiveRule</span>(type, keepStart, keepEnd, <span class="string">&quot;*&quot;</span>);</span><br><span class="line">        ruleCache.put(fieldName, rule);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ ¹æ®å­—æ®µåè·å–è„±æ•è§„åˆ™</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> SensitiveRule <span class="title function_">getRule</span><span class="params">(String fieldName)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> ruleCache.get(fieldName);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è„±æ•è§„åˆ™é…ç½®ç±»</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">SensitiveRule</span> &#123;</span><br><span class="line">        <span class="keyword">private</span> SensitiveType type;</span><br><span class="line">        <span class="keyword">private</span> <span class="type">int</span> keepStart;</span><br><span class="line">        <span class="keyword">private</span> <span class="type">int</span> keepEnd;</span><br><span class="line">        <span class="keyword">private</span> String maskChar;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// constructors, getters and setters...</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="5-4-å¤šç¯å¢ƒè„±æ•ç­–ç•¥"><a href="#5-4-å¤šç¯å¢ƒè„±æ•ç­–ç•¥" class="headerlink" title="5.4 å¤šç¯å¢ƒè„±æ•ç­–ç•¥"></a>5.4 å¤šç¯å¢ƒè„±æ•ç­–ç•¥</h3><p>ä¸åŒç¯å¢ƒä½¿ç”¨ä¸åŒçš„è„±æ•ç­–ç•¥ï¼š</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="comment"># application-dev.yml - å¼€å‘ç¯å¢ƒ</span></span><br><span class="line"><span class="attr">sensitive:</span></span><br><span class="line">  <span class="attr">enabled:</span> <span class="literal">false</span>  <span class="comment"># å¼€å‘ç¯å¢ƒä¸è„±æ•ï¼Œä¾¿äºè°ƒè¯•</span></span><br><span class="line">  </span><br><span class="line"><span class="comment"># application-test.yml - æµ‹è¯•ç¯å¢ƒ  </span></span><br><span class="line"><span class="attr">sensitive:</span></span><br><span class="line">  <span class="attr">enabled:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">enable-log:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">enable-json:</span> <span class="literal">true</span></span><br><span class="line">  </span><br><span class="line"><span class="comment"># application-prod.yml - ç”Ÿäº§ç¯å¢ƒ</span></span><br><span class="line"><span class="attr">sensitive:</span></span><br><span class="line">  <span class="attr">enabled:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">enable-log:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">enable-json:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">default-mask-char:</span> <span class="string">&quot;*&quot;</span></span><br></pre></td></tr></table></figure>

<h2 id="6-æœ€ä½³å®è·µ"><a href="#6-æœ€ä½³å®è·µ" class="headerlink" title="6. æœ€ä½³å®è·µ"></a>6. æœ€ä½³å®è·µ</h2><h3 id="6-1-æ³¨è§£ä½¿ç”¨æœ€ä½³å®è·µ"><a href="#6-1-æ³¨è§£ä½¿ç”¨æœ€ä½³å®è·µ" class="headerlink" title="6.1 æ³¨è§£ä½¿ç”¨æœ€ä½³å®è·µ"></a>6.1 æ³¨è§£ä½¿ç”¨æœ€ä½³å®è·µ</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Entity</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserProfile</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// âœ… æ¨èï¼šæ˜ç¡®æŒ‡å®šè„±æ•ç±»å‹</span></span><br><span class="line">    <span class="meta">@Sensitive(SensitiveType.MOBILE)</span></span><br><span class="line">    <span class="keyword">private</span> String phoneNumber;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// âœ… æ¨èï¼šè‡ªå®šä¹‰è„±æ•å‚æ•°</span></span><br><span class="line">    <span class="meta">@Sensitive(value = SensitiveType.CUSTOM, keepStart = 2, keepEnd = 4, maskChar = &quot;#&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String customerCode;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// âœ… æ¨èï¼šæ§åˆ¶è„±æ•åœºæ™¯</span></span><br><span class="line">    <span class="meta">@Sensitive(value = SensitiveType.EMAIL, enableLog = false, enableJson = true)</span></span><br><span class="line">    <span class="keyword">private</span> String email;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// âŒ ä¸æ¨èï¼šæ•æ„Ÿå­—æ®µä¸åŠ æ³¨è§£</span></span><br><span class="line">    <span class="keyword">private</span> String idCard; <span class="comment">// åº”è¯¥æ·»åŠ  @Sensitive(SensitiveType.ID_CARD)</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// âŒ ä¸æ¨èï¼šéæ•æ„Ÿå­—æ®µåŠ è„±æ•æ³¨è§£</span></span><br><span class="line">    <span class="meta">@Sensitive(SensitiveType.NAME)</span></span><br><span class="line">    <span class="keyword">private</span> String nickname; <span class="comment">// æ˜µç§°é€šå¸¸ä¸éœ€è¦è„±æ•</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="6-2-æ€§èƒ½ä¼˜åŒ–ç­–ç•¥"><a href="#6-2-æ€§èƒ½ä¼˜åŒ–ç­–ç•¥" class="headerlink" title="6.2 æ€§èƒ½ä¼˜åŒ–ç­–ç•¥"></a>6.2 æ€§èƒ½ä¼˜åŒ–ç­–ç•¥</h3><h4 id="ç¼“å­˜è„±æ•ç»“æœ"><a href="#ç¼“å­˜è„±æ•ç»“æœ" class="headerlink" title="ç¼“å­˜è„±æ•ç»“æœ"></a>ç¼“å­˜è„±æ•ç»“æœ</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CachedSensitiveUtil</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> LoadingCache&lt;String, String&gt; cache = Caffeine.newBuilder()</span><br><span class="line">            .maximumSize(<span class="number">10000</span>)</span><br><span class="line">            .expireAfterWrite(<span class="number">1</span>, TimeUnit.HOURS)</span><br><span class="line">            .build(key -&gt; &#123;</span><br><span class="line">                String[] parts = key.split(<span class="string">&quot;:&quot;</span>);</span><br><span class="line">                <span class="type">SensitiveType</span> <span class="variable">type</span> <span class="operator">=</span> SensitiveType.valueOf(parts[<span class="number">0</span>]);</span><br><span class="line">                <span class="type">String</span> <span class="variable">data</span> <span class="operator">=</span> parts[<span class="number">1</span>];</span><br><span class="line">                <span class="keyword">return</span> SensitiveUtil.desensitize(data, type);</span><br><span class="line">            &#125;);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">desensitizeWithCache</span><span class="params">(String data, SensitiveType type)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">key</span> <span class="operator">=</span> type.name() + <span class="string">&quot;:&quot;</span> + data;</span><br><span class="line">        <span class="keyword">return</span> cache.getUnchecked(key);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="å¼‚æ­¥è„±æ•å¤„ç†"><a href="#å¼‚æ­¥è„±æ•å¤„ç†" class="headerlink" title="å¼‚æ­¥è„±æ•å¤„ç†"></a>å¼‚æ­¥è„±æ•å¤„ç†</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AsyncSensitiveService</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Async(&quot;sensitiveExecutor&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> CompletableFuture&lt;List&lt;String&gt;&gt; <span class="title function_">desensitizeBatchAsync</span><span class="params">(List&lt;String&gt; dataList, SensitiveType type)</span> &#123;</span><br><span class="line">        List&lt;String&gt; result = dataList.parallelStream()</span><br><span class="line">                .map(data -&gt; SensitiveUtil.desensitize(data, type))</span><br><span class="line">                .collect(Collectors.toList());</span><br><span class="line">        <span class="keyword">return</span> CompletableFuture.completedFuture(result);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="6-3-å®‰å…¨æ€§è€ƒè™‘"><a href="#6-3-å®‰å…¨æ€§è€ƒè™‘" class="headerlink" title="6.3 å®‰å…¨æ€§è€ƒè™‘"></a>6.3 å®‰å…¨æ€§è€ƒè™‘</h3><h4 id="è„±æ•ç»“æœä¸å¯é€†"><a href="#è„±æ•ç»“æœä¸å¯é€†" class="headerlink" title="è„±æ•ç»“æœä¸å¯é€†"></a>è„±æ•ç»“æœä¸å¯é€†</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * ç¡®ä¿è„±æ•ç»“æœä¸å¯é€†</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SecureSensitiveUtil</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// âœ… æ­£ç¡®ï¼šå•å‘è„±æ•ï¼Œæ— æ³•è¿˜åŸ</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">secureDesensitize</span><span class="params">(String data, SensitiveType type)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">masked</span> <span class="operator">=</span> SensitiveUtil.desensitize(data, type);</span><br><span class="line">        <span class="comment">// é¢å¤–çš„å®‰å…¨å¤„ç†</span></span><br><span class="line">        <span class="keyword">return</span> addSecuritySalt(masked);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// âŒ é”™è¯¯ï¼šå¯é€†è„±æ•å­˜åœ¨å®‰å…¨é£é™©</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">reversibleDesensitize</span><span class="params">(String data)</span> &#123;</span><br><span class="line">        <span class="comment">// ä¸è¦å®ç°å¯é€†çš„è„±æ•ç®—æ³•</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;NEVER_IMPLEMENT_THIS&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> String <span class="title function_">addSecuritySalt</span><span class="params">(String data)</span> &#123;</span><br><span class="line">        <span class="comment">// æ·»åŠ å®‰å…¨ç›å€¼ï¼Œé˜²æ­¢ç¢°æ’æ”»å‡»</span></span><br><span class="line">        <span class="keyword">return</span> data + <span class="string">&quot;_SECURE&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="è„±æ•å®¡è®¡æ—¥å¿—"><a href="#è„±æ•å®¡è®¡æ—¥å¿—" class="headerlink" title="è„±æ•å®¡è®¡æ—¥å¿—"></a>è„±æ•å®¡è®¡æ—¥å¿—</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SensitiveAuditLogger</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">Logger</span> <span class="variable">auditLogger</span> <span class="operator">=</span> LoggerFactory.getLogger(<span class="string">&quot;SENSITIVE_AUDIT&quot;</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">logDesensitizeOperation</span><span class="params">(String userId, String fieldName, SensitiveType type)</span> &#123;</span><br><span class="line">        auditLogger.info(<span class="string">&quot;è„±æ•æ“ä½œ - ç”¨æˆ·: &#123;&#125;, å­—æ®µ: &#123;&#125;, ç±»å‹: &#123;&#125;, æ—¶é—´: &#123;&#125;&quot;</span>, </span><br><span class="line">                userId, fieldName, type, LocalDateTime.now());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="7-æ€§èƒ½ä¼˜åŒ–"><a href="#7-æ€§èƒ½ä¼˜åŒ–" class="headerlink" title="7. æ€§èƒ½ä¼˜åŒ–"></a>7. æ€§èƒ½ä¼˜åŒ–</h2><h3 id="7-1-æ€§èƒ½æµ‹è¯•ç»“æœ"><a href="#7-1-æ€§èƒ½æµ‹è¯•ç»“æœ" class="headerlink" title="7.1 æ€§èƒ½æµ‹è¯•ç»“æœ"></a>7.1 æ€§èƒ½æµ‹è¯•ç»“æœ</h3><p>æˆ‘ä»¬å¯¹è„±æ•ç³»ç»Ÿè¿›è¡Œäº†æ€§èƒ½æµ‹è¯•ï¼š</p>
<table>
<thead>
<tr>
<th>åœºæ™¯</th>
<th>æ•°æ®é‡</th>
<th>è€—æ—¶ï¼ˆmsï¼‰</th>
<th>QPS</th>
</tr>
</thead>
<tbody><tr>
<td>å•æ¡è„±æ•</td>
<td>1</td>
<td>0.1</td>
<td>10,000</td>
</tr>
<tr>
<td>æ‰¹é‡è„±æ•</td>
<td>1,000</td>
<td>15</td>
<td>66,667</td>
</tr>
<tr>
<td>JSONåºåˆ—åŒ–è„±æ•</td>
<td>100å¯¹è±¡</td>
<td>50</td>
<td>2,000</td>
</tr>
<tr>
<td>AOPæ‹¦æˆªè„±æ•</td>
<td>100å¯¹è±¡</td>
<td>80</td>
<td>1,250</td>
</tr>
</tbody></table>
<h3 id="7-2-æ€§èƒ½ä¼˜åŒ–å»ºè®®"><a href="#7-2-æ€§èƒ½ä¼˜åŒ–å»ºè®®" class="headerlink" title="7.2 æ€§èƒ½ä¼˜åŒ–å»ºè®®"></a>7.2 æ€§èƒ½ä¼˜åŒ–å»ºè®®</h3><h4 id="ä¼˜åŒ–1ï¼šå‡å°‘åå°„æ“ä½œ"><a href="#ä¼˜åŒ–1ï¼šå‡å°‘åå°„æ“ä½œ" class="headerlink" title="ä¼˜åŒ–1ï¼šå‡å°‘åå°„æ“ä½œ"></a>ä¼˜åŒ–1ï¼šå‡å°‘åå°„æ“ä½œ</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OptimizedSensitiveProcessor</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// ç¼“å­˜å­—æ®µä¿¡æ¯ï¼Œé¿å…é‡å¤åå°„</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Map&lt;Class&lt;?&gt;, List&lt;FieldInfo&gt;&gt; fieldCache = <span class="keyword">new</span> <span class="title class_">ConcurrentHashMap</span>&lt;&gt;();</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">processObject</span><span class="params">(Object obj)</span> &#123;</span><br><span class="line">        Class&lt;?&gt; clazz = obj.getClass();</span><br><span class="line">        List&lt;FieldInfo&gt; fields = fieldCache.computeIfAbsent(clazz, <span class="built_in">this</span>::extractSensitiveFields);</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">for</span> (FieldInfo fieldInfo : fields) &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="type">String</span> <span class="variable">value</span> <span class="operator">=</span> (String) fieldInfo.getField().get(obj);</span><br><span class="line">                <span class="type">String</span> <span class="variable">masked</span> <span class="operator">=</span> SensitiveUtil.desensitize(value, fieldInfo.getType());</span><br><span class="line">                fieldInfo.getField().set(obj, masked);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (IllegalAccessException e) &#123;</span><br><span class="line">                <span class="comment">// å¤„ç†å¼‚å¸¸</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> obj;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> List&lt;FieldInfo&gt; <span class="title function_">extractSensitiveFields</span><span class="params">(Class&lt;?&gt; clazz)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> Arrays.stream(clazz.getDeclaredFields())</span><br><span class="line">                .filter(field -&gt; field.isAnnotationPresent(Sensitive.class))</span><br><span class="line">                .filter(field -&gt; field.getType() == String.class)</span><br><span class="line">                .map(field -&gt; &#123;</span><br><span class="line">                    field.setAccessible(<span class="literal">true</span>);</span><br><span class="line">                    <span class="type">Sensitive</span> <span class="variable">annotation</span> <span class="operator">=</span> field.getAnnotation(Sensitive.class);</span><br><span class="line">                    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">FieldInfo</span>(field, annotation.value());</span><br><span class="line">                &#125;)</span><br><span class="line">                .collect(Collectors.toList());</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">FieldInfo</span> &#123;</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">final</span> Field field;</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">final</span> SensitiveType type;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// constructor, getters...</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="ä¼˜åŒ–2ï¼šå¹¶è¡Œå¤„ç†"><a href="#ä¼˜åŒ–2ï¼šå¹¶è¡Œå¤„ç†" class="headerlink" title="ä¼˜åŒ–2ï¼šå¹¶è¡Œå¤„ç†"></a>ä¼˜åŒ–2ï¼šå¹¶è¡Œå¤„ç†</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ParallelSensitiveProcessor</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> List&lt;String&gt; <span class="title function_">desensitizeBatch</span><span class="params">(List&lt;String&gt; dataList, SensitiveType type)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> dataList.parallelStream()</span><br><span class="line">                .map(data -&gt; SensitiveUtil.desensitize(data, type))</span><br><span class="line">                .collect(Collectors.toList());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="8-æ•…éšœæ’æŸ¥"><a href="#8-æ•…éšœæ’æŸ¥" class="headerlink" title="8. æ•…éšœæ’æŸ¥"></a>8. æ•…éšœæ’æŸ¥</h2><h3 id="8-1-å¸¸è§é—®é¢˜åŠè§£å†³æ–¹æ¡ˆ"><a href="#8-1-å¸¸è§é—®é¢˜åŠè§£å†³æ–¹æ¡ˆ" class="headerlink" title="8.1 å¸¸è§é—®é¢˜åŠè§£å†³æ–¹æ¡ˆ"></a>8.1 å¸¸è§é—®é¢˜åŠè§£å†³æ–¹æ¡ˆ</h3><h4 id="é—®é¢˜1ï¼šLocalDateTime-åºåˆ—åŒ–å¼‚å¸¸"><a href="#é—®é¢˜1ï¼šLocalDateTime-åºåˆ—åŒ–å¼‚å¸¸" class="headerlink" title="é—®é¢˜1ï¼šLocalDateTime åºåˆ—åŒ–å¼‚å¸¸"></a>é—®é¢˜1ï¼šLocalDateTime åºåˆ—åŒ–å¼‚å¸¸</h4><p><strong>é”™è¯¯ä¿¡æ¯</strong>ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">Java 8 date/time type `java.time.LocalDateTime` not supported by default</span><br></pre></td></tr></table></figure>

<p><strong>è§£å†³æ–¹æ¡ˆ</strong>ï¼š</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!-- æ·»åŠ  Jackson JSR310 ä¾èµ– --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.fasterxml.jackson.datatype<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jackson-datatype-jsr310<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// åœ¨é…ç½®ç±»ä¸­æ³¨å†Œ JSR310 æ¨¡å—</span></span><br><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="meta">@Primary</span></span><br><span class="line"><span class="keyword">public</span> ObjectMapper <span class="title function_">sensitiveObjectMapper</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">ObjectMapper</span> <span class="variable">objectMapper</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectMapper</span>();</span><br><span class="line">    objectMapper.registerModule(<span class="keyword">new</span> <span class="title class_">JavaTimeModule</span>());</span><br><span class="line">    objectMapper.disable(SerializationFeature.WRITE_DATES_AS_TIMESTAMPS);</span><br><span class="line">    <span class="comment">// ... å…¶ä»–é…ç½®</span></span><br><span class="line">    <span class="keyword">return</span> objectMapper;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="é—®é¢˜2ï¼šè„±æ•åŠŸèƒ½ä¸ç”Ÿæ•ˆ"><a href="#é—®é¢˜2ï¼šè„±æ•åŠŸèƒ½ä¸ç”Ÿæ•ˆ" class="headerlink" title="é—®é¢˜2ï¼šè„±æ•åŠŸèƒ½ä¸ç”Ÿæ•ˆ"></a>é—®é¢˜2ï¼šè„±æ•åŠŸèƒ½ä¸ç”Ÿæ•ˆ</h4><p><strong>å¯èƒ½åŸå› </strong>ï¼š</p>
<ul>
<li>è„±æ•åŠŸèƒ½è¢«ç¦ç”¨</li>
<li>æ³¨è§£ä½¿ç”¨ä¸æ­£ç¡®</li>
<li>AOP é…ç½®é—®é¢˜</li>
</ul>
<p><strong>æ’æŸ¥æ­¥éª¤</strong>ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SensitiveDebugController</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> SensitiveConfig.SensitiveProperties sensitiveProperties;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@GetMapping(&quot;/debug/sensitive-config&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Map&lt;String, Object&gt; <span class="title function_">debugConfig</span><span class="params">()</span> &#123;</span><br><span class="line">        Map&lt;String, Object&gt; config = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">        config.put(<span class="string">&quot;enabled&quot;</span>, sensitiveProperties.isEnabled());</span><br><span class="line">        config.put(<span class="string">&quot;enableLog&quot;</span>, sensitiveProperties.isEnableLog());</span><br><span class="line">        config.put(<span class="string">&quot;enableJson&quot;</span>, sensitiveProperties.isEnableJson());</span><br><span class="line">        config.put(<span class="string">&quot;defaultMaskChar&quot;</span>, sensitiveProperties.getDefaultMaskChar());</span><br><span class="line">        <span class="keyword">return</span> config;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="é—®é¢˜3ï¼šæ€§èƒ½é—®é¢˜"><a href="#é—®é¢˜3ï¼šæ€§èƒ½é—®é¢˜" class="headerlink" title="é—®é¢˜3ï¼šæ€§èƒ½é—®é¢˜"></a>é—®é¢˜3ï¼šæ€§èƒ½é—®é¢˜</h4><p><strong>æ€§èƒ½åˆ†æ</strong>ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SensitivePerformanceMonitor</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">Logger</span> <span class="variable">perfLogger</span> <span class="operator">=</span> LoggerFactory.getLogger(<span class="string">&quot;PERFORMANCE&quot;</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">monitorDesensitize</span><span class="params">(String data, SensitiveType type)</span> &#123;</span><br><span class="line">        <span class="type">long</span> <span class="variable">startTime</span> <span class="operator">=</span> System.nanoTime();</span><br><span class="line">        <span class="type">String</span> <span class="variable">result</span> <span class="operator">=</span> SensitiveUtil.desensitize(data, type);</span><br><span class="line">        <span class="type">long</span> <span class="variable">duration</span> <span class="operator">=</span> System.nanoTime() - startTime;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> (duration &gt; <span class="number">1_000_000</span>) &#123; <span class="comment">// è¶…è¿‡1msè®°å½•æ—¥å¿—</span></span><br><span class="line">            perfLogger.warn(<span class="string">&quot;è„±æ•æ“ä½œè€—æ—¶è¿‡é•¿: &#123;&#125;ns, ç±»å‹: &#123;&#125;, æ•°æ®é•¿åº¦: &#123;&#125;&quot;</span>, </span><br><span class="line">                    duration, type, data.length());</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="8-2-ç›‘æ§å’Œå‘Šè­¦"><a href="#8-2-ç›‘æ§å’Œå‘Šè­¦" class="headerlink" title="8.2 ç›‘æ§å’Œå‘Šè­¦"></a>8.2 ç›‘æ§å’Œå‘Šè­¦</h3><h4 id="è„±æ•æ“ä½œç›‘æ§"><a href="#è„±æ•æ“ä½œç›‘æ§" class="headerlink" title="è„±æ•æ“ä½œç›‘æ§"></a>è„±æ•æ“ä½œç›‘æ§</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SensitiveMetrics</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">Counter</span> <span class="variable">desensitizeCounter</span> <span class="operator">=</span> Counter.builder(<span class="string">&quot;sensitive.desensitize&quot;</span>)</span><br><span class="line">            .description(<span class="string">&quot;è„±æ•æ“ä½œè®¡æ•°&quot;</span>)</span><br><span class="line">            .register(Metrics.globalRegistry);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">Timer</span> <span class="variable">desensitizeTimer</span> <span class="operator">=</span> Timer.builder(<span class="string">&quot;sensitive.desensitize.duration&quot;</span>)</span><br><span class="line">            .description(<span class="string">&quot;è„±æ•æ“ä½œè€—æ—¶&quot;</span>)</span><br><span class="line">            .register(Metrics.globalRegistry);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">desensitizeWithMetrics</span><span class="params">(String data, SensitiveType type)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> desensitizeTimer.recordCallable(() -&gt; &#123;</span><br><span class="line">            desensitizeCounter.increment(Tags.of(<span class="string">&quot;type&quot;</span>, type.name()));</span><br><span class="line">            <span class="keyword">return</span> SensitiveUtil.desensitize(data, type);</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="å‘Šè­¦è§„åˆ™é…ç½®"><a href="#å‘Šè­¦è§„åˆ™é…ç½®" class="headerlink" title="å‘Šè­¦è§„åˆ™é…ç½®"></a>å‘Šè­¦è§„åˆ™é…ç½®</h4><figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Prometheus å‘Šè­¦è§„åˆ™</span></span><br><span class="line"><span class="attr">groups:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">sensitive_alerts</span></span><br><span class="line">    <span class="attr">rules:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">alert:</span> <span class="string">HighDesensitizeLatency</span></span><br><span class="line">        <span class="attr">expr:</span> <span class="string">histogram_quantile(0.95,</span> <span class="string">sensitive_desensitize_duration_seconds)</span> <span class="string">&gt;</span> <span class="number">0.1</span></span><br><span class="line">        <span class="attr">for:</span> <span class="string">5m</span></span><br><span class="line">        <span class="attr">labels:</span></span><br><span class="line">          <span class="attr">severity:</span> <span class="string">warning</span></span><br><span class="line">        <span class="attr">annotations:</span></span><br><span class="line">          <span class="attr">summary:</span> <span class="string">&quot;è„±æ•æ“ä½œå»¶è¿Ÿè¿‡é«˜&quot;</span></span><br><span class="line">          <span class="attr">description:</span> <span class="string">&quot;95%åˆ†ä½è„±æ•æ“ä½œè€—æ—¶è¶…è¿‡100ms&quot;</span></span><br><span class="line">      </span><br><span class="line">      <span class="bullet">-</span> <span class="attr">alert:</span> <span class="string">DesensitizeErrorRate</span></span><br><span class="line">        <span class="attr">expr:</span> <span class="string">rate(sensitive_desensitize_errors_total[5m])</span> <span class="string">&gt;</span> <span class="number">0.01</span></span><br><span class="line">        <span class="attr">for:</span> <span class="string">2m</span></span><br><span class="line">        <span class="attr">labels:</span></span><br><span class="line">          <span class="attr">severity:</span> <span class="string">critical</span></span><br><span class="line">        <span class="attr">annotations:</span></span><br><span class="line">          <span class="attr">summary:</span> <span class="string">&quot;è„±æ•æ“ä½œé”™è¯¯ç‡è¿‡é«˜&quot;</span></span><br><span class="line">          <span class="attr">description:</span> <span class="string">&quot;è„±æ•æ“ä½œé”™è¯¯ç‡è¶…è¿‡1%&quot;</span></span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>web</category>
      </categories>
      <tags>
        <tag>springboot</tag>
      </tags>
  </entry>
  <entry>
    <title>SpringBootç»Ÿä¸€é”™è¯¯å¤„ç†å®ç°æŒ‡å—</title>
    <url>/2025/09/15/web/SpringBoot%E7%BB%9F%E4%B8%80%E9%94%99%E8%AF%AF%E5%A4%84%E7%90%86%E5%AE%9E%E7%8E%B0%E6%8C%87%E5%8D%97/</url>
    <content><![CDATA[<h2 id="æ¦‚è¿°"><a href="#æ¦‚è¿°" class="headerlink" title="æ¦‚è¿°"></a>æ¦‚è¿°</h2><p>æœ¬æ–‡æ¡£è¯¦ç»†è®°å½•äº†å¦‚ä½•åœ¨Spring Booté¡¹ç›®ä¸­å®ç°ç»Ÿä¸€çš„é”™è¯¯å¤„ç†ç³»ç»Ÿï¼ŒåŒ…æ‹¬æ ‡å‡†åŒ–é”™è¯¯ç ã€ç»Ÿä¸€å“åº”æ ¼å¼ã€å…¨å±€å¼‚å¸¸å¤„ç†å’Œæ–­è¨€å·¥å…·ç±»ã€‚</p>
<h2 id="é¡¹ç›®ç»“æ„"><a href="#é¡¹ç›®ç»“æ„" class="headerlink" title="é¡¹ç›®ç»“æ„"></a>é¡¹ç›®ç»“æ„</h2><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">src/main/java/com/yourpackage/</span><br><span class="line">â”œâ”€â”€ constant/</span><br><span class="line">â”‚   â””â”€â”€ ErrorCode.java          # æ ‡å‡†åŒ–é”™è¯¯ç æšä¸¾</span><br><span class="line">â”œâ”€â”€ vo/</span><br><span class="line">â”‚   â””â”€â”€ ApiResponse.java        # ç»Ÿä¸€å“åº”ç»“æœç±»</span><br><span class="line">â”œâ”€â”€ exception/</span><br><span class="line">â”‚   â”œâ”€â”€ BusinessException.java  # ä¸šåŠ¡å¼‚å¸¸ç±»</span><br><span class="line">â”‚   â””â”€â”€ GlobalExceptionHandler.java # å…¨å±€å¼‚å¸¸å¤„ç†å™¨</span><br><span class="line">â”œâ”€â”€ util/</span><br><span class="line">â”‚   â””â”€â”€ AssertUtil.java         # æ–­è¨€å·¥å…·ç±»</span><br><span class="line">â””â”€â”€ controller/</span><br><span class="line">    â””â”€â”€ TestController.java     # ä½¿ç”¨ç¤ºä¾‹</span><br></pre></td></tr></table></figure>

<h2 id="å®ç°æ­¥éª¤"><a href="#å®ç°æ­¥éª¤" class="headerlink" title="å®ç°æ­¥éª¤"></a>å®ç°æ­¥éª¤</h2><h3 id="1-æ·»åŠ ä¾èµ–"><a href="#1-æ·»åŠ ä¾èµ–" class="headerlink" title="1. æ·»åŠ ä¾èµ–"></a>1. æ·»åŠ ä¾èµ–</h3><p>åœ¨ <code>pom.xml</code> ä¸­æ·»åŠ éªŒè¯ä¾èµ–ï¼š</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-validation<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="2-åˆ›å»ºæ ‡å‡†åŒ–é”™è¯¯ç æšä¸¾"><a href="#2-åˆ›å»ºæ ‡å‡†åŒ–é”™è¯¯ç æšä¸¾" class="headerlink" title="2. åˆ›å»ºæ ‡å‡†åŒ–é”™è¯¯ç æšä¸¾"></a>2. åˆ›å»ºæ ‡å‡†åŒ–é”™è¯¯ç æšä¸¾</h3><p><strong>æ–‡ä»¶è·¯å¾„</strong>: <code>src/main/java/com/yourpackage/constant/ErrorCode.java</code></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.yourpackage.constant;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.http.HttpStatus;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æ ‡å‡†åŒ–é”™è¯¯ç æšä¸¾</span></span><br><span class="line"><span class="comment"> * æ ¼å¼: ABCD-EFGH</span></span><br><span class="line"><span class="comment"> * ABCD: æ¨¡å—æ ‡è¯†</span></span><br><span class="line"><span class="comment"> * EFGH: é”™è¯¯åºå·</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">enum</span> <span class="title class_">ErrorCode</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æˆåŠŸçŠ¶æ€ç </span></span><br><span class="line">    SUCCESS(<span class="string">&quot;0000-0000&quot;</span>, <span class="string">&quot;æ“ä½œæˆåŠŸ&quot;</span>, HttpStatus.OK),</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// é€šç”¨é”™è¯¯ç </span></span><br><span class="line">    SYSTEM_ERROR(<span class="string">&quot;1000-0001&quot;</span>, <span class="string">&quot;ç³»ç»Ÿç¹å¿™ï¼Œè¯·ç¨åé‡è¯•&quot;</span>, HttpStatus.INTERNAL_SERVER_ERROR),</span><br><span class="line">    PARAM_ERROR(<span class="string">&quot;1000-0002&quot;</span>, <span class="string">&quot;å‚æ•°é”™è¯¯&quot;</span>, HttpStatus.BAD_REQUEST),</span><br><span class="line">    UNAUTHORIZED(<span class="string">&quot;1000-0003&quot;</span>, <span class="string">&quot;æœªæˆæƒè®¿é—®&quot;</span>, HttpStatus.UNAUTHORIZED),</span><br><span class="line">    FORBIDDEN(<span class="string">&quot;1000-0004&quot;</span>, <span class="string">&quot;æƒé™ä¸è¶³&quot;</span>, HttpStatus.FORBIDDEN),</span><br><span class="line">    NOT_FOUND(<span class="string">&quot;1000-0005&quot;</span>, <span class="string">&quot;èµ„æºä¸å­˜åœ¨&quot;</span>, HttpStatus.NOT_FOUND),</span><br><span class="line">    METHOD_NOT_ALLOWED(<span class="string">&quot;1000-0006&quot;</span>, <span class="string">&quot;è¯·æ±‚æ–¹æ³•ä¸æ”¯æŒ&quot;</span>, HttpStatus.METHOD_NOT_ALLOWED),</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// ç”¨æˆ·æ¨¡å—é”™è¯¯ç </span></span><br><span class="line">    USER_NOT_FOUND(<span class="string">&quot;2000-0001&quot;</span>, <span class="string">&quot;ç”¨æˆ·ä¸å­˜åœ¨&quot;</span>, HttpStatus.NOT_FOUND),</span><br><span class="line">    USER_ALREADY_EXISTS(<span class="string">&quot;2000-0002&quot;</span>, <span class="string">&quot;ç”¨æˆ·å·²å­˜åœ¨&quot;</span>, HttpStatus.CONFLICT),</span><br><span class="line">    USER_DISABLED(<span class="string">&quot;2000-0003&quot;</span>, <span class="string">&quot;ç”¨æˆ·å·²è¢«ç¦ç”¨&quot;</span>, HttpStatus.FORBIDDEN),</span><br><span class="line">    PASSWORD_ERROR(<span class="string">&quot;2000-0004&quot;</span>, <span class="string">&quot;å¯†ç é”™è¯¯&quot;</span>, HttpStatus.UNAUTHORIZED),</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// è®¤è¯æˆæƒé”™è¯¯ç </span></span><br><span class="line">    TOKEN_EXPIRED(<span class="string">&quot;3000-0001&quot;</span>, <span class="string">&quot;ä»¤ç‰Œå·²è¿‡æœŸ&quot;</span>, HttpStatus.UNAUTHORIZED),</span><br><span class="line">    TOKEN_INVALID(<span class="string">&quot;3000-0002&quot;</span>, <span class="string">&quot;ä»¤ç‰Œæ— æ•ˆ&quot;</span>, HttpStatus.UNAUTHORIZED),</span><br><span class="line">    LOGIN_REQUIRED(<span class="string">&quot;3000-0003&quot;</span>, <span class="string">&quot;è¯·å…ˆç™»å½•&quot;</span>, HttpStatus.UNAUTHORIZED),</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// é—®å·æ¨¡å—é”™è¯¯ç </span></span><br><span class="line">    SURVEY_NOT_FOUND(<span class="string">&quot;4000-0001&quot;</span>, <span class="string">&quot;é—®å·ä¸å­˜åœ¨&quot;</span>, HttpStatus.NOT_FOUND),</span><br><span class="line">    SURVEY_EXPIRED(<span class="string">&quot;4000-0002&quot;</span>, <span class="string">&quot;é—®å·å·²è¿‡æœŸ&quot;</span>, HttpStatus.BAD_REQUEST),</span><br><span class="line">    SURVEY_ALREADY_SUBMITTED(<span class="string">&quot;4000-0003&quot;</span>, <span class="string">&quot;é—®å·å·²æäº¤&quot;</span>, HttpStatus.CONFLICT),</span><br><span class="line">    QUESTION_NOT_FOUND(<span class="string">&quot;4000-0004&quot;</span>, <span class="string">&quot;é—®é¢˜ä¸å­˜åœ¨&quot;</span>, HttpStatus.NOT_FOUND),</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// æ•°æ®æ¨¡å—é”™è¯¯ç </span></span><br><span class="line">    DATA_NOT_FOUND(<span class="string">&quot;5000-0001&quot;</span>, <span class="string">&quot;æ•°æ®ä¸å­˜åœ¨&quot;</span>, HttpStatus.NOT_FOUND),</span><br><span class="line">    DATA_DUPLICATE(<span class="string">&quot;5000-0002&quot;</span>, <span class="string">&quot;æ•°æ®é‡å¤&quot;</span>, HttpStatus.CONFLICT),</span><br><span class="line">    DATA_INVALID(<span class="string">&quot;5000-0003&quot;</span>, <span class="string">&quot;æ•°æ®æ— æ•ˆ&quot;</span>, HttpStatus.BAD_REQUEST),</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// æ–‡ä»¶æ¨¡å—é”™è¯¯ç </span></span><br><span class="line">    FILE_UPLOAD_FAILED(<span class="string">&quot;6000-0001&quot;</span>, <span class="string">&quot;æ–‡ä»¶ä¸Šä¼ å¤±è´¥&quot;</span>, HttpStatus.INTERNAL_SERVER_ERROR),</span><br><span class="line">    FILE_NOT_FOUND(<span class="string">&quot;6000-0002&quot;</span>, <span class="string">&quot;æ–‡ä»¶ä¸å­˜åœ¨&quot;</span>, HttpStatus.NOT_FOUND),</span><br><span class="line">    FILE_TYPE_NOT_SUPPORTED(<span class="string">&quot;6000-0003&quot;</span>, <span class="string">&quot;æ–‡ä»¶ç±»å‹ä¸æ”¯æŒ&quot;</span>, HttpStatus.BAD_REQUEST),</span><br><span class="line">    FILE_SIZE_EXCEEDED(<span class="string">&quot;6000-0004&quot;</span>, <span class="string">&quot;æ–‡ä»¶å¤§å°è¶…å‡ºé™åˆ¶&quot;</span>, HttpStatus.BAD_REQUEST);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> String code;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> String message;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> HttpStatus httpStatus;</span><br><span class="line"></span><br><span class="line">    ErrorCode(String code, String message, HttpStatus httpStatus) &#123;</span><br><span class="line">        <span class="built_in">this</span>.code = code;</span><br><span class="line">        <span class="built_in">this</span>.message = message;</span><br><span class="line">        <span class="built_in">this</span>.httpStatus = httpStatus;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getCode</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> code;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getMessage</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> message;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> HttpStatus <span class="title function_">getHttpStatus</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> httpStatus;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> ErrorCode <span class="title function_">fromCode</span><span class="params">(String code)</span> &#123;</span><br><span class="line">        <span class="keyword">for</span> (ErrorCode errorCode : ErrorCode.values()) &#123;</span><br><span class="line">            <span class="keyword">if</span> (errorCode.getCode().equals(code)) &#123;</span><br><span class="line">                <span class="keyword">return</span> errorCode;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> SYSTEM_ERROR;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="3-åˆ›å»ºç»Ÿä¸€å“åº”ç»“æœç±»"><a href="#3-åˆ›å»ºç»Ÿä¸€å“åº”ç»“æœç±»" class="headerlink" title="3. åˆ›å»ºç»Ÿä¸€å“åº”ç»“æœç±»"></a>3. åˆ›å»ºç»Ÿä¸€å“åº”ç»“æœç±»</h3><p><strong>æ–‡ä»¶è·¯å¾„</strong>: <code>src/main/java/com/yourpackage/vo/ApiResponse.java</code></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.yourpackage.vo;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.annotation.JsonInclude;</span><br><span class="line"><span class="keyword">import</span> com.yourpackage.constant.ErrorCode;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.time.LocalDateTime;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * ç»Ÿä¸€APIå“åº”ç»“æœç±»</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> &lt;T&gt; å“åº”æ•°æ®ç±»å‹</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@JsonInclude(JsonInclude.Include.NON_NULL)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ApiResponse</span>&lt;T&gt; &#123;</span><br><span class="line">    <span class="keyword">private</span> String code;</span><br><span class="line">    <span class="keyword">private</span> String message;</span><br><span class="line">    <span class="keyword">private</span> T data;</span><br><span class="line">    <span class="keyword">private</span> LocalDateTime timestamp;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">ApiResponse</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.timestamp = LocalDateTime.now();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">ApiResponse</span><span class="params">(String code, String message, T data)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>();</span><br><span class="line">        <span class="built_in">this</span>.code = code;</span><br><span class="line">        <span class="built_in">this</span>.message = message;</span><br><span class="line">        <span class="built_in">this</span>.data = data;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> &lt;T&gt; ApiResponse&lt;T&gt; <span class="title function_">success</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ApiResponse</span>&lt;&gt;(ErrorCode.SUCCESS.getCode(), ErrorCode.SUCCESS.getMessage(), <span class="literal">null</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> &lt;T&gt; ApiResponse&lt;T&gt; <span class="title function_">success</span><span class="params">(T data)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ApiResponse</span>&lt;&gt;(ErrorCode.SUCCESS.getCode(), ErrorCode.SUCCESS.getMessage(), data);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> &lt;T&gt; ApiResponse&lt;T&gt; <span class="title function_">success</span><span class="params">(String message, T data)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ApiResponse</span>&lt;&gt;(ErrorCode.SUCCESS.getCode(), message, data);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> &lt;T&gt; ApiResponse&lt;T&gt; <span class="title function_">error</span><span class="params">(ErrorCode errorCode)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ApiResponse</span>&lt;&gt;(errorCode.getCode(), errorCode.getMessage(), <span class="literal">null</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> &lt;T&gt; ApiResponse&lt;T&gt; <span class="title function_">error</span><span class="params">(ErrorCode errorCode, String message)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ApiResponse</span>&lt;&gt;(errorCode.getCode(), message, <span class="literal">null</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> &lt;T&gt; ApiResponse&lt;T&gt; <span class="title function_">error</span><span class="params">(String code, String message)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ApiResponse</span>&lt;&gt;(code, message, <span class="literal">null</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> &lt;T&gt; ApiResponse&lt;T&gt; <span class="title function_">error</span><span class="params">(ErrorCode errorCode, T data)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ApiResponse</span>&lt;&gt;(errorCode.getCode(), errorCode.getMessage(), data);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> &lt;T&gt; ApiResponseBuilder&lt;T&gt; <span class="title function_">builder</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ApiResponseBuilder</span>&lt;&gt;();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">ApiResponseBuilder</span>&lt;T&gt; &#123;</span><br><span class="line">        <span class="keyword">private</span> String code;</span><br><span class="line">        <span class="keyword">private</span> String message;</span><br><span class="line">        <span class="keyword">private</span> T data;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> ApiResponseBuilder&lt;T&gt; <span class="title function_">code</span><span class="params">(String code)</span> &#123;</span><br><span class="line">            <span class="built_in">this</span>.code = code;</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">this</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> ApiResponseBuilder&lt;T&gt; <span class="title function_">message</span><span class="params">(String message)</span> &#123;</span><br><span class="line">            <span class="built_in">this</span>.message = message;</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">this</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> ApiResponseBuilder&lt;T&gt; <span class="title function_">data</span><span class="params">(T data)</span> &#123;</span><br><span class="line">            <span class="built_in">this</span>.data = data;</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">this</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> ApiResponse&lt;T&gt; <span class="title function_">build</span><span class="params">()</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ApiResponse</span>&lt;&gt;(code, message, data);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Getters and Setters</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getCode</span><span class="params">()</span> &#123; <span class="keyword">return</span> code; &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setCode</span><span class="params">(String code)</span> &#123; <span class="built_in">this</span>.code = code; &#125;</span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getMessage</span><span class="params">()</span> &#123; <span class="keyword">return</span> message; &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setMessage</span><span class="params">(String message)</span> &#123; <span class="built_in">this</span>.message = message; &#125;</span><br><span class="line">    <span class="keyword">public</span> T <span class="title function_">getData</span><span class="params">()</span> &#123; <span class="keyword">return</span> data; &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setData</span><span class="params">(T data)</span> &#123; <span class="built_in">this</span>.data = data; &#125;</span><br><span class="line">    <span class="keyword">public</span> LocalDateTime <span class="title function_">getTimestamp</span><span class="params">()</span> &#123; <span class="keyword">return</span> timestamp; &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setTimestamp</span><span class="params">(LocalDateTime timestamp)</span> &#123; <span class="built_in">this</span>.timestamp = timestamp; &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="4-åˆ›å»ºä¸šåŠ¡å¼‚å¸¸ç±»"><a href="#4-åˆ›å»ºä¸šåŠ¡å¼‚å¸¸ç±»" class="headerlink" title="4. åˆ›å»ºä¸šåŠ¡å¼‚å¸¸ç±»"></a>4. åˆ›å»ºä¸šåŠ¡å¼‚å¸¸ç±»</h3><p><strong>æ–‡ä»¶è·¯å¾„</strong>: <code>src/main/java/com/yourpackage/exception/BusinessException.java</code></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.yourpackage.exception;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.yourpackage.constant.ErrorCode;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * ä¸šåŠ¡å¼‚å¸¸ç±»</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BusinessException</span> <span class="keyword">extends</span> <span class="title class_">RuntimeException</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> ErrorCode errorCode;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Object[] args;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">BusinessException</span><span class="params">(ErrorCode errorCode)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>(errorCode.getMessage());</span><br><span class="line">        <span class="built_in">this</span>.errorCode = errorCode;</span><br><span class="line">        <span class="built_in">this</span>.args = <span class="keyword">new</span> <span class="title class_">Object</span>[<span class="number">0</span>];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">BusinessException</span><span class="params">(ErrorCode errorCode, String message)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>(message);</span><br><span class="line">        <span class="built_in">this</span>.errorCode = errorCode;</span><br><span class="line">        <span class="built_in">this</span>.args = <span class="keyword">new</span> <span class="title class_">Object</span>[<span class="number">0</span>];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">BusinessException</span><span class="params">(ErrorCode errorCode, Object... args)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>(errorCode.getMessage());</span><br><span class="line">        <span class="built_in">this</span>.errorCode = errorCode;</span><br><span class="line">        <span class="built_in">this</span>.args = args;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">BusinessException</span><span class="params">(ErrorCode errorCode, Throwable cause)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>(errorCode.getMessage(), cause);</span><br><span class="line">        <span class="built_in">this</span>.errorCode = errorCode;</span><br><span class="line">        <span class="built_in">this</span>.args = <span class="keyword">new</span> <span class="title class_">Object</span>[<span class="number">0</span>];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> ErrorCode <span class="title function_">getErrorCode</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> errorCode;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Object[] getArgs() &#123;</span><br><span class="line">        <span class="keyword">return</span> args;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getFormattedMessage</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (args != <span class="literal">null</span> &amp;&amp; args.length &gt; <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> String.format(errorCode.getMessage(), args);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> errorCode.getMessage();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="5-åˆ›å»ºå…¨å±€å¼‚å¸¸å¤„ç†å™¨"><a href="#5-åˆ›å»ºå…¨å±€å¼‚å¸¸å¤„ç†å™¨" class="headerlink" title="5. åˆ›å»ºå…¨å±€å¼‚å¸¸å¤„ç†å™¨"></a>5. åˆ›å»ºå…¨å±€å¼‚å¸¸å¤„ç†å™¨</h3><p><strong>æ–‡ä»¶è·¯å¾„</strong>: <code>src/main/java/com/yourpackage/exception/GlobalExceptionHandler.java</code></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.yourpackage.exception;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.yourpackage.constant.ErrorCode;</span><br><span class="line"><span class="keyword">import</span> com.yourpackage.vo.ApiResponse;</span><br><span class="line"><span class="keyword">import</span> org.slf4j.Logger;</span><br><span class="line"><span class="keyword">import</span> org.slf4j.LoggerFactory;</span><br><span class="line"><span class="keyword">import</span> org.springframework.http.converter.HttpMessageNotReadableException;</span><br><span class="line"><span class="keyword">import</span> org.springframework.validation.BindException;</span><br><span class="line"><span class="keyword">import</span> org.springframework.validation.BindingResult;</span><br><span class="line"><span class="keyword">import</span> org.springframework.validation.FieldError;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.HttpRequestMethodNotSupportedException;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.MethodArgumentNotValidException;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.MissingServletRequestParameterException;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.ExceptionHandler;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RestControllerAdvice;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.method.annotation.MethodArgumentTypeMismatchException;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.servlet.NoHandlerFoundException;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.validation.ConstraintViolation;</span><br><span class="line"><span class="keyword">import</span> javax.validation.ConstraintViolationException;</span><br><span class="line"><span class="keyword">import</span> java.util.stream.Collectors;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * å…¨å±€å¼‚å¸¸å¤„ç†å™¨</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@RestControllerAdvice</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">GlobalExceptionHandler</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">Logger</span> <span class="variable">logger</span> <span class="operator">=</span> LoggerFactory.getLogger(GlobalExceptionHandler.class);</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å¤„ç†ä¸šåŠ¡å¼‚å¸¸</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@ExceptionHandler(BusinessException.class)</span></span><br><span class="line">    <span class="keyword">public</span> ApiResponse&lt;Void&gt; <span class="title function_">handleBusinessException</span><span class="params">(BusinessException e)</span> &#123;</span><br><span class="line">        logger.warn(<span class="string">&quot;ä¸šåŠ¡å¼‚å¸¸: &#123;&#125;&quot;</span>, e.getFormattedMessage(), e);</span><br><span class="line">        <span class="keyword">return</span> ApiResponse.error(e.getErrorCode(), e.getFormattedMessage());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å¤„ç†å‚æ•°æ ¡éªŒå¼‚å¸¸</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@ExceptionHandler(MethodArgumentNotValidException.class)</span></span><br><span class="line">    <span class="keyword">public</span> ApiResponse&lt;Void&gt; <span class="title function_">handleMethodArgumentNotValidException</span><span class="params">(MethodArgumentNotValidException e)</span> &#123;</span><br><span class="line">        <span class="type">BindingResult</span> <span class="variable">bindingResult</span> <span class="operator">=</span> e.getBindingResult();</span><br><span class="line">        <span class="type">String</span> <span class="variable">errorMessage</span> <span class="operator">=</span> bindingResult.getFieldErrors().stream()</span><br><span class="line">                .map(FieldError::getDefaultMessage)</span><br><span class="line">                .collect(Collectors.joining(<span class="string">&quot;, &quot;</span>));</span><br><span class="line">        logger.warn(<span class="string">&quot;å‚æ•°æ ¡éªŒå¼‚å¸¸: &#123;&#125;&quot;</span>, errorMessage);</span><br><span class="line">        <span class="keyword">return</span> ApiResponse.error(ErrorCode.PARAM_ERROR, errorMessage);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å¤„ç†ç»‘å®šå¼‚å¸¸</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@ExceptionHandler(BindException.class)</span></span><br><span class="line">    <span class="keyword">public</span> ApiResponse&lt;Void&gt; <span class="title function_">handleBindException</span><span class="params">(BindException e)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">errorMessage</span> <span class="operator">=</span> e.getFieldErrors().stream()</span><br><span class="line">                .map(FieldError::getDefaultMessage)</span><br><span class="line">                .collect(Collectors.joining(<span class="string">&quot;, &quot;</span>));</span><br><span class="line">        logger.warn(<span class="string">&quot;ç»‘å®šå¼‚å¸¸: &#123;&#125;&quot;</span>, errorMessage);</span><br><span class="line">        <span class="keyword">return</span> ApiResponse.error(ErrorCode.PARAM_ERROR, errorMessage);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å¤„ç†çº¦æŸè¿åå¼‚å¸¸</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@ExceptionHandler(ConstraintViolationException.class)</span></span><br><span class="line">    <span class="keyword">public</span> ApiResponse&lt;Void&gt; <span class="title function_">handleConstraintViolationException</span><span class="params">(ConstraintViolationException e)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">errorMessage</span> <span class="operator">=</span> e.getConstraintViolations().stream()</span><br><span class="line">                .map(ConstraintViolation::getMessage)</span><br><span class="line">                .collect(Collectors.joining(<span class="string">&quot;, &quot;</span>));</span><br><span class="line">        logger.warn(<span class="string">&quot;çº¦æŸè¿åå¼‚å¸¸: &#123;&#125;&quot;</span>, errorMessage);</span><br><span class="line">        <span class="keyword">return</span> ApiResponse.error(ErrorCode.PARAM_ERROR, errorMessage);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å¤„ç†ç¼ºå°‘è¯·æ±‚å‚æ•°å¼‚å¸¸</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@ExceptionHandler(MissingServletRequestParameterException.class)</span></span><br><span class="line">    <span class="keyword">public</span> ApiResponse&lt;Void&gt; <span class="title function_">handleMissingServletRequestParameterException</span><span class="params">(MissingServletRequestParameterException e)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">errorMessage</span> <span class="operator">=</span> <span class="string">&quot;ç¼ºå°‘å‚æ•°: &quot;</span> + e.getParameterName();</span><br><span class="line">        logger.warn(<span class="string">&quot;ç¼ºå°‘è¯·æ±‚å‚æ•°: &#123;&#125;&quot;</span>, errorMessage);</span><br><span class="line">        <span class="keyword">return</span> ApiResponse.error(ErrorCode.PARAM_ERROR, errorMessage);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å¤„ç†è¯·æ±‚æ–¹æ³•ä¸æ”¯æŒå¼‚å¸¸</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@ExceptionHandler(HttpRequestMethodNotSupportedException.class)</span></span><br><span class="line">    <span class="keyword">public</span> ApiResponse&lt;Void&gt; <span class="title function_">handleHttpRequestMethodNotSupportedException</span><span class="params">(HttpRequestMethodNotSupportedException e)</span> &#123;</span><br><span class="line">        logger.warn(<span class="string">&quot;è¯·æ±‚æ–¹æ³•ä¸æ”¯æŒ: &#123;&#125;&quot;</span>, e.getMessage());</span><br><span class="line">        <span class="keyword">return</span> ApiResponse.error(ErrorCode.METHOD_NOT_ALLOWED, e.getMessage());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å¤„ç†404é”™è¯¯</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@ExceptionHandler(NoHandlerFoundException.class)</span></span><br><span class="line">    <span class="keyword">public</span> ApiResponse&lt;Void&gt; <span class="title function_">handleNoHandlerFoundException</span><span class="params">(NoHandlerFoundException e)</span> &#123;</span><br><span class="line">        logger.warn(<span class="string">&quot;404é”™è¯¯: &#123;&#125;&quot;</span>, e.getMessage());</span><br><span class="line">        <span class="keyword">return</span> ApiResponse.error(ErrorCode.NOT_FOUND, <span class="string">&quot;æ¥å£ä¸å­˜åœ¨&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å¤„ç†å‚æ•°ç±»å‹ä¸åŒ¹é…å¼‚å¸¸</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@ExceptionHandler(MethodArgumentTypeMismatchException.class)</span></span><br><span class="line">    <span class="keyword">public</span> ApiResponse&lt;Void&gt; <span class="title function_">handleMethodArgumentTypeMismatchException</span><span class="params">(MethodArgumentTypeMismatchException e)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">errorMessage</span> <span class="operator">=</span> <span class="string">&quot;å‚æ•°ç±»å‹é”™è¯¯: &quot;</span> + e.getName();</span><br><span class="line">        logger.warn(<span class="string">&quot;å‚æ•°ç±»å‹ä¸åŒ¹é…: &#123;&#125;&quot;</span>, errorMessage);</span><br><span class="line">        <span class="keyword">return</span> ApiResponse.error(ErrorCode.PARAM_ERROR, errorMessage);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å¤„ç†HTTPæ¶ˆæ¯ä¸å¯è¯»å¼‚å¸¸</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@ExceptionHandler(HttpMessageNotReadableException.class)</span></span><br><span class="line">    <span class="keyword">public</span> ApiResponse&lt;Void&gt; <span class="title function_">handleHttpMessageNotReadableException</span><span class="params">(HttpMessageNotReadableException e)</span> &#123;</span><br><span class="line">        logger.warn(<span class="string">&quot;HTTPæ¶ˆæ¯ä¸å¯è¯»: &#123;&#125;&quot;</span>, e.getMessage());</span><br><span class="line">        <span class="keyword">return</span> ApiResponse.error(ErrorCode.PARAM_ERROR, <span class="string">&quot;è¯·æ±‚å‚æ•°æ ¼å¼é”™è¯¯&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å¤„ç†æœªæ•è·çš„å¼‚å¸¸</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@ExceptionHandler(Exception.class)</span></span><br><span class="line">    <span class="keyword">public</span> ApiResponse&lt;Void&gt; <span class="title function_">handleException</span><span class="params">(Exception e)</span> &#123;</span><br><span class="line">        logger.error(<span class="string">&quot;æœªæ•è·çš„å¼‚å¸¸&quot;</span>, e);</span><br><span class="line">        <span class="keyword">return</span> ApiResponse.error(ErrorCode.SYSTEM_ERROR);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="6-åˆ›å»ºæ–­è¨€å·¥å…·ç±»"><a href="#6-åˆ›å»ºæ–­è¨€å·¥å…·ç±»" class="headerlink" title="6. åˆ›å»ºæ–­è¨€å·¥å…·ç±»"></a>6. åˆ›å»ºæ–­è¨€å·¥å…·ç±»</h3><p><strong>æ–‡ä»¶è·¯å¾„</strong>: <code>src/main/java/com/yourpackage/util/AssertUtil.java</code></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.yourpackage.util;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.yourpackage.constant.ErrorCode;</span><br><span class="line"><span class="keyword">import</span> com.yourpackage.exception.BusinessException;</span><br><span class="line"><span class="keyword">import</span> org.springframework.util.CollectionUtils;</span><br><span class="line"><span class="keyword">import</span> org.springframework.util.StringUtils;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Collection;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æ–­è¨€å·¥å…·ç±»</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AssertUtil</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">isTrue</span><span class="params">(<span class="type">boolean</span> expression, ErrorCode errorCode)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (!expression) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">BusinessException</span>(errorCode);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">isTrue</span><span class="params">(<span class="type">boolean</span> expression, ErrorCode errorCode, String message)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (!expression) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">BusinessException</span>(errorCode, message);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">isFalse</span><span class="params">(<span class="type">boolean</span> expression, ErrorCode errorCode)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (expression) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">BusinessException</span>(errorCode);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">isNull</span><span class="params">(Object object, ErrorCode errorCode)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (object != <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">BusinessException</span>(errorCode);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">notNull</span><span class="params">(Object object, ErrorCode errorCode)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (object == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">BusinessException</span>(errorCode);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">notBlank</span><span class="params">(String str, ErrorCode errorCode)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (!StringUtils.hasText(str)) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">BusinessException</span>(errorCode);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">notEmpty</span><span class="params">(Collection&lt;?&gt; collection, ErrorCode errorCode)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (CollectionUtils.isEmpty(collection)) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">BusinessException</span>(errorCode);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">notEmpty</span><span class="params">(Map&lt;?, ?&gt; map, ErrorCode errorCode)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (CollectionUtils.isEmpty(map)) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">BusinessException</span>(errorCode);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">notEmpty</span><span class="params">(Object[] array, ErrorCode errorCode)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (array == <span class="literal">null</span> || array.length == <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">BusinessException</span>(errorCode);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="7-ä½¿ç”¨ç¤ºä¾‹"><a href="#7-ä½¿ç”¨ç¤ºä¾‹" class="headerlink" title="7. ä½¿ç”¨ç¤ºä¾‹"></a>7. ä½¿ç”¨ç¤ºä¾‹</h3><p><strong>æ–‡ä»¶è·¯å¾„</strong>: <code>src/main/java/com/yourpackage/controller/TestController.java</code></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.yourpackage.controller;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.yourpackage.constant.ErrorCode;</span><br><span class="line"><span class="keyword">import</span> com.yourpackage.exception.BusinessException;</span><br><span class="line"><span class="keyword">import</span> com.yourpackage.util.AssertUtil;</span><br><span class="line"><span class="keyword">import</span> com.yourpackage.vo.ApiResponse;</span><br><span class="line"><span class="keyword">import</span> org.springframework.validation.annotation.Validated;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.validation.Valid;</span><br><span class="line"><span class="keyword">import</span> javax.validation.constraints.NotBlank;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/test&quot;)</span></span><br><span class="line"><span class="meta">@Validated</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TestController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ä½¿ç”¨æ–­è¨€å·¥å…·ç±»</span></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/assert&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> ApiResponse&lt;String&gt; <span class="title function_">testAssert</span><span class="params">(<span class="meta">@RequestParam</span> String param)</span> &#123;</span><br><span class="line">        AssertUtil.notBlank(param, ErrorCode.PARAM_ERROR, <span class="string">&quot;å‚æ•°ä¸èƒ½ä¸ºç©º&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> ApiResponse.success(<span class="string">&quot;å‚æ•°æœ‰æ•ˆ: &quot;</span> + param);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æŠ›å‡ºä¸šåŠ¡å¼‚å¸¸</span></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/business-exception&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> ApiResponse&lt;String&gt; <span class="title function_">testBusinessException</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">BusinessException</span>(ErrorCode.USER_NOT_FOUND, <span class="string">&quot;ç”¨æˆ·ID: 123&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è¿”å›ç»Ÿä¸€å“åº”</span></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/response&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> ApiResponse&lt;UserVO&gt; <span class="title function_">testResponse</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">UserVO</span> <span class="variable">user</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">UserVO</span>(<span class="number">1L</span>, <span class="string">&quot;å¼ ä¸‰&quot;</span>, <span class="string">&quot;zhangsan@example.com&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> ApiResponse.success(user);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å‚æ•°æ ¡éªŒå¼‚å¸¸</span></span><br><span class="line">    <span class="meta">@PostMapping(&quot;/validation&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> ApiResponse&lt;String&gt; <span class="title function_">testValidation</span><span class="params">(<span class="meta">@Valid</span> <span class="meta">@RequestBody</span> UserDTO userDTO)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> ApiResponse.success(<span class="string">&quot;å‚æ•°æ ¡éªŒé€šè¿‡&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å†…éƒ¨ç±»ç¤ºä¾‹</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">UserVO</span> &#123;</span><br><span class="line">        <span class="keyword">private</span> Long id;</span><br><span class="line">        <span class="keyword">private</span> String username;</span><br><span class="line">        <span class="keyword">private</span> String email;</span><br><span class="line">        <span class="comment">// æ„é€ å‡½æ•°ã€getterã€setterçœç•¥</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">UserDTO</span> &#123;</span><br><span class="line">        <span class="meta">@NotBlank(message = &quot;ç”¨æˆ·åä¸èƒ½ä¸ºç©º&quot;)</span></span><br><span class="line">        <span class="keyword">private</span> String username;</span><br><span class="line">        </span><br><span class="line">        <span class="meta">@NotBlank(message = &quot;é‚®ç®±ä¸èƒ½ä¸ºç©º&quot;)</span></span><br><span class="line">        <span class="keyword">private</span> String email;</span><br><span class="line">        <span class="comment">// getterã€setterçœç•¥</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="ä½¿ç”¨è§„èŒƒ"><a href="#ä½¿ç”¨è§„èŒƒ" class="headerlink" title="ä½¿ç”¨è§„èŒƒ"></a>ä½¿ç”¨è§„èŒƒ</h2><h3 id="1-é”™è¯¯ç å‘½åè§„èŒƒ"><a href="#1-é”™è¯¯ç å‘½åè§„èŒƒ" class="headerlink" title="1. é”™è¯¯ç å‘½åè§„èŒƒ"></a>1. é”™è¯¯ç å‘½åè§„èŒƒ</h3><ul>
<li>æ¨¡å—æ ‡è¯† + é”™è¯¯åºå·</li>
<li>4ä½æ¨¡å—æ ‡è¯† + 4ä½é”™è¯¯åºå·</li>
<li>ç¤ºä¾‹ï¼šUSER-0001ï¼ˆç”¨æˆ·æ¨¡å—ç¬¬1ä¸ªé”™è¯¯ï¼‰</li>
</ul>
<h3 id="2-å¼‚å¸¸å¤„ç†è§„èŒƒ"><a href="#2-å¼‚å¸¸å¤„ç†è§„èŒƒ" class="headerlink" title="2. å¼‚å¸¸å¤„ç†è§„èŒƒ"></a>2. å¼‚å¸¸å¤„ç†è§„èŒƒ</h3><ul>
<li>ä¸šåŠ¡å¼‚å¸¸ä½¿ç”¨ <code>BusinessException</code></li>
<li>å‚æ•°æ ¡éªŒä½¿ç”¨æ–­è¨€å·¥å…·ç±»</li>
<li>ç³»ç»Ÿå¼‚å¸¸ç”±å…¨å±€å¼‚å¸¸å¤„ç†å™¨ç»Ÿä¸€å¤„ç†</li>
</ul>
<h3 id="3-å“åº”æ ¼å¼è§„èŒƒ"><a href="#3-å“åº”æ ¼å¼è§„èŒƒ" class="headerlink" title="3. å“åº”æ ¼å¼è§„èŒƒ"></a>3. å“åº”æ ¼å¼è§„èŒƒ</h3><ul>
<li>æ‰€æœ‰æ¥å£è¿”å› <code>ApiResponse&lt;T&gt;</code></li>
<li>æˆåŠŸä½¿ç”¨ <code>ApiResponse.success(data)</code></li>
<li>å¤±è´¥ä½¿ç”¨ <code>ApiResponse.error(errorCode)</code></li>
</ul>
<h3 id="4-æ—¥å¿—è®°å½•è§„èŒƒ"><a href="#4-æ—¥å¿—è®°å½•è§„èŒƒ" class="headerlink" title="4. æ—¥å¿—è®°å½•è§„èŒƒ"></a>4. æ—¥å¿—è®°å½•è§„èŒƒ</h3><ul>
<li>ä¸šåŠ¡å¼‚å¸¸è®°å½•WARNçº§åˆ«æ—¥å¿—</li>
<li>ç³»ç»Ÿå¼‚å¸¸è®°å½•ERRORçº§åˆ«æ—¥å¿—</li>
<li>å‚æ•°å¼‚å¸¸è®°å½•WARNçº§åˆ«æ—¥å¿—</li>
</ul>
<h2 id="æµ‹è¯•éªŒè¯"><a href="#æµ‹è¯•éªŒè¯" class="headerlink" title="æµ‹è¯•éªŒè¯"></a>æµ‹è¯•éªŒè¯</h2><p>å¯åŠ¨é¡¹ç›®åï¼Œå¯ä»¥é€šè¿‡ä»¥ä¸‹æ¥å£æµ‹è¯•ï¼š</p>
<ul>
<li><code>GET /test/assert?param=hello</code> - æµ‹è¯•æ–­è¨€å·¥å…·</li>
<li><code>GET /test/business-exception</code> - æµ‹è¯•ä¸šåŠ¡å¼‚å¸¸</li>
<li><code>GET /test/response</code> - æµ‹è¯•ç»Ÿä¸€å“åº”</li>
<li><code>POST /test/validation</code> - æµ‹è¯•å‚æ•°æ ¡éªŒ</li>
</ul>
]]></content>
      <categories>
        <category>web</category>
      </categories>
      <tags>
        <tag>springboot</tag>
      </tags>
  </entry>
  <entry>
    <title>Springç»Ÿä¸€æ—¥å¿—è¾“å‡ºå®ç°æŒ‡å—</title>
    <url>/2025/09/15/web/Spring%E7%BB%9F%E4%B8%80%E6%97%A5%E5%BF%97%E8%BE%93%E5%87%BA%E5%AE%9E%E7%8E%B0%E6%8C%87%E5%8D%97/</url>
    <content><![CDATA[<h2 id="æ¦‚è¿°"><a href="#æ¦‚è¿°" class="headerlink" title="æ¦‚è¿°"></a>æ¦‚è¿°</h2><p>æœ¬æ–‡æ¡£è¯¦ç»†è®°å½•äº†å¦‚ä½•åœ¨Spring Booté¡¹ç›®ä¸­å®ç°ç»Ÿä¸€çš„æ—¥å¿—è¾“å‡ºç³»ç»Ÿï¼ŒåŒ…æ‹¬æ ‡å‡†åŒ–æ—¥å¿—æ ¼å¼ã€åˆ†ç¯å¢ƒé…ç½®ã€æ—¥å¿—åˆ†ç±»å­˜å‚¨ã€æ¥å£è®¿é—®æ—¥å¿—å’Œä¸šåŠ¡æ—¥å¿—è®°å½•ã€‚</p>
<h2 id="é¡¹ç›®ç»“æ„"><a href="#é¡¹ç›®ç»“æ„" class="headerlink" title="é¡¹ç›®ç»“æ„"></a>é¡¹ç›®ç»“æ„</h2><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">src/main/java/com/yourpackage/</span><br><span class="line">â”œâ”€â”€ util/</span><br><span class="line">â”‚   â””â”€â”€ LogUtil.java            # ç»Ÿä¸€æ—¥å¿—å·¥å…·ç±»</span><br><span class="line">â”œâ”€â”€ interceptor/</span><br><span class="line">â”‚   â””â”€â”€ LogInterceptor.java     # è¯·æ±‚æ—¥å¿—æ‹¦æˆªå™¨</span><br><span class="line">â”œâ”€â”€ aspect/</span><br><span class="line">â”‚   â””â”€â”€ LogAspect.java          # æ—¥å¿—åˆ‡é¢</span><br><span class="line">â”œâ”€â”€ config/</span><br><span class="line">â”‚   â””â”€â”€ LogConfig.java          # æ—¥å¿—é…ç½®</span><br><span class="line">â”œâ”€â”€ annotation/</span><br><span class="line">â”‚   â””â”€â”€ LogBusiness.java        # ä¸šåŠ¡æ—¥å¿—æ³¨è§£</span><br><span class="line">â””â”€â”€ controller/</span><br><span class="line">    â””â”€â”€ LogDemoController.java  # ä½¿ç”¨ç¤ºä¾‹</span><br><span class="line"></span><br><span class="line">src/main/resources/</span><br><span class="line">â”œâ”€â”€ logback-spring.xml          # æ—¥å¿—é…ç½®æ–‡ä»¶</span><br><span class="line">â””â”€â”€ application.yml             # ç¯å¢ƒé…ç½®</span><br></pre></td></tr></table></figure>

<h2 id="å®ç°æ­¥éª¤"><a href="#å®ç°æ­¥éª¤" class="headerlink" title="å®ç°æ­¥éª¤"></a>å®ç°æ­¥éª¤</h2><h3 id="1-æ·»åŠ ä¾èµ–"><a href="#1-æ·»åŠ ä¾èµ–" class="headerlink" title="1. æ·»åŠ ä¾èµ–"></a>1. æ·»åŠ ä¾èµ–</h3><p>åœ¨ <code>pom.xml</code> ä¸­æ·»åŠ å¿…è¦ä¾èµ–ï¼š</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!-- AOPä¾èµ– --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-aop<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- JSONå¤„ç† --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.fasterxml.jackson.core<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jackson-databind<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="2-åˆ›å»ºæ—¥å¿—é…ç½®æ–‡ä»¶"><a href="#2-åˆ›å»ºæ—¥å¿—é…ç½®æ–‡ä»¶" class="headerlink" title="2. åˆ›å»ºæ—¥å¿—é…ç½®æ–‡ä»¶"></a>2. åˆ›å»ºæ—¥å¿—é…ç½®æ–‡ä»¶</h3><p><strong>æ–‡ä»¶è·¯å¾„</strong>: <code>src/main/resources/logback-spring.xml</code></p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">configuration</span> <span class="attr">scan</span>=<span class="string">&quot;true&quot;</span> <span class="attr">scanPeriod</span>=<span class="string">&quot;60 seconds&quot;</span> <span class="attr">debug</span>=<span class="string">&quot;false&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- å®šä¹‰æ—¥å¿—æ–‡ä»¶çš„å­˜å‚¨åœ°å€ --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;LOG_HOME&quot;</span> <span class="attr">value</span>=<span class="string">&quot;logs&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;APP_NAME&quot;</span> <span class="attr">value</span>=<span class="string">&quot;YourAppName&quot;</span>/&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">&lt;!-- æ§åˆ¶å°è¾“å‡º --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">appender</span> <span class="attr">name</span>=<span class="string">&quot;STDOUT&quot;</span> <span class="attr">class</span>=<span class="string">&quot;ch.qos.logback.core.ConsoleAppender&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">encoder</span> <span class="attr">class</span>=<span class="string">&quot;ch.qos.logback.classic.encoder.PatternLayoutEncoder&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">pattern</span>&gt;</span>%d&#123;yyyy-MM-dd HH:mm:ss.SSS&#125; [%thread] %-5level [%logger&#123;50&#125;] - %msg%n<span class="tag">&lt;/<span class="name">pattern</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">charset</span>&gt;</span>UTF-8<span class="tag">&lt;/<span class="name">charset</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">encoder</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">appender</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- ä¸»æ—¥å¿—æ–‡ä»¶ --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">appender</span> <span class="attr">name</span>=<span class="string">&quot;FILE&quot;</span> <span class="attr">class</span>=<span class="string">&quot;ch.qos.logback.core.rolling.RollingFileAppender&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">file</span>&gt;</span>$&#123;LOG_HOME&#125;/$&#123;APP_NAME&#125;.log<span class="tag">&lt;/<span class="name">file</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">rollingPolicy</span> <span class="attr">class</span>=<span class="string">&quot;ch.qos.logback.core.rolling.TimeBasedRollingPolicy&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">FileNamePattern</span>&gt;</span>$&#123;LOG_HOME&#125;/$&#123;APP_NAME&#125;.%d&#123;yyyy-MM-dd&#125;.%i.log<span class="tag">&lt;/<span class="name">FileNamePattern</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">MaxHistory</span>&gt;</span>30<span class="tag">&lt;/<span class="name">MaxHistory</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">timeBasedFileNamingAndTriggeringPolicy</span> <span class="attr">class</span>=<span class="string">&quot;ch.qos.logback.core.rolling.SizeAndTimeBasedFNATP&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">maxFileSize</span>&gt;</span>100MB<span class="tag">&lt;/<span class="name">maxFileSize</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">timeBasedFileNamingAndTriggeringPolicy</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">rollingPolicy</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">encoder</span> <span class="attr">class</span>=<span class="string">&quot;ch.qos.logback.classic.encoder.PatternLayoutEncoder&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">pattern</span>&gt;</span>%d&#123;yyyy-MM-dd HH:mm:ss.SSS&#125; [%thread] %-5level [%logger&#123;50&#125;] - %msg%n<span class="tag">&lt;/<span class="name">pattern</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">charset</span>&gt;</span>UTF-8<span class="tag">&lt;/<span class="name">charset</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">encoder</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">appender</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- é”™è¯¯æ—¥å¿—æ–‡ä»¶ --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">appender</span> <span class="attr">name</span>=<span class="string">&quot;ERROR_FILE&quot;</span> <span class="attr">class</span>=<span class="string">&quot;ch.qos.logback.core.rolling.RollingFileAppender&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">file</span>&gt;</span>$&#123;LOG_HOME&#125;/$&#123;APP_NAME&#125;_error.log<span class="tag">&lt;/<span class="name">file</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">filter</span> <span class="attr">class</span>=<span class="string">&quot;ch.qos.logback.classic.filter.LevelFilter&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">level</span>&gt;</span>ERROR<span class="tag">&lt;/<span class="name">level</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">onMatch</span>&gt;</span>ACCEPT<span class="tag">&lt;/<span class="name">onMatch</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">onMismatch</span>&gt;</span>DENY<span class="tag">&lt;/<span class="name">onMismatch</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">filter</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">rollingPolicy</span> <span class="attr">class</span>=<span class="string">&quot;ch.qos.logback.core.rolling.TimeBasedRollingPolicy&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">FileNamePattern</span>&gt;</span>$&#123;LOG_HOME&#125;/$&#123;APP_NAME&#125;_error.%d&#123;yyyy-MM-dd&#125;.%i.log<span class="tag">&lt;/<span class="name">FileNamePattern</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">MaxHistory</span>&gt;</span>30<span class="tag">&lt;/<span class="name">MaxHistory</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">timeBasedFileNamingAndTriggeringPolicy</span> <span class="attr">class</span>=<span class="string">&quot;ch.qos.logback.core.rolling.SizeAndTimeBasedFNATP&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">maxFileSize</span>&gt;</span>100MB<span class="tag">&lt;/<span class="name">maxFileSize</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">timeBasedFileNamingAndTriggeringPolicy</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">rollingPolicy</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">encoder</span> <span class="attr">class</span>=<span class="string">&quot;ch.qos.logback.classic.encoder.PatternLayoutEncoder&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">pattern</span>&gt;</span>%d&#123;yyyy-MM-dd HH:mm:ss.SSS&#125; [%thread] %-5level [%logger&#123;50&#125;] - %msg%n<span class="tag">&lt;/<span class="name">pattern</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">charset</span>&gt;</span>UTF-8<span class="tag">&lt;/<span class="name">charset</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">encoder</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">appender</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- ä¸šåŠ¡æ—¥å¿—æ–‡ä»¶ --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">appender</span> <span class="attr">name</span>=<span class="string">&quot;BUSINESS_FILE&quot;</span> <span class="attr">class</span>=<span class="string">&quot;ch.qos.logback.core.rolling.RollingFileAppender&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">file</span>&gt;</span>$&#123;LOG_HOME&#125;/$&#123;APP_NAME&#125;_business.log<span class="tag">&lt;/<span class="name">file</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">rollingPolicy</span> <span class="attr">class</span>=<span class="string">&quot;ch.qos.logback.core.rolling.TimeBasedRollingPolicy&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">FileNamePattern</span>&gt;</span>$&#123;LOG_HOME&#125;/$&#123;APP_NAME&#125;_business.%d&#123;yyyy-MM-dd&#125;.%i.log<span class="tag">&lt;/<span class="name">FileNamePattern</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">MaxHistory</span>&gt;</span>30<span class="tag">&lt;/<span class="name">MaxHistory</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">timeBasedFileNamingAndTriggeringPolicy</span> <span class="attr">class</span>=<span class="string">&quot;ch.qos.logback.core.rolling.SizeAndTimeBasedFNATP&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">maxFileSize</span>&gt;</span>100MB<span class="tag">&lt;/<span class="name">maxFileSize</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">timeBasedFileNamingAndTriggeringPolicy</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">rollingPolicy</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">encoder</span> <span class="attr">class</span>=<span class="string">&quot;ch.qos.logback.classic.encoder.PatternLayoutEncoder&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">pattern</span>&gt;</span>%d&#123;yyyy-MM-dd HH:mm:ss.SSS&#125; [%thread] %-5level [%logger&#123;50&#125;] - %msg%n<span class="tag">&lt;/<span class="name">pattern</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">charset</span>&gt;</span>UTF-8<span class="tag">&lt;/<span class="name">charset</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">encoder</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">appender</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- SQLæ—¥å¿—æ–‡ä»¶ --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">appender</span> <span class="attr">name</span>=<span class="string">&quot;SQL_FILE&quot;</span> <span class="attr">class</span>=<span class="string">&quot;ch.qos.logback.core.rolling.RollingFileAppender&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">file</span>&gt;</span>$&#123;LOG_HOME&#125;/$&#123;APP_NAME&#125;_sql.log<span class="tag">&lt;/<span class="name">file</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">rollingPolicy</span> <span class="attr">class</span>=<span class="string">&quot;ch.qos.logback.core.rolling.TimeBasedRollingPolicy&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">FileNamePattern</span>&gt;</span>$&#123;LOG_HOME&#125;/$&#123;APP_NAME&#125;_sql.%d&#123;yyyy-MM-dd&#125;.%i.log<span class="tag">&lt;/<span class="name">FileNamePattern</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">MaxHistory</span>&gt;</span>30<span class="tag">&lt;/<span class="name">MaxHistory</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">timeBasedFileNamingAndTriggeringPolicy</span> <span class="attr">class</span>=<span class="string">&quot;ch.qos.logback.core.rolling.SizeAndTimeBasedFNATP&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">maxFileSize</span>&gt;</span>100MB<span class="tag">&lt;/<span class="name">maxFileSize</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">timeBasedFileNamingAndTriggeringPolicy</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">rollingPolicy</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">encoder</span> <span class="attr">class</span>=<span class="string">&quot;ch.qos.logback.classic.encoder.PatternLayoutEncoder&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">pattern</span>&gt;</span>%d&#123;yyyy-MM-dd HH:mm:ss.SSS&#125; [%thread] %-5level [%logger&#123;50&#125;] - %msg%n<span class="tag">&lt;/<span class="name">pattern</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">charset</span>&gt;</span>UTF-8<span class="tag">&lt;/<span class="name">charset</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">encoder</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">appender</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- å¼€å‘ç¯å¢ƒ --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">springProfile</span> <span class="attr">name</span>=<span class="string">&quot;dev&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">root</span> <span class="attr">level</span>=<span class="string">&quot;DEBUG&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">appender-ref</span> <span class="attr">ref</span>=<span class="string">&quot;STDOUT&quot;</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">appender-ref</span> <span class="attr">ref</span>=<span class="string">&quot;FILE&quot;</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">appender-ref</span> <span class="attr">ref</span>=<span class="string">&quot;ERROR_FILE&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">root</span>&gt;</span></span><br><span class="line">        </span><br><span class="line">        <span class="tag">&lt;<span class="name">logger</span> <span class="attr">name</span>=<span class="string">&quot;org.mybatis&quot;</span> <span class="attr">level</span>=<span class="string">&quot;DEBUG&quot;</span> <span class="attr">additivity</span>=<span class="string">&quot;false&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">appender-ref</span> <span class="attr">ref</span>=<span class="string">&quot;SQL_FILE&quot;</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">appender-ref</span> <span class="attr">ref</span>=<span class="string">&quot;STDOUT&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">logger</span>&gt;</span></span><br><span class="line">        </span><br><span class="line">        <span class="tag">&lt;<span class="name">logger</span> <span class="attr">name</span>=<span class="string">&quot;java.sql&quot;</span> <span class="attr">level</span>=<span class="string">&quot;DEBUG&quot;</span> <span class="attr">additivity</span>=<span class="string">&quot;false&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">appender-ref</span> <span class="attr">ref</span>=<span class="string">&quot;SQL_FILE&quot;</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">appender-ref</span> <span class="attr">ref</span>=<span class="string">&quot;STDOUT&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">logger</span>&gt;</span></span><br><span class="line">        </span><br><span class="line">        <span class="tag">&lt;<span class="name">logger</span> <span class="attr">name</span>=<span class="string">&quot;com.yourpackage&quot;</span> <span class="attr">level</span>=<span class="string">&quot;DEBUG&quot;</span> <span class="attr">additivity</span>=<span class="string">&quot;false&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">appender-ref</span> <span class="attr">ref</span>=<span class="string">&quot;BUSINESS_FILE&quot;</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">appender-ref</span> <span class="attr">ref</span>=<span class="string">&quot;STDOUT&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">logger</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">springProfile</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- æµ‹è¯•ç¯å¢ƒ --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">springProfile</span> <span class="attr">name</span>=<span class="string">&quot;test&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">root</span> <span class="attr">level</span>=<span class="string">&quot;INFO&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">appender-ref</span> <span class="attr">ref</span>=<span class="string">&quot;FILE&quot;</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">appender-ref</span> <span class="attr">ref</span>=<span class="string">&quot;ERROR_FILE&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">root</span>&gt;</span></span><br><span class="line">        </span><br><span class="line">        <span class="tag">&lt;<span class="name">logger</span> <span class="attr">name</span>=<span class="string">&quot;com.yourpackage&quot;</span> <span class="attr">level</span>=<span class="string">&quot;INFO&quot;</span> <span class="attr">additivity</span>=<span class="string">&quot;false&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">appender-ref</span> <span class="attr">ref</span>=<span class="string">&quot;BUSINESS_FILE&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">logger</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">springProfile</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- ç”Ÿäº§ç¯å¢ƒ --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">springProfile</span> <span class="attr">name</span>=<span class="string">&quot;prod&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">root</span> <span class="attr">level</span>=<span class="string">&quot;INFO&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">appender-ref</span> <span class="attr">ref</span>=<span class="string">&quot;FILE&quot;</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">appender-ref</span> <span class="attr">ref</span>=<span class="string">&quot;ERROR_FILE&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">root</span>&gt;</span></span><br><span class="line">        </span><br><span class="line">        <span class="tag">&lt;<span class="name">logger</span> <span class="attr">name</span>=<span class="string">&quot;com.yourpackage&quot;</span> <span class="attr">level</span>=<span class="string">&quot;INFO&quot;</span> <span class="attr">additivity</span>=<span class="string">&quot;false&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">appender-ref</span> <span class="attr">ref</span>=<span class="string">&quot;BUSINESS_FILE&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">logger</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">springProfile</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="3-æ›´æ–°application-ymlé…ç½®"><a href="#3-æ›´æ–°application-ymlé…ç½®" class="headerlink" title="3. æ›´æ–°application.ymlé…ç½®"></a>3. æ›´æ–°application.ymlé…ç½®</h3><p><strong>æ–‡ä»¶è·¯å¾„</strong>: <code>src/main/resources/application.yml</code></p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">profiles:</span></span><br><span class="line">    <span class="attr">active:</span> <span class="string">dev</span>  <span class="comment"># é»˜è®¤ä½¿ç”¨å¼€å‘ç¯å¢ƒ</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æ—¥å¿—é…ç½®</span></span><br><span class="line"><span class="attr">logging:</span></span><br><span class="line">  <span class="attr">level:</span></span><br><span class="line">    <span class="attr">com.yourpackage:</span> <span class="string">DEBUG</span></span><br><span class="line">    <span class="attr">org.mybatis:</span> <span class="string">DEBUG</span></span><br><span class="line">    <span class="attr">java.sql:</span> <span class="string">DEBUG</span></span><br><span class="line">  <span class="attr">pattern:</span></span><br><span class="line">    <span class="attr">console:</span> <span class="string">&quot;%d&#123;yyyy-MM-dd HH:mm:ss.SSS&#125; [%thread] %-5level [%logger&#123;50&#125;] - %msg%n&quot;</span></span><br><span class="line">    <span class="attr">file:</span> <span class="string">&quot;%d&#123;yyyy-MM-dd HH:mm:ss.SSS&#125; [%thread] %-5level [%logger&#123;50&#125;] - %msg%n&quot;</span></span><br></pre></td></tr></table></figure>

<h3 id="4-åˆ›å»ºç»Ÿä¸€æ—¥å¿—å·¥å…·ç±»"><a href="#4-åˆ›å»ºç»Ÿä¸€æ—¥å¿—å·¥å…·ç±»" class="headerlink" title="4. åˆ›å»ºç»Ÿä¸€æ—¥å¿—å·¥å…·ç±»"></a>4. åˆ›å»ºç»Ÿä¸€æ—¥å¿—å·¥å…·ç±»</h3><p><strong>æ–‡ä»¶è·¯å¾„</strong>: <code>src/main/java/com/yourpackage/util/LogUtil.java</code></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.yourpackage.util;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.databind.ObjectMapper;</span><br><span class="line"><span class="keyword">import</span> org.slf4j.Logger;</span><br><span class="line"><span class="keyword">import</span> org.slf4j.LoggerFactory;</span><br><span class="line"><span class="keyword">import</span> org.slf4j.MDC;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"><span class="keyword">import</span> java.util.UUID;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * ç»Ÿä¸€æ—¥å¿—å·¥å…·ç±»</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LogUtil</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">ObjectMapper</span> <span class="variable">objectMapper</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectMapper</span>();</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è·å–Loggerå®ä¾‹</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Logger <span class="title function_">getLogger</span><span class="params">(Class&lt;?&gt; clazz)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> LoggerFactory.getLogger(clazz);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è®¾ç½®è¯·æ±‚è¿½è¸ªID</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">setTraceId</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">traceId</span> <span class="operator">=</span> UUID.randomUUID().toString().replace(<span class="string">&quot;-&quot;</span>, <span class="string">&quot;&quot;</span>);</span><br><span class="line">        MDC.put(<span class="string">&quot;traceId&quot;</span>, traceId);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è·å–è¯·æ±‚è¿½è¸ªID</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">getTraceId</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> MDC.get(<span class="string">&quot;traceId&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ¸…é™¤è¯·æ±‚è¿½è¸ªID</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">clearTraceId</span><span class="params">()</span> &#123;</span><br><span class="line">        MDC.clear();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è®°å½•ä¸šåŠ¡æ—¥å¿—</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">logBusiness</span><span class="params">(Logger logger, String operation, Object request, Object response)</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="type">String</span> <span class="variable">logMessage</span> <span class="operator">=</span> String.format(</span><br><span class="line">                <span class="string">&quot;[ä¸šåŠ¡æ—¥å¿—] æ“ä½œ: %s, è¯·æ±‚: %s, å“åº”: %s&quot;</span>,</span><br><span class="line">                operation,</span><br><span class="line">                objectMapper.writeValueAsString(request),</span><br><span class="line">                objectMapper.writeValueAsString(response)</span><br><span class="line">            );</span><br><span class="line">            logger.info(logMessage);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            logger.error(<span class="string">&quot;è®°å½•ä¸šåŠ¡æ—¥å¿—å¤±è´¥&quot;</span>, e);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è®°å½•æ¥å£è®¿é—®æ—¥å¿—</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">logAccess</span><span class="params">(Logger logger, String method, String uri, String ip, </span></span><br><span class="line"><span class="params">                               Object params, Object result, <span class="type">long</span> duration)</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="type">String</span> <span class="variable">logMessage</span> <span class="operator">=</span> String.format(</span><br><span class="line">                <span class="string">&quot;[æ¥å£è®¿é—®] %s %s, IP: %s, å‚æ•°: %s, è€—æ—¶: %dms, ç»“æœ: %s&quot;</span>,</span><br><span class="line">                method, uri, ip,</span><br><span class="line">                objectMapper.writeValueAsString(params),</span><br><span class="line">                duration,</span><br><span class="line">                objectMapper.writeValueAsString(result)</span><br><span class="line">            );</span><br><span class="line">            logger.info(logMessage);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            logger.error(<span class="string">&quot;è®°å½•æ¥å£è®¿é—®æ—¥å¿—å¤±è´¥&quot;</span>, e);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è®°å½•å¼‚å¸¸æ—¥å¿—</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">logException</span><span class="params">(Logger logger, String operation, Throwable throwable, Object... params)</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="type">String</span> <span class="variable">logMessage</span> <span class="operator">=</span> String.format(</span><br><span class="line">                <span class="string">&quot;[å¼‚å¸¸æ—¥å¿—] æ“ä½œ: %s, å‚æ•°: %s, å¼‚å¸¸: %s&quot;</span>,</span><br><span class="line">                operation,</span><br><span class="line">                params.length &gt; <span class="number">0</span> ? objectMapper.writeValueAsString(params) : <span class="string">&quot;æ— &quot;</span>,</span><br><span class="line">                throwable.getMessage()</span><br><span class="line">            );</span><br><span class="line">            logger.error(logMessage, throwable);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            logger.error(<span class="string">&quot;è®°å½•å¼‚å¸¸æ—¥å¿—å¤±è´¥&quot;</span>, e);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è®°å½•æ€§èƒ½æ—¥å¿—</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">logPerformance</span><span class="params">(Logger logger, String operation, <span class="type">long</span> duration, Object... params)</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="type">String</span> <span class="variable">logMessage</span> <span class="operator">=</span> String.format(</span><br><span class="line">                <span class="string">&quot;[æ€§èƒ½æ—¥å¿—] æ“ä½œ: %s, è€—æ—¶: %dms, å‚æ•°: %s&quot;</span>,</span><br><span class="line">                operation, duration,</span><br><span class="line">                params.length &gt; <span class="number">0</span> ? objectMapper.writeValueAsString(params) : <span class="string">&quot;æ— &quot;</span></span><br><span class="line">            );</span><br><span class="line">            logger.info(logMessage);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            logger.error(<span class="string">&quot;è®°å½•æ€§èƒ½æ—¥å¿—å¤±è´¥&quot;</span>, e);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è®°å½•è°ƒè¯•æ—¥å¿—</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">logDebug</span><span class="params">(Logger logger, String operation, Object... params)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (logger.isDebugEnabled()) &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="type">String</span> <span class="variable">logMessage</span> <span class="operator">=</span> String.format(</span><br><span class="line">                    <span class="string">&quot;[è°ƒè¯•æ—¥å¿—] æ“ä½œ: %s, å‚æ•°: %s&quot;</span>,</span><br><span class="line">                    operation,</span><br><span class="line">                    params.length &gt; <span class="number">0</span> ? objectMapper.writeValueAsString(params) : <span class="string">&quot;æ— &quot;</span></span><br><span class="line">                );</span><br><span class="line">                logger.debug(logMessage);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">                logger.error(<span class="string">&quot;è®°å½•è°ƒè¯•æ—¥å¿—å¤±è´¥&quot;</span>, e);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è®°å½•SQLæ—¥å¿—</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">logSql</span><span class="params">(Logger logger, String sql, Object... params)</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="type">String</span> <span class="variable">logMessage</span> <span class="operator">=</span> String.format(</span><br><span class="line">                <span class="string">&quot;[SQLæ—¥å¿—] SQL: %s, å‚æ•°: %s&quot;</span>,</span><br><span class="line">                sql,</span><br><span class="line">                params.length &gt; <span class="number">0</span> ? objectMapper.writeValueAsString(params) : <span class="string">&quot;æ— &quot;</span></span><br><span class="line">            );</span><br><span class="line">            logger.debug(logMessage);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            logger.error(<span class="string">&quot;è®°å½•SQLæ—¥å¿—å¤±è´¥&quot;</span>, e);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è®°å½•ç”¨æˆ·æ“ä½œæ—¥å¿—</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">logUserAction</span><span class="params">(Logger logger, String userId, String action, Object details)</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="type">String</span> <span class="variable">logMessage</span> <span class="operator">=</span> String.format(</span><br><span class="line">                <span class="string">&quot;[ç”¨æˆ·æ“ä½œ] ç”¨æˆ·ID: %s, æ“ä½œ: %s, è¯¦æƒ…: %s&quot;</span>,</span><br><span class="line">                userId, action,</span><br><span class="line">                objectMapper.writeValueAsString(details)</span><br><span class="line">            );</span><br><span class="line">            logger.info(logMessage);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            logger.error(<span class="string">&quot;è®°å½•ç”¨æˆ·æ“ä½œæ—¥å¿—å¤±è´¥&quot;</span>, e);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è®°å½•å®‰å…¨æ—¥å¿—</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">logSecurity</span><span class="params">(Logger logger, String userId, String action, String ip, Object details)</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="type">String</span> <span class="variable">logMessage</span> <span class="operator">=</span> String.format(</span><br><span class="line">                <span class="string">&quot;[å®‰å…¨æ—¥å¿—] ç”¨æˆ·ID: %s, æ“ä½œ: %s, IP: %s, è¯¦æƒ…: %s&quot;</span>,</span><br><span class="line">                userId, action, ip,</span><br><span class="line">                objectMapper.writeValueAsString(details)</span><br><span class="line">            );</span><br><span class="line">            logger.warn(logMessage);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            logger.error(<span class="string">&quot;è®°å½•å®‰å…¨æ—¥å¿—å¤±è´¥&quot;</span>, e);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ„å»ºæ—¥å¿—ä¸Šä¸‹æ–‡</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Map&lt;String, Object&gt; <span class="title function_">buildContext</span><span class="params">(String key, Object value)</span> &#123;</span><br><span class="line">        Map&lt;String, Object&gt; context = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">        context.put(key, value);</span><br><span class="line">        <span class="keyword">return</span> context;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="5-åˆ›å»ºæ—¥å¿—æ‹¦æˆªå™¨"><a href="#5-åˆ›å»ºæ—¥å¿—æ‹¦æˆªå™¨" class="headerlink" title="5. åˆ›å»ºæ—¥å¿—æ‹¦æˆªå™¨"></a>5. åˆ›å»ºæ—¥å¿—æ‹¦æˆªå™¨</h3><p><strong>æ–‡ä»¶è·¯å¾„</strong>: <code>src/main/java/com/yourpackage/interceptor/LogInterceptor.java</code></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.yourpackage.interceptor;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.yourpackage.util.LogUtil;</span><br><span class="line"><span class="keyword">import</span> org.slf4j.Logger;</span><br><span class="line"><span class="keyword">import</span> org.slf4j.LoggerFactory;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.servlet.HandlerInterceptor;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.ConcurrentHashMap;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LogInterceptor</span> <span class="keyword">implements</span> <span class="title class_">HandlerInterceptor</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">Logger</span> <span class="variable">logger</span> <span class="operator">=</span> LoggerFactory.getLogger(LogInterceptor.class);</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">START_TIME_ATTR</span> <span class="operator">=</span> <span class="string">&quot;requestStartTime&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">preHandle</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        LogUtil.setTraceId();</span><br><span class="line">        request.setAttribute(START_TIME_ATTR, System.currentTimeMillis());</span><br><span class="line">        </span><br><span class="line">        Map&lt;String, Object&gt; context = LogUtil.buildContext(<span class="string">&quot;uri&quot;</span>, request.getRequestURI());</span><br><span class="line">        context.put(<span class="string">&quot;method&quot;</span>, request.getMethod());</span><br><span class="line">        context.put(<span class="string">&quot;ip&quot;</span>, getClientIpAddress(request));</span><br><span class="line">        context.put(<span class="string">&quot;params&quot;</span>, request.getParameterMap());</span><br><span class="line">        </span><br><span class="line">        LogUtil.logDebug(logger, <span class="string">&quot;è¯·æ±‚å¼€å§‹&quot;</span>, context);</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">afterCompletion</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler, Exception ex)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="type">Long</span> <span class="variable">startTime</span> <span class="operator">=</span> (Long) request.getAttribute(START_TIME_ATTR);</span><br><span class="line">        <span class="type">long</span> <span class="variable">duration</span> <span class="operator">=</span> System.currentTimeMillis() - (startTime != <span class="literal">null</span> ? startTime : System.currentTimeMillis());</span><br><span class="line">        </span><br><span class="line">        LogUtil.logAccess(logger, </span><br><span class="line">            request.getMethod(), </span><br><span class="line">            request.getRequestURI(), </span><br><span class="line">            getClientIpAddress(request),</span><br><span class="line">            request.getParameterMap(),</span><br><span class="line">            Map.of(<span class="string">&quot;status&quot;</span>, response.getStatus()),</span><br><span class="line">            duration);</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> (ex != <span class="literal">null</span>) &#123;</span><br><span class="line">            LogUtil.logException(logger, request.getRequestURI() + <span class="string">&quot; è¯·æ±‚å¼‚å¸¸&quot;</span>, ex);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        LogUtil.clearTraceId();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String <span class="title function_">getClientIpAddress</span><span class="params">(HttpServletRequest request)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">xForwardedFor</span> <span class="operator">=</span> request.getHeader(<span class="string">&quot;X-Forwarded-For&quot;</span>);</span><br><span class="line">        <span class="keyword">if</span> (xForwardedFor != <span class="literal">null</span> &amp;&amp; !xForwardedFor.isEmpty()) &#123;</span><br><span class="line">            <span class="keyword">return</span> xForwardedFor.split(<span class="string">&quot;,&quot;</span>)[<span class="number">0</span>].trim();</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="type">String</span> <span class="variable">xRealIp</span> <span class="operator">=</span> request.getHeader(<span class="string">&quot;X-Real-IP&quot;</span>);</span><br><span class="line">        <span class="keyword">if</span> (xRealIp != <span class="literal">null</span> &amp;&amp; !xRealIp.isEmpty()) &#123;</span><br><span class="line">            <span class="keyword">return</span> xRealIp;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> request.getRemoteAddr();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="6-åˆ›å»ºæ—¥å¿—é…ç½®ç±»"><a href="#6-åˆ›å»ºæ—¥å¿—é…ç½®ç±»" class="headerlink" title="6. åˆ›å»ºæ—¥å¿—é…ç½®ç±»"></a>6. åˆ›å»ºæ—¥å¿—é…ç½®ç±»</h3><p><strong>æ–‡ä»¶è·¯å¾„</strong>: <code>src/main/java/com/yourpackage/config/LogConfig.java</code></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.yourpackage.config;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.yourpackage.interceptor.LogInterceptor;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.servlet.config.annotation.InterceptorRegistry;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.servlet.config.annotation.WebMvcConfigurer;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LogConfig</span> <span class="keyword">implements</span> <span class="title class_">WebMvcConfigurer</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> LogInterceptor logInterceptor;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addInterceptors</span><span class="params">(InterceptorRegistry registry)</span> &#123;</span><br><span class="line">        registry.addInterceptor(logInterceptor)</span><br><span class="line">                .addPathPatterns(<span class="string">&quot;/**&quot;</span>)</span><br><span class="line">                .excludePathPatterns(</span><br><span class="line">                        <span class="string">&quot;/swagger-ui/**&quot;</span>,</span><br><span class="line">                        <span class="string">&quot;/swagger-resources/**&quot;</span>,</span><br><span class="line">                        <span class="string">&quot;/v3/api-docs/**&quot;</span>,</span><br><span class="line">                        <span class="string">&quot;/webjars/**&quot;</span>,</span><br><span class="line">                        <span class="string">&quot;/actuator/**&quot;</span>,</span><br><span class="line">                        <span class="string">&quot;/error&quot;</span></span><br><span class="line">                );</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="7-åˆ›å»ºæ—¥å¿—åˆ‡é¢"><a href="#7-åˆ›å»ºæ—¥å¿—åˆ‡é¢" class="headerlink" title="7. åˆ›å»ºæ—¥å¿—åˆ‡é¢"></a>7. åˆ›å»ºæ—¥å¿—åˆ‡é¢</h3><p><strong>æ–‡ä»¶è·¯å¾„</strong>: <code>src/main/java/com/yourpackage/aspect/LogAspect.java</code></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.yourpackage.aspect;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.yourpackage.annotation.LogBusiness;</span><br><span class="line"><span class="keyword">import</span> com.yourpackage.util.LogUtil;</span><br><span class="line"><span class="keyword">import</span> org.aspectj.lang.ProceedingJoinPoint;</span><br><span class="line"><span class="keyword">import</span> org.aspectj.lang.annotation.Around;</span><br><span class="line"><span class="keyword">import</span> org.aspectj.lang.annotation.Aspect;</span><br><span class="line"><span class="keyword">import</span> org.aspectj.lang.annotation.Pointcut;</span><br><span class="line"><span class="keyword">import</span> org.slf4j.Logger;</span><br><span class="line"><span class="keyword">import</span> org.slf4j.LoggerFactory;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Aspect</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LogAspect</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">Logger</span> <span class="variable">logger</span> <span class="operator">=</span> LoggerFactory.getLogger(LogAspect.class);</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Pointcut(&quot;within(@org.springframework.stereotype.Controller *) || &quot; +</span></span><br><span class="line"><span class="meta">              &quot;within(@org.springframework.web.bind.annotation.RestController *) || &quot; +</span></span><br><span class="line"><span class="meta">              &quot;within(@org.springframework.stereotype.Service *) || &quot; +</span></span><br><span class="line"><span class="meta">              &quot;within(@org.springframework.stereotype.Repository *)&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">applicationPackagePointcut</span><span class="params">()</span> &#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Around(&quot;applicationPackagePointcut()&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">logAround</span><span class="params">(ProceedingJoinPoint joinPoint)</span> <span class="keyword">throws</span> Throwable &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">operation</span> <span class="operator">=</span> joinPoint.getSignature().getDeclaringTypeName() + <span class="string">&quot;.&quot;</span> + joinPoint.getSignature().getName();</span><br><span class="line">        </span><br><span class="line">        <span class="type">long</span> <span class="variable">startTime</span> <span class="operator">=</span> System.currentTimeMillis();</span><br><span class="line">        <span class="type">Object</span> <span class="variable">result</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="type">Exception</span> <span class="variable">thrownException</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            LogUtil.logDebug(logger, <span class="string">&quot;æ–¹æ³•è°ƒç”¨å¼€å§‹&quot;</span>, operation, joinPoint.getArgs());</span><br><span class="line">            result = joinPoint.proceed();</span><br><span class="line">            <span class="keyword">return</span> result;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            thrownException = e;</span><br><span class="line">            <span class="keyword">throw</span> e;</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            <span class="type">long</span> <span class="variable">duration</span> <span class="operator">=</span> System.currentTimeMillis() - startTime;</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">if</span> (thrownException != <span class="literal">null</span>) &#123;</span><br><span class="line">                LogUtil.logException(logger, operation, thrownException, joinPoint.getArgs());</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                LogUtil.logPerformance(logger, operation, duration, joinPoint.getArgs(), result);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Pointcut(&quot;@annotation(com.yourpackage.annotation.LogBusiness)&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">logBusinessPointcut</span><span class="params">()</span> &#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Around(&quot;logBusinessPointcut()&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">logBusinessAround</span><span class="params">(ProceedingJoinPoint joinPoint)</span> <span class="keyword">throws</span> Throwable &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">operation</span> <span class="operator">=</span> joinPoint.getSignature().getDeclaringTypeName() + <span class="string">&quot;.&quot;</span> + joinPoint.getSignature().getName();</span><br><span class="line">        </span><br><span class="line">        <span class="type">Object</span> <span class="variable">result</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="type">Exception</span> <span class="variable">thrownException</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            result = joinPoint.proceed();</span><br><span class="line">            <span class="keyword">return</span> result;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            thrownException = e;</span><br><span class="line">            <span class="keyword">throw</span> e;</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (thrownException == <span class="literal">null</span>) &#123;</span><br><span class="line">                LogUtil.logBusiness(logger, operation, joinPoint.getArgs(), result);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="8-åˆ›å»ºä¸šåŠ¡æ—¥å¿—æ³¨è§£"><a href="#8-åˆ›å»ºä¸šåŠ¡æ—¥å¿—æ³¨è§£" class="headerlink" title="8. åˆ›å»ºä¸šåŠ¡æ—¥å¿—æ³¨è§£"></a>8. åˆ›å»ºä¸šåŠ¡æ—¥å¿—æ³¨è§£</h3><p><strong>æ–‡ä»¶è·¯å¾„</strong>: <code>src/main/java/com/yourpackage/annotation/LogBusiness.java</code></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.yourpackage.annotation;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.lang.annotation.ElementType;</span><br><span class="line"><span class="keyword">import</span> java.lang.annotation.Retention;</span><br><span class="line"><span class="keyword">import</span> java.lang.annotation.RetentionPolicy;</span><br><span class="line"><span class="keyword">import</span> java.lang.annotation.Target;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Target(ElementType.METHOD)</span></span><br><span class="line"><span class="meta">@Retention(RetentionPolicy.RUNTIME)</span></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> LogBusiness &#123;</span><br><span class="line">    String <span class="title function_">value</span><span class="params">()</span> <span class="keyword">default</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">    <span class="type">boolean</span> <span class="title function_">logParams</span><span class="params">()</span> <span class="keyword">default</span> <span class="literal">true</span>;</span><br><span class="line">    <span class="type">boolean</span> <span class="title function_">logResult</span><span class="params">()</span> <span class="keyword">default</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="9-ä½¿ç”¨ç¤ºä¾‹"><a href="#9-ä½¿ç”¨ç¤ºä¾‹" class="headerlink" title="9. ä½¿ç”¨ç¤ºä¾‹"></a>9. ä½¿ç”¨ç¤ºä¾‹</h3><p><strong>æ–‡ä»¶è·¯å¾„</strong>: <code>src/main/java/com/yourpackage/controller/LogDemoController.java</code></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.yourpackage.controller;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.yourpackage.annotation.LogBusiness;</span><br><span class="line"><span class="keyword">import</span> com.yourpackage.util.LogUtil;</span><br><span class="line"><span class="keyword">import</span> org.slf4j.Logger;</span><br><span class="line"><span class="keyword">import</span> org.slf4j.LoggerFactory;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/log-demo&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LogDemoController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">Logger</span> <span class="variable">logger</span> <span class="operator">=</span> LoggerFactory.getLogger(LogDemoController.class);</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/test&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Map&lt;String, Object&gt; <span class="title function_">testLog</span><span class="params">(<span class="meta">@RequestParam(defaultValue = &quot;test&quot;)</span> String name)</span> &#123;</span><br><span class="line">        Map&lt;String, Object&gt; params = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">        params.put(<span class="string">&quot;name&quot;</span>, name);</span><br><span class="line">        LogUtil.logDebug(logger, <span class="string">&quot;æµ‹è¯•æ—¥å¿—è®°å½•&quot;</span>, params);</span><br><span class="line">        </span><br><span class="line">        Map&lt;String, Object&gt; result = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">        result.put(<span class="string">&quot;message&quot;</span>, <span class="string">&quot;Hello &quot;</span> + name);</span><br><span class="line">        result.put(<span class="string">&quot;timestamp&quot;</span>, System.currentTimeMillis());</span><br><span class="line">        </span><br><span class="line">        LogUtil.logBusiness(logger, <span class="string">&quot;æµ‹è¯•ä¸šåŠ¡æ“ä½œ&quot;</span>, params, result);</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/business&quot;)</span></span><br><span class="line">    <span class="meta">@LogBusiness(&quot;ç”¨æˆ·æŸ¥è¯¢æ“ä½œ&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Map&lt;String, Object&gt; <span class="title function_">testBusinessLog</span><span class="params">(<span class="meta">@RequestParam</span> String userId)</span> &#123;</span><br><span class="line">        Map&lt;String, Object&gt; result = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">        result.put(<span class="string">&quot;userId&quot;</span>, userId);</span><br><span class="line">        result.put(<span class="string">&quot;username&quot;</span>, <span class="string">&quot;å¼ ä¸‰&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/user-action&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Map&lt;String, Object&gt; <span class="title function_">testUserAction</span><span class="params">(<span class="meta">@RequestParam</span> String userId, <span class="meta">@RequestParam</span> String action)</span> &#123;</span><br><span class="line">        Map&lt;String, Object&gt; details = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">        details.put(<span class="string">&quot;action&quot;</span>, action);</span><br><span class="line">        details.put(<span class="string">&quot;time&quot;</span>, System.currentTimeMillis());</span><br><span class="line">        </span><br><span class="line">        LogUtil.logUserAction(logger, userId, action, details);</span><br><span class="line">        LogUtil.logSecurity(logger, userId, action, <span class="string">&quot;127.0.0.1&quot;</span>, details);</span><br><span class="line">        </span><br><span class="line">        Map&lt;String, Object&gt; result = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">        result.put(<span class="string">&quot;status&quot;</span>, <span class="string">&quot;logged&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="æ—¥å¿—æ–‡ä»¶è¯´æ˜"><a href="#æ—¥å¿—æ–‡ä»¶è¯´æ˜" class="headerlink" title="æ—¥å¿—æ–‡ä»¶è¯´æ˜"></a>æ—¥å¿—æ–‡ä»¶è¯´æ˜</h2><h3 id="æ—¥å¿—æ–‡ä»¶åˆ†ç±»"><a href="#æ—¥å¿—æ–‡ä»¶åˆ†ç±»" class="headerlink" title="æ—¥å¿—æ–‡ä»¶åˆ†ç±»"></a>æ—¥å¿—æ–‡ä»¶åˆ†ç±»</h3><ul>
<li><strong>ä¸»æ—¥å¿—</strong>: <code>logs/YourAppName.log</code> - åº”ç”¨ä¸»è¦æ—¥å¿—</li>
<li><strong>é”™è¯¯æ—¥å¿—</strong>: <code>logs/YourAppName_error.log</code> - ä»…åŒ…å«ERRORçº§åˆ«æ—¥å¿—</li>
<li><strong>ä¸šåŠ¡æ—¥å¿—</strong>: <code>logs/YourAppName_business.log</code> - ä¸šåŠ¡æ“ä½œæ—¥å¿—</li>
<li><strong>SQLæ—¥å¿—</strong>: <code>logs/YourAppName_sql.log</code> - æ•°æ®åº“æ“ä½œæ—¥å¿—</li>
<li><strong>è®¿é—®æ—¥å¿—</strong>: <code>logs/YourAppName_access.log</code> - æ¥å£è®¿é—®æ—¥å¿—ï¼ˆè‡ªåŠ¨ç”Ÿæˆï¼‰</li>
</ul>
<h3 id="æ—¥å¿—æ ¼å¼"><a href="#æ—¥å¿—æ ¼å¼" class="headerlink" title="æ—¥å¿—æ ¼å¼"></a>æ—¥å¿—æ ¼å¼</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">2024-01-15 10:30:45.123 [http-nio-8080-exec-1] INFO  [c.y.c.LogDemoController] - [æ¥å£è®¿é—®] GET /api/test, IP: 127.0.0.1, å‚æ•°: &#123;&quot;id&quot;:1&#125;, è€—æ—¶: 150ms, ç»“æœ: &#123;&quot;success&quot;:true&#125;</span><br></pre></td></tr></table></figure>

<h2 id="ä½¿ç”¨è§„èŒƒ"><a href="#ä½¿ç”¨è§„èŒƒ" class="headerlink" title="ä½¿ç”¨è§„èŒƒ"></a>ä½¿ç”¨è§„èŒƒ</h2><h3 id="1-æ—¥å¿—çº§åˆ«è§„èŒƒ"><a href="#1-æ—¥å¿—çº§åˆ«è§„èŒƒ" class="headerlink" title="1. æ—¥å¿—çº§åˆ«è§„èŒƒ"></a>1. æ—¥å¿—çº§åˆ«è§„èŒƒ</h3><ul>
<li><strong>DEBUG</strong>: è°ƒè¯•ä¿¡æ¯ï¼Œä»…åœ¨å¼€å‘ç¯å¢ƒä½¿ç”¨</li>
<li><strong>INFO</strong>: ä¸šåŠ¡æ“ä½œã€æ¥å£è®¿é—®ã€æ€§èƒ½ç»Ÿè®¡</li>
<li><strong>WARN</strong>: ä¸šåŠ¡è­¦å‘Šã€å®‰å…¨ç›¸å…³æ“ä½œ</li>
<li><strong>ERROR</strong>: ç³»ç»Ÿå¼‚å¸¸ã€ä¸šåŠ¡å¼‚å¸¸</li>
</ul>
<h3 id="2-æ—¥å¿—è®°å½•åœºæ™¯"><a href="#2-æ—¥å¿—è®°å½•åœºæ™¯" class="headerlink" title="2. æ—¥å¿—è®°å½•åœºæ™¯"></a>2. æ—¥å¿—è®°å½•åœºæ™¯</h3><table>
<thead>
<tr>
<th>åœºæ™¯ç±»å‹</th>
<th>è®°å½•æ–¹å¼</th>
<th>æ—¥å¿—çº§åˆ«</th>
</tr>
</thead>
<tbody><tr>
<td>æ¥å£è®¿é—®</td>
<td>è‡ªåŠ¨è®°å½•</td>
<td>INFO</td>
</tr>
<tr>
<td>ä¸šåŠ¡æ“ä½œ</td>
<td>@LogBusinessæ³¨è§£</td>
<td>INFO</td>
</tr>
<tr>
<td>å¼‚å¸¸å¤„ç†</td>
<td>LogUtil.logException</td>
<td>ERROR</td>
</tr>
<tr>
<td>æ€§èƒ½ç»Ÿè®¡</td>
<td>LogUtil.logPerformance</td>
<td>INFO</td>
</tr>
<tr>
<td>ç”¨æˆ·æ“ä½œ</td>
<td>LogUtil.logUserAction</td>
<td>INFO</td>
</tr>
<tr>
<td>å®‰å…¨æ“ä½œ</td>
<td>LogUtil.logSecurity</td>
<td>WARN</td>
</tr>
</tbody></table>
<h3 id="3-ä½¿ç”¨æ–¹æ³•"><a href="#3-ä½¿ç”¨æ–¹æ³•" class="headerlink" title="3. ä½¿ç”¨æ–¹æ³•"></a>3. ä½¿ç”¨æ–¹æ³•</h3><h4 id="åŸºç¡€æ—¥å¿—è®°å½•"><a href="#åŸºç¡€æ—¥å¿—è®°å½•" class="headerlink" title="åŸºç¡€æ—¥å¿—è®°å½•"></a>åŸºç¡€æ—¥å¿—è®°å½•</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// è·å–logger</span></span><br><span class="line"><span class="type">Logger</span> <span class="variable">logger</span> <span class="operator">=</span> LogUtil.getLogger(YourClass.class);</span><br><span class="line"></span><br><span class="line"><span class="comment">// è®°å½•ä¸šåŠ¡æ—¥å¿—</span></span><br><span class="line">LogUtil.logBusiness(logger, <span class="string">&quot;ç”¨æˆ·ç™»å½•&quot;</span>, loginRequest, loginResponse);</span><br><span class="line"></span><br><span class="line"><span class="comment">// è®°å½•å¼‚å¸¸æ—¥å¿—</span></span><br><span class="line">LogUtil.logException(logger, <span class="string">&quot;è®¢å•å¤„ç†&quot;</span>, exception, orderId, userId);</span><br><span class="line"></span><br><span class="line"><span class="comment">// è®°å½•æ€§èƒ½æ—¥å¿—</span></span><br><span class="line">LogUtil.logPerformance(logger, <span class="string">&quot;æ•°æ®åº“æŸ¥è¯¢&quot;</span>, duration, queryParams);</span><br></pre></td></tr></table></figure>

<h4 id="æ³¨è§£æ–¹å¼è®°å½•"><a href="#æ³¨è§£æ–¹å¼è®°å½•" class="headerlink" title="æ³¨è§£æ–¹å¼è®°å½•"></a>æ³¨è§£æ–¹å¼è®°å½•</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserService</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@LogBusiness(&quot;ç”¨æˆ·æ³¨å†Œ&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> User <span class="title function_">registerUser</span><span class="params">(UserRegisterRequest request)</span> &#123;</span><br><span class="line">        <span class="comment">// æ–¹æ³•æ‰§è¡Œåä¼šè‡ªåŠ¨è®°å½•ä¸šåŠ¡æ—¥å¿—</span></span><br><span class="line">        <span class="keyword">return</span> user;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="è¯·æ±‚è¿½è¸ª"><a href="#è¯·æ±‚è¿½è¸ª" class="headerlink" title="è¯·æ±‚è¿½è¸ª"></a>è¯·æ±‚è¿½è¸ª</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// åœ¨æ‹¦æˆªå™¨ä¸­è‡ªåŠ¨è®¾ç½®</span></span><br><span class="line">LogUtil.setTraceId(); <span class="comment">// è®¾ç½®è¿½è¸ªID</span></span><br><span class="line"><span class="type">String</span> <span class="variable">traceId</span> <span class="operator">=</span> LogUtil.getTraceId(); <span class="comment">// è·å–è¿½è¸ªID</span></span><br><span class="line">LogUtil.clearTraceId(); <span class="comment">// æ¸…ç†è¿½è¸ªID</span></span><br></pre></td></tr></table></figure>

<h2 id="ç¯å¢ƒé…ç½®"><a href="#ç¯å¢ƒé…ç½®" class="headerlink" title="ç¯å¢ƒé…ç½®"></a>ç¯å¢ƒé…ç½®</h2><h3 id="å¼€å‘ç¯å¢ƒ-dev"><a href="#å¼€å‘ç¯å¢ƒ-dev" class="headerlink" title="å¼€å‘ç¯å¢ƒ (dev)"></a>å¼€å‘ç¯å¢ƒ (dev)</h3><ul>
<li>æ—¥å¿—çº§åˆ«: DEBUG</li>
<li>è¾“å‡º: æ§åˆ¶å° + æ‰€æœ‰æ–‡ä»¶</li>
<li>SQLæ—¥å¿—: å¼€å¯</li>
</ul>
<h3 id="æµ‹è¯•ç¯å¢ƒ-test"><a href="#æµ‹è¯•ç¯å¢ƒ-test" class="headerlink" title="æµ‹è¯•ç¯å¢ƒ (test)"></a>æµ‹è¯•ç¯å¢ƒ (test)</h3><ul>
<li>æ—¥å¿—çº§åˆ«: INFO</li>
<li>è¾“å‡º: æ–‡ä»¶è¾“å‡º</li>
<li>SQLæ—¥å¿—: å…³é—­</li>
</ul>
<h3 id="ç”Ÿäº§ç¯å¢ƒ-prod"><a href="#ç”Ÿäº§ç¯å¢ƒ-prod" class="headerlink" title="ç”Ÿäº§ç¯å¢ƒ (prod)"></a>ç”Ÿäº§ç¯å¢ƒ (prod)</h3><ul>
<li>æ—¥å¿—çº§åˆ«: INFO</li>
<li>è¾“å‡º: æ–‡ä»¶è¾“å‡º</li>
<li>SQLæ—¥å¿—: å…³é—­</li>
</ul>
<h2 id="æµ‹è¯•éªŒè¯"><a href="#æµ‹è¯•éªŒè¯" class="headerlink" title="æµ‹è¯•éªŒè¯"></a>æµ‹è¯•éªŒè¯</h2><p>å¯åŠ¨é¡¹ç›®åï¼Œå¯ä»¥é€šè¿‡ä»¥ä¸‹æ¥å£æµ‹è¯•ï¼š</p>
<ul>
<li><code>GET /log-demo/test?name=test</code> - æµ‹è¯•åŸºç¡€æ—¥å¿—</li>
<li><code>GET /log-demo/business?userId=123</code> - æµ‹è¯•ä¸šåŠ¡æ—¥å¿—æ³¨è§£</li>
<li><code>GET /log-demo/user-action?userId=123&amp;action=login</code> - æµ‹è¯•ç”¨æˆ·æ“ä½œæ—¥å¿—</li>
</ul>
<h2 id="æ³¨æ„äº‹é¡¹"><a href="#æ³¨æ„äº‹é¡¹" class="headerlink" title="æ³¨æ„äº‹é¡¹"></a>æ³¨æ„äº‹é¡¹</h2><ol>
<li><strong>æ—¥å¿—æ–‡ä»¶å¤§å°</strong>: å•ä¸ªæ—¥å¿—æ–‡ä»¶æœ€å¤§100MBï¼Œä¿ç•™30å¤©</li>
<li><strong>æ•æ„Ÿä¿¡æ¯</strong>: é¿å…åœ¨æ—¥å¿—ä¸­è®°å½•å¯†ç ã€tokenç­‰æ•æ„Ÿä¿¡æ¯</li>
<li><strong>æ€§èƒ½å½±å“</strong>: ç”Ÿäº§ç¯å¢ƒé¿å…è®°å½•è¿‡å¤šDEBUGæ—¥å¿—</li>
<li><strong>JSONåºåˆ—åŒ–</strong>: å¤æ‚å¯¹è±¡ç¡®ä¿æœ‰é»˜è®¤æ„é€ å‡½æ•°</li>
<li><strong>è¿½è¸ªID</strong>: æ‰€æœ‰æ—¥å¿—è‡ªåŠ¨åŒ…å«è¿½è¸ªIDï¼Œä¾¿äºé“¾è·¯è¿½è¸ª</li>
</ol>
<h2 id="æ‰©å±•å»ºè®®"><a href="#æ‰©å±•å»ºè®®" class="headerlink" title="æ‰©å±•å»ºè®®"></a>æ‰©å±•å»ºè®®</h2><ol>
<li><strong>ELKé›†æˆ</strong>: å¯æ¥å…¥ELKè¿›è¡Œæ—¥å¿—åˆ†æå’Œå¯è§†åŒ–</li>
<li><strong>å¼‚æ­¥æ—¥å¿—</strong>: é«˜å¹¶å‘åœºæ™¯å¯ä½¿ç”¨å¼‚æ­¥æ—¥å¿—æå‡æ€§èƒ½</li>
<li><strong>æ—¥å¿—è„±æ•</strong>: å¯¹æ•æ„Ÿä¿¡æ¯è¿›è¡Œè„±æ•å¤„ç†</li>
<li><strong>é“¾è·¯è¿½è¸ª</strong>: é›†æˆZipkinæˆ–SkyWalkingè¿›è¡Œåˆ†å¸ƒå¼è¿½è¸ª</li>
</ol>
]]></content>
      <categories>
        <category>web</category>
      </categories>
      <tags>
        <tag>springboot</tag>
      </tags>
  </entry>
  <entry>
    <title>golangä¸ºå•¥è¿è¡Œè¿‡ç¨‹å ç”¨å†…å­˜å°</title>
    <url>/2025/08/09/web/golang%E4%B8%BA%E5%95%A5%E8%BF%90%E8%A1%8C%E8%BF%87%E7%A8%8B%E5%8D%A0%E7%94%A8%E5%86%85%E5%AD%98%E5%B0%8F/</url>
    <content><![CDATA[<p>Go è¯­è¨€åœ¨è¿è¡Œè¿‡ç¨‹ä¸­çœ‹èµ·æ¥â€œå ç”¨å†…å­˜å°â€ï¼Œå…¶å®æ˜¯å¤šç§è®¾è®¡æƒè¡¡å’Œè¿è¡Œæ—¶ä¼˜åŒ–å…±åŒä½œç”¨çš„ç»“æœã€‚ä¸‹é¢ä»å‡ ä¸ªæ ¸å¿ƒæ–¹é¢è§£é‡Šå®ƒä¸ºä»€ä¹ˆèƒ½ç»™äººä¸€ç§â€œçœå†…å­˜â€çš„å°è±¡ï¼Œå¹¶æ¾„æ¸…ä¸€äº›å¸¸è§è¯¯è§£ã€‚</p>
<hr>
<h3 id="ä¸€ã€å€¼ç±»å‹ä¸å†…å­˜å¸ƒå±€ç´§å‡‘"><a href="#ä¸€ã€å€¼ç±»å‹ä¸å†…å­˜å¸ƒå±€ç´§å‡‘" class="headerlink" title="ä¸€ã€å€¼ç±»å‹ä¸å†…å­˜å¸ƒå±€ç´§å‡‘"></a>ä¸€ã€<strong>å€¼ç±»å‹ä¸å†…å­˜å¸ƒå±€ç´§å‡‘</strong></h3><ul>
<li><p><strong>å¤§å¤šæ•°ç±»å‹æ˜¯å€¼ç±»å‹</strong>ï¼š<br>Go ä¸­ <code>int</code>ã€<code>float</code>ã€<code>struct</code> ç”šè‡³ <code>array</code> éƒ½æ˜¯å€¼ç±»å‹ï¼Œç›´æ¥å†…è”åœ¨æ ˆæˆ–å¯¹è±¡å†…å­˜ä¸­ï¼Œé¿å…äº† Java&#x2F;C# é‚£ç§â€œä¸€åˆ‡çš†å¯¹è±¡â€å¸¦æ¥çš„é¢å¤–å¯¹è±¡å¤´ï¼ˆobject headerï¼‰å¼€é”€ã€‚<br>ä¸¾ä¾‹ï¼š  </p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">type</span> Point <span class="keyword">struct</span>&#123; X, Y <span class="type">int</span> &#125; <span class="comment">// 16 å­—èŠ‚ï¼Œæ— é¢å¤–å¤´éƒ¨</span></span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>å†…å­˜å¯¹é½ä¼˜åŒ–</strong>ï¼š<br>Go ç¼–è¯‘å™¨è‡ªåŠ¨é‡æ’ç»“æ„ä½“å­—æ®µï¼Œå‡å°‘å¡«å……ï¼ˆpaddingï¼‰ï¼Œä½¿å†…å­˜å¸ƒå±€æ›´ç´§å‡‘ã€‚  </p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="comment">// ä¼˜åŒ–å‰ï¼š24 å­—èŠ‚ï¼ˆå› å¯¹é½å¡«å……ï¼‰</span></span><br><span class="line"><span class="keyword">type</span> Bad <span class="keyword">struct</span>&#123; a <span class="type">bool</span>; b <span class="type">int64</span>; c <span class="type">bool</span> &#125;</span><br><span class="line"><span class="comment">// ä¼˜åŒ–åï¼š16 å­—èŠ‚ï¼ˆå­—æ®µé‡æ’åï¼‰</span></span><br><span class="line"><span class="keyword">type</span> Good <span class="keyword">struct</span>&#123; b <span class="type">int64</span>; a, c <span class="type">bool</span> &#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<hr>
<h3 id="äºŒã€é«˜æ•ˆçš„åƒåœ¾å›æ”¶ï¼ˆGCï¼‰"><a href="#äºŒã€é«˜æ•ˆçš„åƒåœ¾å›æ”¶ï¼ˆGCï¼‰" class="headerlink" title="äºŒã€é«˜æ•ˆçš„åƒåœ¾å›æ”¶ï¼ˆGCï¼‰"></a>äºŒã€<strong>é«˜æ•ˆçš„åƒåœ¾å›æ”¶ï¼ˆGCï¼‰</strong></h3><ul>
<li><p><strong>å¹¶å‘ã€ä¸‰è‰²æ ‡è®°æ¸…é™¤</strong>ï¼š<br>Go çš„ GC æ˜¯å¹¶å‘æ‰§è¡Œçš„ï¼Œæ ‡è®°é˜¶æ®µä¸ç”¨æˆ·ä»£ç å¹¶è¡Œï¼Œå‡å°‘äº† STWï¼ˆStop-The-Worldï¼‰æ—¶é—´ã€‚è™½ç„¶ GC æœ¬èº«ä¼šå ç”¨é¢å¤–å†…å­˜ï¼ˆå¦‚æ ‡è®°ä½å›¾ã€å†™å±éšœç¼“å†²åŒºï¼‰ï¼Œä½† <strong>GC è§¦å‘é˜ˆå€¼åŠ¨æ€è°ƒæ•´</strong> ä½¿å¾—å†…å­˜ä¸ä¼šæ— é™å¢é•¿ï¼š  </p>
<ul>
<li>å½“å­˜æ´»å¯¹è±¡æ¯”ä¾‹è¾ƒé«˜æ—¶ï¼ŒGC ä¼šæ›´é¢‘ç¹åœ°è¿è¡Œï¼Œé¿å…å†…å­˜å †ç§¯ã€‚  </li>
<li>å½“å†…å­˜å‹åŠ›å°æ—¶ï¼ŒGC ä¼šå‡å°‘é¢‘ç‡ï¼Œé™ä½ CPU å¼€é”€ã€‚</li>
</ul>
</li>
<li><p><strong>å†…å­˜é‡Šæ”¾å›æ“ä½œç³»ç»Ÿ</strong>ï¼š<br>Go 1.19+ æ”¹è¿›äº†å†…å­˜é‡Šæ”¾ç­–ç•¥ï¼Œ<strong>ç©ºé—²å†…å­˜ä¼šå®šæœŸå½’è¿˜ç»™æ“ä½œç³»ç»Ÿ</strong>ï¼ˆé€šè¿‡ <code>madvise</code> ç³»ç»Ÿè°ƒç”¨ï¼‰ï¼Œè€Œå…¶ä»–è¯­è¨€ï¼ˆå¦‚ Javaï¼‰çš„ JVM é€šå¸¸ä¸ä¼šä¸»åŠ¨å½’è¿˜å†…å­˜ç»™ OSï¼Œå¯¼è‡´çœ‹èµ·æ¥â€œå ç”¨é«˜â€ã€‚</p>
</li>
</ul>
<hr>
<h3 id="ä¸‰ã€è¿è¡Œæ—¶å†…å­˜åˆ†é…ä¼˜åŒ–"><a href="#ä¸‰ã€è¿è¡Œæ—¶å†…å­˜åˆ†é…ä¼˜åŒ–" class="headerlink" title="ä¸‰ã€è¿è¡Œæ—¶å†…å­˜åˆ†é…ä¼˜åŒ–"></a>ä¸‰ã€<strong>è¿è¡Œæ—¶å†…å­˜åˆ†é…ä¼˜åŒ–</strong></h3><ul>
<li><p><strong>åŸºäº TCMalloc çš„å†…å­˜åˆ†é…å™¨</strong>ï¼š<br>Go çš„è¿è¡Œæ—¶ï¼ˆruntimeï¼‰ä½¿ç”¨çº¿ç¨‹æœ¬åœ°ç¼“å­˜ï¼ˆmcacheï¼‰ã€ä¸­å¿ƒç¼“å­˜ï¼ˆmcentralï¼‰å’Œé¡µå †ï¼ˆmheapï¼‰ä¸‰çº§ç»“æ„ï¼Œå‡å°‘é”ç«äº‰å’Œç¢ç‰‡ã€‚å°å¯¹è±¡ï¼ˆ&lt;32KBï¼‰ç›´æ¥ä»çº¿ç¨‹ç¼“å­˜åˆ†é…ï¼Œé¿å…ç³»ç»Ÿè°ƒç”¨ã€‚</p>
</li>
<li><p><strong>å¯¹è±¡å¤ç”¨ï¼ˆsync.Poolï¼‰</strong>ï¼š<br>æ ‡å‡†åº“æä¾› <code>sync.Pool</code> ä¸´æ—¶å¯¹è±¡æ± ï¼Œå¤ç”¨é«˜é¢‘åˆ›å»ºçš„ä¸´æ—¶å¯¹è±¡ï¼ˆå¦‚ <code>bytes.Buffer</code>ï¼‰ï¼Œæ˜¾è‘—å‡å°‘ GC å‹åŠ›ã€‚  </p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> bufPool = sync.Pool&#123;</span><br><span class="line">    New: <span class="function"><span class="keyword">func</span><span class="params">()</span></span> <span class="keyword">interface</span>&#123;&#125; &#123; <span class="keyword">return</span> <span class="built_in">new</span>(bytes.Buffer) &#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<hr>
<h3 id="å››ã€æ— è™šæ‹Ÿæœºï¼ˆVMï¼‰å¼€é”€"><a href="#å››ã€æ— è™šæ‹Ÿæœºï¼ˆVMï¼‰å¼€é”€" class="headerlink" title="å››ã€æ— è™šæ‹Ÿæœºï¼ˆVMï¼‰å¼€é”€"></a>å››ã€<strong>æ— è™šæ‹Ÿæœºï¼ˆVMï¼‰å¼€é”€</strong></h3><ul>
<li><strong>ç›´æ¥ç¼–è¯‘ä¸ºæœºå™¨ç </strong>ï¼š<br>Go æ˜¯é™æ€ç¼–è¯‘è¯­è¨€ï¼Œç”Ÿæˆçš„äºŒè¿›åˆ¶ç›´æ¥è¿è¡Œåœ¨ç¡¬ä»¶ä¸Šï¼Œæ— éœ€åƒ JVM æˆ– Python è§£é‡Šå™¨é‚£æ ·åŠ è½½åºå¤§çš„è¿è¡Œæ—¶ç¯å¢ƒï¼ˆå¦‚ JVM çš„ç±»åŠ è½½å™¨ã€å­—èŠ‚ç éªŒè¯å™¨ï¼‰ã€‚<br>ä¾‹å¦‚ï¼šä¸€ä¸ªæœ€å° Go HTTP æœåŠ¡ç¼–è¯‘åäºŒè¿›åˆ¶çº¦ 5-10MBï¼Œè€Œ JVM å¯åŠ¨æ—¶ä»… heap å°±å¯èƒ½å ç”¨æ•°å MBã€‚</li>
</ul>
<hr>
<h3 id="äº”ã€è¯­è¨€è®¾è®¡é™åˆ¶å†…å­˜æ»¥ç”¨"><a href="#äº”ã€è¯­è¨€è®¾è®¡é™åˆ¶å†…å­˜æ»¥ç”¨" class="headerlink" title="äº”ã€è¯­è¨€è®¾è®¡é™åˆ¶å†…å­˜æ»¥ç”¨"></a>äº”ã€<strong>è¯­è¨€è®¾è®¡é™åˆ¶å†…å­˜æ»¥ç”¨</strong></h3><ul>
<li><p><strong>æ— éšå¼å†…å­˜å…±äº«</strong>ï¼š<br>Go çš„å¹¶å‘æ¨¡å‹åŸºäº CSPï¼ˆé€šä¿¡é¡ºåºè¿›ç¨‹ï¼‰ï¼Œé¼“åŠ±é€šè¿‡ channel ä¼ é€’æ•°æ®å‰¯æœ¬ï¼Œè€Œéå…±äº«å†…å­˜ã€‚è¿™å‡å°‘äº†å› å…±äº«æ•°æ®ç»“æ„å¯¼è‡´çš„é•¿æœŸå†…å­˜å ç”¨ã€‚</p>
</li>
<li><p><strong>åˆ‡ç‰‡ï¼ˆsliceï¼‰çš„åº•å±‚æ•°ç»„å¤ç”¨</strong>ï¼š<br>åˆ‡ç‰‡æ“ä½œå¯èƒ½å…±äº«åº•å±‚æ•°ç»„ï¼Œä½†è‹¥å‘ç”Ÿæ‰©å®¹ï¼ˆå¦‚ <code>append</code> è¶…è¿‡å®¹é‡ï¼‰ï¼Œä¼šé‡æ–°åˆ†é…å¹¶å¤åˆ¶æ•°æ®ï¼Œé¿å…è¿‡åº¦å ç”¨å†…å­˜ã€‚</p>
</li>
</ul>
<hr>
<h3 id="å¸¸è§è¯¯è§£æ¾„æ¸…"><a href="#å¸¸è§è¯¯è§£æ¾„æ¸…" class="headerlink" title="å¸¸è§è¯¯è§£æ¾„æ¸…"></a>å¸¸è§è¯¯è§£æ¾„æ¸…</h3><ol>
<li><p><strong>â€œGo ç¨‹åºå†…å­˜å ç”¨ä¸€å®šæ¯” Java&#x2F;Python å°â€</strong>ï¼š<br>è‹¥ç¨‹åºæœ¬èº«é€»è¾‘éœ€è¦å¤§é‡æ•°æ®ï¼ˆå¦‚åŠ è½½ 1GB æ–‡ä»¶åˆ°å†…å­˜ï¼‰ï¼Œä»»ä½•è¯­è¨€éƒ½ä¼šå ç”¨ 1GBã€‚Go çš„â€œçœå†…å­˜â€ä½“ç°åœ¨<strong>è¿è¡Œæ—¶é¢å¤–å¼€é”€å°</strong>ï¼Œè€Œéé­”æ³•èˆ¬å‡å°‘å®é™…éœ€æ±‚ã€‚</p>
</li>
<li><p><strong>â€œGo çš„ GC ä¸å¦‚ Java çš„ G1 é«˜æ•ˆâ€</strong>ï¼š<br>ç°ä»£ Go çš„ GC ååé‡å¯èƒ½ä½äº G1ï¼Œä½†å»¶è¿Ÿæ›´ä½ï¼ˆé»˜è®¤ &lt;1msï¼‰ï¼Œä¸”å†…å­˜é‡Šæ”¾æ›´ç§¯æã€‚è¿™æ˜¯é’ˆå¯¹æœåŠ¡ç«¯åœºæ™¯çš„æƒè¡¡ã€‚</p>
</li>
</ol>
<hr>
<h3 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h3><p>Go çš„â€œå†…å­˜å ç”¨å°â€æ˜¯<strong>è¯­è¨€è®¾è®¡ï¼ˆå€¼ç±»å‹ã€ç´§å‡‘å¸ƒå±€ï¼‰ + è¿è¡Œæ—¶ä¼˜åŒ–ï¼ˆGCã€åˆ†é…å™¨ï¼‰ + æ—  VM å¼€é”€</strong>çš„ç»¼åˆç»“æœã€‚å®ƒå¹¶éç»å¯¹èŠ‚çœå†…å­˜ï¼Œè€Œæ˜¯<strong>åœ¨åŒç­‰ä¸šåŠ¡éœ€æ±‚ä¸‹ï¼Œè¿è¡Œæ—¶é¢å¤–è´Ÿæ‹…æ›´å°</strong>ï¼Œå°¤å…¶é€‚åˆäº‘åŸç”Ÿã€å¾®æœåŠ¡ç­‰å¯¹èµ„æºæ•æ„Ÿçš„åœºæ™¯ã€‚</p>
]]></content>
      <categories>
        <category>web</category>
      </categories>
      <tags>
        <tag>golang</tag>
      </tags>
  </entry>
  <entry>
    <title>golangä½¿ç”¨apiå¯åŠ¨æˆ–åœæ­¢goroutine</title>
    <url>/2025/08/13/web/golang%E4%BD%BF%E7%94%A8api%E5%90%AF%E5%8A%A8%E6%88%96%E5%81%9C%E6%AD%A2goroutine/</url>
    <content><![CDATA[<p><em>åœ¨ Go è¯­è¨€ä¸­ï¼ŒGoroutine æ˜¯ä¸€ç§è½»é‡çº§çš„çº¿ç¨‹å®ç°ï¼Œå®ƒä½¿å¾—å¹¶å‘ç¼–ç¨‹å˜å¾—éå¸¸å®¹æ˜“ã€‚ç„¶è€Œï¼Œåœ¨å®é™…åº”ç”¨ä¸­ï¼Œæˆ‘ä»¬å¸¸å¸¸éœ€è¦å¯¹è¿™äº› Goroutine è¿›è¡Œç®¡ç†ï¼Œä¾‹å¦‚å¯åŠ¨å’Œåœæ­¢å®ƒä»¬ã€‚æœ¬æ–‡å°†è¯¦ç»†ä»‹ç»å¦‚ä½•é€šè¿‡ API æ¥å¯åŠ¨å’Œåœæ­¢ Goroutineï¼ŒåŒæ—¶ä¼šå¯¹æä¾›çš„ç¤ºä¾‹ä»£ç è¿›è¡Œæ·±å…¥åˆ†æã€‚</em></p>
<h2 id="ä»£ç åŠŸèƒ½æ¦‚è¿°"><a href="#ä»£ç åŠŸèƒ½æ¦‚è¿°" class="headerlink" title="ä»£ç åŠŸèƒ½æ¦‚è¿°"></a>ä»£ç åŠŸèƒ½æ¦‚è¿°</h2><p>æˆ‘ä»¬çš„ç›®æ ‡æ˜¯åˆ›å»ºä¸€ä¸ªå¯ä»¥é€šè¿‡ HTTP API å¯åŠ¨å’Œåœæ­¢ç‰¹å®šä»»åŠ¡çš„æœåŠ¡ã€‚è¿™äº›ä»»åŠ¡ä»¥ Goroutine çš„å½¢å¼è¿è¡Œï¼Œå¹¶ä¸”ä¼šæŒ‰ç…§ä¸€å®šçš„æ—¶é—´é—´éš”æ‰§è¡Œç‰¹å®šçš„æ“ä½œã€‚å…·ä½“æ¥è¯´ï¼Œæˆ‘ä»¬æœ‰ä¸¤ä¸ªä»»åŠ¡ï¼š<code>SellerWellOrder</code> å’Œ <code>WpsTask</code>ï¼Œå®ƒä»¬ä¼šæ¯ 5 ç§’æ‰“å°ä¸€æ¡æ—¥å¿—ä¿¡æ¯ã€‚</p>
<h2 id="ä»£ç è¯¦ç»†åˆ†æ"><a href="#ä»£ç è¯¦ç»†åˆ†æ" class="headerlink" title="ä»£ç è¯¦ç»†åˆ†æ"></a>ä»£ç è¯¦ç»†åˆ†æ</h2><h3 id="æ•°æ®ç»“æ„å®šä¹‰"><a href="#æ•°æ®ç»“æ„å®šä¹‰" class="headerlink" title="æ•°æ®ç»“æ„å®šä¹‰"></a>æ•°æ®ç»“æ„å®šä¹‰</h3><figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">type</span> GoroutineInfo <span class="keyword">struct</span> &#123;</span><br><span class="line">    stopCh <span class="keyword">chan</span> <span class="keyword">struct</span>&#123;&#125;</span><br><span class="line">    wg     sync.WaitGroup</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> GoroutineManager <span class="keyword">struct</span> &#123;</span><br><span class="line">    goroutines <span class="keyword">map</span>[<span class="type">string</span>]*GoroutineInfo</span><br><span class="line">    mu         sync.Mutex</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li><code>GoroutineInfo</code> ç»“æ„ä½“ç”¨äºå­˜å‚¨æ¯ä¸ª Goroutine çš„åœæ­¢é€šé“ <code>stopCh</code> å’Œç­‰å¾…ç»„ <code>wg</code>ã€‚<code>stopCh</code> ç”¨äºå‘ Goroutine å‘é€åœæ­¢ä¿¡å·ï¼Œ<code>wg</code> ç”¨äºç­‰å¾… Goroutine æ‰§è¡Œå®Œæ¯•ã€‚</li>
<li><code>GoroutineManager</code> ç»“æ„ä½“ç”¨äºç®¡ç†æ‰€æœ‰çš„ Goroutineã€‚<code>goroutines</code> æ˜¯ä¸€ä¸ªæ˜ å°„ï¼Œé”®ä¸ºä»»åŠ¡ç±»å‹å­—ç¬¦ä¸²ï¼Œå€¼ä¸º <code>GoroutineInfo</code> æŒ‡é’ˆã€‚<code>mu</code> æ˜¯ä¸€ä¸ªäº’æ–¥é”ï¼Œç”¨äºä¿è¯å¯¹ <code>goroutines</code> çš„å¹¶å‘å®‰å…¨è®¿é—®ã€‚</li>
</ul>
<h3 id="åˆå§‹åŒ–-Goroutine-ç®¡ç†å™¨"><a href="#åˆå§‹åŒ–-Goroutine-ç®¡ç†å™¨" class="headerlink" title="åˆå§‹åŒ– Goroutine ç®¡ç†å™¨"></a>åˆå§‹åŒ– Goroutine ç®¡ç†å™¨</h3><figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">NewGoroutineManager</span><span class="params">()</span></span> *GoroutineManager &#123;</span><br><span class="line">    <span class="keyword">return</span> &amp;GoroutineManager&#123;</span><br><span class="line">        goroutines: <span class="built_in">make</span>(<span class="keyword">map</span>[<span class="type">string</span>]*GoroutineInfo),</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>NewGoroutineManager</code> å‡½æ•°ç”¨äºåˆ›å»ºä¸€ä¸ªæ–°çš„ <code>GoroutineManager</code> å®ä¾‹ï¼Œå¹¶åˆå§‹åŒ– <code>goroutines</code> æ˜ å°„ã€‚</p>
<h3 id="ä»»åŠ¡å‡½æ•°"><a href="#ä»»åŠ¡å‡½æ•°" class="headerlink" title="ä»»åŠ¡å‡½æ•°"></a>ä»»åŠ¡å‡½æ•°</h3><figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">SellWellTask</span><span class="params">(stopCh <span class="keyword">chan</span> <span class="keyword">struct</span>&#123;&#125;)</span></span> &#123;</span><br><span class="line">    ticker := time.NewTicker(<span class="number">5</span> * time.Second)</span><br><span class="line">    <span class="keyword">defer</span> ticker.Stop()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> &#123;</span><br><span class="line">        <span class="keyword">select</span> &#123;</span><br><span class="line">        <span class="keyword">case</span> &lt;-stopCh:</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        <span class="keyword">case</span> &lt;-ticker.C:</span><br><span class="line">            log.Println(<span class="string">&quot;SellerWellTask running...&quot;</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">WpsTaskS</span><span class="params">(stopCh <span class="keyword">chan</span> <span class="keyword">struct</span>&#123;&#125;)</span></span> &#123;</span><br><span class="line">    ticker := time.NewTicker(<span class="number">5</span> * time.Second)</span><br><span class="line">    <span class="keyword">defer</span> ticker.Stop()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> &#123;</span><br><span class="line">        <span class="keyword">select</span> &#123;</span><br><span class="line">        <span class="keyword">case</span> &lt;-stopCh:</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        <span class="keyword">case</span> &lt;-ticker.C:</span><br><span class="line">            log.Println(<span class="string">&quot;WpsTask running...&quot;</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li><code>SellWellTask</code> å’Œ <code>WpsTaskS</code> æ˜¯ä¸¤ä¸ªå…·ä½“çš„ä»»åŠ¡å‡½æ•°ï¼Œå®ƒä»¬ä¼šåœ¨ä¸€ä¸ªæ— é™å¾ªç¯ä¸­è¿è¡Œã€‚ä½¿ç”¨ <code>time.Ticker</code> æ¯ 5 ç§’è§¦å‘ä¸€æ¬¡æ“ä½œï¼Œæ‰“å°ç›¸åº”çš„æ—¥å¿—ä¿¡æ¯ã€‚å½“æ¥æ”¶åˆ° <code>stopCh</code> é€šé“çš„ä¿¡å·æ—¶ï¼Œå‡½æ•°ä¼šé€€å‡ºå¾ªç¯å¹¶è¿”å›ã€‚</li>
</ul>
<h3 id="å¯åŠ¨ä»»åŠ¡"><a href="#å¯åŠ¨ä»»åŠ¡" class="headerlink" title="å¯åŠ¨ä»»åŠ¡"></a>å¯åŠ¨ä»»åŠ¡</h3><figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(m *GoroutineManager)</span></span> StartTask(taskType <span class="type">string</span>) <span class="type">error</span> &#123;</span><br><span class="line">    m.mu.Lock()</span><br><span class="line">    <span class="keyword">defer</span> m.mu.Unlock()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> _, exists := m.goroutines[taskType]; exists &#123;</span><br><span class="line">        <span class="keyword">return</span> fmt.Errorf(<span class="string">&quot;task already running&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    info := &amp;GoroutineInfo&#123;</span><br><span class="line">        stopCh: <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="keyword">struct</span>&#123;&#125;),</span><br><span class="line">    &#125;</span><br><span class="line">    info.wg.Add(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">    m.goroutines[taskType] = info</span><br><span class="line"></span><br><span class="line">    <span class="keyword">go</span> <span class="function"><span class="keyword">func</span><span class="params">(info *GoroutineInfo)</span></span> &#123;</span><br><span class="line">        <span class="keyword">defer</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">            log.Printf(<span class="string">&quot;%s task stopped&quot;</span>, taskType)</span><br><span class="line">            info.wg.Done()</span><br><span class="line">        &#125;()</span><br><span class="line"></span><br><span class="line">        <span class="keyword">switch</span> taskType &#123;</span><br><span class="line">        <span class="keyword">case</span> SellerWellOrder:</span><br><span class="line">            SellWellTask(info.stopCh)</span><br><span class="line">        <span class="keyword">case</span> WpsTask:</span><br><span class="line">            WpsTaskS(info.stopCh)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;(info)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li><code>StartTask</code> æ–¹æ³•ç”¨äºå¯åŠ¨ä¸€ä¸ªæ–°çš„ä»»åŠ¡ã€‚é¦–å…ˆï¼Œå®ƒä¼šåŠ é”ä»¥ä¿è¯å¹¶å‘å®‰å…¨ã€‚ç„¶åæ£€æŸ¥è¯¥ä»»åŠ¡æ˜¯å¦å·²ç»åœ¨è¿è¡Œï¼Œå¦‚æœæ˜¯åˆ™è¿”å›é”™è¯¯ã€‚æ¥ç€åˆ›å»ºä¸€ä¸ªæ–°çš„ <code>GoroutineInfo</code> å®ä¾‹ï¼Œå¹¶å°†å…¶æ·»åŠ åˆ° <code>goroutines</code> æ˜ å°„ä¸­ã€‚æœ€åï¼Œå¯åŠ¨ä¸€ä¸ªæ–°çš„ Goroutine æ¥æ‰§è¡Œç›¸åº”çš„ä»»åŠ¡ã€‚</li>
</ul>
<h3 id="åœæ­¢ä»»åŠ¡"><a href="#åœæ­¢ä»»åŠ¡" class="headerlink" title="åœæ­¢ä»»åŠ¡"></a>åœæ­¢ä»»åŠ¡</h3><figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(m *GoroutineManager)</span></span> StopTask(taskType <span class="type">string</span>) <span class="type">bool</span> &#123;</span><br><span class="line">    m.mu.Lock()</span><br><span class="line">    info, exists := m.goroutines[taskType]</span><br><span class="line">    <span class="keyword">if</span> !exists &#123;</span><br><span class="line">        m.mu.Unlock()</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">delete</span>(m.goroutines, taskType)</span><br><span class="line">    m.mu.Unlock()</span><br><span class="line"></span><br><span class="line">    <span class="built_in">close</span>(info.stopCh)</span><br><span class="line">    info.wg.Wait()</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li><code>StopTask</code> æ–¹æ³•ç”¨äºåœæ­¢ä¸€ä¸ªæ­£åœ¨è¿è¡Œçš„ä»»åŠ¡ã€‚é¦–å…ˆï¼Œå®ƒä¼šåŠ é”å¹¶æ£€æŸ¥è¯¥ä»»åŠ¡æ˜¯å¦å­˜åœ¨ã€‚å¦‚æœå­˜åœ¨ï¼Œåˆ™ä» <code>goroutines</code> æ˜ å°„ä¸­åˆ é™¤è¯¥ä»»åŠ¡ï¼Œå¹¶è§£é”ã€‚ç„¶åå…³é—­ <code>stopCh</code> é€šé“ï¼Œå‘ Goroutine å‘é€åœæ­¢ä¿¡å·ï¼Œå¹¶ç­‰å¾… Goroutine æ‰§è¡Œå®Œæ¯•ã€‚</li>
</ul>
<h3 id="HTTP-API-å¤„ç†"><a href="#HTTP-API-å¤„ç†" class="headerlink" title="HTTP API å¤„ç†"></a>HTTP API å¤„ç†</h3><figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">TestGoroutineManager</span><span class="params">(t *testing.T)</span></span> &#123;</span><br><span class="line">    manager := NewGoroutineManager()</span><br><span class="line"></span><br><span class="line">    http.HandleFunc(<span class="string">&quot;/start&quot;</span>, authMiddleware(<span class="function"><span class="keyword">func</span><span class="params">(w http.ResponseWriter, r *http.Request)</span></span> &#123;</span><br><span class="line">        <span class="keyword">if</span> r.Method != http.MethodPost &#123;</span><br><span class="line">            http.Error(w, <span class="string">&quot;Method not allowed&quot;</span>, http.StatusMethodNotAllowed)</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">var</span> req <span class="keyword">struct</span> &#123;</span><br><span class="line">            TaskType <span class="type">string</span> <span class="string">`json:&quot;task_type&quot;`</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> err := json.NewDecoder(r.Body).Decode(&amp;req); err != <span class="literal">nil</span> &#123;</span><br><span class="line">            http.Error(w, <span class="string">&quot;Invalid request body&quot;</span>, http.StatusBadRequest)</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        err := manager.StartTask(req.TaskType)</span><br><span class="line">        <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">            http.Error(w, err.Error(), http.StatusBadRequest)</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        json.NewEncoder(w).Encode(<span class="keyword">map</span>[<span class="type">string</span>]<span class="type">string</span>&#123;<span class="string">&quot;status&quot;</span>: <span class="string">&quot;started&quot;</span>, <span class="string">&quot;task_type&quot;</span>: req.TaskType&#125;)</span><br><span class="line">    &#125;))</span><br><span class="line"></span><br><span class="line">    http.HandleFunc(<span class="string">&quot;/stop&quot;</span>, authMiddleware(<span class="function"><span class="keyword">func</span><span class="params">(w http.ResponseWriter, r *http.Request)</span></span> &#123;</span><br><span class="line">        <span class="keyword">if</span> r.Method != http.MethodPost &#123;</span><br><span class="line">            http.Error(w, <span class="string">&quot;Method not allowed&quot;</span>, http.StatusMethodNotAllowed)</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">var</span> req <span class="keyword">struct</span> &#123;</span><br><span class="line">            TaskType <span class="type">string</span> <span class="string">`json:&quot;task_type&quot;`</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> err := json.NewDecoder(r.Body).Decode(&amp;req); err != <span class="literal">nil</span> &#123;</span><br><span class="line">            http.Error(w, <span class="string">&quot;Invalid request body&quot;</span>, http.StatusBadRequest)</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        stopped := manager.StopTask(req.TaskType)</span><br><span class="line">        <span class="keyword">if</span> !stopped &#123;</span><br><span class="line">            http.Error(w, <span class="string">&quot;Task not found&quot;</span>, http.StatusNotFound)</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        json.NewEncoder(w).Encode(<span class="keyword">map</span>[<span class="type">string</span>]<span class="type">string</span>&#123;<span class="string">&quot;status&quot;</span>: <span class="string">&quot;stopped&quot;</span>&#125;)</span><br><span class="line">    &#125;))</span><br><span class="line"></span><br><span class="line">    log.Println(<span class="string">&quot;Server starting on :8080&quot;</span>)</span><br><span class="line">    log.Fatal(http.ListenAndServe(<span class="string">&quot;:8080&quot;</span>, <span class="literal">nil</span>))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li><code>/start</code> ç«¯ç‚¹ç”¨äºå¯åŠ¨ä¸€ä¸ªä»»åŠ¡ã€‚å®ƒæ¥æ”¶ä¸€ä¸ª JSON æ ¼å¼çš„è¯·æ±‚ä½“ï¼ŒåŒ…å« <code>task_type</code> å­—æ®µã€‚å¦‚æœè¯·æ±‚æ–¹æ³•ä¸æ˜¯ POST æˆ–è€…è¯·æ±‚ä½“è§£æå¤±è´¥ï¼Œä¼šè¿”å›ç›¸åº”çš„é”™è¯¯ä¿¡æ¯ã€‚å¦‚æœä»»åŠ¡å¯åŠ¨æˆåŠŸï¼Œä¼šè¿”å›ä¸€ä¸ª JSON å“åº”ï¼ŒåŒ…å«ä»»åŠ¡çŠ¶æ€å’Œä»»åŠ¡ç±»å‹ã€‚</li>
<li><code>/stop</code> ç«¯ç‚¹ç”¨äºåœæ­¢ä¸€ä¸ªä»»åŠ¡ã€‚åŒæ ·æ¥æ”¶ä¸€ä¸ª JSON æ ¼å¼çš„è¯·æ±‚ä½“ï¼ŒåŒ…å« <code>task_type</code> å­—æ®µã€‚å¦‚æœä»»åŠ¡ä¸å­˜åœ¨ï¼Œä¼šè¿”å› <code>Task not found</code> é”™è¯¯ä¿¡æ¯ã€‚å¦‚æœä»»åŠ¡åœæ­¢æˆåŠŸï¼Œä¼šè¿”å›ä¸€ä¸ª JSON å“åº”ï¼ŒåŒ…å«ä»»åŠ¡çŠ¶æ€ã€‚</li>
</ul>
<h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>é€šè¿‡ä¸Šè¿°ä»£ç ï¼Œæˆ‘ä»¬å®ç°äº†ä¸€ä¸ªå¯ä»¥é€šè¿‡ HTTP API å¯åŠ¨å’Œåœæ­¢ Goroutine çš„æœåŠ¡ã€‚æ ¸å¿ƒè¦ç‚¹åŒ…æ‹¬ä½¿ç”¨é€šé“æ¥æ§åˆ¶ Goroutine çš„ç”Ÿå‘½å‘¨æœŸï¼Œä½¿ç”¨äº’æ–¥é”æ¥ä¿è¯å¹¶å‘å®‰å…¨ï¼Œä»¥åŠä½¿ç”¨ HTTP æœåŠ¡å™¨æ¥å¤„ç† API è¯·æ±‚ã€‚è¿™ç§æ–¹æ³•ä½¿å¾—æˆ‘ä»¬å¯ä»¥æ–¹ä¾¿åœ°ç®¡ç†å¤šä¸ªå¹¶å‘ä»»åŠ¡ï¼Œæé«˜äº†ç³»ç»Ÿçš„å¯ç»´æŠ¤æ€§å’Œçµæ´»æ€§ã€‚</p>
]]></content>
      <categories>
        <category>web</category>
      </categories>
      <tags>
        <tag>Golang</tag>
      </tags>
  </entry>
  <entry>
    <title>mybatiså’ŒhibernateåŒºåˆ«</title>
    <url>/2025/03/28/web/mybatis%E5%92%8Chibernate%E5%8C%BA%E5%88%AB/</url>
    <content><![CDATA[<p>MyBatiså’ŒHibernateæ˜¯Javaå¼€å‘ä¸­å¸¸ç”¨çš„ä¸¤ç§æŒä¹…åŒ–æ¡†æ¶ï¼Œå®ƒä»¬å„æœ‰ç‰¹ç‚¹ï¼Œä¸‹é¢ä¸ºä½ è¯¦ç»†ä»‹ç»ä¸¤è€…çš„åŒºåˆ«ï¼š</p>
<h3 id="1-å¼€å‘ç†å¿µ"><a href="#1-å¼€å‘ç†å¿µ" class="headerlink" title="1. å¼€å‘ç†å¿µ"></a>1. å¼€å‘ç†å¿µ</h3><ul>
<li><strong>MyBatis</strong>ï¼šå®ƒæ˜¯åŠè‡ªåŠ¨åŒ–çš„ORMï¼ˆå¯¹è±¡å…³ç³»æ˜ å°„ï¼‰æ¡†æ¶ã€‚å®ƒéœ€è¦å¼€å‘è€…æ‰‹åŠ¨ç¼–å†™SQLè¯­å¥ï¼Œè¿™æ ·å¯ä»¥å¯¹SQLè¿›è¡Œç²¾ç»†çš„æ§åˆ¶ï¼Œåœ¨å¤„ç†å¤æ‚çš„ä¸šåŠ¡é€»è¾‘å’ŒæŸ¥è¯¢æ—¶æ›´åŠ çµæ´»ã€‚</li>
<li><strong>Hibernate</strong>ï¼šå±äºå…¨è‡ªåŠ¨åŒ–çš„ORMæ¡†æ¶ã€‚å®ƒé€šè¿‡æ˜ å°„é…ç½®æ–‡ä»¶æˆ–è€…æ³¨è§£ï¼Œè®©å¼€å‘è€…æ— éœ€ç¼–å†™SQLè¯­å¥ï¼ŒHibernateä¼šæ ¹æ®å¯¹è±¡çš„æ“ä½œè‡ªåŠ¨ç”Ÿæˆç›¸åº”çš„SQLï¼Œèƒ½æé«˜å¼€å‘æ•ˆç‡ã€‚</li>
</ul>
<h3 id="2-SQLæ§åˆ¶"><a href="#2-SQLæ§åˆ¶" class="headerlink" title="2. SQLæ§åˆ¶"></a>2. SQLæ§åˆ¶</h3><ul>
<li><strong>MyBatis</strong>ï¼šå¼€å‘è€…ç›´æ¥ç¼–å†™SQLè¯­å¥ï¼Œèƒ½æ ¹æ®ä¸åŒçš„ä¸šåŠ¡éœ€æ±‚ç¼–å†™æœ€ä¼˜åŒ–çš„SQLï¼Œå¯¹æ•°æ®åº“çš„æ“ä½œç»†èŠ‚æœ‰å®Œå…¨çš„æ§åˆ¶æƒã€‚æ¯”å¦‚åœ¨å¤„ç†å¤æ‚çš„å¤šè¡¨å…³è”æŸ¥è¯¢æ—¶ï¼Œå¯ä»¥çµæ´»åœ°ç¼–å†™SQLè¯­å¥ã€‚<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">&lt;select id=<span class="string">&quot;getUserList&quot;</span> resultType=<span class="string">&quot;User&quot;</span>&gt;</span><br><span class="line">    SELECT * FROM users WHERE age &gt; #&#123;age&#125;</span><br><span class="line">&lt;/select&gt;</span><br></pre></td></tr></table></figure></li>
<li><strong>Hibernate</strong>ï¼šç”±æ¡†æ¶è‡ªåŠ¨ç”ŸæˆSQLï¼Œå¼€å‘è€…å¯¹SQLçš„æ§åˆ¶ç›¸å¯¹è¾ƒå°‘ã€‚è™½ç„¶Hibernateä¹Ÿæä¾›äº†ä¸€äº›è‡ªå®šä¹‰SQLçš„æ–¹å¼ï¼Œä½†åœ¨å¤æ‚ä¸šåŠ¡åœºæ™¯ä¸‹ï¼Œå¯èƒ½æ— æ³•åƒMyBatisé‚£æ ·çµæ´»åœ°æ§åˆ¶SQLã€‚</li>
</ul>
<h3 id="3-å­¦ä¹ æˆæœ¬"><a href="#3-å­¦ä¹ æˆæœ¬" class="headerlink" title="3. å­¦ä¹ æˆæœ¬"></a>3. å­¦ä¹ æˆæœ¬</h3><ul>
<li><strong>MyBatis</strong>ï¼šç”±äºéœ€è¦æ‰‹åŠ¨ç¼–å†™SQLï¼Œå¼€å‘è€…éœ€è¦å¯¹æ•°æ®åº“å’ŒSQLæœ‰è¾ƒå¥½çš„æŒæ¡ï¼Œå­¦ä¹ æˆæœ¬ä¸»è¦é›†ä¸­åœ¨SQLç¼–å†™å’ŒMyBatisçš„é…ç½®ä¸Šã€‚</li>
<li><strong>Hibernate</strong>ï¼šéœ€è¦ç†è§£å¯¹è±¡å…³ç³»æ˜ å°„çš„æ¦‚å¿µå’ŒHibernateçš„å„ç§ç‰¹æ€§ï¼Œå¦‚ç¼“å­˜æœºåˆ¶ã€äº‹åŠ¡ç®¡ç†ç­‰ï¼Œå­¦ä¹ æ›²çº¿ç›¸å¯¹è¾ƒé™¡ã€‚</li>
</ul>
<h3 id="4-æ€§èƒ½"><a href="#4-æ€§èƒ½" class="headerlink" title="4. æ€§èƒ½"></a>4. æ€§èƒ½</h3><ul>
<li><strong>MyBatis</strong>ï¼šå› ä¸ºå¼€å‘è€…å¯ä»¥æ‰‹åŠ¨ä¼˜åŒ–SQLï¼Œåœ¨å¤„ç†å¤æ‚æŸ¥è¯¢å’Œå¤§æ•°æ®é‡æ“ä½œæ—¶ï¼Œæ€§èƒ½å¯èƒ½ä¼šæ›´å¥½ã€‚</li>
<li><strong>Hibernate</strong>ï¼šè‡ªåŠ¨ç”Ÿæˆçš„SQLå¯èƒ½ä¸æ˜¯æœ€ä¼˜çš„ï¼Œåœ¨å¤„ç†å¤æ‚æŸ¥è¯¢æ—¶æ€§èƒ½å¯èƒ½ä¸å¦‚MyBatisã€‚ä¸è¿‡ï¼ŒHibernateæœ‰å®Œå–„çš„ç¼“å­˜æœºåˆ¶ï¼Œåœ¨ä¸€å®šç¨‹åº¦ä¸Šå¯ä»¥æé«˜æ€§èƒ½ã€‚</li>
</ul>
<h3 id="5-ç»´æŠ¤æ€§"><a href="#5-ç»´æŠ¤æ€§" class="headerlink" title="5. ç»´æŠ¤æ€§"></a>5. ç»´æŠ¤æ€§</h3><ul>
<li><strong>MyBatis</strong>ï¼šç”±äºSQLè¯­å¥åˆ†æ•£åœ¨å„ä¸ªXMLæ–‡ä»¶æˆ–æ³¨è§£ä¸­ï¼Œå½“ä¸šåŠ¡é€»è¾‘å‘ç”Ÿå˜åŒ–æ—¶ï¼Œéœ€è¦ä¿®æ”¹å¯¹åº”çš„SQLè¯­å¥ï¼Œç»´æŠ¤èµ·æ¥ç›¸å¯¹å¤æ‚ã€‚</li>
<li><strong>Hibernate</strong>ï¼šç”±äºè‡ªåŠ¨ç”ŸæˆSQLï¼Œå½“ä¸šåŠ¡é€»è¾‘å‘ç”Ÿå˜åŒ–æ—¶ï¼Œåªéœ€è¦ä¿®æ”¹å¯¹è±¡çš„æ˜ å°„å…³ç³»ï¼Œç»´æŠ¤ç›¸å¯¹ç®€å•ã€‚</li>
</ul>
<h3 id="6-é€‚ç”¨åœºæ™¯"><a href="#6-é€‚ç”¨åœºæ™¯" class="headerlink" title="6. é€‚ç”¨åœºæ™¯"></a>6. é€‚ç”¨åœºæ™¯</h3><ul>
<li><strong>MyBatis</strong>ï¼šé€‚ç”¨äºå¯¹SQLæ€§èƒ½è¦æ±‚è¾ƒé«˜ã€ä¸šåŠ¡é€»è¾‘å¤æ‚ã€éœ€è¦å¯¹æ•°æ®åº“è¿›è¡Œç²¾ç»†æ§åˆ¶çš„åœºæ™¯ï¼Œå¦‚ç”µå•†ç³»ç»Ÿã€é‡‘èç³»ç»Ÿç­‰ã€‚</li>
<li><strong>Hibernate</strong>ï¼šé€‚ç”¨äºä¸šåŠ¡é€»è¾‘ç›¸å¯¹ç®€å•ã€å¼€å‘æ•ˆç‡è¦æ±‚è¾ƒé«˜çš„åœºæ™¯ï¼Œå¦‚å°å‹çš„ä¼ä¸šç®¡ç†ç³»ç»Ÿã€ä¿¡æ¯ç³»ç»Ÿç­‰ã€‚</li>
</ul>
]]></content>
      <categories>
        <category>web</category>
      </categories>
      <tags>
        <tag>springboot</tag>
      </tags>
  </entry>
  <entry>
    <title>springbootè°ƒç”¨ä¸ƒç‰›äº‘ä¸Šä¼ åŠŸèƒ½ä»£ç å®ç°</title>
    <url>/2023/03/25/web/springboot%E8%B0%83%E7%94%A8%E4%B8%83%E7%89%9B%E4%BA%91%E4%B8%8A%E4%BC%A0%E5%8A%9F%E8%83%BD%E4%BB%A3%E7%A0%81%E5%AE%9E%E7%8E%B0/</url>
    <content><![CDATA[<h3 id="springbootè°ƒç”¨ä¸ƒç‰›äº‘ä¸Šä¼ åŠŸèƒ½ä»£ç å®ç°"><a href="#springbootè°ƒç”¨ä¸ƒç‰›äº‘ä¸Šä¼ åŠŸèƒ½ä»£ç å®ç°" class="headerlink" title="springbootè°ƒç”¨ä¸ƒç‰›äº‘ä¸Šä¼ åŠŸèƒ½ä»£ç å®ç°"></a>springbootè°ƒç”¨ä¸ƒç‰›äº‘ä¸Šä¼ åŠŸèƒ½ä»£ç å®ç°</h3><h2 id="å¼•å…¥ä¾èµ–"><a href="#å¼•å…¥ä¾èµ–" class="headerlink" title="å¼•å…¥ä¾èµ–"></a>å¼•å…¥ä¾èµ–</h2><ul>
<li>mavenå¼•å…¥<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line">	&lt;groupId&gt;com.qiniu&lt;/groupId&gt;</span><br><span class="line">	&lt;artifactId&gt;qiniu-java-sdk&lt;/artifactId&gt;</span><br><span class="line">	&lt;version&gt;<span class="number">7.2</span><span class="number">.7</span>&lt;/version&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure></li>
<li>åœ¨application.ymlæ–‡ä»¶ä¸­é…ç½®<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">oss:</span><br><span class="line">  qiniu:</span><br><span class="line">    domain: http://rwg3rc3zm.hd-bkt.clouddn.com</span><br><span class="line">    accessKey: ****************</span><br><span class="line">    secretKey: **************</span><br><span class="line">    bucketName: tongyouyun</span><br></pre></td></tr></table></figure></li>
<li>æ–°å»ºé…ç½®ç±»<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Value;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ColudConfig</span> &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ä¸ƒç‰›åŸŸådomain</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;oss.qiniu.domain&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String qiniuDomain;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ä¸ƒç‰›ACCESS_KEY</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;oss.qiniu.accessKey&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String qiniuAccessKey;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ä¸ƒç‰›SECRET_KEY</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;oss.qiniu.secretKey&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String qiniuSecretKey;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ä¸ƒç‰›ç©ºé—´å</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;oss.qiniu.bucketName&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String qiniuBucketName;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
ä¸Šé¢æˆ‘ä»¬å°†ä¸Šä¼ æ–‡ä»¶çš„é…ç½®å°è£…èµ·æ¥ã€‚</li>
<li>æ–°å»ºæŠ½è±¡ç±»<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> com.personapi.config.ColudConfig;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.FileInputStream;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">class</span> <span class="title class_">UploadImageService</span> &#123;</span><br><span class="line">    <span class="keyword">protected</span> ColudConfig config;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">abstract</span> String <span class="title function_">uploadQNImg</span><span class="params">(FileInputStream file, String path)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li>å®ç°æŠ½è±¡ç±»<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> com.google.gson.Gson;</span><br><span class="line"><span class="keyword">import</span> com.personapi.config.ColudConfig;</span><br><span class="line"><span class="keyword">import</span> com.qiniu.common.QiniuException;</span><br><span class="line"><span class="keyword">import</span> com.qiniu.common.Zone;</span><br><span class="line"><span class="keyword">import</span> com.qiniu.http.Response;</span><br><span class="line"><span class="keyword">import</span> com.qiniu.storage.Configuration;</span><br><span class="line"><span class="keyword">import</span> com.qiniu.storage.UploadManager;</span><br><span class="line"><span class="keyword">import</span> com.qiniu.storage.model.DefaultPutRet;</span><br><span class="line"><span class="keyword">import</span> com.qiniu.util.Auth;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Service;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.FileInputStream;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UploadImageServiceImpl</span> <span class="keyword">extends</span> <span class="title class_">UploadImageService</span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ä¸ƒç‰›æ–‡ä»¶ä¸Šä¼ ç®¡ç†å™¨</span></span><br><span class="line">    <span class="keyword">private</span> UploadManager uploadManager;</span><br><span class="line">    <span class="keyword">private</span> String token;</span><br><span class="line">    <span class="comment">// ä¸ƒç‰›è®¤è¯ç®¡ç†</span></span><br><span class="line">    <span class="keyword">private</span> Auth auth;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">UploadImageServiceImpl</span><span class="params">(ColudConfig config)</span>&#123;</span><br><span class="line">        <span class="built_in">this</span>.config = config;</span><br><span class="line">        init();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">init</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="comment">// æ„é€ ä¸€ä¸ªå¸¦æŒ‡å®šZoneå¯¹è±¡çš„é…ç½®ç±», æ³¨æ„è¿™é‡Œçš„Zone.zone0éœ€è¦æ ¹æ®ä¸»æœºé€‰æ‹©</span></span><br><span class="line">        uploadManager = <span class="keyword">new</span> <span class="title class_">UploadManager</span>(<span class="keyword">new</span> <span class="title class_">Configuration</span>(Zone.zone0()));</span><br><span class="line">        auth = Auth.create(config.getQiniuAccessKey(), config.getQiniuSecretKey());</span><br><span class="line">        <span class="comment">// æ ¹æ®å‘½åç©ºé—´ç”Ÿæˆçš„ä¸Šä¼ token</span></span><br><span class="line">        token = auth.uploadToken(config.getQiniuBucketName());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">uploadQNImg</span><span class="params">(FileInputStream file, String key)</span> &#123;</span><br><span class="line">        <span class="keyword">try</span>&#123;</span><br><span class="line">            <span class="comment">// ä¸Šä¼ å›¾ç‰‡æ–‡ä»¶</span></span><br><span class="line">            <span class="type">Response</span> <span class="variable">res</span> <span class="operator">=</span> uploadManager.put(file, key, token, <span class="literal">null</span>, <span class="literal">null</span>);</span><br><span class="line">            <span class="keyword">if</span> (!res.isOK()) &#123;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(<span class="string">&quot;ä¸Šä¼ ä¸ƒç‰›å‡ºé”™ï¼š&quot;</span> + res.toString());</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// è§£æä¸Šä¼ æˆåŠŸçš„ç»“æœ</span></span><br><span class="line">            <span class="type">DefaultPutRet</span> <span class="variable">putRet</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Gson</span>().fromJson(res.bodyString(), DefaultPutRet.class);</span><br><span class="line"></span><br><span class="line">            <span class="type">String</span> <span class="variable">path</span> <span class="operator">=</span> config.getQiniuDomain() + <span class="string">&quot;/&quot;</span> + putRet.key;</span><br><span class="line">            <span class="comment">// è¿™ä¸ªreturnPathæ˜¯è·å¾—åˆ°çš„å¤–é“¾åœ°å€,é€šè¿‡è¿™ä¸ªåœ°å€å¯ä»¥ç›´æ¥æ‰“å¼€å›¾ç‰‡</span></span><br><span class="line">            <span class="keyword">return</span> path;</span><br><span class="line">        &#125;<span class="keyword">catch</span> (QiniuException e)&#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
åœ¨utilåŒ…ä¸­æ–°å»ºå·¥å…·ç±»<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">getRandomImgName</span><span class="params">(String fileName)</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> <span class="variable">index</span> <span class="operator">=</span> fileName.lastIndexOf(<span class="string">&quot;.&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> ((fileName == <span class="literal">null</span> || fileName.isEmpty()) || index == -<span class="number">1</span>)&#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalArgumentException</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// è·å–æ–‡ä»¶åç¼€</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">suffix</span> <span class="operator">=</span> fileName.substring(index);</span><br><span class="line">    <span class="comment">// ç”ŸæˆUUID</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">uuid</span> <span class="operator">=</span> UUID.randomUUID().toString().replaceAll(<span class="string">&quot;-&quot;</span>, <span class="string">&quot;&quot;</span>);</span><br><span class="line">    <span class="comment">// ç”Ÿæˆä¸Šä¼ è‡³äº‘æœåŠ¡å™¨çš„è·¯å¾„</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">path</span> <span class="operator">=</span> <span class="string">&quot;code/test/&quot;</span> + DateUtil.today() + <span class="string">&quot;-&quot;</span> + uuid + suffix;</span><br><span class="line">    <span class="keyword">return</span> path;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li>è¿”å›ä¿å­˜è·¯å¾„</li>
<li>æ¥ä¸‹æ¥å°±æ˜¯åœ¨æ§åˆ¶ç±»ä¸­å°è£…æ¥å£äº†<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> com.personapi.Util.StringUtil;</span><br><span class="line"><span class="keyword">import</span> com.personapi.pojo.UploadImageService;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.http.HttpStatus;</span><br><span class="line"><span class="keyword">import</span> org.springframework.http.ResponseEntity;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.*;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.multipart.MultipartFile;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.FileInputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/api&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UploadController</span> &#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    UploadImageService uploadImageService;</span><br><span class="line">    <span class="meta">@PostMapping(&quot;/image&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> ResponseEntity&lt;String&gt; <span class="title function_">upLoadImage</span><span class="params">(<span class="meta">@RequestPart(&quot;file&quot;)</span> MultipartFile file)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// è·å–æ–‡ä»¶çš„åç§°</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">fileName</span> <span class="operator">=</span> file.getOriginalFilename();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// ä½¿ç”¨å·¥å…·ç±»æ ¹æ®ä¸Šä¼ æ–‡ä»¶ç”Ÿæˆå”¯ä¸€å›¾ç‰‡åç§°</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">imgName</span> <span class="operator">=</span> StringUtil.getRandomImgName(fileName);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (!file.isEmpty()) &#123;</span><br><span class="line"></span><br><span class="line">            <span class="type">FileInputStream</span> <span class="variable">inputStream</span> <span class="operator">=</span> (FileInputStream) file.getInputStream();</span><br><span class="line"></span><br><span class="line">            <span class="type">String</span> <span class="variable">path</span> <span class="operator">=</span> uploadImageService.uploadQNImg(inputStream, imgName);</span><br><span class="line">            System.out.print(<span class="string">&quot;ä¸ƒç‰›äº‘è¿”å›çš„å›¾ç‰‡é“¾æ¥:&quot;</span> + path);</span><br><span class="line">            <span class="keyword">return</span> ResponseEntity.ok(path);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> ResponseEntity.status(HttpStatus.BAD_REQUEST).body(<span class="string">&quot;error&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
ä¸ƒç‰›äº‘çš„ä¸Šä¼ åŠŸèƒ½å°±æ•´åˆå®Œæˆäº†</li>
</ul>
]]></content>
      <categories>
        <category>web</category>
      </categories>
      <tags>
        <tag>springboot</tag>
      </tags>
  </entry>
  <entry>
    <title>vueå¼•å…¥è¡¨æƒ…åŒ…</title>
    <url>/2024/08/28/web/vue%E5%BC%95%E5%85%A5%E8%A1%A8%E6%83%85%E5%8C%85/</url>
    <content><![CDATA[<h3 id="å¼•å…¥emoji-mart-vue-fastè¡¨æƒ…åŒ…"><a href="#å¼•å…¥emoji-mart-vue-fastè¡¨æƒ…åŒ…" class="headerlink" title="å¼•å…¥emoji-mart-vue-fastè¡¨æƒ…åŒ…"></a>å¼•å…¥emoji-mart-vue-fastè¡¨æƒ…åŒ…</h3><ul>
<li>è¡¨æƒ…åŒ…åœ¨æˆ‘ä»¬çš„ç”Ÿæ´»ä¸­å¿…ä¸å¯å°‘ï¼Œé‚£æˆ‘æˆ‘ä»¬å¦‚ä½•ä½¿ç”¨vueå¼•å…¥è¡¨æƒ…åŒ…</li>
<li>è¿™é‡Œæˆ‘ä½¿ç”¨çš„æ˜¯emoji-mart-vue-fast <a class="link"   href="https://github.com/serebrov/emoji-mart-vue" >githubåœ°å€<i class="fas fa-external-link-alt"></i></a></li>
<li>npmä¸‹è½½emoji-mart-vue-fast<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">npm install emoji-mart-vue-fast</span><br></pre></td></tr></table></figure>
ä¸‹è½½å®Œæˆåç›´æ¥å¼•å…¥ï¼Œå®Œæ•´ä»£ç <figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">Picker</span> <span class="attr">:data</span>=<span class="string">&quot;emojiIndex&quot;</span> <span class="attr">set</span>=<span class="string">&quot;twitter&quot;</span> @<span class="attr">select</span>=<span class="string">&quot;showEmoji&quot;</span>  <span class="attr">class</span>=<span class="string">&quot;picker&quot;</span>/&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">&quot;span&quot;</span>&gt;</span>hello<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">textarea</span> <span class="attr">v-model</span>=<span class="string">&quot;helloData.content&quot;</span> <span class="attr">style</span>=<span class="string">&quot;float:right;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">textarea</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="keyword">import</span> &#123; reactive, ref &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span>;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="keyword">import</span> data <span class="keyword">from</span> <span class="string">&quot;emoji-mart-vue-fast/data/all.json&quot;</span>;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="comment">// Import default CSS</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="keyword">import</span> <span class="string">&quot;emoji-mart-vue-fast/css/emoji-mart.css&quot;</span>;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="keyword">import</span> &#123; <span class="title class_">Picker</span>, <span class="title class_">EmojiIndex</span> &#125; <span class="keyword">from</span> <span class="string">&quot;emoji-mart-vue-fast/src&quot;</span>;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  <span class="attr">name</span>: <span class="string">&quot;test&quot;</span>,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  <span class="title function_">setup</span>(<span class="params"></span>) &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="keyword">const</span> helloData = <span class="title function_">reactive</span>(&#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      <span class="attr">content</span>:<span class="string">&#x27;&#x27;</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    &#125;)</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="keyword">const</span> emojiIndex = <span class="keyword">new</span> <span class="title class_">EmojiIndex</span>(data);</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="keyword">const</span> emojisOutput = <span class="title function_">ref</span>(<span class="string">&#x27;&#x27;</span>);</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="keyword">const</span> <span class="title function_">showEmoji</span> = (<span class="params">emoji</span>) =&gt; &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      helloData.<span class="property">content</span> += emoji.<span class="property">native</span>;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="keyword">return</span> &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      emojiIndex,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      emojisOutput,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      showEmoji,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      helloData</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    &#125;;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  &#125;,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  <span class="attr">components</span>: &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="title class_">Picker</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">&#125;;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="language-css"></span></span></span><br><span class="line"><span class="language-css"><span class="language-xml"><span class="selector-class">.picker</span>&#123;</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml">  <span class="attribute">position</span>:relative;</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml">  <span class="attribute">z-index</span>: <span class="number">999</span>;</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml">  <span class="attribute">margin-top</span>:<span class="number">100px</span>;</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml">&#125;</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml"><span class="selector-class">.span</span>&#123;</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml">  <span class="attribute">position</span>:relative;</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml">  <span class="attribute">z-index</span>: <span class="number">1</span>;</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml">&#125;</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span></span><br></pre></td></tr></table></figure>
è¿™é‡Œæˆ‘æ˜¯ç”¨çš„æ˜¯vue3ï¼Œvue2å¼•å…¥æ–¹å¼æœ‰æ‰€ä¸åŒ<figure class="highlight js"><figcaption><span>&#123;2,4&#125;</span></figcaption><table><tr><td class="code"><pre><span class="line"><span class="comment">// Vue 2:</span></span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">Picker</span>, <span class="title class_">EmojiIndex</span> &#125; <span class="keyword">from</span> <span class="string">&quot;emoji-mart-vue-fast&quot;</span>;</span><br><span class="line"><span class="comment">// Vue 3, import components from `/src`:</span></span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">Picker</span>, <span class="title class_">EmojiIndex</span> &#125; <span class="keyword">from</span> <span class="string">&quot;emoji-mart-vue-fast/src&quot;</span>;</span><br></pre></td></tr></table></figure></li>
</ul>
]]></content>
      <categories>
        <category>web</category>
      </categories>
      <tags>
        <tag>vue</tag>
      </tags>
  </entry>
  <entry>
    <title>vueè¡¨æƒ…åŒ…</title>
    <url>/2024/01/26/web/vue%E8%A1%A8%E6%83%85%E5%8C%85/</url>
    <content><![CDATA[<h3 id="å¼•å…¥emoji-mart-vue-fastè¡¨æƒ…åŒ…"><a href="#å¼•å…¥emoji-mart-vue-fastè¡¨æƒ…åŒ…" class="headerlink" title="å¼•å…¥emoji-mart-vue-fastè¡¨æƒ…åŒ…"></a>å¼•å…¥emoji-mart-vue-fastè¡¨æƒ…åŒ…</h3><h4 id="è¡¨æƒ…åŒ…åœ¨æˆ‘ä»¬çš„ç”Ÿæ´»ä¸­å¿…ä¸å¯å°‘ï¼Œé‚£æˆ‘æˆ‘ä»¬å¦‚ä½•ä½¿ç”¨vueå¼•å…¥è¡¨æƒ…åŒ…"><a href="#è¡¨æƒ…åŒ…åœ¨æˆ‘ä»¬çš„ç”Ÿæ´»ä¸­å¿…ä¸å¯å°‘ï¼Œé‚£æˆ‘æˆ‘ä»¬å¦‚ä½•ä½¿ç”¨vueå¼•å…¥è¡¨æƒ…åŒ…" class="headerlink" title="è¡¨æƒ…åŒ…åœ¨æˆ‘ä»¬çš„ç”Ÿæ´»ä¸­å¿…ä¸å¯å°‘ï¼Œé‚£æˆ‘æˆ‘ä»¬å¦‚ä½•ä½¿ç”¨vueå¼•å…¥è¡¨æƒ…åŒ…"></a>è¡¨æƒ…åŒ…åœ¨æˆ‘ä»¬çš„ç”Ÿæ´»ä¸­å¿…ä¸å¯å°‘ï¼Œé‚£æˆ‘æˆ‘ä»¬å¦‚ä½•ä½¿ç”¨vueå¼•å…¥è¡¨æƒ…åŒ…</h4><p>è¿™é‡Œæˆ‘ä½¿ç”¨çš„æ˜¯emoji-mart-vue-fast<br><a class="link"   href="https://github.com/serebrov/emoji-mart-vue" >githubåœ°å€<i class="fas fa-external-link-alt"></i></a></p>
<ul>
<li>npmä¸‹è½½emoji-mart-vue-fast<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">npm install emoji-mart-vue-fast</span><br></pre></td></tr></table></figure>
ä¸‹è½½å®Œæˆåç›´æ¥å¼•å…¥ï¼Œå®Œæ•´ä»£ç <figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">Picker</span> <span class="attr">:data</span>=<span class="string">&quot;emojiIndex&quot;</span> <span class="attr">set</span>=<span class="string">&quot;twitter&quot;</span> @<span class="attr">select</span>=<span class="string">&quot;showEmoji&quot;</span>  <span class="attr">class</span>=<span class="string">&quot;picker&quot;</span>/&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">&quot;span&quot;</span>&gt;</span>hello<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">textarea</span> <span class="attr">v-model</span>=<span class="string">&quot;helloData.content&quot;</span> <span class="attr">style</span>=<span class="string">&quot;float:right;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">textarea</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="keyword">import</span> &#123; reactive, ref &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span>;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="keyword">import</span> data <span class="keyword">from</span> <span class="string">&quot;emoji-mart-vue-fast/data/all.json&quot;</span>;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="comment">// Import default CSS</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="keyword">import</span> <span class="string">&quot;emoji-mart-vue-fast/css/emoji-mart.css&quot;</span>;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="keyword">import</span> &#123; <span class="title class_">Picker</span>, <span class="title class_">EmojiIndex</span> &#125; <span class="keyword">from</span> <span class="string">&quot;emoji-mart-vue-fast/src&quot;</span>;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  <span class="attr">name</span>: <span class="string">&quot;test&quot;</span>,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  <span class="title function_">setup</span>(<span class="params"></span>) &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="keyword">const</span> helloData = <span class="title function_">reactive</span>(&#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      <span class="attr">content</span>:<span class="string">&#x27;&#x27;</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    &#125;)</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="keyword">const</span> emojiIndex = <span class="keyword">new</span> <span class="title class_">EmojiIndex</span>(data);</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="keyword">const</span> emojisOutput = <span class="title function_">ref</span>(<span class="string">&#x27;&#x27;</span>);</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="keyword">const</span> <span class="title function_">showEmoji</span> = (<span class="params">emoji</span>) =&gt; &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      helloData.<span class="property">content</span> += emoji.<span class="property">native</span>;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="keyword">return</span> &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      emojiIndex,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      emojisOutput,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      showEmoji,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      helloData</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    &#125;;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  &#125;,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  <span class="attr">components</span>: &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="title class_">Picker</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">&#125;;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="language-css"></span></span></span><br><span class="line"><span class="language-css"><span class="language-xml"><span class="selector-class">.picker</span>&#123;</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml">  <span class="attribute">position</span>:relative;</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml">  <span class="attribute">z-index</span>: <span class="number">999</span>;</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml">  <span class="attribute">margin-top</span>:<span class="number">100px</span>;</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml">&#125;</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml"><span class="selector-class">.span</span>&#123;</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml">  <span class="attribute">position</span>:relative;</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml">  <span class="attribute">z-index</span>: <span class="number">1</span>;</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml">&#125;</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span></span><br></pre></td></tr></table></figure>
è¿™é‡Œæˆ‘æ˜¯ç”¨çš„æ˜¯vue3ï¼Œvue2å¼•å…¥æ–¹å¼æœ‰æ‰€ä¸åŒ<figure class="highlight js"><figcaption><span>&#123;2,4&#125;</span></figcaption><table><tr><td class="code"><pre><span class="line"><span class="comment">// Vue 2:</span></span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">Picker</span>, <span class="title class_">EmojiIndex</span> &#125; <span class="keyword">from</span> <span class="string">&quot;emoji-mart-vue-fast&quot;</span>;</span><br><span class="line"><span class="comment">// Vue 3, import components from `/src`:</span></span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">Picker</span>, <span class="title class_">EmojiIndex</span> &#125; <span class="keyword">from</span> <span class="string">&quot;emoji-mart-vue-fast/src&quot;</span>;</span><br></pre></td></tr></table></figure></li>
</ul>
]]></content>
      <categories>
        <category>web</category>
      </categories>
      <tags>
        <tag>vue</tag>
      </tags>
  </entry>
  <entry>
    <title>ä½¿ç”¨el-image-vieweræŸ¥çœ‹å¤§å›¾</title>
    <url>/2024/01/25/web/%E4%BD%BF%E7%94%A8el-image-viewer%E6%9F%A5%E7%9C%8B%E5%A4%A7%E5%9B%BE/</url>
    <content><![CDATA[<h3 id="ä½¿ç”¨el-image-vieweræŸ¥çœ‹å¤§å›¾"><a href="#ä½¿ç”¨el-image-vieweræŸ¥çœ‹å¤§å›¾" class="headerlink" title="ä½¿ç”¨el-image-vieweræŸ¥çœ‹å¤§å›¾"></a>ä½¿ç”¨el-image-vieweræŸ¥çœ‹å¤§å›¾</h3><figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">el-image-viewer</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">      <span class="attr">v-if</span>=<span class="string">&quot;showImageViewer&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">      <span class="attr">:url-list</span>=<span class="string">&quot;imageList&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">      <span class="attr">:z-index</span>=<span class="string">&quot;9999&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">      <span class="attr">:initial-index</span>=<span class="string">&quot;selectedIndex&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">      @<span class="attr">close</span>=<span class="string">&quot;handleImageHide&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">    &gt;</span><span class="tag">&lt;/<span class="name">el-image-viewer</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">    <span class="comment">&lt;!-- ç‚¹å‡»å›¾ç‰‡ç¼©ç•¥å›¾æ—¶è§¦å‘æ˜¾ç¤ºå›¾ç‰‡ --&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">img</span> </span></span></span><br><span class="line"><span class="tag"><span class="language-xml">      <span class="attr">v-for</span>=<span class="string">&quot;(image, index) in imageList&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">      <span class="attr">:</span> <span class="attr">src</span>=<span class="string">&quot;image&quot;</span> </span></span></span><br><span class="line"><span class="tag"><span class="language-xml">      <span class="attr">:key</span>=<span class="string">&quot;index&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">      @<span class="attr">click</span>=<span class="string">&quot;handleImageClick(index)&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">      <span class="attr">style</span>=<span class="string">&quot;cursor: pointer&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">    &gt;</span></span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="keyword">import</span> &#123; defineComponent, ref &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="keyword">import</span> &#123; <span class="title class_">ElImageViewer</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;element-plus&#x27;</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title function_">defineComponent</span>(&#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  <span class="attr">name</span>: <span class="string">&#x27;text&#x27;</span>,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  <span class="attr">components</span>: &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="title class_">ElImageViewer</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  &#125;,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  <span class="title function_">setup</span>(<span class="params"></span>) &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="keyword">const</span> showImageViewer = <span class="title function_">ref</span>(<span class="literal">false</span>)</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="keyword">const</span> selectedIndex = <span class="title function_">ref</span>(<span class="number">0</span>)</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="keyword">const</span> imageList = <span class="title function_">ref</span>([</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      <span class="string">&#x27;https://bing.com/th?id=OHR.ItalyCinqueTerre_ZH-CN6495965228_1920x1080.jpg&amp;rf=LaDigue_1920x1080.jpg&amp;pid=hp&#x27;</span>,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      <span class="string">&#x27;https://img3.wallspic.com/previews/5/7/7/3/7/173775/173775-dong_tian-a_er_bei_si_shan-fa_guo-jia_na_da-luo_ye_song-x750.jpg&#x27;</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    ])</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="keyword">const</span> <span class="title function_">handleImageClick</span> = (<span class="params">index</span>) =&gt; &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      showImageViewer.<span class="property">value</span> = <span class="literal">true</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      <span class="variable language_">console</span>.<span class="title function_">log</span>(index)</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      selectedIndex.<span class="property">value</span> = index</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="keyword">const</span> <span class="title function_">handleImageHide</span> = (<span class="params"></span>) =&gt; &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      showImageViewer.<span class="property">value</span> = <span class="literal">false</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="keyword">return</span> &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      imageList,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      showImageViewer,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      selectedIndex,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      handleImageClick,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      handleImageHide</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">&#125;)</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br></pre></td></tr></table></figure>
<h3 id="è§£é‡Šä¸€ä¸‹el-image-viewerçš„å±æ€§"><a href="#è§£é‡Šä¸€ä¸‹el-image-viewerçš„å±æ€§" class="headerlink" title="è§£é‡Šä¸€ä¸‹el-image-viewerçš„å±æ€§"></a>è§£é‡Šä¸€ä¸‹el-image-viewerçš„å±æ€§</h3><figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&lt;el-image-viewer</span><br><span class="line">  v-<span class="keyword">if</span>=<span class="string">&quot;showImageViewer&quot;</span></span><br><span class="line">  :url-list=<span class="string">&quot;imageList&quot;</span></span><br><span class="line">  :z-index=<span class="string">&quot;9999&quot;</span></span><br><span class="line">  :initial-index=<span class="string">&quot;selectedIndex&quot;</span></span><br><span class="line">  @close=<span class="string">&quot;handleImageHide&quot;</span></span><br><span class="line">&gt;&lt;/el-image-viewer&gt;</span><br></pre></td></tr></table></figure>
<ul>
<li>showImageVieweræˆ‘ä»¬å®šä¹‰è¿™ä¸ªå‡½æ•°è®©å®ƒåˆå§‹åŒ–ä¸ºfalse</li>
<li>url-listä¹Ÿå°±æ˜¯ç»‘å®šå›¾ç‰‡çš„åˆ—è¡¨<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> imageList = <span class="title function_">ref</span>([</span><br><span class="line">  <span class="string">&#x27;https://bing.com/th?id=OHR.ItalyCinqueTerre_ZH-CN6495965228_1920x1080.jpg&amp;rf=LaDigue_1920x1080.jpg&amp;pid=hp&#x27;</span>,</span><br><span class="line">  <span class="string">&#x27;https://img3.wallspic.com/previews/5/7/7/3/7/173775/173775-dong_tian-a_er_bei_si_shan-fa_guo-jia_na_da-luo_ye_song-x750.jpg&#x27;</span></span><br><span class="line">])</span><br></pre></td></tr></table></figure>
å¯ä»¥çœ‹åˆ°æˆ‘åœ¨imageListä¸­ç»™äº†ä¸¤å¼ å›¾ç‰‡çš„url</li>
<li>initial-indexå±æ€§ï¼Œå½“æˆ‘ä»¬ç‚¹å‡»å›¾ç‰‡çš„æ—¶å€™å®ƒé»˜è®¤ä¼šä»imageListåˆ—è¡¨ä¸­çš„ç¬¬ä¸€å¼ å›¾ç‰‡è¿›è¡Œæ’­æ”¾ï¼Œè€Œæˆ‘ä»¬æƒ³è®©å®ƒä»ç‚¹å‡»çš„å›¾ç‰‡æ’­æ”¾ï¼Œå°†handleImageClick(index)ç»‘å®šåœ¨å›¾ç‰‡ä¸Šï¼Œæˆ‘ä»¬å°±å¯ä»¥è·å–å›¾ç‰‡çš„ç´¢å¼•äº†ã€‚</li>
</ul>
]]></content>
      <categories>
        <category>web</category>
      </categories>
      <tags>
        <tag>vue</tag>
      </tags>
  </entry>
  <entry>
    <title>åˆè¯†Golang-Gin</title>
    <url>/2023/08/12/web/%E5%88%9D%E8%AF%86Golang-Gin/</url>
    <content><![CDATA[<h3 id="goæ‹‰å–åŒ…å‘½ä»¤"><a href="#goæ‹‰å–åŒ…å‘½ä»¤" class="headerlink" title="goæ‹‰å–åŒ…å‘½ä»¤"></a>goæ‹‰å–åŒ…å‘½ä»¤</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">go get</span><br><span class="line">go get -u github.com/gin-gonic/gin  <span class="comment">#æ‹‰å–ginåŒ…</span></span><br></pre></td></tr></table></figure>
<h3 id="Ginæ¥å£"><a href="#Ginæ¥å£" class="headerlink" title="Ginæ¥å£"></a>Ginæ¥å£</h3><figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">&quot;encoding/json&quot;</span></span><br><span class="line">	<span class="string">&quot;github.com/gin-gonic/gin&quot;</span></span><br><span class="line">	<span class="string">&quot;log&quot;</span></span><br><span class="line">	<span class="string">&quot;net/http&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">// è‡ªå®šä¹‰Goä¸­é—´ä»¶ æ‹¦æˆªå™¨</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">myHandler</span><span class="params">()</span></span> gin.HandlerFunc &#123;</span><br><span class="line">	<span class="keyword">return</span> <span class="function"><span class="keyword">func</span><span class="params">(context *gin.Context)</span></span> &#123;</span><br><span class="line">		context.Set(<span class="string">&quot;usersession&quot;</span>, <span class="string">&quot;userid-1&quot;</span>)</span><br><span class="line">		context.Next() <span class="comment">//æ”¾è¡Œ</span></span><br><span class="line">		<span class="comment">//context.Abort() //é˜»æ­¢</span></span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	ginServer := gin.Default()</span><br><span class="line">	<span class="comment">//ginServer.Use(myHandler()) //æ³¨å†Œä¸­é—´ä»¶ä¹‹åå…¨å±€ä½¿ç”¨</span></span><br><span class="line">	ginServer.GET(<span class="string">&quot;/hello&quot;</span>, <span class="function"><span class="keyword">func</span><span class="params">(context *gin.Context)</span></span> &#123;</span><br><span class="line">		context.JSON(<span class="number">200</span>, gin.H&#123;<span class="string">&quot;msg&quot;</span>: <span class="string">&quot;hello,gin&quot;</span>&#125;)</span><br><span class="line">	&#125;)</span><br><span class="line"></span><br><span class="line">	<span class="comment">//åŠ è½½é™æ€é¡µé¢</span></span><br><span class="line">	ginServer.LoadHTMLGlob(<span class="string">&quot;../templates/*&quot;</span>)</span><br><span class="line"></span><br><span class="line">	ginServer.GET(<span class="string">&quot;/index&quot;</span>, <span class="function"><span class="keyword">func</span><span class="params">(context *gin.Context)</span></span> &#123;</span><br><span class="line">		context.HTML(http.StatusOK, <span class="string">&quot;index.html&quot;</span>, gin.H&#123;</span><br><span class="line">			<span class="string">&quot;msg&quot;</span>: <span class="string">&quot;This is go give message&quot;</span>,</span><br><span class="line">		&#125;)</span><br><span class="line">	&#125;)</span><br><span class="line"></span><br><span class="line">	<span class="comment">//æ¥å—å‰ç«¯ä¼ è¿‡æ¥çš„å‚æ•°</span></span><br><span class="line">	ginServer.GET(<span class="string">&quot;/user/Info&quot;</span>, myHandler(), <span class="function"><span class="keyword">func</span><span class="params">(context *gin.Context)</span></span> &#123;</span><br><span class="line"></span><br><span class="line">		<span class="comment">//å–å‡ºä¸­é—´ä»¶çš„å€¼</span></span><br><span class="line">		usersession := context.MustGet(<span class="string">&quot;usersession&quot;</span>).(<span class="type">string</span>)</span><br><span class="line">		log.Println(usersession)</span><br><span class="line"></span><br><span class="line">		userid := context.Query(<span class="string">&quot;userid&quot;</span>)</span><br><span class="line">		username := context.Query(<span class="string">&quot;username&quot;</span>)</span><br><span class="line">		context.JSON(http.StatusOK, gin.H&#123;</span><br><span class="line">			<span class="string">&quot;userid&quot;</span>:   userid,</span><br><span class="line">			<span class="string">&quot;username&quot;</span>: username,</span><br><span class="line">		&#125;)</span><br><span class="line">	&#125;)</span><br><span class="line"></span><br><span class="line">	<span class="comment">//æ¥å—å‚æ•°</span></span><br><span class="line">	ginServer.GET(<span class="string">&quot;/user/Info/:userid/:username&quot;</span>, <span class="function"><span class="keyword">func</span><span class="params">(context *gin.Context)</span></span> &#123;</span><br><span class="line">		userid := context.Param(<span class="string">&quot;userid&quot;</span>)</span><br><span class="line">		username := context.Param(<span class="string">&quot;username&quot;</span>)</span><br><span class="line">		context.JSON(http.StatusOK, gin.H&#123;</span><br><span class="line">			<span class="string">&quot;userid&quot;</span>:   userid,</span><br><span class="line">			<span class="string">&quot;username&quot;</span>: username,</span><br><span class="line">		&#125;)</span><br><span class="line">	&#125;)</span><br><span class="line"></span><br><span class="line">	<span class="comment">//jsonåºåˆ—åŒ–</span></span><br><span class="line">	ginServer.POST(<span class="string">&quot;/json&quot;</span>, <span class="function"><span class="keyword">func</span><span class="params">(context *gin.Context)</span></span> &#123;</span><br><span class="line">		data, _ := context.GetRawData()</span><br><span class="line">		<span class="keyword">var</span> m <span class="keyword">map</span>[<span class="type">string</span>]<span class="keyword">interface</span>&#123;&#125;</span><br><span class="line">		_ = json.Unmarshal(data, &amp;m)</span><br><span class="line">		context.JSON(http.StatusOK, m)</span><br><span class="line">	&#125;)</span><br><span class="line"></span><br><span class="line">	<span class="comment">//è¡¨å•ä¼ é€’</span></span><br><span class="line">	<span class="comment">//æ”¯æŒå‡½æ•°å¼ç¼–ç¨‹</span></span><br><span class="line">	ginServer.POST(<span class="string">&quot;/user/add&quot;</span>, <span class="function"><span class="keyword">func</span><span class="params">(context *gin.Context)</span></span> &#123;</span><br><span class="line">		username := context.PostForm(<span class="string">&quot;username&quot;</span>)</span><br><span class="line">		password := context.PostForm(<span class="string">&quot;password&quot;</span>)</span><br><span class="line">		context.JSON(http.StatusOK, gin.H&#123;</span><br><span class="line">			<span class="string">&quot;msg&quot;</span>:      <span class="string">&quot;ok&quot;</span>,</span><br><span class="line">			<span class="string">&quot;username&quot;</span>: username,</span><br><span class="line">			<span class="string">&quot;password&quot;</span>: password,</span><br><span class="line">		&#125;)</span><br><span class="line">	&#125;)</span><br><span class="line"></span><br><span class="line">	<span class="comment">//é‡å®šå‘</span></span><br><span class="line">	ginServer.GET(<span class="string">&quot;/test&quot;</span>, <span class="function"><span class="keyword">func</span><span class="params">(context *gin.Context)</span></span> &#123;</span><br><span class="line">		context.Redirect(http.StatusMovedPermanently, <span class="string">&quot;https://lllcnm.cn&quot;</span>)</span><br><span class="line">	&#125;)</span><br><span class="line"></span><br><span class="line">	<span class="comment">//è·¯ç”±ç»„</span></span><br><span class="line">	<span class="comment">//userGroup := ginServer.Group(&quot;/user&quot;)</span></span><br><span class="line">	<span class="comment">//&#123;</span></span><br><span class="line">	<span class="comment">//	userGroup.GET(&quot;/add&quot;)</span></span><br><span class="line">	<span class="comment">//	userGroup.GET(&quot;/login&quot;)</span></span><br><span class="line">	<span class="comment">//	userGroup.GET(&quot;/logout&quot;, func(context *gin.Context) &#123;</span></span><br><span class="line">	<span class="comment">//		//å¤„ç†è¯·æ±‚</span></span><br><span class="line">	<span class="comment">//	&#125;)</span></span><br><span class="line">	<span class="comment">//&#125;</span></span><br><span class="line">	<span class="comment">//æœåŠ¡å™¨ç«¯å£</span></span><br><span class="line">	ginServer.Run(<span class="string">&quot;:8082&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="å¼€å¯å¤šçº¿ç¨‹"><a href="#å¼€å¯å¤šçº¿ç¨‹" class="headerlink" title="å¼€å¯å¤šçº¿ç¨‹"></a>å¼€å¯å¤šçº¿ç¨‹</h3><figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">&quot;fmt&quot;</span></span><br><span class="line">	<span class="string">&quot;time&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">*</span></span><br><span class="line"><span class="comment">@author LJN</span></span><br><span class="line"><span class="comment">@dev å¤šçº¿ç¨‹</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="comment">//goçš„å¤šçº¿ç¨‹-åç¨‹</span></span><br><span class="line">	<span class="keyword">go</span> goRun()</span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="number">1000</span>; i++ &#123;</span><br><span class="line">		fmt.Println(<span class="string">&quot;main ========&gt;&quot;</span>, i)</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	time.Sleep(time.Second * <span class="number">3</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">goRun</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="number">1000</span>; i++ &#123;</span><br><span class="line">		fmt.Println(<span class="string">&quot;goRun ========&gt;&quot;</span>, i)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h3 id="Ginè¿æ¥æ•°æ®åº“"><a href="#Ginè¿æ¥æ•°æ®åº“" class="headerlink" title="Ginè¿æ¥æ•°æ®åº“"></a>Ginè¿æ¥æ•°æ®åº“</h3><ul>
<li>ä¸‹è½½mysqlé©±åŠ¨åŒ…<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">go get -u github.com/go-sql-driver/mysql</span><br></pre></td></tr></table></figure>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> dao</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">&quot;database/sql&quot;</span></span><br><span class="line">	<span class="string">&quot;fmt&quot;</span></span><br><span class="line">	_ <span class="string">&quot;github.com/go-sql-driver/mysql&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> (</span><br><span class="line">	username = <span class="string">&quot;root&quot;</span></span><br><span class="line">	password = <span class="string">&quot;fdsafdfa&quot;</span></span><br><span class="line">	host     = <span class="string">&quot;localhost&quot;</span></span><br><span class="line">	port     = <span class="number">3306</span></span><br><span class="line">	dbname   = <span class="string">&quot;test&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> User2 <span class="keyword">struct</span> &#123;</span><br><span class="line">	ID       <span class="type">int</span>    <span class="string">`json:&quot;id&quot;`</span></span><br><span class="line">	Name     <span class="type">string</span> <span class="string">`json:&quot;name&quot;`</span></span><br><span class="line">	Password <span class="type">string</span> <span class="string">`json:&quot;password&quot;`</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">ConnectToDb</span><span class="params">()</span></span> (*sql.DB, <span class="type">error</span>) &#123;</span><br><span class="line">	dataSourceName := fmt.Sprintf(<span class="string">&quot;%s:%s@tcp(%s:%d)/%s&quot;</span>, username, password, host, port, dbname)</span><br><span class="line">	db, err := sql.Open(<span class="string">&quot;mysql&quot;</span>, dataSourceName) <span class="comment">// æ‰“å¼€åä¸º MySQL çš„SQLæ•°æ®åº“</span></span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="literal">nil</span>, err</span><br><span class="line">	&#125;</span><br><span class="line">	err = db.Ping() <span class="comment">// æ£€æŸ¥è¿æ¥æ˜¯å¦å»ºç«‹ï¼Œä»¥ç¡®ä¿è¿æ¥å­˜æ´»</span></span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="literal">nil</span>, err</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> db, <span class="literal">nil</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<h3 id="Ginæ•°æ®åº“å¢åˆ æ”¹æŸ¥"><a href="#Ginæ•°æ®åº“å¢åˆ æ”¹æŸ¥" class="headerlink" title="Ginæ•°æ®åº“å¢åˆ æ”¹æŸ¥"></a>Ginæ•°æ®åº“å¢åˆ æ”¹æŸ¥</h3><h4 id="ä½¿ç”¨åŸç”Ÿsqlè¯­å¥è¿›è¡Œå¢åˆ æ”¹æŸ¥"><a href="#ä½¿ç”¨åŸç”Ÿsqlè¯­å¥è¿›è¡Œå¢åˆ æ”¹æŸ¥" class="headerlink" title="ä½¿ç”¨åŸç”Ÿsqlè¯­å¥è¿›è¡Œå¢åˆ æ”¹æŸ¥"></a>ä½¿ç”¨åŸç”Ÿsqlè¯­å¥è¿›è¡Œå¢åˆ æ”¹æŸ¥</h4><ol>
<li>åœ¨UserControllerä¸­ç¼–å†™å¢åˆ æ”¹æŸ¥æ–¹æ³•<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> controller</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">&quot;database/sql&quot;</span></span><br><span class="line">	<span class="string">&quot;github.com/gin-gonic/gin&quot;</span></span><br><span class="line">	<span class="string">&quot;log&quot;</span></span><br><span class="line">	<span class="string">&quot;main/dao&quot;</span></span><br><span class="line">	<span class="string">&quot;net/http&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> UserController <span class="keyword">struct</span> &#123;</span><br><span class="line">	BaseController</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">*</span></span><br><span class="line"><span class="comment">æŸ¥è¯¢å•ä¸ªç”¨æˆ·</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(this *UserController)</span></span> GetUser(ctx *gin.Context) &#123;</span><br><span class="line">	<span class="comment">// è·å–æ•°æ®åº“è¿æ¥</span></span><br><span class="line">	db, err := dao.ConnectToDb()</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		log.Println(<span class="string">&quot;Database connection error:&quot;</span>, err)</span><br><span class="line">		ctx.JSON(http.StatusInternalServerError, gin.H&#123;<span class="string">&quot;error&quot;</span>: <span class="string">&quot;Database error&quot;</span>&#125;)</span><br><span class="line">		<span class="keyword">return</span></span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">defer</span> db.Close()</span><br><span class="line"></span><br><span class="line">	<span class="keyword">var</span> (</span><br><span class="line">		user   dao.User2</span><br><span class="line">		result gin.H</span><br><span class="line">	)</span><br><span class="line">	id := ctx.Param(<span class="string">&quot;id&quot;</span>)</span><br><span class="line">	log.Println(<span class="string">&quot;è·å–åˆ°çš„id&quot;</span>, id)</span><br><span class="line"></span><br><span class="line">	<span class="comment">// æŸ¥è¯¢ç”¨æˆ·</span></span><br><span class="line">	row := db.QueryRow(<span class="string">&quot;SELECT * FROM user2 WHERE id = ?&quot;</span>, id)</span><br><span class="line">	err = row.Scan(&amp;user.ID, &amp;user.Name, &amp;user.Password)</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		<span class="keyword">if</span> err == sql.ErrNoRows &#123;</span><br><span class="line">			result = gin.H&#123;</span><br><span class="line">				<span class="string">&quot;message&quot;</span>: <span class="string">&quot;User not found&quot;</span>,</span><br><span class="line">			&#125;</span><br><span class="line">			ctx.JSON(http.StatusNotFound, result)</span><br><span class="line">		&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">			log.Println(<span class="string">&quot;Error retrieving user:&quot;</span>, err)</span><br><span class="line">			ctx.JSON(http.StatusInternalServerError, gin.H&#123;<span class="string">&quot;error&quot;</span>: <span class="string">&quot;Error retrieving user&quot;</span>&#125;)</span><br><span class="line">		&#125;</span><br><span class="line">	&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">		result = gin.H&#123;<span class="string">&quot;data&quot;</span>: user&#125;</span><br><span class="line">		ctx.JSON(http.StatusOK, result)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æŸ¥è¯¢æ‰€æœ‰ç”¨æˆ·</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(this *UserController)</span></span> GetAllUser(ctx *gin.Context) &#123;</span><br><span class="line">	db, err := dao.ConnectToDb()</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		log.Println(<span class="string">&quot;Database find error ....&quot;</span>, err)</span><br><span class="line">		ctx.JSON(http.StatusInternalServerError, gin.H&#123;<span class="string">&quot;error&quot;</span>: <span class="string">&quot;Database error&quot;</span>&#125;)</span><br><span class="line">		<span class="keyword">return</span></span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">defer</span> db.Close()</span><br><span class="line">	<span class="keyword">var</span> (</span><br><span class="line">		users  []dao.User2</span><br><span class="line">		result gin.H</span><br><span class="line">	)</span><br><span class="line">	rows, err := db.Query(<span class="string">&quot;SELECT * FROM user2&quot;</span>)</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		log.Println(<span class="string">&quot;Error retrieving users:&quot;</span>, err)</span><br><span class="line">		ctx.JSON(http.StatusInternalServerError, gin.H&#123;<span class="string">&quot;error&quot;</span>: <span class="string">&quot;Error retrieving users&quot;</span>&#125;)</span><br><span class="line">		<span class="keyword">return</span></span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">defer</span> rows.Close()</span><br><span class="line">	<span class="keyword">for</span> rows.Next() &#123;</span><br><span class="line">		<span class="keyword">var</span> user dao.User2</span><br><span class="line">		err := rows.Scan(&amp;user.ID, &amp;user.Name, &amp;user.Password)</span><br><span class="line">		<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">			log.Println(<span class="string">&quot;Error scanning user data:&quot;</span>, err)</span><br><span class="line">			<span class="keyword">continue</span></span><br><span class="line">		&#125;</span><br><span class="line">		users = <span class="built_in">append</span>(users, user)</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	result = gin.H&#123;<span class="string">&quot;data&quot;</span>: users&#125;</span><br><span class="line">	ctx.JSON(http.StatusOK, result)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ·»åŠ ç”¨æˆ·</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(this *UserController)</span></span> AddUser(ctx *gin.Context) &#123;</span><br><span class="line">	db, err := dao.ConnectToDb()</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		log.Println(<span class="string">&quot;database connect error&quot;</span>, err)</span><br><span class="line">		ctx.JSON(http.StatusInternalServerError, gin.H&#123;<span class="string">&quot;error&quot;</span>: <span class="string">&quot;Database error&quot;</span>&#125;)</span><br><span class="line">		<span class="keyword">return</span></span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">defer</span> db.Close()</span><br><span class="line"></span><br><span class="line">	<span class="keyword">var</span> newUser dao.User2</span><br><span class="line">	<span class="keyword">if</span> err := ctx.ShouldBindJSON(&amp;newUser); err != <span class="literal">nil</span> &#123;</span><br><span class="line">		ctx.JSON(http.StatusBadRequest, gin.H&#123;<span class="string">&quot;error&quot;</span>: err.Error()&#125;)</span><br><span class="line">		<span class="keyword">return</span></span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">// æ’å…¥ç”¨æˆ·åˆ°æ•°æ®åº“</span></span><br><span class="line">	_, err = db.Exec(<span class="string">&quot;INSERT INTO user2(name,password) VALUES (?,?)&quot;</span>, newUser.Name, newUser.Password)</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		log.Println(<span class="string">&quot;Error adding user:&quot;</span>, err)</span><br><span class="line">		ctx.JSON(http.StatusInternalServerError, gin.H&#123;<span class="string">&quot;error&quot;</span>: <span class="string">&quot;Error adding User&quot;</span>&#125;)</span><br><span class="line">		<span class="keyword">return</span></span><br><span class="line">	&#125;</span><br><span class="line">	ctx.JSON(http.StatusCreated, gin.H&#123;<span class="string">&quot;message&quot;</span>: <span class="string">&quot;User added successfully&quot;</span>&#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ›´æ–°ç”¨æˆ·</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(this *UserController)</span></span> UpdateUser(ctx *gin.Context) &#123;</span><br><span class="line">	db, err := dao.ConnectToDb()</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		log.Println(<span class="string">&quot;databse connection error&quot;</span>, err)</span><br><span class="line">		ctx.JSON(http.StatusInternalServerError, gin.H&#123;<span class="string">&quot;error&quot;</span>: <span class="string">&quot;Database error&quot;</span>&#125;)</span><br><span class="line">		<span class="keyword">return</span></span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">defer</span> db.Close()</span><br><span class="line"></span><br><span class="line">	id := ctx.Param(<span class="string">&quot;id&quot;</span>)</span><br><span class="line"></span><br><span class="line">	<span class="keyword">var</span> updateUser dao.User2</span><br><span class="line">	<span class="keyword">if</span> err := ctx.ShouldBindJSON(&amp;updateUser); err != <span class="literal">nil</span> &#123;</span><br><span class="line">		ctx.JSON(http.StatusBadRequest, gin.H&#123;<span class="string">&quot;error&quot;</span>: err.Error()&#125;)</span><br><span class="line">		<span class="keyword">return</span></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	_, err = db.Exec(<span class="string">&quot;UPDATE user2 SET name = ?,password = ? WHERE id = ?&quot;</span>,</span><br><span class="line">		updateUser.Name, updateUser.Password, id)</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		log.Println(<span class="string">&quot;Error adding user:&quot;</span>, err)</span><br><span class="line">		ctx.JSON(http.StatusInternalServerError, gin.H&#123;<span class="string">&quot;error&quot;</span>: <span class="string">&quot;Error adding User&quot;</span>&#125;)</span><br><span class="line">		<span class="keyword">return</span></span><br><span class="line">	&#125;</span><br><span class="line">	ctx.JSON(http.StatusCreated, gin.H&#123;<span class="string">&quot;message&quot;</span>: <span class="string">&quot;Update User is Succefully&quot;</span>&#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(this *UserController)</span></span> DeleteUser(ctx *gin.Context) &#123;</span><br><span class="line">	db, err := dao.ConnectToDb()</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		log.Println(<span class="string">&quot;databse connection error&quot;</span>, err)</span><br><span class="line">		ctx.JSON(http.StatusInternalServerError, gin.H&#123;<span class="string">&quot;error&quot;</span>: <span class="string">&quot;Database error&quot;</span>&#125;)</span><br><span class="line">		<span class="keyword">return</span></span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">defer</span> db.Close()</span><br><span class="line">	id := ctx.Param(<span class="string">&quot;id&quot;</span>)</span><br><span class="line"></span><br><span class="line">	_, err = db.Exec(<span class="string">&quot;DELETE FROM user2 WHERE id = ?&quot;</span>, id)</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		log.Println(<span class="string">&quot;Error adding user:&quot;</span>, err)</span><br><span class="line">		ctx.JSON(http.StatusInternalServerError, gin.H&#123;<span class="string">&quot;error&quot;</span>: <span class="string">&quot;Error adding User&quot;</span>&#125;)</span><br><span class="line">		<span class="keyword">return</span></span><br><span class="line">	&#125;</span><br><span class="line">	ctx.JSON(http.StatusOK, gin.H&#123;<span class="string">&quot;message&quot;</span>: <span class="string">&quot;Delete User is Succefully&quot;</span>&#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
2.åœ¨routerç›®å½•ä¸‹UserRouteræ–‡ä»¶ä¸­æ³¨å†Œè·¯ç”±<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> router</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">&quot;github.com/gin-gonic/gin&quot;</span></span><br><span class="line">	<span class="string">&quot;main/controller&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">UserRouterInit</span><span class="params">(r *gin.Engine)</span></span> &#123;</span><br><span class="line">	user := &amp;controller.UserController&#123;&#125;</span><br><span class="line">	userGroup := r.Group(<span class="string">&quot;/user&quot;</span>)</span><br><span class="line">	&#123;</span><br><span class="line">		userGroup.GET(<span class="string">&quot;/getUser/:id&quot;</span>, <span class="function"><span class="keyword">func</span><span class="params">(context *gin.Context)</span></span> &#123;</span><br><span class="line">			user.GetUser(context)</span><br><span class="line">		&#125;)</span><br><span class="line">		userGroup.GET(<span class="string">&quot;/getAllUser&quot;</span>, <span class="function"><span class="keyword">func</span><span class="params">(context *gin.Context)</span></span> &#123;</span><br><span class="line">			user.GetAllUser(context)</span><br><span class="line">		&#125;)</span><br><span class="line">		userGroup.POST(<span class="string">&quot;/addUser&quot;</span>, <span class="function"><span class="keyword">func</span><span class="params">(context *gin.Context)</span></span> &#123;</span><br><span class="line">			user.AddUser(context)</span><br><span class="line">		&#125;)</span><br><span class="line">		userGroup.POST(<span class="string">&quot;/updateUser/:id&quot;</span>, <span class="function"><span class="keyword">func</span><span class="params">(context *gin.Context)</span></span> &#123;</span><br><span class="line">			user.UpdateUser(context)</span><br><span class="line">		&#125;)</span><br><span class="line">		userGroup.DELETE(<span class="string">&quot;/deleteUser/:id&quot;</span>, <span class="function"><span class="keyword">func</span><span class="params">(context *gin.Context)</span></span> &#123;</span><br><span class="line">			user.DeleteUser(context)</span><br><span class="line">		&#125;)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
3.åœ¨main.goæ–‡ä»¶ä¸­å¼•å…¥æ³¨å†Œè·¯ç”±</li>
</ol>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">&quot;github.com/gin-gonic/gin&quot;</span></span><br><span class="line">	<span class="string">&quot;main/router&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	r := gin.Default()</span><br><span class="line">	router.StudyRouterInit(r)</span><br><span class="line">	router.UserRouterInit(r)</span><br><span class="line">	r.Run(<span class="string">&quot;:8082&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="ä¸Šé¢æ˜¯åŸç”Ÿsqlè¯­å¥æ‰§è¡Œå¢åˆ æ”¹æŸ¥çš„æ–¹æ³•-ä¸‹é¢æˆ‘ä»¬å°†ä»‹ç»gormå¢åˆ æ”¹æŸ¥"><a href="#ä¸Šé¢æ˜¯åŸç”Ÿsqlè¯­å¥æ‰§è¡Œå¢åˆ æ”¹æŸ¥çš„æ–¹æ³•-ä¸‹é¢æˆ‘ä»¬å°†ä»‹ç»gormå¢åˆ æ”¹æŸ¥" class="headerlink" title="ä¸Šé¢æ˜¯åŸç”Ÿsqlè¯­å¥æ‰§è¡Œå¢åˆ æ”¹æŸ¥çš„æ–¹æ³•,ä¸‹é¢æˆ‘ä»¬å°†ä»‹ç»gormå¢åˆ æ”¹æŸ¥"></a>ä¸Šé¢æ˜¯åŸç”Ÿsqlè¯­å¥æ‰§è¡Œå¢åˆ æ”¹æŸ¥çš„æ–¹æ³•,ä¸‹é¢æˆ‘ä»¬å°†ä»‹ç»gormå¢åˆ æ”¹æŸ¥</h4><h3 id="GORMå¢åˆ æ”¹æŸ¥"><a href="#GORMå¢åˆ æ”¹æŸ¥" class="headerlink" title="GORMå¢åˆ æ”¹æŸ¥"></a>GORMå¢åˆ æ”¹æŸ¥</h3><p><a class="link"   href="https://gorm.io/zh_CN/docs/create.html" >å®˜æ–¹æ–‡æ¡£<i class="fas fa-external-link-alt"></i></a><br><a class="link"   href="https://jasperxu.github.io/gorm-zh/" >æ•™å­¦æ–‡æ¡£<i class="fas fa-external-link-alt"></i></a></p>
<ul>
<li>å…ˆæ¥äº†è§£ä¸€ä¸‹orm<blockquote>
<p>ORMï¼ˆObject Relational Mappingï¼Œå¯¹è±¡å…³ç³»æ˜ å°„ï¼‰æ¡†æ¶æ˜¯ä¸€ç§å°†æ•°æ®åº“è¡¨ä¸å¯¹è±¡æ¨¡å‹ä¹‹é—´è¿›è¡Œæ˜ å°„çš„æŠ€æœ¯ã€‚å®ƒå…è®¸å¼€å‘è€…ä½¿ç”¨é¢å‘å¯¹è±¡çš„æ–¹å¼æ“ä½œæ•°æ®åº“ï¼Œè€Œæ— éœ€ç›´æ¥ç¼–å†™SQLè¯­å¥</p>
</blockquote>
</li>
<li>å¼•å…¥gormåŒ…<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">go get -u github.com/jinzhu/gorm</span><br></pre></td></tr></table></figure></li>
</ul>
<p>1.åœ¨UserGormControlleræ·»åŠ å¢åˆ æ”¹æŸ¥æ–¹æ³•</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> controller</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">&quot;github.com/gin-gonic/gin&quot;</span></span><br><span class="line">	<span class="string">&quot;log&quot;</span></span><br><span class="line">	<span class="string">&quot;main/dao&quot;</span></span><br><span class="line">	<span class="string">&quot;net/http&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> UserGormController <span class="keyword">struct</span> &#123;</span><br><span class="line">	BaseController</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">*</span></span><br><span class="line"><span class="comment">æŸ¥è¯¢å•ä¸ªç”¨æˆ·</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(ctrl *UserGormController)</span></span> SearchUser(ctx *gin.Context) &#123;</span><br><span class="line">	db, err := dao.ConnectDataBase()</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		log.Println(<span class="string">&quot;Database connection error:&quot;</span>, err)</span><br><span class="line">		ctx.JSON(http.StatusInternalServerError, gin.H&#123;<span class="string">&quot;error&quot;</span>: <span class="string">&quot;Database error&quot;</span>&#125;)</span><br><span class="line">		<span class="keyword">return</span></span><br><span class="line">	&#125;</span><br><span class="line">	userID := ctx.Param(<span class="string">&quot;id&quot;</span>)</span><br><span class="line">	<span class="keyword">var</span> user dao.User2</span><br><span class="line">	<span class="keyword">if</span> err := db.Where(<span class="string">&quot;id = ?&quot;</span>, userID).First(&amp;user).Error; err != <span class="literal">nil</span> &#123;</span><br><span class="line">		log.Println(<span class="string">&quot;User not found:&quot;</span>, err)</span><br><span class="line">		ctx.JSON(http.StatusNotFound, gin.H&#123;<span class="string">&quot;error&quot;</span>: <span class="string">&quot;User not found&quot;</span>&#125;)</span><br><span class="line">		<span class="keyword">return</span></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	ctx.JSON(http.StatusOK, user)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æŸ¥è¯¢æ‰€æœ‰ç”¨æˆ·</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(ctrl *UserGormController)</span></span> SearchAllUser(ctx *gin.Context) &#123;</span><br><span class="line">	db, err := dao.ConnectDataBase()</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		log.Println(<span class="string">&quot;Database connection error:&quot;</span>, err)</span><br><span class="line">		ctx.JSON(http.StatusInternalServerError, gin.H&#123;<span class="string">&quot;error&quot;</span>: <span class="string">&quot;Database error&quot;</span>&#125;)</span><br><span class="line">		<span class="keyword">return</span></span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">var</span> users []dao.User2</span><br><span class="line">	<span class="keyword">if</span> err := db.Find(&amp;users).Error; err != <span class="literal">nil</span> &#123;</span><br><span class="line">		log.Println(<span class="string">&quot;User not found:&quot;</span>, err)</span><br><span class="line">		ctx.JSON(http.StatusNotFound, gin.H&#123;<span class="string">&quot;error&quot;</span>: <span class="string">&quot;User not found&quot;</span>&#125;)</span><br><span class="line">		<span class="keyword">return</span></span><br><span class="line">	&#125;</span><br><span class="line">	ctx.JSON(http.StatusOK, users)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ›´æ–°ç”¨æˆ·</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(ctrl *UserGormController)</span></span> UpdateUser(ctx *gin.Context) &#123;</span><br><span class="line">	db, err := dao.ConnectDataBase()</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		log.Println(<span class="string">&quot;Database connection error:&quot;</span>, err)</span><br><span class="line">		ctx.JSON(http.StatusInternalServerError, gin.H&#123;<span class="string">&quot;error&quot;</span>: <span class="string">&quot;Database error&quot;</span>&#125;)</span><br><span class="line">		<span class="keyword">return</span></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// è·å–è¦æ›´æ–°çš„ç”¨æˆ·ID</span></span><br><span class="line">	userID := ctx.Param(<span class="string">&quot;id&quot;</span>)</span><br><span class="line"></span><br><span class="line">	<span class="comment">// è§£æè¯·æ±‚ä½“ä¸­çš„ç”¨æˆ·åå’Œå¯†ç </span></span><br><span class="line">	<span class="keyword">var</span> user dao.User2</span><br><span class="line">	<span class="keyword">if</span> err := ctx.ShouldBindJSON(&amp;user); err != <span class="literal">nil</span> &#123;</span><br><span class="line">		log.Println(<span class="string">&quot;Invalid request body:&quot;</span>, err)</span><br><span class="line">		ctx.JSON(http.StatusBadRequest, gin.H&#123;<span class="string">&quot;error&quot;</span>: <span class="string">&quot;Invalid request body&quot;</span>&#125;)</span><br><span class="line">		<span class="keyword">return</span></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// æ›´æ–°ç”¨æˆ·ä¿¡æ¯</span></span><br><span class="line">	<span class="keyword">if</span> err := db.Model(&amp;dao.User2&#123;&#125;).Where(<span class="string">&quot;id = ?&quot;</span>, userID).Updates(user).Error; err != <span class="literal">nil</span> &#123;</span><br><span class="line">		log.Println(<span class="string">&quot;Error updating user:&quot;</span>, err)</span><br><span class="line">		ctx.JSON(http.StatusInternalServerError, gin.H&#123;<span class="string">&quot;error&quot;</span>: <span class="string">&quot;Error updating user&quot;</span>&#125;)</span><br><span class="line">		<span class="keyword">return</span></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	ctx.JSON(http.StatusOK, gin.H&#123;<span class="string">&quot;message&quot;</span>: <span class="string">&quot;User updated successfully&quot;</span>&#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// åˆ›å»ºå­—æ®µ</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(ctrl *UserGormController)</span></span> AddUser(ctx *gin.Context) &#123;</span><br><span class="line">	db, err := dao.ConnectDataBase()</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		log.Println(<span class="string">&quot;Database connection error:&quot;</span>, err)</span><br><span class="line">		ctx.JSON(http.StatusInternalServerError, gin.H&#123;<span class="string">&quot;error&quot;</span>: <span class="string">&quot;Database error&quot;</span>&#125;)</span><br><span class="line">		<span class="keyword">return</span></span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">var</span> user dao.User2</span><br><span class="line">	<span class="keyword">if</span> err := ctx.ShouldBindJSON(&amp;user); err != <span class="literal">nil</span> &#123;</span><br><span class="line">		log.Println(<span class="string">&quot;Invalid request body:&quot;</span>, err)</span><br><span class="line">		ctx.JSON(http.StatusBadRequest, gin.H&#123;<span class="string">&quot;error&quot;</span>: <span class="string">&quot;Invalid request body&quot;</span>&#125;)</span><br><span class="line">		<span class="keyword">return</span></span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">if</span> err := db.Create(&amp;user).Error; err != <span class="literal">nil</span> &#123;</span><br><span class="line">		log.Println(<span class="string">&quot;Add User Error !&quot;</span>, err)</span><br><span class="line">		ctx.JSON(http.StatusInternalServerError, gin.H&#123;<span class="string">&quot;error&quot;</span>: <span class="string">&quot;Add User Error&quot;</span>&#125;)</span><br><span class="line">		<span class="keyword">return</span></span><br><span class="line">	&#125;</span><br><span class="line">	ctx.JSON(http.StatusCreated, gin.H&#123;<span class="string">&quot;message&quot;</span>: <span class="string">&quot;Add User is successfully&quot;</span>&#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// åˆ é™¤å­—æ®µ</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(ctrl *UserGormController)</span></span> DeleteUser(ctx *gin.Context) &#123;</span><br><span class="line">	db, err := dao.ConnectDataBase()</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		log.Println(<span class="string">&quot;Database connection error:&quot;</span>, err)</span><br><span class="line">		ctx.JSON(http.StatusInternalServerError, gin.H&#123;<span class="string">&quot;error&quot;</span>: <span class="string">&quot;Database error&quot;</span>&#125;)</span><br><span class="line">		<span class="keyword">return</span></span><br><span class="line">	&#125;</span><br><span class="line">	userID := ctx.Param(<span class="string">&quot;id&quot;</span>)</span><br><span class="line">	<span class="keyword">if</span> err := db.Where(<span class="string">&quot;id = ?&quot;</span>, userID).Delete(&amp;dao.User2&#123;&#125;).Error; err != <span class="literal">nil</span> &#123;</span><br><span class="line">		log.Println(<span class="string">&quot;Delete User Error !&quot;</span>, err)</span><br><span class="line">		ctx.JSON(http.StatusInternalServerError, gin.H&#123;<span class="string">&quot;error&quot;</span>: <span class="string">&quot;Delete User Error&quot;</span>&#125;)</span><br><span class="line">		<span class="keyword">return</span></span><br><span class="line">	&#125;</span><br><span class="line">	ctx.JSON(http.StatusOK, gin.H&#123;<span class="string">&quot;message&quot;</span>: <span class="string">&quot;Delete User is successfully&quot;</span>&#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>2.åœ¨UserGormRouteræ³¨å†Œæ–¹æ³•è·¯ç”±</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> router</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">&quot;github.com/gin-gonic/gin&quot;</span></span><br><span class="line">	<span class="string">&quot;main/controller&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">UserGormInit</span><span class="params">(r *gin.Engine)</span></span> &#123;</span><br><span class="line">	user := controller.UserGormController&#123;&#125;</span><br><span class="line">	userGroup := r.Group(<span class="string">&quot;/gorm&quot;</span>)</span><br><span class="line">	&#123;</span><br><span class="line">		userGroup.GET(<span class="string">&quot;/searchUser/:id&quot;</span>, <span class="function"><span class="keyword">func</span><span class="params">(context *gin.Context)</span></span> &#123;</span><br><span class="line">			user.SearchUser(context)</span><br><span class="line">		&#125;)</span><br><span class="line">		userGroup.GET(<span class="string">&quot;/searchAllUser&quot;</span>, <span class="function"><span class="keyword">func</span><span class="params">(context *gin.Context)</span></span> &#123;</span><br><span class="line">			user.SearchAllUser(context)</span><br><span class="line">		&#125;)</span><br><span class="line">		userGroup.POST(<span class="string">&quot;/updateUser/:id&quot;</span>, <span class="function"><span class="keyword">func</span><span class="params">(context *gin.Context)</span></span> &#123;</span><br><span class="line">			user.UpdateUser(context)</span><br><span class="line">		&#125;)</span><br><span class="line">		userGroup.POST(<span class="string">&quot;/addUser&quot;</span>, <span class="function"><span class="keyword">func</span><span class="params">(context *gin.Context)</span></span> &#123;</span><br><span class="line">			user.AddUser(context)</span><br><span class="line">		&#125;)</span><br><span class="line">		userGroup.DELETE(<span class="string">&quot;/deleteUser/:id&quot;</span>, <span class="function"><span class="keyword">func</span><span class="params">(context *gin.Context)</span></span> &#123;</span><br><span class="line">			user.DeleteUser(context)</span><br><span class="line">		&#125;)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ol>
<li>åœ¨main.goæ–‡ä»¶ä¸­æ‰§è¡Œè¯¥è·¯ç”±ç»„<figure class="highlight go"><table><tr><td class="code"><pre><span class="line">router.UserGormInit(r)</span><br></pre></td></tr></table></figure></li>
</ol>
<h3 id="Giné‚®ä»¶æœåŠ¡"><a href="#Giné‚®ä»¶æœåŠ¡" class="headerlink" title="Giné‚®ä»¶æœåŠ¡"></a>Giné‚®ä»¶æœåŠ¡</h3><ul>
<li>ä¸‹è½½ä¾èµ–åŒ…<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">go get gopkg.in/gomail.v2</span><br></pre></td></tr></table></figure>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> service</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">&quot;fmt&quot;</span></span><br><span class="line">	<span class="string">&quot;gopkg.in/gomail.v2&quot;</span></span><br><span class="line">	<span class="string">&quot;gopkg.in/ini.v1&quot;</span></span><br><span class="line">	<span class="string">&quot;log&quot;</span></span><br><span class="line">	<span class="string">&quot;os&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> MailService <span class="keyword">struct</span> &#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> (</span><br><span class="line">	username <span class="type">string</span></span><br><span class="line">	password <span class="type">string</span></span><br><span class="line">	host     <span class="type">string</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">InitMail</span><span class="params">()</span></span> &#123;</span><br><span class="line">	cfg, err := ini.Load(<span class="string">&quot;D:\\Go-Web\\Blog-go\\main\\config\\config.ini&quot;</span>)</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		fmt.Println(<span class="string">&quot;è¯»å–å¤±è´¥:&quot;</span>, err)</span><br><span class="line">		os.Exit(<span class="number">1</span>)</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	username = cfg.Section(<span class="string">&quot;Mail&quot;</span>).Key(<span class="string">&quot;username&quot;</span>).String()</span><br><span class="line">	password = cfg.Section(<span class="string">&quot;Mail&quot;</span>).Key(<span class="string">&quot;password&quot;</span>).String()</span><br><span class="line">	host = cfg.Section(<span class="string">&quot;Mail&quot;</span>).Key(<span class="string">&quot;host&quot;</span>).String()</span><br><span class="line">	log.Println(<span class="string">&quot;==========================&gt;é‚®ä»¶é…ç½®æ„å»º&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">SendEmail</span><span class="params">(to <span class="type">string</span>, sub <span class="type">string</span>, body <span class="type">string</span>)</span></span> <span class="type">bool</span> &#123;</span><br><span class="line">	m := gomail.NewMessage()</span><br><span class="line">	m.SetHeader(<span class="string">&quot;From&quot;</span>, username)</span><br><span class="line">	m.SetHeader(<span class="string">&quot;To&quot;</span>, to)</span><br><span class="line">	m.SetHeader(<span class="string">&quot;Subject&quot;</span>, sub)</span><br><span class="line">	m.SetBody(<span class="string">&quot;text/plain&quot;</span>, body)</span><br><span class="line">	d := gomail.NewDialer(host, <span class="number">465</span>, username, password)</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> err := d.DialAndSend(m); err != <span class="literal">nil</span> &#123;</span><br><span class="line">		log.Println(err)</span><br><span class="line">		<span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
</ul>
<h3 id="GinåŠ è½½inié…ç½®æ–‡ä»¶"><a href="#GinåŠ è½½inié…ç½®æ–‡ä»¶" class="headerlink" title="GinåŠ è½½inié…ç½®æ–‡ä»¶"></a>GinåŠ è½½inié…ç½®æ–‡ä»¶</h3><ul>
<li>åŠ è½½ä¾èµ–åŒ…<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">go get gopkg.in/ini.v1</span><br></pre></td></tr></table></figure></li>
<li>config.iniæ–‡ä»¶<figure class="highlight ini"><table><tr><td class="code"><pre><span class="line"><span class="section">[Mail]</span></span><br><span class="line"><span class="attr">username</span> = <span class="number">1323231313</span>@qq.com</span><br><span class="line"><span class="attr">password</span> = fdsfasfdafdsfdf</span><br><span class="line"><span class="attr">port</span> = <span class="number">465</span></span><br><span class="line"><span class="attr">host</span> = smtp.qq.com</span><br><span class="line"></span><br><span class="line"><span class="section">[Mysql]</span></span><br><span class="line"><span class="attr">url</span> = root:fdfsfaliu@/personblog?charset=utf8&amp;parseTime=<span class="literal">True</span>&amp;loc=Local</span><br></pre></td></tr></table></figure></li>
<li>è·å–é…ç½®æ–‡ä»¶å†…å®¹<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">InitMail</span><span class="params">()</span></span> &#123;</span><br><span class="line">	cfg, err := ini.Load(<span class="string">&quot;D:\\Go-Web\\Blog-go\\main\\config\\config.ini&quot;</span>)</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		fmt.Println(<span class="string">&quot;è¯»å–å¤±è´¥:&quot;</span>, err)</span><br><span class="line">		os.Exit(<span class="number">1</span>)</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	username = cfg.Section(<span class="string">&quot;Mail&quot;</span>).Key(<span class="string">&quot;username&quot;</span>).String()</span><br><span class="line">	password = cfg.Section(<span class="string">&quot;Mail&quot;</span>).Key(<span class="string">&quot;password&quot;</span>).String()</span><br><span class="line">	host = cfg.Section(<span class="string">&quot;Mail&quot;</span>).Key(<span class="string">&quot;host&quot;</span>).String()</span><br><span class="line">	log.Println(<span class="string">&quot;==========================&gt;é‚®ä»¶é…ç½®æ„å»º&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<h3 id="Gin-Redis"><a href="#Gin-Redis" class="headerlink" title="Gin Redis"></a>Gin Redis</h3><ul>
<li>redisåŸºç¡€ç”¨æ³•<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">InitRDB</span><span class="params">()</span></span> &#123;</span><br><span class="line">	cfg, err := ini.Load(<span class="string">&quot;D:\\Go-Web\\Blog-go\\main\\config\\config.ini&quot;</span>)</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		fmt.Println(<span class="string">&quot;è¯»å–å¤±è´¥:&quot;</span>, err)</span><br><span class="line">		os.Exit(<span class="number">1</span>)</span><br><span class="line">	&#125;</span><br><span class="line">	host = cfg.Section(<span class="string">&quot;Redis&quot;</span>).Key(<span class="string">&quot;host&quot;</span>).String()</span><br><span class="line">	password = cfg.Section(<span class="string">&quot;Redis&quot;</span>).Key(<span class="string">&quot;password&quot;</span>).String()</span><br><span class="line">	strdb := cfg.Section(<span class="string">&quot;Redis&quot;</span>).Key(<span class="string">&quot;db&quot;</span>).String()</span><br><span class="line">	db, _ = strconv.Atoi(strdb)</span><br><span class="line">	rdb = redis.NewClient(&amp;redis.Options&#123;</span><br><span class="line">		Addr:     host,</span><br><span class="line">		Password: password,</span><br><span class="line">		DB:       db,</span><br><span class="line">	&#125;)</span><br><span class="line">	log.Println(<span class="string">&quot;=========================&gt;Redisé…ç½®æ–‡ä»¶æ„å»º&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">SetCache</span><span class="params">(key <span class="type">string</span>, value <span class="type">string</span>, expiration time.Duration)</span></span> &#123;</span><br><span class="line">	err := rdb.Set(ctx, key, value, expiration).Err()</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		<span class="built_in">panic</span>(err)</span><br><span class="line">	&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">		log.Println(<span class="string">&quot;ç¼“å­˜è®¾ç½®æˆåŠŸ&quot;</span>)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Get</span><span class="params">(key <span class="type">string</span>)</span></span> (<span class="type">string</span>, <span class="type">error</span>) &#123;</span><br><span class="line">	val, err := rdb.Get(ctx, key).Result()</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="string">&quot;&quot;</span>, err</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> val, <span class="literal">nil</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Delete</span><span class="params">(key <span class="type">string</span>)</span></span> <span class="type">bool</span> &#123;</span><br><span class="line">	err := rdb.Del(ctx, key).Err()</span><br><span class="line">	log.Println(<span class="string">&quot;åˆ é™¤æˆåŠŸ&quot;</span>)</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">SetHashField</span><span class="params">(hashKey <span class="type">string</span>, field <span class="type">string</span>, value <span class="type">string</span>)</span></span> &#123;</span><br><span class="line">	err := rdb.HSet(ctx, hashKey, field, value).Err()</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		log.Println(<span class="string">&quot;è®¾ç½®å“ˆå¸Œè¡¨å­—æ®µå¤±è´¥:&quot;</span>, err)</span><br><span class="line">	&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">		log.Println(<span class="string">&quot;è®¾ç½®å“ˆå¸Œè¡¨å­—æ®µæˆåŠŸ&quot;</span>)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">GetHashField</span><span class="params">(hashKey <span class="type">string</span>, field <span class="type">string</span>)</span></span> (<span class="type">string</span>, <span class="type">error</span>) &#123;</span><br><span class="line">	val, err := rdb.HGet(ctx, hashKey, field).Result()</span><br><span class="line">	<span class="keyword">if</span> err == redis.Nil &#123;</span><br><span class="line">		log.Println(<span class="string">&quot;å“ˆå¸Œè¡¨å­—æ®µä¸å­˜åœ¨:&quot;</span>, field)</span><br><span class="line">		<span class="keyword">return</span> <span class="string">&quot;&quot;</span>, <span class="literal">nil</span></span><br><span class="line">	&#125; <span class="keyword">else</span> <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="string">&quot;&quot;</span>, err</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> val, <span class="literal">nil</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">AddToListLeft</span><span class="params">(listKey <span class="type">string</span>, values ...<span class="type">string</span>)</span></span> &#123;</span><br><span class="line">	err := rdb.LPush(ctx, listKey, values).Err()</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		log.Println(<span class="string">&quot;å‘åˆ—è¡¨å·¦ç«¯æ·»åŠ å…ƒç´ å¤±è´¥:&quot;</span>, err)</span><br><span class="line">	&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">		log.Println(<span class="string">&quot;å‘åˆ—è¡¨å·¦ç«¯æ·»åŠ å…ƒç´ æˆåŠŸ&quot;</span>)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">AddToListRight</span><span class="params">(listKey <span class="type">string</span>, values ...<span class="type">string</span>)</span></span> &#123;</span><br><span class="line">	err := rdb.RPush(ctx, listKey, values).Err()</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		log.Println(<span class="string">&quot;å‘åˆ—è¡¨å³ç«¯æ·»åŠ å…ƒç´ å¤±è´¥:&quot;</span>, err)</span><br><span class="line">	&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">		log.Println(<span class="string">&quot;å‘åˆ—è¡¨å³ç«¯æ·»åŠ å…ƒç´ æˆåŠŸ&quot;</span>)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">GetListRange</span><span class="params">(listKey <span class="type">string</span>, start, stop <span class="type">int64</span>)</span></span> ([]<span class="type">string</span>, <span class="type">error</span>) &#123;</span><br><span class="line">	vals, err := rdb.LRange(ctx, listKey, start, stop).Result()</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="literal">nil</span>, err</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> vals, <span class="literal">nil</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">AddJSONToListLeft</span><span class="params">(listKey <span class="type">string</span>, item Item)</span></span> &#123;</span><br><span class="line">	itemJSON, err := json.Marshal(item)</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		log.Println(<span class="string">&quot;JSON åºåˆ—åŒ–å¤±è´¥:&quot;</span>, err)</span><br><span class="line">		<span class="keyword">return</span></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	err = rdb.LPush(ctx, listKey, itemJSON).Err()</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		log.Println(<span class="string">&quot;å‘åˆ—è¡¨å·¦ç«¯æ·»åŠ  JSON å…ƒç´ å¤±è´¥:&quot;</span>, err)</span><br><span class="line">	&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">		log.Println(<span class="string">&quot;å‘åˆ—è¡¨å·¦ç«¯æ·»åŠ  JSON å…ƒç´ æˆåŠŸ&quot;</span>)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">GetJSONListRange</span><span class="params">(listKey <span class="type">string</span>, start, stop <span class="type">int64</span>)</span></span> ([]Item, <span class="type">error</span>) &#123;</span><br><span class="line">	vals, err := rdb.LRange(ctx, listKey, start, stop).Result()</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="literal">nil</span>, err</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">var</span> items []Item</span><br><span class="line">	<span class="keyword">for</span> _, val := <span class="keyword">range</span> vals &#123;</span><br><span class="line">		<span class="keyword">var</span> item Item</span><br><span class="line">		err := json.Unmarshal([]<span class="type">byte</span>(val), &amp;item)</span><br><span class="line">		<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">			log.Println(<span class="string">&quot;JSON ååºåˆ—åŒ–å¤±è´¥:&quot;</span>, err)</span><br><span class="line">		&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">			items = <span class="built_in">append</span>(items, item)</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> items, <span class="literal">nil</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
]]></content>
      <categories>
        <category>web</category>
      </categories>
      <tags>
        <tag>Golang</tag>
        <tag>Gin</tag>
      </tags>
  </entry>
  <entry>
    <title>SolidityåŸºç¡€</title>
    <url>/2023/08/21/%E5%8C%BA%E5%9D%97%E9%93%BE/Solidity%E5%9F%BA%E7%A1%80/</url>
    <content><![CDATA[<h3 id="solidityåŸºç¡€è¯­æ³•"><a href="#solidityåŸºç¡€è¯­æ³•" class="headerlink" title="solidityåŸºç¡€è¯­æ³•"></a>solidityåŸºç¡€è¯­æ³•</h3><p>:::tip å¯¼èˆª<br><a class="link"   href="https://github.com/AmazingAng/WTF-Solidity/tree/main" >solidityæ•™ç¨‹<i class="fas fa-external-link-alt"></i></a><br>:::</p>
<h4 id="åœ¨ç¼–å†™solæ–‡ä»¶ä¹‹å‰è¦åŠ ä¸Š"><a href="#åœ¨ç¼–å†™solæ–‡ä»¶ä¹‹å‰è¦åŠ ä¸Š" class="headerlink" title="åœ¨ç¼–å†™solæ–‡ä»¶ä¹‹å‰è¦åŠ ä¸Š"></a>åœ¨ç¼–å†™solæ–‡ä»¶ä¹‹å‰è¦åŠ ä¸Š</h4><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">// SPDX-License-Identifier: MIT </span><br></pre></td></tr></table></figure>
<p>æˆ–è€…</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">// SPDX-License-Identifier: SimPL-3.0</span><br></pre></td></tr></table></figure>
<h3 id="æ•°æ®ç±»å‹"><a href="#æ•°æ®ç±»å‹" class="headerlink" title="æ•°æ®ç±»å‹"></a>æ•°æ®ç±»å‹</h3><p>ç‰¹æ®Šå˜é‡&#x2F;å…¨å±€å˜é‡ï¼Œæ˜¯å…¨å±€å¯ç”¨çš„å˜é‡<br><img  
                       lazyload
                       alt="image"
                       data-src="/images/2024-12-22-15-40-33.png"
                       
                 ></p>
<h3 id="Solidity-ç‰¹æ®Šå˜é‡-å…¨å±€å˜é‡"><a href="#Solidity-ç‰¹æ®Šå˜é‡-å…¨å±€å˜é‡" class="headerlink" title="Solidity ç‰¹æ®Šå˜é‡&#x2F;å…¨å±€å˜é‡"></a>Solidity ç‰¹æ®Šå˜é‡&#x2F;å…¨å±€å˜é‡</h3><p><img  
                       lazyload
                       alt="image"
                       data-src="/images/2024-12-22-15-41-09.png"
                       
                 ></p>
<h3 id="Solidity-å˜é‡ä½œç”¨åŸŸ"><a href="#Solidity-å˜é‡ä½œç”¨åŸŸ" class="headerlink" title="Solidity å˜é‡ä½œç”¨åŸŸ"></a>Solidity å˜é‡ä½œç”¨åŸŸ</h3><p>å±€éƒ¨å˜é‡çš„ä½œç”¨åŸŸä»…é™äºå®šä¹‰å®ƒä»¬çš„å‡½æ•°ï¼Œä½†æ˜¯çŠ¶æ€å˜é‡å¯ä»¥æœ‰å››ç§ä½œç”¨åŸŸç±»å‹ï¼š</p>
<ul>
<li>public â€“ å…¬å…±çŠ¶æ€å˜é‡å¯ä»¥åœ¨å†…éƒ¨è®¿é—®ï¼Œä¹Ÿå¯ä»¥ä»å¤–éƒ¨è®¿é—®ã€‚å¯¹äºå…¬å…±çŠ¶æ€å˜é‡ï¼Œå°†è‡ªåŠ¨ç”Ÿæˆä¸€ä¸ª getter å‡½æ•°ã€‚</li>
<li>private â€“ ç§æœ‰çŠ¶æ€å˜é‡åªèƒ½ä»å½“å‰åˆçº¦å†…éƒ¨è®¿é—®ï¼Œæ´¾ç”Ÿåˆçº¦å†…ä¸èƒ½è®¿é—®ã€‚</li>
<li>internal â€“ å†…éƒ¨çŠ¶æ€å˜é‡åªèƒ½ä»å½“å‰åˆçº¦æˆ–å…¶æ´¾ç”Ÿåˆçº¦å†…è®¿é—®ã€‚</li>
<li>external - å¤–éƒ¨çŠ¶æ€å˜é‡åªèƒ½åœ¨åˆçº¦ä¹‹å¤–è°ƒç”¨ ï¼Œä¸èƒ½è¢«åˆçº¦å†…çš„å…¶ä»–å‡½æ•°è°ƒç”¨ã€‚</li>
</ul>
<h3 id="Solidity-æ¡ä»¶è¿ç®—ç¬¦"><a href="#Solidity-æ¡ä»¶è¿ç®—ç¬¦" class="headerlink" title="Solidity æ¡ä»¶è¿ç®—ç¬¦"></a>Solidity æ¡ä»¶è¿ç®—ç¬¦</h3><pre><code>? : (æ¡ä»¶è¿ç®—ç¬¦ )
</code></pre>
<p>å¦‚æœæ¡ä»¶ä¸ºçœŸ ? åˆ™å–å€¼X : å¦åˆ™å€¼Y</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">function getResult() public pure returns(uint)&#123;</span><br><span class="line">   uint a = 1; // å±€éƒ¨å˜é‡</span><br><span class="line">   uint b = 2;</span><br><span class="line">   uint result = (a &gt; b? a: b);  //æ¡ä»¶è¿ç®—</span><br><span class="line">   return result; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è¾“å‡ºç»“æœ</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">	&quot;0&quot;: &quot;uint256: 2&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="å¾ªç¯è¯­å¥"><a href="#å¾ªç¯è¯­å¥" class="headerlink" title="å¾ªç¯è¯­å¥"></a>å¾ªç¯è¯­å¥</h3><h4 id="whileå¾ªç¯"><a href="#whileå¾ªç¯" class="headerlink" title="whileå¾ªç¯"></a>whileå¾ªç¯</h4><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">function whilexunhuan(uint loop) public pure returns (uint) &#123;</span><br><span class="line">    uint sum = 0;</span><br><span class="line">    uint i = 1;</span><br><span class="line">    while (i &lt;= loop) &#123;</span><br><span class="line">        sum += i;</span><br><span class="line">        i++;</span><br><span class="line">    &#125;</span><br><span class="line">    return sum;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="forå¾ªç¯"><a href="#forå¾ªç¯" class="headerlink" title="forå¾ªç¯"></a>forå¾ªç¯</h4><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">function forXunhuan(uint loop) public pure returns (uint) &#123;</span><br><span class="line">    uint sum = 0;</span><br><span class="line">    for (uint i = 1;i &lt;= loop;i++) &#123;</span><br><span class="line">        sum += i;</span><br><span class="line">    &#125;</span><br><span class="line">    return sum;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="do-whileå¾ªç¯"><a href="#do-whileå¾ªç¯" class="headerlink" title="do-whileå¾ªç¯"></a>do-whileå¾ªç¯</h4><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">function doWhileXunhuan(uint loop) public  pure returns (uint) &#123;</span><br><span class="line">     uint sum = 0;</span><br><span class="line">     uint i = 1;</span><br><span class="line">     do&#123;</span><br><span class="line">         sum += i;</span><br><span class="line">         i++;</span><br><span class="line">     &#125; while (i &lt; loop);</span><br><span class="line">         return sum;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="pureå’Œview"><a href="#pureå’Œview" class="headerlink" title="pureå’Œview"></a>pureå’Œview</h3><blockquote>
<p>solidity pureå‡½æ•°ï¼Œä¹Ÿå°±æ˜¯çº¯å‡½æ•°ï¼Œæ˜¯æŒ‡å‡½æ•°ä¸ä¼šè¯»å–æˆ–ä¿®æ”¹çŠ¶æ€ã€‚<br> æ¢è¨€ä¹‹ï¼Œsolidity pureå‡½æ•°ä¸ä¼šæ“ä½œé“¾ä¸Šæ•°æ®ã€‚<br>solidity viewå‡½æ•°ï¼Œä¹Ÿå°±æ˜¯è§†å›¾å‡½æ•°ï¼Œæ˜¯æŒ‡å‡½æ•°åªä¼šè¯»å–çŠ¶æ€ï¼Œä¸ä¼šä¿®æ”¹çŠ¶æ€ã€‚<br> æ¢è¨€ä¹‹ï¼Œsolidity viewå‡½æ•°åªä¼šè¯»å–é“¾ä¸Šæ•°æ®ï¼Œä¸ä¼šä¿®æ”¹é“¾ä¸Šæ•°æ®ã€‚</p>
</blockquote>
<h3 id="æ„é€ å‡½æ•°"><a href="#æ„é€ å‡½æ•°" class="headerlink" title="æ„é€ å‡½æ•°"></a>æ„é€ å‡½æ•°</h3><blockquote>
<p>Solidityæ„é€ å‡½æ•°æ˜¯ä¸€ä¸ªç‰¹æ®Šå‡½æ•°ï¼Œå®ƒä»…èƒ½åœ¨æ™ºèƒ½åˆçº¦éƒ¨ç½²çš„æ—¶å€™è°ƒç”¨ä¸€æ¬¡ï¼Œä¹‹åå°±ä¸èƒ½å†æ¬¡è¢«è°ƒç”¨ã€‚<br> Solidityæ„é€ å‡½æ•°å¸¸ç”¨æ¥è¿›è¡ŒçŠ¶æ€å˜é‡çš„åˆå§‹åŒ–å·¥ä½œã€‚<br>Solidityç¼–è¯‘å™¨ä¸­ï¼Œä½¿ç”¨å…³é”®è¯ constructor ä½œä¸ºæ„é€ å‡½æ•°ã€‚</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">uint public user;</span><br><span class="line">address public owner;</span><br><span class="line"></span><br><span class="line">constructor (uint _user) &#123;</span><br><span class="line">    // å°†éƒ¨ç½²è€…åœ°å€å­˜å‚¨åˆ°ownerå˜é‡</span><br><span class="line">    owner = msg.sender;</span><br><span class="line">    user = _user;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="onlyOwnerä¿®é¥°ç¬¦"><a href="#onlyOwnerä¿®é¥°ç¬¦" class="headerlink" title="onlyOwnerä¿®é¥°ç¬¦"></a>onlyOwnerä¿®é¥°ç¬¦</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">/**</span><br><span class="line"> * @dev è°ƒç”¨è€…ä¸æ˜¯â€˜ä¸»äººâ€™ï¼Œå°±ä¼šæŠ›å‡ºå¼‚å¸¸</span><br><span class="line"> */</span><br><span class="line">modifier onlyOwner() &#123;</span><br><span class="line">  require(msg.sender == owner);</span><br><span class="line">  _;</span><br><span class="line">&#125;</span><br><span class="line">onlyOwner å‡½æ•°ä¿®é¥°ç¬¦æ˜¯è¿™ä¹ˆç”¨çš„ï¼š</span><br><span class="line"></span><br><span class="line">contract MyContract is Ownable &#123;</span><br><span class="line">  event LaughManiacally(string laughter);</span><br><span class="line"></span><br><span class="line">  //æ³¨æ„ï¼ `onlyOwner`ä¸Šåœº :</span><br><span class="line">  function likeABoss() external onlyOwner &#123;</span><br><span class="line">    LaughManiacally(&quot;Muahahahaha&quot;);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="Solidity-åŠ å¯†å‡½æ•°"><a href="#Solidity-åŠ å¯†å‡½æ•°" class="headerlink" title="Solidity åŠ å¯†å‡½æ•°"></a>Solidity åŠ å¯†å‡½æ•°</h3><ul>
<li>keccak256(bytes memory) returns (bytes32) è®¡ç®—è¾“å…¥çš„Keccak-256æ•£åˆ—ã€‚</li>
<li>sha256(bytes memory) returns (bytes32) è®¡ç®—è¾“å…¥çš„SHA-256æ•£åˆ—ã€‚</li>
<li>ripemd160(bytes memory) returns (bytes20) è®¡ç®—è¾“å…¥çš„RIPEMD-160æ•£åˆ—ã€‚</li>
<li>ecrecover(bytes32 hash, uint8 v, bytes32 r, bytes32 s) returns (address) ä»æ¤­åœ†æ›²çº¿ç­¾åä¸­æ¢å¤ä¸å…¬é’¥ç›¸å…³çš„åœ°å€ï¼Œæˆ–åœ¨å‡ºé”™æ—¶è¿”å›é›¶ã€‚å‡½æ•°å‚æ•°å¯¹åº”äºç­¾åçš„ECDSAå€¼: r â€“ ç­¾åçš„å‰32å­—èŠ‚; s: ç­¾åçš„ç¬¬äºŒä¸ª32å­—èŠ‚; v: ç­¾åçš„æœ€åä¸€ä¸ªå­—èŠ‚ã€‚è¿™ä¸ªæ–¹æ³•è¿”å›ä¸€ä¸ªåœ°å€ã€‚</li>
</ul>
<h4 id="keccak256åŠ å¯†"><a href="#keccak256åŠ å¯†" class="headerlink" title="keccak256åŠ å¯†"></a>keccak256åŠ å¯†</h4><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">function callkeccak256(string memory a) public pure  returns (bytes memory) &#123;</span><br><span class="line">    bytes memory byteArray = bytes(a);</span><br><span class="line">    bytes32 hash = keccak256(byteArray);</span><br><span class="line">    return abi.encodePacked(hash);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="Solidity-ä¸å¯å˜é‡-immutable"><a href="#Solidity-ä¸å¯å˜é‡-immutable" class="headerlink" title="Solidity ä¸å¯å˜é‡ immutable"></a>Solidity ä¸å¯å˜é‡ immutable</h3><blockquote>
<p>Solidity immutable æ˜¯å¦ä¸€ç§å¸¸é‡çš„è¡¨è¾¾æ–¹å¼ã€‚ä¸å¸¸é‡ç±»ä¼¼ï¼Œä½†æ˜¯ä¸å¿…ç¡¬ç¼–ç ï¼Œå¯ä»¥åœ¨æ„é€ å‡½æ•°æ—¶ä¼ å€¼ï¼Œéƒ¨ç½²åæ— æ³•æ”¹å˜ã€‚<br>immutable ä¸å¯å˜é‡åŒæ ·ä¸ä¼šå ç”¨çŠ¶æ€å˜é‡å­˜å‚¨ç©ºé—´ï¼Œåœ¨éƒ¨ç½²æ—¶ï¼Œå˜é‡çš„å€¼ä¼šè¢«è¿½åŠ çš„è¿è¡Œæ—¶å­—èŠ‚ç ä¸­ï¼Œ å› æ­¤å®ƒæ¯”ä½¿ç”¨çŠ¶æ€å˜é‡ä¾¿å®œçš„å¤šï¼Œä¹ŸåŒæ ·å¸¦æ¥äº†æ›´å¤šçš„å®‰å…¨æ€§ã€‚</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">address public immutable owner = msg.sender;</span><br></pre></td></tr></table></figure>
<h3 id="Solidity-åˆçº¦ç»§æ‰¿"><a href="#Solidity-åˆçº¦ç»§æ‰¿" class="headerlink" title="Solidity åˆçº¦ç»§æ‰¿"></a>Solidity åˆçº¦ç»§æ‰¿</h3><h4 id="virtual-å’Œ-override"><a href="#virtual-å’Œ-override" class="headerlink" title="virtual å’Œ override"></a>virtual å’Œ override</h4><blockquote>
<p>solidity å¼•å…¥äº† virtualï¼Œoverride å…³é”®å­—ï¼Œç”¨äºé‡å†™å‡½æ•°ã€‚<br>çˆ¶åˆçº¦å¯ä»¥ä½¿ç”¨ virtual å…³é”®å­—å£°æ˜ä¸€ä¸ªè™šå‡½æ•°ï¼Œå­åˆçº¦ä½¿ç”¨ override å…³é”®å­—æ¥è¦†ç›–çˆ¶åˆçº¦çš„æ–¹æ³•</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">// SPDX-License-Identifier: MIT</span><br><span class="line">pragma solidity ^0.8.0;</span><br><span class="line">contract test1&#123;</span><br><span class="line">  string public name;</span><br><span class="line">  uint public age;</span><br><span class="line">  function getSalary() external pure virtual returns(string memory)&#123;</span><br><span class="line">    return &quot;Hello World&quot;;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">contract test2 is test1&#123;</span><br><span class="line">  function getSalary() external pure override returns(string memory)&#123;</span><br><span class="line">    return &quot;hahahaha&quot;;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="abstract"><a href="#abstract" class="headerlink" title="abstract"></a>abstract</h4><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">// SPDX-License-Identifier: MIT</span><br><span class="line">pragma solidity ^0.8.0;</span><br><span class="line">abstract contract test3&#123; //æŠ½è±¡åˆçº¦</span><br><span class="line">    function getTest() public pure virtual returns (string memory);</span><br><span class="line">&#125;</span><br><span class="line">contract test4 is test3 &#123; //å®ç°åˆçº¦</span><br><span class="line">    function getTest() public pure override returns (string memory) &#123;</span><br><span class="line">        return &quot;I am an implementation class&quot;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="Solidity-å¼‚å¸¸å¤„ç†"><a href="#Solidity-å¼‚å¸¸å¤„ç†" class="headerlink" title="Solidity å¼‚å¸¸å¤„ç†"></a>Solidity å¼‚å¸¸å¤„ç†</h3><blockquote>
<p>Solidity æ˜¯é€šè¿‡å›é€€çŠ¶æ€çš„æ–¹å¼æ¥å¤„ç†å¼‚å¸¸é”™è¯¯ã€‚<br> Solidity å‘ç”Ÿå¼‚å¸¸æ—¶ï¼Œä¼šæ’¤æ¶ˆå½“å‰è°ƒç”¨å’Œæ‰€æœ‰å­è°ƒç”¨æ”¹å˜çš„çŠ¶æ€ï¼ŒåŒæ—¶ç»™è°ƒç”¨è€…è¿”å›ä¸€ä¸ªé”™è¯¯æ ‡è¯†ã€‚<br>Solidity æä¾›äº†require ã€assert å’Œ revert æ¥å¤„ç†å¼‚å¸¸ã€‚</p>
</blockquote>
<h4 id="require"><a href="#require" class="headerlink" title="require"></a>require</h4><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">uint a = 8;</span><br><span class="line">function shuru(uint b) public view returns (uint) &#123;</span><br><span class="line">    require(b == a, &quot;b is not equal to a&quot;);</span><br><span class="line">    return 0;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>éšä¾¿è¾“å…¥ä¸€ä¸ªä¸ç­‰äº8çš„æ•°å­—æç¤º<br><img  
                       lazyload
                       alt="image"
                       data-src="/images/2024-12-22-15-41-49.png"
                       
                 ></p>
<h4 id="assert"><a href="#assert" class="headerlink" title="assert"></a>assert</h4><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">function shuru2(uint b) public view returns (uint) &#123;</span><br><span class="line">    assert(a == b);</span><br><span class="line">    return 0;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>éšä¾¿è¾“å…¥ä¸€ä¸ªä¸ç­‰äº8çš„æ•°å­—æç¤º<br><img  
                       lazyload
                       alt="image"
                       data-src="/images/2024-12-22-15-42-29.png"
                       
                 ></p>
<h3 id="requireã€assert-ä½¿ç”¨åœºæ™¯"><a href="#requireã€assert-ä½¿ç”¨åœºæ™¯" class="headerlink" title="requireã€assert ä½¿ç”¨åœºæ™¯"></a>requireã€assert ä½¿ç”¨åœºæ™¯</h3><blockquote>
<p>require() å‡½æ•°ç”¨äºæ£€æµ‹è¾“å…¥å˜é‡æˆ–çŠ¶æ€å˜é‡æ˜¯å¦æ»¡è¶³æ¡ä»¶ï¼Œä»¥åŠéªŒè¯è°ƒç”¨å¤–éƒ¨åˆçº¦çš„è¿”å›å€¼ã€‚<br> require() è¯­å¥çš„å¤±è´¥æŠ¥é”™ï¼Œåº”è¯¥è¢«çœ‹ä½œä¸€ä¸ªæ­£å¸¸çš„åˆ¤æ–­è¯­å¥æµç¨‹ä¸èƒ½é€šè¿‡çš„äº‹ä»¶ã€‚<br> assert()è¯­å¥çš„å¤±è´¥æŠ¥é”™ï¼Œæ„å‘³ç€å‘ç”Ÿäº†ä»£ç å±‚é¢çš„é”™è¯¯äº‹ä»¶ï¼Œå¾ˆå¤§å¯èƒ½æ˜¯åˆçº¦ä¸­æœ‰ä¸€ä¸ªbugéœ€è¦ä¿®å¤ã€‚</p>
</blockquote>
<h3 id="delete"><a href="#delete" class="headerlink" title="delete"></a>delete</h3><blockquote>
<p>ç”¨äºå°†æŸä¸ªå˜é‡é‡ç½®ä¸ºåˆå§‹å€¼ã€‚å¯¹äºæ•´æ•°ï¼Œè¿ç®—ç¬¦çš„æ•ˆæœç­‰åŒäºa &#x3D; 0ã€‚è€Œå¯¹äºå®šé•¿æ•°ç»„ï¼Œåˆ™æ˜¯æŠŠæ•°ç»„ä¸­çš„æ¯ä¸ªå…ƒç´ ç½®ä¸ºåˆå§‹å€¼ï¼Œå˜é•¿æ•°ç»„åˆ™æ˜¯å°†é•¿åº¦ç½®ä¸º0ã€‚å¯¹äºç»“æ„ä½“ï¼Œä¹Ÿæ˜¯ç±»ä¼¼ï¼Œæ˜¯å°†æ‰€æœ‰çš„æˆå‘˜å‡é‡ç½®ä¸ºåˆå§‹å€¼ã€‚</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">uint data;</span><br><span class="line"></span><br><span class="line">function change(uint  i) internal &#123;</span><br><span class="line">    data = i;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function getData() public returns (uint) &#123;</span><br><span class="line">    delete data;</span><br><span class="line">    return data;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="æ¥å—å‡½æ•°receive"><a href="#æ¥å—å‡½æ•°receive" class="headerlink" title="æ¥å—å‡½æ•°receive"></a>æ¥å—å‡½æ•°receive</h4><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">// å®šä¹‰äº‹ä»¶</span><br><span class="line">event Received(address Sender, uint Value);</span><br><span class="line">// æ¥æ”¶ETHæ—¶é‡Šæ”¾Receivedäº‹ä»¶</span><br><span class="line">receive() external payable &#123;</span><br><span class="line">    emit Received(msg.sender, msg.value);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="å›é€€å‡½æ•°"><a href="#å›é€€å‡½æ•°" class="headerlink" title="å›é€€å‡½æ•°"></a>å›é€€å‡½æ•°</h4><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">event fallbackCalled(address Sender, uint Value, bytes Data);</span><br><span class="line"></span><br><span class="line">// fallback</span><br><span class="line">function fallback() external payable&#123;</span><br><span class="line">    emit fallbackCalled(msg.sender, msg.value, msg.data);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="å›é€€å‡½æ•°fallbackå’ŒreceiveåŒºåˆ«"><a href="#å›é€€å‡½æ•°fallbackå’ŒreceiveåŒºåˆ«" class="headerlink" title="å›é€€å‡½æ•°fallbackå’ŒreceiveåŒºåˆ«"></a>å›é€€å‡½æ•°fallbackå’ŒreceiveåŒºåˆ«</h4><blockquote>
<p>ç®€å•æ¥è¯´ï¼Œåˆçº¦æ¥æ”¶ETHæ—¶ï¼Œmsg.dataä¸ºç©ºä¸”å­˜åœ¨receive()æ—¶ï¼Œä¼šè§¦å‘receive()ï¼›msg.dataä¸ä¸ºç©ºæˆ–ä¸å­˜åœ¨receive()æ—¶ï¼Œä¼šè§¦å‘fallback()ï¼Œæ­¤æ—¶fallback()å¿…é¡»ä¸ºpayableã€‚<br>receive()å’Œpayable fallback()å‡ä¸å­˜åœ¨çš„æ—¶å€™ï¼Œå‘åˆçº¦ç›´æ¥å‘é€ETHå°†ä¼šæŠ¥é”™ï¼ˆä½ ä»å¯ä»¥é€šè¿‡å¸¦æœ‰payableçš„å‡½æ•°å‘åˆçº¦å‘é€ETHï¼‰ã€‚</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">è§¦å‘fallback() è¿˜æ˜¯ receive()?</span><br><span class="line">           æ¥æ”¶ETH</span><br><span class="line">              |</span><br><span class="line">         msg.dataæ˜¯ç©ºï¼Ÿ</span><br><span class="line">            /  \</span><br><span class="line">          æ˜¯    å¦</span><br><span class="line">          /      \</span><br><span class="line">receive()å­˜åœ¨?   fallback()</span><br><span class="line">        / \</span><br><span class="line">       æ˜¯  å¦</span><br><span class="line">      /     \</span><br><span class="line">receive()   fallback()</span><br></pre></td></tr></table></figure>
<h5 id="ç‰¹ç‚¹"><a href="#ç‰¹ç‚¹" class="headerlink" title="ç‰¹ç‚¹"></a>ç‰¹ç‚¹</h5><ul>
<li>ä¸€ä¸ªåˆçº¦æœ€å¤šå­˜åœ¨ä¸€ä¸ªå›é€€å‡½æ•°ã€‚</li>
<li>å®ƒå¿…é¡»è¢«æ ‡è®°ä¸ºå¤–éƒ¨ï¼ˆexternalï¼‰å‡½æ•°ã€‚</li>
</ul>
<h3 id="selfdestruct-è‡ªæ¯å‡½æ•°"><a href="#selfdestruct-è‡ªæ¯å‡½æ•°" class="headerlink" title="selfdestruct è‡ªæ¯å‡½æ•°"></a>selfdestruct è‡ªæ¯å‡½æ•°</h3><p><a class="link"   href="https://learnblockchain.cn/article/3331" >æ–‡ç« é“¾æ¥<i class="fas fa-external-link-alt"></i></a></p>
<h3 id="msg-senderå’Œtx-originçš„åŒºåˆ«"><a href="#msg-senderå’Œtx-originçš„åŒºåˆ«" class="headerlink" title="msg.senderå’Œtx.originçš„åŒºåˆ«"></a>msg.senderå’Œtx.originçš„åŒºåˆ«</h3><blockquote>
<p>åœ¨Solidityä¸­ï¼Œ<code>msg.sender</code>å’Œ<code>tx.origin</code>éƒ½ä»£è¡¨äº†äº¤æ˜“çš„å‘é€è€…ï¼Œä½†ä¸¤è€…çš„å«ä¹‰å’Œåº”ç”¨åœºæ™¯æœ‰æ‰€ä¸åŒã€‚</p>
<ol>
<li><code>msg.sender</code>ï¼šå®ƒä»£è¡¨ç›´æ¥è°ƒç”¨æ™ºèƒ½åˆçº¦å‡½æ•°çš„è´¦æˆ·åœ°å€æˆ–æ™ºèƒ½åˆçº¦åœ°å€ã€‚æ— è®ºæ˜¯å¤–éƒ¨è´¦æˆ·è¿˜æ˜¯æ™ºèƒ½åˆçº¦å†…éƒ¨çš„å…¶ä»–åˆçº¦ï¼Œåªè¦æ˜¯ç›´æ¥å‘èµ·è°ƒç”¨çš„ï¼Œå…¶åœ°å€éƒ½ä¼šè¢«è®°å½•ä¸º<code>msg.sender</code>ã€‚è¿™æ„å‘³ç€ï¼Œå¦‚æœä¸€ä¸ªåˆçº¦Aå†…éƒ¨è°ƒç”¨äº†å¦ä¸€ä¸ªåˆçº¦Bçš„ä¸€ä¸ªå‡½æ•°ï¼Œé‚£ä¹ˆåœ¨åˆçº¦Bä¸­ï¼Œ<code>msg.sender</code>å°†è¡¨ç¤ºåˆçº¦Açš„åœ°å€ã€‚</li>
<li><code>tx.origin</code>ï¼šå®ƒä»£è¡¨æ•´ä¸ªäº¤æ˜“è¿‡ç¨‹ä¸­æœ€åˆçš„é‚£ä¸ªäº¤æ˜“å‘é€æ–¹çš„åœ°å€ã€‚è¿™é€šå¸¸æ˜¯ä¸€ä¸ªå¤–éƒ¨è´¦æˆ·çš„åœ°å€ï¼Œå› ä¸ºåªæœ‰å¤–éƒ¨è´¦æˆ·çš„åœ°å€æ‰è¢«è§†ä¸ºäº¤æ˜“çš„å‘èµ·è€…ã€‚åœ¨æ™ºèƒ½åˆçº¦å†…éƒ¨ï¼Œå¦‚æœä¸€ä¸ªåˆçº¦æ¥æ”¶åˆ°æ¥è‡ªå¤–éƒ¨è´¦æˆ·çš„äº¤æ˜“è°ƒç”¨ï¼Œé‚£ä¹ˆåœ¨åˆçº¦å†…éƒ¨ï¼Œ<code>tx.origin</code>å°†è¡¨ç¤ºå‘èµ·è¯¥äº¤æ˜“çš„å¤–éƒ¨è´¦æˆ·åœ°å€ã€‚</li>
</ol>
</blockquote>
<blockquote>
<p>ç®€è€Œè¨€ä¹‹ï¼Œ<code>msg.sender</code>å…³æ³¨çš„æ˜¯ç›´æ¥è°ƒç”¨è€…ï¼Œè€Œ<code>tx.origin</code>å…³æ³¨çš„æ˜¯åŸå§‹äº¤æ˜“çš„å‘é€è€…ã€‚åœ¨å®é™…åº”ç”¨ä¸­ï¼Œå¼€å‘è€…éœ€è¦æ ¹æ®å…·ä½“çš„åœºæ™¯å’Œéœ€æ±‚æ¥å†³å®šä½¿ç”¨å“ªä¸€ä¸ªã€‚</p>
</blockquote>
<h3 id="abiç¼–ç "><a href="#abiç¼–ç " class="headerlink" title="abiç¼–ç "></a>abiç¼–ç </h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">// SPDX-License-Identifier: UNLICENSED</span><br><span class="line">pragma solidity ^0.8.9;</span><br><span class="line"></span><br><span class="line">contract Test &#123;</span><br><span class="line">    uint256 x = 10;</span><br><span class="line">    address addr = 0x13a6D1fe418de7e5B03Fb4a15352DfeA3249eAA4;</span><br><span class="line">    string str = &quot;This is China&quot;;</span><br><span class="line">    uint256[2] arr = [1, 2];</span><br><span class="line"></span><br><span class="line">    function core(uint256 _x, address _addr, string calldata _str, uint256[2] calldata _arr) public &#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    function testEncode() public view returns (bytes memory result) &#123;</span><br><span class="line">        result = abi.encode(x, addr, str, arr);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    function testEncodePacked() public view returns (bytes memory result) &#123;</span><br><span class="line">        result = abi.encodePacked(x, addr, str, arr);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    function testEncodeWithSignature() public view returns (bytes memory result) &#123;</span><br><span class="line">        result = abi.encodeWithSignature(&quot;core(uint256,address,string,uint256[2])&quot;, x, addr, str, arr);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    function testEncodeWithSelector() public view returns (bytes memory result) &#123;</span><br><span class="line">        result = abi.encodeWithSelector(bytes4(keccak256(&quot;core(uint256,address,string,uint256[2])&quot;)), x, addr, str, arr);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    function testDecode() public view returns (uint256 _x, address _addr, string memory _str, uint256[2] memory _arr) &#123;</span><br><span class="line">        bytes memory result = testEncode();</span><br><span class="line">        return abi.decode(result, (uint256, address, string, uint256[2]));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img  
                       lazyload
                       alt="image"
                       data-src="/images/2024-12-22-15-43-00.png"
                       
                 ><br><img  
                       lazyload
                       alt="image"
                       data-src="/images/2024-12-22-15-43-41.png"
                       
                 ></p>
<blockquote>
<p><span style="color:red;">abi.encodePacked(x, addr, str, arr)</span> çš„ä½œç”¨æ˜¯å°†å‚æ•° xã€addrã€str å’Œ arr è¿›è¡Œæ‰“åŒ…ç¼–ç ã€‚åœ¨ Solidity ä¸­ï¼Œå½“éœ€è¦å°†å¤šä¸ªç±»å‹ä¸åŒçš„å‚æ•°ä¸€èµ·ä¼ é€’ç»™ä¸€ä¸ªå‡½æ•°æ—¶ï¼Œå¯ä»¥ä½¿ç”¨ abi.encodePacked() å‡½æ•°å°†è¿™äº›å‚æ•°æ‰“åŒ…æˆä¸€ä¸ªå­—èŠ‚æ•°ç»„ã€‚è¿™æ ·å¯ä»¥å‡å°‘è°ƒç”¨æ•°æ®çš„æˆæœ¬ï¼Œå› ä¸ºæ‰“åŒ…åçš„æ•°æ®åªéœ€è¦å ç”¨ä¸€ä¸ªå­˜å‚¨ç©ºé—´ã€‚<br><span style="color:red;">abi.encodeWithSignature()</span> å‡½æ•°ç”¨äºå°†å‚æ•°ç¼–ç ä¸ºå­—èŠ‚æ•°ç»„ï¼Œå¹¶é™„åŠ ä¸€ä¸ªç­¾åã€‚è¿™ä¸ªç­¾åå¯ä»¥ç”¨äºåœ¨æ™ºèƒ½åˆçº¦ä¸­è°ƒç”¨è¯¥å‡½æ•°æ—¶è¿›è¡ŒéªŒè¯ã€‚<br>å…·ä½“æ¥è¯´ï¼Œabi.encodeWithSignature(â€œcore(uint256,address,string,uint256[2])â€, x, addr, str, arr) çš„ä½œç”¨æ˜¯å°†å‚æ•° xã€addrã€str å’Œ arr æŒ‰ç…§æŒ‡å®šçš„å‡½æ•°ç­¾å â€œcore(uint256,address,string,uint256[2])â€ è¿›è¡Œç¼–ç ï¼Œç”Ÿæˆä¸€ä¸ªå­—èŠ‚æ•°ç»„ã€‚è¿™ä¸ªå­—èŠ‚æ•°ç»„å¯ä»¥ä½œä¸ºäº¤æ˜“æ•°æ®æˆ–æ¶ˆæ¯ä½“å‘é€ç»™å…¶ä»–æ™ºèƒ½åˆçº¦ã€‚<br>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œä½¿ç”¨ abi.encodeWithSignature() å‡½æ•°æ—¶ï¼Œéœ€è¦ç¡®ä¿ä¼ å…¥çš„å‚æ•°ç±»å‹ä¸å‡½æ•°ç­¾åä¸­çš„å‚æ•°ç±»å‹ç›¸åŒ¹é…ï¼Œå¦åˆ™ä¼šå¯¼è‡´ç¼–ç å¤±è´¥ã€‚<br><span style="color:red;">abi.encodeWithSelector()</span> å‡½æ•°ç”¨äºå°†å‚æ•°ç¼–ç ä¸ºå­—èŠ‚æ•°ç»„ï¼Œå¹¶é™„åŠ ä¸€ä¸ªé€‰æ‹©å™¨ã€‚è¿™ä¸ªé€‰æ‹©å™¨å¯ä»¥ç”¨äºåœ¨æ™ºèƒ½åˆçº¦ä¸­è°ƒç”¨è¯¥å‡½æ•°æ—¶è¿›è¡ŒéªŒè¯ã€‚<br>å…·ä½“æ¥è¯´ï¼Œabi.encodeWithSelector(bytes4(keccak256(â€œcore(uint256,address,string,uint256[2])â€)), x, addr, str, arr) çš„ä½œç”¨æ˜¯å°†å‚æ•° xã€addrã€str å’Œ arr æŒ‰ç…§æŒ‡å®šçš„å‡½æ•°ç­¾å â€œcore(uint256,address,string,uint256[2])â€ è¿›è¡Œç¼–ç ï¼Œç”Ÿæˆä¸€ä¸ªå­—èŠ‚æ•°ç»„ã€‚è¿™ä¸ªå­—èŠ‚æ•°ç»„å¯ä»¥ä½œä¸ºäº¤æ˜“æ•°æ®æˆ–æ¶ˆæ¯ä½“å‘é€ç»™å…¶ä»–æ™ºèƒ½åˆçº¦ã€‚<br>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œä½¿ç”¨ abi.encodeWithSelector() å‡½æ•°æ—¶ï¼Œéœ€è¦ç¡®ä¿ä¼ å…¥çš„å‚æ•°ç±»å‹ä¸å‡½æ•°ç­¾åä¸­çš„å‚æ•°ç±»å‹ç›¸åŒ¹é…ï¼Œå¦åˆ™ä¼šå¯¼è‡´ç¼–ç å¤±è´¥ã€‚</p>
</blockquote>
<h5 id="å®Œç»“"><a href="#å®Œç»“" class="headerlink" title="å®Œç»“"></a>å®Œç»“</h5><img    
                       lazyload
                       alt="image"
                       data-src="https://s1.chu0.com/src/img/gif/7f/7ff33469d8d148998adc4371ff22fd50.gif?e=1735488000&token=1srnZGLKZ0Aqlz6dk7yF4SkiYf4eP-YrEOdM1sob:bwGC7sqerarUu1DVragekmF7ZtI="
                        
                 >


]]></content>
      <categories>
        <category>åŒºå—é“¾</category>
      </categories>
      <tags>
        <tag>solidity</tag>
      </tags>
  </entry>
  <entry>
    <title>XuperChain</title>
    <url>/2024/08/28/%E5%8C%BA%E5%9D%97%E9%93%BE/XuperChain/</url>
    <content><![CDATA[<h3 id="ç™¾åº¦è¶…çº§é“¾ä½¿ç”¨"><a href="#ç™¾åº¦è¶…çº§é“¾ä½¿ç”¨" class="headerlink" title="ç™¾åº¦è¶…çº§é“¾ä½¿ç”¨"></a>ç™¾åº¦è¶…çº§é“¾ä½¿ç”¨</h3><h3 id="è¶…çº§é“¾ç¯å¢ƒéƒ¨ç½²"><a href="#è¶…çº§é“¾ç¯å¢ƒéƒ¨ç½²" class="headerlink" title="è¶…çº§é“¾ç¯å¢ƒéƒ¨ç½²"></a>è¶…çº§é“¾ç¯å¢ƒéƒ¨ç½²</h3><p><a class="link"   href="https://xuper.baidu.com/n/xuperdoc/general_introduction/brief.html" >å®˜æ–¹æ–‡æ¡£<i class="fas fa-external-link-alt"></i></a></p>
<ul>
<li>æ‹‰å–è¶…çº§é“¾è½¯ä»¶åŒ…<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">wget https://mirrors.lllcnm.cn/xuper.zip</span><br></pre></td></tr></table></figure></li>
<li>ç½‘ç»œç¯å¢ƒé…ç½®<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">make testnet</span><br></pre></td></tr></table></figure></li>
<li>å¯åŠ¨æ‰€æœ‰èŠ‚ç‚¹<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">sh control_all.sh start</span><br></pre></td></tr></table></figure></li>
<li>åˆçº¦è´¦å·åˆ›å»º<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">bin/xchain-cli account new --account 1111111111111112 --fee 1000</span><br></pre></td></tr></table></figure></li>
</ul>
<p><img  
                       lazyload
                       alt="image"
                       data-src="/images/9444eb91-0275-4271-bdb7-14d6a67d4d11.png"
                        alt="Description"
                 ></p>
<ul>
<li>æŸ¥è¯¢è´¦å·ä¿¡æ¯<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">bin/xchain-cli acl query --account XC1111111111111112@xuper</span><br></pre></td></tr></table></figure></li>
<li>æŸ¥è¯¢è´¦å·ä½™é¢<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">./bin/xchain-cli account balance XC1111111111111112@xuper -H 127.0.0.1:37101</span><br></pre></td></tr></table></figure></li>
<li>æ›´æ–°è´¦æˆ·ä½™é¢<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">bin/xchain-cli transfer --to XC1111111111111112@xuper --amount 1000 --keys data/keys/ -H 127.0.0.1:37101</span><br></pre></td></tr></table></figure></li>
<li>éƒ¨ç½²solidityåˆçº¦<br>ç¼–è¯‘åˆçº¦abi bin<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">solc --bin --abi Test.sol -o .</span><br></pre></td></tr></table></figure>
éƒ¨ç½²Helloåˆçº¦<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">pragma solidity ^0.4.25;</span><br><span class="line"></span><br><span class="line">contract Hello &#123;</span><br><span class="line">    string name;</span><br><span class="line">    <span class="keyword">function</span> <span class="built_in">set</span>(string memory _name) public&#123;</span><br><span class="line">        name = _name;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">function</span> get() public view returns(string) &#123;</span><br><span class="line">        <span class="built_in">return</span> name;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">./bin/xchain-cli evm deploy --account XC1111111111111121@xuper --cname Hello --fee 2000 Hello.bin --abi Hello.abi</span><br></pre></td></tr></table></figure>
è°ƒç”¨åˆçº¦<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">./bin/xchain-cli evm invoke --method <span class="built_in">set</span> -a <span class="string">&#x27;&#123;&quot;name&quot;:&quot;hhh&quot;&#125;&#x27;</span> Hello --fee 1000</span><br><span class="line">./bin/xchain-cli evm query --method get Hello</span><br></pre></td></tr></table></figure></li>
</ul>
<h3 id="java-sdkè°ƒç”¨"><a href="#java-sdkè°ƒç”¨" class="headerlink" title="java sdkè°ƒç”¨"></a>java sdkè°ƒç”¨</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">XuperChainUtil</span> &#123;</span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;xuperchain.client.url&#125;&quot;)</span></span><br><span class="line">    String xuperClientUrl;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;xuperchain.admin.keys&#125;&quot;)</span></span><br><span class="line">    String keyPath;</span><br><span class="line">    XuperClient client;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@PostConstruct</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">initField</span><span class="params">()</span> &#123;</span><br><span class="line">        client = <span class="keyword">new</span> <span class="title class_">XuperClient</span>(xuperClientUrl);</span><br><span class="line">        System.out.println(keyPath);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">//è·å–åŒºå—IDã€é«˜åº¦ã€äº¤æ˜“ID</span></span><br><span class="line">    <span class="keyword">public</span> Dict <span class="title function_">getBlockchainStatus</span><span class="params">()</span> &#123;</span><br><span class="line">        XchainOuterClass.<span class="type">BCStatus</span> <span class="variable">bcs</span> <span class="operator">=</span> client.getBlockchainStatus(<span class="string">&quot;xuper&quot;</span>);</span><br><span class="line">        XchainOuterClass.<span class="type">SystemsStatus</span> <span class="variable">systemStatus</span> <span class="operator">=</span> client.getSystemStatus();</span><br><span class="line">        <span class="type">byte</span>[] hex = Hex.encode(bcs.getBlock().getBlockid().toByteArray());</span><br><span class="line">        <span class="type">String</span> <span class="variable">blockId</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">String</span>(hex);</span><br><span class="line">        XchainOuterClass.<span class="type">InternalBlock</span> <span class="variable">getBlocks</span> <span class="operator">=</span> bcs.getBlock();</span><br><span class="line">        System.out.println(getBlocks);</span><br><span class="line">        List&lt;XchainOuterClass.Transaction&gt; transList = getBlocks.getTransactionsList();</span><br><span class="line">        <span class="type">String</span> <span class="variable">lastTransactionId</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">String</span>(Hex.encode(transList.get(transList.size() - <span class="number">1</span>).getTxid().toByteArray()));</span><br><span class="line">        <span class="type">long</span> <span class="variable">height</span> <span class="operator">=</span> getBlocks.getHeight();</span><br><span class="line">        <span class="type">Dict</span> <span class="variable">retDict</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Dict</span>();</span><br><span class="line">        retDict.put(<span class="string">&quot;height&quot;</span>, height);</span><br><span class="line">        retDict.put(<span class="string">&quot;blockId&quot;</span>, blockId);</span><br><span class="line">        retDict.put(<span class="string">&quot;transactionId&quot;</span>, lastTransactionId);</span><br><span class="line">        <span class="keyword">return</span> retDict;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è§¦å‘åˆçº¦äº¤æ˜“(invoke)</span></span><br><span class="line"><span class="comment">     * */</span></span><br><span class="line">        <span class="keyword">public</span> Dict <span class="title function_">invokeContract</span><span class="params">(String accountName,</span></span><br><span class="line"><span class="params">                               String contractName,</span></span><br><span class="line"><span class="params">                               String funcName,</span></span><br><span class="line"><span class="params">                               Map&lt;String, String&gt; args)</span> &#123;</span><br><span class="line">        <span class="type">Account</span> <span class="variable">account</span> <span class="operator">=</span> Account.create(keyPath);</span><br><span class="line">        <span class="comment">//è®¾ç½®åˆçº¦ç”¨æˆ·</span></span><br><span class="line">        account.setContractAccount(accountName);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span>&#123;</span><br><span class="line">            <span class="type">Transaction</span> <span class="variable">tx</span> <span class="operator">=</span> client.invokeEVMContract(account, contractName, funcName, args, <span class="literal">null</span>);</span><br><span class="line">            <span class="type">Map</span> <span class="variable">resMap</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;String, String&gt;() &#123;</span><br><span class="line">                &#123;</span><br><span class="line">                    put(<span class="string">&quot;txId&quot;</span>, tx.getTxid());</span><br><span class="line">                    put(<span class="string">&quot;message&quot;</span>, tx.getContractResponse().getMessage());</span><br><span class="line">                    put(<span class="string">&quot;body&quot;</span>, tx.getContractResponse().getBodyStr());</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Dict</span>(resMap);</span><br><span class="line">        &#125;<span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            <span class="type">Map</span> <span class="variable">resMap</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;String, String&gt;();</span><br><span class="line">            resMap.put(<span class="string">&quot;isError&quot;</span>, <span class="number">1</span>);</span><br><span class="line">            resMap.put(<span class="string">&quot;msg&quot;</span>, e.getMessage());</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Dict</span>(resMap);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æŸ¥è¯¢åˆçº¦åŠŸèƒ½(query)</span></span><br><span class="line"><span class="comment">     * */</span></span><br><span class="line">    <span class="keyword">public</span> Dict <span class="title function_">queryContract</span><span class="params">(String accountName,</span></span><br><span class="line"><span class="params">                              String contractName,</span></span><br><span class="line"><span class="params">                              String funcName,</span></span><br><span class="line"><span class="params">                              Map&lt;String, String&gt; args)</span> &#123;</span><br><span class="line">        <span class="type">Account</span> <span class="variable">account</span> <span class="operator">=</span> Account.create(keyPath);</span><br><span class="line">        <span class="comment">//è®¾ç½®åˆçº¦ç”¨æˆ·</span></span><br><span class="line">        account.setContractAccount(accountName);</span><br><span class="line">        <span class="type">Transaction</span> <span class="variable">tx</span> <span class="operator">=</span> client.queryEVMContract(account, contractName, funcName, args);</span><br><span class="line">        <span class="type">Map</span> <span class="variable">resMap</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;String, String&gt;() &#123;</span><br><span class="line">            &#123;</span><br><span class="line">                put(<span class="string">&quot;message&quot;</span>, tx.getContractResponse().getMessage());</span><br><span class="line">                put(<span class="string">&quot;body&quot;</span>, tx.getContractResponse().getBodyStr());</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Dict</span>(resMap);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>ç›®å½•ç»“æ„</li>
</ul>
<p><img  
                       lazyload
                       alt="image"
                       data-src="/images/41e0d56d-64ae-4300-86d5-6e0af5947172.png"
                        alt="Description"
                 ></p>
<ul>
<li>controller ç±»<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> cn.hutool.core.lang.Dict;</span><br><span class="line"><span class="keyword">import</span> com.example.xuperchaintest.util.XuperChainUtil;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Value;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.UnsupportedEncodingException;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TestController</span> &#123;</span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;contract.creator&#125;&quot;)</span></span><br><span class="line">    String contractCreator;</span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;contract.name&#125;&quot;)</span></span><br><span class="line">    String contractName;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    XuperChainUtil xuperChainUtil;</span><br><span class="line">    <span class="meta">@RequestMapping(value = &quot;getBlockchainStatus&quot;, method = RequestMethod.GET)</span></span><br><span class="line">    <span class="keyword">public</span> Dict <span class="title function_">getBlockchainStatus</span><span class="params">()</span> <span class="keyword">throws</span> UnsupportedEncodingException &#123;</span><br><span class="line">        <span class="keyword">return</span> xuperChainUtil.getBlockchainStatus();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@PostMapping(&quot;set&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Dict <span class="title function_">addUser</span><span class="params">(<span class="meta">@RequestBody</span> Map&lt;String,String&gt; args)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> xuperChainUtil.invokeContract(contractCreator,contractName,<span class="string">&quot;set&quot;</span>,args);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@GetMapping(&quot;get&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Dict <span class="title function_">getUser</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> xuperChainUtil.queryContract(contractCreator,contractName,<span class="string">&quot;get&quot;</span>,<span class="literal">null</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
<li>è°ƒç”¨setæ¥å£</li>
</ul>
<p><img  
                       lazyload
                       alt="image"
                       data-src="/images/a8669804-852d-44f4-b2aa-a9eb23de346c.png"
                        alt="Description"
                 ></p>
<ul>
<li>è°ƒç”¨getæ¥å£</li>
</ul>
<p><img  
                       lazyload
                       alt="image"
                       data-src="/images/2b89a17a-aa51-421c-b174-0d81e9a2dddd.png"
                        alt="Description"
                 ></p>
]]></content>
      <categories>
        <category>åŒºå—é“¾</category>
      </categories>
      <tags>
        <tag>åŒºå—é“¾</tag>
        <tag>XuperChain</tag>
      </tags>
  </entry>
  <entry>
    <title>fisco-bcos-consoleå‘½ä»¤æ³¨é‡Š</title>
    <url>/2023/05/22/%E5%8C%BA%E5%9D%97%E9%93%BE/fisco-bcos-console%E5%91%BD%E4%BB%A4%E6%B3%A8%E9%87%8A/</url>
    <content><![CDATA[<h3 id="fisco-bcos-consoleå‘½ä»¤å¤§å…¨"><a href="#fisco-bcos-consoleå‘½ä»¤å¤§å…¨" class="headerlink" title="fisco-bcos consoleå‘½ä»¤å¤§å…¨"></a>fisco-bcos consoleå‘½ä»¤å¤§å…¨</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">- `addObserver`: æ·»åŠ ä¸€ä¸ªè§‚å¯Ÿè€…èŠ‚ç‚¹</span><br><span class="line">- `addPeers`: æ·»åŠ æ›´å¤šè¿æ¥çš„èŠ‚ç‚¹P2Pç½‘ç»œä¸­çš„å¯¹ç­‰èŠ‚ç‚¹</span><br><span class="line">- `addSealer`: æ·»åŠ ä¸€ä¸ªå…±è¯†èŠ‚ç‚¹</span><br><span class="line">- `call`: è°ƒç”¨åˆçº¦çš„æŸä¸ªå‡½æ•°å’Œå‚æ•°</span><br><span class="line">- `callByCNS`: é€šè¿‡CNSè°ƒç”¨åˆçº¦çš„æŸä¸ªå‡½æ•°å’Œå‚æ•°</span><br><span class="line">- `chargeGas`: ä¸ºæŒ‡å®šè´¦æˆ·å……å€¼æŒ‡å®šçš„gasï¼ˆç‡ƒæ–™è´¹ç”¨ï¼‰</span><br><span class="line">- `create`: é€šè¿‡SQLåˆ›å»ºè¡¨æ ¼</span><br><span class="line">- `deductGas`: ä»ç»™å®šè´¦æˆ·æ‰£é™¤æŒ‡å®šçš„gasï¼ˆç‡ƒæ–™è´¹ç”¨ï¼‰</span><br><span class="line">- `delete`: é€šè¿‡SQLåˆ é™¤è®°å½•</span><br><span class="line">- `deploy`: åœ¨åŒºå—é“¾ä¸Šéƒ¨ç½²ä¸€ä¸ªåˆçº¦</span><br><span class="line">- `deployByCNS`: é€šè¿‡CNSåœ¨åŒºå—é“¾ä¸Šéƒ¨ç½²ä¸€ä¸ªåˆçº¦</span><br><span class="line">- `desc`: æè¿°è¡¨æ ¼ä¿¡æ¯</span><br><span class="line">- `erasePeers`: ç§»é™¤èŠ‚ç‚¹P2Pç½‘ç»œä¸­çš„å·²è¿æ¥å¯¹ç­‰èŠ‚ç‚¹</span><br><span class="line">- `quit([quit, q, <span class="built_in">exit</span>])`: é€€å‡ºæ§åˆ¶å°</span><br><span class="line">- `freezeAccount`: å†»ç»“è´¦æˆ·</span><br><span class="line">- `freezeContract`: å†»ç»“åˆçº¦</span><br><span class="line">- `generateGroup`: ä¸ºæŒ‡å®šèŠ‚ç‚¹ç”Ÿæˆä¸€ä¸ªç¾¤ç»„</span><br><span class="line">- `generateGroupFromFile`: æ ¹æ®æŒ‡å®šæ–‡ä»¶ç”Ÿæˆä¸€ä¸ªç¾¤ç»„</span><br><span class="line">- `getAccountStatus`: è·å–è´¦æˆ·çŠ¶æ€</span><br><span class="line">- `getAvailableConnections`: è·å–SDKè¿æ¥çš„èŠ‚ç‚¹ä¿¡æ¯</span><br><span class="line">- `getBatchReceiptsByBlockHashAndRange`: æ ¹æ®å—å“ˆå¸Œå’Œäº¤æ˜“èŒƒå›´è·å–æ‰¹é‡äº¤æ˜“æ”¶æ®</span><br><span class="line">- `getBatchReceiptsByBlockNumberAndRange`: æ ¹æ®å—å·å’Œäº¤æ˜“èŒƒå›´è·å–æ‰¹é‡äº¤æ˜“æ”¶æ®</span><br><span class="line">- `getBlockByHash`: æ ¹æ®å“ˆå¸ŒæŸ¥è¯¢å—ä¿¡æ¯</span><br><span class="line">- `getBlockByNumber`: æ ¹æ®å—å·æŸ¥è¯¢å—ä¿¡æ¯</span><br><span class="line">- `getBlockHashByNumber`: æ ¹æ®å—å·æŸ¥è¯¢å—å“ˆå¸Œ</span><br><span class="line">- `getBlockHeaderByHash`: æ ¹æ®å“ˆå¸ŒæŸ¥è¯¢å—å¤´ä¿¡æ¯</span><br><span class="line">- `getBlockHeaderByNumber`: æ ¹æ®å—å·æŸ¥è¯¢å—å¤´ä¿¡æ¯</span><br><span class="line">- `getBlockNumber`: æŸ¥è¯¢æœ€è¿‘å—çš„ç¼–å·</span><br><span class="line">- `getCode`: æŸ¥è¯¢ç»™å®šåœ°å€çš„åˆçº¦ä»£ç </span><br><span class="line">- `getConsensusStatus`: æŸ¥è¯¢å…±è¯†çŠ¶æ€</span><br><span class="line">- `getContractStatus`: è·å–åˆçº¦çŠ¶æ€</span><br><span class="line">- `getCryptoType`: è·å–å½“å‰çš„åŠ å¯†ç±»å‹</span><br><span class="line">- `getCurrentAccount`: è·å–å½“å‰è´¦æˆ·ä¿¡æ¯</span><br><span class="line">- `getDeployLog`: æŸ¥è¯¢å·²éƒ¨ç½²åˆçº¦çš„æ—¥å¿—</span><br><span class="line">- `getGroupConnections`: è·å–è¿æ¥åˆ°SDKçš„ç¾¤ç»„èŠ‚ç‚¹ä¿¡æ¯</span><br><span class="line">- `getGroupList`: æŸ¥è¯¢ç¾¤ç»„åˆ—è¡¨</span><br><span class="line">- `getGroupPeers`: æŸ¥è¯¢å…±è¯†èŠ‚ç‚¹å’Œè§‚å¯Ÿè€…èŠ‚ç‚¹çš„èŠ‚ç‚¹IDåˆ—è¡¨</span><br><span class="line">- `getNodeIDList`: æŸ¥è¯¢æ‰€æœ‰è¿æ¥èŠ‚ç‚¹çš„èŠ‚ç‚¹IDåˆ—è¡¨</span><br><span class="line">- `getNodeInfo`: æŸ¥è¯¢æŒ‡å®šèŠ‚ç‚¹çš„ä¿¡æ¯</span><br><span class="line">- `getNodeVersion`: æŸ¥è¯¢å½“å‰èŠ‚ç‚¹ç‰ˆæœ¬</span><br><span class="line">- `getObserverList`: æŸ¥è¯¢è§‚å¯Ÿè€…èŠ‚ç‚¹çš„èŠ‚ç‚¹IDåˆ—è¡¨</span><br><span class="line">- `getPbftView`: æŸ¥è¯¢èŠ‚ç‚¹çš„PBFTè§†å›¾</span><br><span class="line">- `getPeers`: æŸ¥è¯¢å½“å‰è¿æ¥çš„èŠ‚ç‚¹å¯¹ç­‰åˆ—è¡¨</span><br><span class="line">- `getPendingTransactions`: æŸ¥è¯¢å¾…å¤„ç†çš„äº¤æ˜“</span><br><span class="line">- `getPendingTxSize`: æŸ¥è¯¢å¾…å¤„ç†äº¤æ˜“çš„æ•°é‡</span><br><span class="line">- `getSealerList`: æŸ¥è¯¢å…±è¯†èŠ‚ç‚¹çš„èŠ‚ç‚¹IDåˆ—è¡¨</span><br><span class="line">- `getSyncStatus`: æŸ¥è¯¢åŒæ­¥çŠ¶æ€</span><br><span class="line">- `getSystemConfigByKey`: æ ¹æ®é”®æŸ¥è¯¢ç³»ç»Ÿé…ç½®å€¼</span><br><span class="line">- `getTotalTransactionCount`: æŸ¥è¯¢æ€»äº¤æ˜“æ•°</span><br><span class="line">- `getTransactionByBlockHashAndIndex`: æ ¹æ®å—å“ˆå¸Œå’Œäº¤æ˜“ç´¢å¼•ä½ç½®æŸ¥è¯¢äº¤æ˜“ä¿¡æ¯</span><br><span class="line">- `getTransactionByBlockNumberAndIndex`: æ ¹æ®å—å·å’Œäº¤æ˜“ç´¢å¼•ä½ç½®æŸ¥è¯¢äº¤æ˜“ä¿¡æ¯</span><br><span class="line">- `getTransactionByHash`: æ ¹æ®äº¤æ˜“å“ˆå¸ŒæŸ¥è¯¢äº¤æ˜“ä¿¡æ¯</span><br><span class="line">- `getTransactionByHashWithProof`: æ ¹æ®äº¤æ˜“å“ˆå¸ŒæŸ¥è¯¢äº¤æ˜“å’Œäº¤æ˜“è¯æ˜</span><br><span class="line">- `getTransactionReceipt`: æ ¹æ®äº¤æ˜“å“ˆå¸ŒæŸ¥è¯¢äº¤æ˜“æ”¶æ®</span><br><span class="line">- `getTransactionReceiptByHashWithProof`: æ ¹æ®äº¤æ˜“å“ˆå¸ŒæŸ¥è¯¢äº¤æ˜“æ”¶æ®å’Œäº¤æ˜“æ”¶æ®è¯æ˜</span><br><span class="line">- `grantCNSManager`: æˆäºˆåœ°å€å¯¹CNSçš„ç®¡ç†æƒé™</span><br><span class="line">- `grantCharger`: æˆäºˆè´¦æˆ·å……å€¼gasçš„æƒé™</span><br><span class="line">- `grantCommitteeMember`: æˆäºˆè´¦æˆ·æˆä¸ºå§”å‘˜ä¼šæˆå‘˜çš„æƒé™</span><br><span class="line">- `grantContractStatusManager`: æˆäºˆç”¨æˆ·å¯¹åˆçº¦çš„æˆæƒ</span><br><span class="line">- `grantContractWritePermission`: æˆäºˆè´¦æˆ·åˆçº¦å†™å…¥æƒé™</span><br><span class="line">- `grantDeployAndCreateManager`: æˆäºˆåœ°å€å¯¹éƒ¨ç½²åˆçº¦å’Œåˆ›å»ºç”¨æˆ·è¡¨çš„ç®¡ç†æƒé™</span><br><span class="line">- `grantNodeManager`: æˆäºˆåœ°å€å¯¹èŠ‚ç‚¹é…ç½®çš„ç®¡ç†æƒé™</span><br><span class="line">- `grantOperator`: æˆäºˆè´¦æˆ·è¿è¥è€…æƒé™</span><br><span class="line">- `grantSysConfigManager`: æˆäºˆåœ°å€å¯¹ç³»ç»Ÿé…ç½®çš„ç®¡ç†æƒé™</span><br><span class="line">- `grantUserTableManager`: æˆäºˆè¡¨åå’Œåœ°å€å¯¹ç”¨æˆ·è¡¨çš„ç®¡ç†æƒé™</span><br><span class="line">- `insert`: é€šè¿‡SQLæ’å…¥è®°å½•</span><br><span class="line">- `listAbi`: åˆ—å‡ºåˆçº¦çš„å‡½æ•°å’Œäº‹ä»¶ä¿¡æ¯</span><br><span class="line">- `listAccount`: åˆ—å‡ºå½“å‰ä¿å­˜çš„è´¦æˆ·åˆ—è¡¨</span><br><span class="line">- `listCNSManager`: æŸ¥è¯¢CNSçš„æƒé™ä¿¡æ¯</span><br><span class="line">- `listChargers`: åˆ—å‡ºå…·æœ‰å……å€¼/æ‰£é™¤gasæƒé™çš„è´¦æˆ·åˆ—è¡¨</span><br><span class="line">- `listCommitteeMembers`: åˆ—å‡ºæ‰€æœ‰å§”å‘˜ä¼šæˆå‘˜</span><br><span class="line">- `listContractStatusManager`: åˆ—å‡ºåˆçº¦çš„æˆæƒä¿¡æ¯</span><br><span class="line">- `listContractWritePermission`: æŸ¥è¯¢å…·æœ‰åˆçº¦å†™å…¥æƒé™çš„è´¦æˆ·åˆ—è¡¨</span><br><span class="line">- `listDeployAndCreateManager`: æŸ¥è¯¢éƒ¨ç½²åˆçº¦å’Œåˆ›å»ºç”¨æˆ·è¡¨çš„æƒé™ä¿¡æ¯</span><br><span class="line">- `listDeployContractAddress`: åˆ—å‡ºæŒ‡å®šåˆçº¦çš„åˆçº¦åœ°å€</span><br><span class="line">- `listNodeManager`: æŸ¥è¯¢èŠ‚ç‚¹é…ç½®çš„æƒé™ä¿¡æ¯</span><br><span class="line">- `listOperators`: åˆ—å‡ºæ‰€æœ‰è¿è¥è€…</span><br><span class="line">- `listSysConfigManager`: æŸ¥è¯¢ç³»ç»Ÿé…ç½®çš„æƒé™ä¿¡æ¯</span><br><span class="line">- `listUserTableManager`: æŸ¥è¯¢ç”¨æˆ·è¡¨çš„æƒé™ä¿¡æ¯</span><br><span class="line">- `loadAccount`: ä¸ºäº¤æ˜“ç­¾ååŠ è½½è´¦æˆ·</span><br><span class="line">- `newAccount`: åˆ›å»ºè´¦æˆ·</span><br><span class="line">- `queryCNS`: æ ¹æ®åˆçº¦åç§°å’Œç‰ˆæœ¬æŸ¥è¯¢CNSä¿¡æ¯</span><br><span class="line">- `queryCommitteeMemberWeight`: æŸ¥è¯¢å§”å‘˜ä¼šæˆå‘˜çš„æƒé‡</span><br><span class="line">- `queryGroupStatus`: æŸ¥è¯¢æŒ‡å®šèŠ‚ç‚¹çš„æŒ‡å®šç¾¤ç»„çŠ¶æ€</span><br><span class="line">- `queryPeers`: æŸ¥è¯¢é…ç½®çš„P2Pç½‘ç»œè¿æ¥èŠ‚ç‚¹åˆ—è¡¨</span><br><span class="line">- `queryRemainGas`: æŸ¥è¯¢è´¦æˆ·å‰©ä½™gasï¼ˆç‡ƒæ–™è´¹ç”¨ï¼‰</span><br><span class="line">- `query</span><br><span class="line"></span><br><span class="line">Threshold`: æŸ¥è¯¢é˜ˆå€¼</span><br><span class="line">- `queryVotesOfMember`: æŸ¥è¯¢å§”å‘˜ä¼šæˆå‘˜çš„æŠ•ç¥¨</span><br><span class="line">- `queryVotesOfThreshold`: æŸ¥è¯¢æ›´æ–°é˜ˆå€¼æ“ä½œçš„æŠ•ç¥¨</span><br><span class="line">- `recoverGroup`: æ¢å¤æŒ‡å®šèŠ‚ç‚¹çš„æŒ‡å®šç¾¤ç»„</span><br><span class="line">- `registerCNS`: ä¸ºç»™å®šåˆçº¦æ³¨å†ŒCNSä¿¡æ¯</span><br><span class="line">- `removeGroup`: ç§»é™¤æŒ‡å®šèŠ‚ç‚¹çš„æŒ‡å®šç¾¤ç»„</span><br><span class="line">- `removeNode`: ç§»é™¤ä¸€ä¸ªèŠ‚ç‚¹</span><br><span class="line">- `revokeCNSManager`: æ’¤é”€åœ°å€å¯¹CNSçš„ç®¡ç†æƒé™</span><br><span class="line">- `revokeCharger`: æ’¤é”€è´¦æˆ·çš„å……å€¼gasæƒé™</span><br><span class="line">- `revokeCommitteeMember`: æ’¤é”€è´¦æˆ·çš„å§”å‘˜ä¼šæˆå‘˜æƒé™</span><br><span class="line">- `revokeContractStatusManager`: æ’¤é”€ç”¨æˆ·å¯¹åˆçº¦çš„æˆæƒ</span><br><span class="line">- `revokeContractWritePermission`: æ’¤é”€è´¦æˆ·çš„åˆçº¦å†™å…¥æƒé™</span><br><span class="line">- `revokeDeployAndCreateManager`: æ’¤é”€åœ°å€å¯¹éƒ¨ç½²åˆçº¦å’Œåˆ›å»ºç”¨æˆ·è¡¨çš„ç®¡ç†æƒé™</span><br><span class="line">- `revokeNodeManager`: æ’¤é”€åœ°å€å¯¹èŠ‚ç‚¹é…ç½®çš„ç®¡ç†æƒé™</span><br><span class="line">- `revokeOperator`: æ’¤é”€è´¦æˆ·çš„è¿è¥è€…æƒé™</span><br><span class="line">- `revokeSysConfigManager`: æ’¤é”€åœ°å€å¯¹ç³»ç»Ÿé…ç½®çš„ç®¡ç†æƒé™</span><br><span class="line">- `revokeUserTableManager`: æ’¤é”€è¡¨åå’Œåœ°å€å¯¹ç”¨æˆ·è¡¨çš„ç®¡ç†æƒé™</span><br><span class="line">- `switch([s])`: åˆ‡æ¢åˆ°æŒ‡å®šçš„ç¾¤ç»„é€šè¿‡ç¾¤ç»„ID</span><br><span class="line">- `<span class="keyword">select</span>`: é€šè¿‡SQLæŸ¥è¯¢è®°å½•</span><br><span class="line">- `setSystemConfigByKey`: æ ¹æ®é”®è®¾ç½®ç³»ç»Ÿé…ç½®å€¼</span><br><span class="line">- `startGroup`: å¯åŠ¨æŒ‡å®šèŠ‚ç‚¹çš„æŒ‡å®šç¾¤ç»„</span><br><span class="line">- `stopGroup`: åœæ­¢æŒ‡å®šèŠ‚ç‚¹çš„æŒ‡å®šç¾¤ç»„</span><br><span class="line">- `unfreezeAccount`: è§£å†»è´¦æˆ·</span><br><span class="line">- `unfreezeContract`: è§£å†»åˆçº¦</span><br><span class="line">- `update`: é€šè¿‡SQLæ›´æ–°è®°å½•</span><br><span class="line">- `updateCommitteeMemberWeight`: æ›´æ–°å§”å‘˜ä¼šæˆå‘˜çš„æƒé‡</span><br><span class="line">- `updateThreshold`: æ›´æ–°é˜ˆå€¼</span><br></pre></td></tr></table></figure>

<p><a class="link"   href="https://fisco-bcos-documentation.readthedocs.io/zh_CN/latest/docs/manual/permission_control.html" >è´¦æˆ·æƒé™æ§åˆ¶<i class="fas fa-external-link-alt"></i></a></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">grantCommitteeMember 0xf7085ff39210d2fcd8f30a3255016e1fa52aa896 ;å¢åŠ å§”å‘˜</span><br><span class="line">listCommitteeMembers ;æŸ¥çœ‹æ‰€æœ‰å§”å‘˜ä¿¡æ¯</span><br></pre></td></tr></table></figure>
<h4 id="åŠ å…¥ç¾¤ç»„"><a href="#åŠ å…¥ç¾¤ç»„" class="headerlink" title="åŠ å…¥ç¾¤ç»„"></a>åŠ å…¥ç¾¤ç»„</h4><ul>
<li>è®¾ç½®è§‚å¯Ÿè€…<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[group:1]&gt; addObserver 63de0af9d1612b7765e0e1923de5ed35a6048238ffe6531519efb4286905bd5cf2d77e5e46cc80e572ba70144c431503ae79efa81b2bed25c02056960dd61688</span><br><span class="line">&#123;</span><br><span class="line">    <span class="string">&quot;code&quot;</span>:1,</span><br><span class="line">    <span class="string">&quot;msg&quot;</span>:<span class="string">&quot;Success&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li>è·å–è§‚å¯Ÿè€…åˆ—è¡¨<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[group:1]&gt; getObserverList </span><br><span class="line">[</span><br><span class="line">    63de0af9d1612b7765e0e1923de5ed35a6048238ffe6531519efb4286905bd5cf2d77e5e46cc80e572ba70144c431503ae79efa81b2bed25c02056960dd61688</span><br><span class="line">]</span><br></pre></td></tr></table></figure></li>
<li>ä½¿ç”¨addSealerå°†node4ä½œä¸ºå…±è¯†èŠ‚ç‚¹åŠ å…¥ç¾¤ç»„1<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">addSealer 63de0af9d1612b7765e0e1923de5ed35a6048238ffe6531519efb4286905bd5cf2d77e5e46cc80e572ba70144c431503ae79efa81b2bed25c02056960dd61688</span><br></pre></td></tr></table></figure></li>
</ul>
]]></content>
      <categories>
        <category>åŒºå—é“¾</category>
      </categories>
      <tags>
        <tag>åŒºå—é“¾</tag>
        <tag>fisco-bcos</tag>
      </tags>
  </entry>
  <entry>
    <title>Cè¯­è¨€ç†è®ºé€Ÿè®°</title>
    <url>/2025/03/16/%E5%AF%BC%E8%AE%BA/C%E8%AF%AD%E8%A8%80%E7%90%86%E8%AE%BA%E9%80%9F%E8%AE%B0/</url>
    <content><![CDATA[<h2 id="å˜é‡å®šä¹‰"><a href="#å˜é‡å®šä¹‰" class="headerlink" title="å˜é‡å®šä¹‰"></a>å˜é‡å®šä¹‰</h2><figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="comment">// e æˆ– Eä¹‹å‰å¿…é¡»æœ‰æ•°å­—ï¼Œä¹‹åå¿…é¡»ä½æ•´å‹</span></span><br><span class="line"><span class="type">double</span> a = <span class="number">1.5e11</span>;</span><br><span class="line"><span class="type">double</span> b = <span class="number">1.5E11</span>;</span><br></pre></td></tr></table></figure>
<h2 id="è½¬ä¹‰å­—ç¬¦"><a href="#è½¬ä¹‰å­—ç¬¦" class="headerlink" title="è½¬ä¹‰å­—ç¬¦"></a>è½¬ä¹‰å­—ç¬¦</h2><figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="string">&#x27;\x01&#x27;</span> <span class="comment">// \x ä¹‹ååªèƒ½è·Ÿéš1~2ä½åå…­è¿›åˆ¶æ•°</span></span><br><span class="line"><span class="string">&#x27;\0&#x27;</span> <span class="comment">// è¡¨ç¤ºå­—ç¬¦ä¸²ç»“æŸ</span></span><br></pre></td></tr></table></figure>

<h2 id="æ ¼å¼åŒ–å­—ç¬¦"><a href="#æ ¼å¼åŒ–å­—ç¬¦" class="headerlink" title="æ ¼å¼åŒ–å­—ç¬¦"></a>æ ¼å¼åŒ–å­—ç¬¦</h2><figure class="highlight text"><table><tr><td class="code"><pre><span class="line">%d â€” åè¿›åˆ¶æ•´æ•°ï¼ˆæœ‰ç¬¦å·ï¼‰</span><br><span class="line">%i â€” åè¿›åˆ¶æ•´æ•°ï¼ˆæœ‰ç¬¦å·ï¼‰</span><br><span class="line">%f - æµ®ç‚¹æ•°é»˜è®¤æ ¼å¼ï¼Œè¾“å‡ºæ—¶å°æ•°ç‚¹åæœ‰6ä½å°æ•°ã€‚</span><br><span class="line">%e â€” æŒ‡æ•°è¡¨ç¤ºï¼ˆå°å†™ï¼‰</span><br><span class="line">%E â€” æŒ‡æ•°è¡¨ç¤ºï¼ˆå¤§å†™ï¼‰</span><br><span class="line">%g â€” è‡ªåŠ¨é€‰æ‹© %f æˆ– %eï¼ˆå°å†™ï¼‰</span><br><span class="line">%G â€” è‡ªåŠ¨é€‰æ‹© %f æˆ– %Eï¼ˆå¤§å†™ï¼‰</span><br><span class="line">%c â€” å­—ç¬¦</span><br><span class="line">%s â€” å­—ç¬¦ä¸²</span><br><span class="line">%p â€” æŒ‡é’ˆåœ°å€</span><br><span class="line">%x â€” åå…­è¿›åˆ¶æ•´æ•°ï¼ˆå°å†™ï¼‰</span><br><span class="line">%X â€” åå…­è¿›åˆ¶æ•´æ•°ï¼ˆå¤§å†™ï¼‰</span><br><span class="line">%o â€” å…«è¿›åˆ¶æ•´æ•°</span><br><span class="line">%% â€” è¾“å‡ºç™¾åˆ†å·å­—ç¬¦ %</span><br><span class="line">%u â€” æ— ç¬¦å·åè¿›åˆ¶æ•´æ•°</span><br><span class="line">%lu â€” æ— ç¬¦å·é•¿æ•´æ•°ï¼ˆunsigned longï¼‰</span><br><span class="line">%llu â€” æ— ç¬¦å·é•¿é•¿æ•´æ•°ï¼ˆunsigned long longï¼‰</span><br><span class="line">%ld â€” é•¿æ•´æ•°ï¼ˆlong intï¼‰</span><br><span class="line">%lld â€” é•¿é•¿æ•´æ•°ï¼ˆlong long intï¼‰</span><br><span class="line">%zu â€” æ— ç¬¦å·å¤§å°ç±»å‹ï¼ˆsize_tï¼‰</span><br><span class="line">%h â€” çŸ­æ•´æ•°ï¼ˆshort æˆ– unsigned shortï¼‰</span><br><span class="line">%hh â€” éå¸¸çŸ­æ•´æ•°ï¼ˆsigned char æˆ– unsigned charï¼‰</span><br><span class="line">%L â€” é•¿åŒç²¾åº¦æµ®ç‚¹æ•°ï¼ˆlong doubleï¼‰</span><br><span class="line">%n â€” è¾“å‡ºåˆ°æŒ‡å®šå˜é‡ä¸­å·²æ‰“å°å­—ç¬¦çš„ä¸ªæ•°</span><br><span class="line">%.*f - æŒ‡å®šå°æ•°ç‚¹åçš„ä½æ•°ï¼Œ* å¯ä»¥æ˜¯ä»»æ„æ•´æ•°ã€‚</span><br><span class="line">%.*e æˆ– %.*Eï¼šæŒ‡å®šç§‘å­¦è®¡æ•°æ³•ä¸­å°æ•°ç‚¹åçš„ä½æ•°ã€‚</span><br><span class="line">%.*g æˆ– %.*Gï¼šæŒ‡å®šè‡ªåŠ¨é€‰æ‹©æ ¼å¼ä¸­å°æ•°ç‚¹åçš„ä½æ•°ã€‚</span><br><span class="line">%f ä¹Ÿå¯ä»¥ä¸å®½åº¦å’Œç²¾åº¦ä¸€èµ·ä½¿ç”¨ï¼Œä¾‹å¦‚ %10.2f è¡¨ç¤ºæ€»å…±å 10ä¸ªå­—ç¬¦å®½åº¦ï¼Œå°æ•°ç‚¹åä¿ç•™2ä½å°æ•°ã€‚</span><br></pre></td></tr></table></figure>

<h2 id="è´Ÿæ•°å–æ¨¡"><a href="#è´Ÿæ•°å–æ¨¡" class="headerlink" title="è´Ÿæ•°å–æ¨¡"></a>è´Ÿæ•°å–æ¨¡</h2><p><a class="link"   href="https://blog.csdn.net/zhige_me/article/details/80980566" >å‚è€ƒé“¾æ¥<i class="fas fa-external-link-alt"></i></a></p>
<figure class="highlight text"><table><tr><td class="code"><pre><span class="line">a = nq + r  |r| &lt; |a|</span><br><span class="line">å‡è®¾ q æ˜¯ aã€b ç›¸é™¤å¾—åˆ°çš„å•†(quotient)ï¼Œr æ˜¯ç›¸åº”çš„ä½™æ•°(remainder)</span><br><span class="line">æˆ‘ä»¬çŸ¥é“å•† q = a/nï¼Œä»è€Œå¾—å‡º</span><br><span class="line">r = a - (a/n) * n</span><br><span class="line">è€Œ (a/n) è¿™ä¸ªç»“æœå–å†³äºä¸Šé¢å‡ ç§æ–¹å¼ç”¨å“ªä¸ª</span><br></pre></td></tr></table></figure>
<p>ç¤ºåˆ—ï¼š</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="number">-7</span> % <span class="number">3</span> = <span class="number">-1</span></span><br><span class="line"><span class="number">7</span> % (<span class="number">-3</span>) = <span class="number">1</span> </span><br><span class="line"><span class="comment">// ä¸‹é¢æ˜¯æ¨å€’è¿‡ç¨‹</span></span><br><span class="line"><span class="number">-7</span> % <span class="number">3</span> = <span class="number">-7</span> - trunc(<span class="number">-7</span>/<span class="number">3</span>) * <span class="number">3</span> = <span class="number">-7</span> - (<span class="number">-2</span>) * <span class="number">3</span> = <span class="number">-7</span> + <span class="number">6</span> = <span class="number">-1</span></span><br><span class="line"><span class="number">7</span> % (<span class="number">-3</span>) = <span class="number">7</span> - trunc(<span class="number">7</span> / (<span class="number">-3</span>)) * (<span class="number">-3</span>) = <span class="number">7</span> - (<span class="number">-2</span>) * (<span class="number">-3</span>) = <span class="number">7</span> - <span class="number">6</span> = <span class="number">1</span></span><br></pre></td></tr></table></figure>
<h2 id="è¿ç®—ç¬¦"><a href="#è¿ç®—ç¬¦" class="headerlink" title="è¿ç®—ç¬¦"></a>è¿ç®—ç¬¦</h2><blockquote>
<p>Cè¯­è¨€ä¸­çš„è¿ç®—ç¬¦ä¼˜å…ˆçº§å†³å®šäº†è¡¨è¾¾å¼ä¸­è¿ç®—çš„é¡ºåºã€‚ä»¥ä¸‹æ˜¯Cè¯­è¨€ä¸­è¿ç®—ç¬¦çš„ä¼˜å…ˆçº§åˆ—è¡¨ï¼Œä»æœ€é«˜åˆ°æœ€ä½ï¼š</p>
</blockquote>
<blockquote>
<p>ï¼ &gt; ç®—æœ¯è¿ç®—ç¬¦ &gt; å…³ç³»è¿ç®—ç¬¦ &gt; &amp;&amp; &gt; || &gt; èµ‹å€¼è¿ç®—ç¬¦</p>
</blockquote>
<blockquote>
<p>åç¼€è¿ç®—ç¬¦ã€ä¸€å…ƒè¿ç®—ç¬¦ã€ä¹˜é™¤å’Œå–æ¨¡ã€åŠ å‡ã€ä½ç§»ã€å…³ç³»ã€ç›¸ç­‰æ€§ã€ä½è¿ç®—ã€é€»è¾‘è¿ç®—ã€æ¡ä»¶è¿ç®—ç¬¦ã€èµ‹å€¼è¿ç®—ç¬¦ã€é€—å·è¿ç®—ç¬¦ã€‚</p>
</blockquote>
<ol>
<li><p><strong>åç¼€è¿ç®—ç¬¦</strong></p>
<ul>
<li><code>() å‡½æ•°è°ƒç”¨</code></li>
<li><code>[] æ•°ç»„ä¸‹æ ‡</code></li>
<li><code>-&gt; æŒ‡å‘ç»“æ„ä½“æˆå‘˜</code></li>
<li><code>. ç»“æ„ä½“æˆå‘˜è®¿é—®</code></li>
<li><code>++ åç½®å¢é‡</code></li>
<li><code>-- åç½®å‡é‡</code></li>
</ul>
</li>
<li><p><strong>ä¸€å…ƒè¿ç®—ç¬¦</strong></p>
<ul>
<li><code>++ å‰ç½®å¢é‡</code></li>
<li><code>-- å‰ç½®å‡é‡</code></li>
<li><code>+ æ­£å·</code></li>
<li><code>- è´Ÿå·</code></li>
<li><code>! é€»è¾‘é</code></li>
<li><code>~ æŒ‰ä½å–å</code></li>
<li><code>* æŒ‡é’ˆè§£å¼•ç”¨</code></li>
<li><code>&amp; å–åœ°å€</code></li>
<li><code>sizeof è®¡ç®—å¤§å°</code></li>
<li><code>typeid ç±»å‹è¯†åˆ«</code>ï¼ˆC++ç‰¹æœ‰ï¼‰</li>
<li><code>cast å¼ºåˆ¶ç±»å‹è½¬æ¢</code>ï¼ˆC++ç‰¹æœ‰ï¼‰</li>
</ul>
</li>
<li><p><strong>ä¹˜æ³•å’Œé™¤æ³•</strong></p>
<ul>
<li><code>* ä¹˜æ³•</code></li>
<li><code>/ é™¤æ³•</code></li>
<li><code>% å–æ¨¡ï¼ˆæ±‚ä½™ï¼‰</code></li>
</ul>
</li>
<li><p><strong>åŠ æ³•å’Œå‡æ³•</strong></p>
<ul>
<li><code>+ åŠ æ³•</code></li>
<li><code>- å‡æ³•</code></li>
</ul>
</li>
<li><p><strong>ä½ç§»è¿ç®—ç¬¦</strong></p>
<ul>
<li><code>&lt;&lt; å·¦ç§»</code></li>
<li><code>&gt;&gt; å³ç§»</code></li>
</ul>
</li>
<li><p><strong>å…³ç³»è¿ç®—ç¬¦</strong></p>
<ul>
<li><code>&lt; å°äº</code></li>
<li><code>&gt; å¤§äº</code></li>
<li><code>&lt;= å°äºç­‰äº</code></li>
<li><code>&gt;= å¤§äºç­‰äº</code></li>
</ul>
</li>
<li><p><strong>ç›¸ç­‰æ€§è¿ç®—ç¬¦</strong></p>
<ul>
<li><code>== ç­‰äº</code></li>
<li><code>!= ä¸ç­‰äº</code></li>
</ul>
</li>
<li><p><strong>ä½è¿ç®—ç¬¦</strong></p>
<ul>
<li><code>&amp; æŒ‰ä½ä¸</code></li>
<li><code>^ æŒ‰ä½å¼‚æˆ–</code></li>
<li><code>| æŒ‰ä½æˆ–</code></li>
</ul>
</li>
<li><p><strong>é€»è¾‘è¿ç®—ç¬¦</strong></p>
<ul>
<li><code>&amp;&amp; é€»è¾‘ä¸</code></li>
<li><code>|| é€»è¾‘æˆ–</code></li>
</ul>
</li>
<li><p><strong>æ¡ä»¶è¿ç®—ç¬¦ï¼ˆä¸‰å…ƒè¿ç®—ç¬¦ï¼‰</strong></p>
<ul>
<li><code>? : æ¡ä»¶è¡¨è¾¾å¼</code></li>
</ul>
</li>
<li><p><strong>èµ‹å€¼è¿ç®—ç¬¦</strong></p>
<ul>
<li><code>=</code></li>
<li><code>+=</code></li>
<li><code>-=</code></li>
<li><code>*=</code></li>
<li><code>/=</code></li>
<li><code>%=</code></li>
<li><code>&lt;&lt;=</code></li>
<li><code>&gt;&gt;=</code></li>
<li><code>&amp;=</code></li>
<li><code>^=</code></li>
<li><code>|=</code></li>
</ul>
</li>
<li><p><strong>é€—å·è¿ç®—ç¬¦</strong></p>
<ul>
<li><code>, é€—å·åˆ†éš”è¡¨è¾¾å¼</code></li>
</ul>
</li>
</ol>
]]></content>
      <categories>
        <category>å¯¼è®º</category>
      </categories>
      <tags>
        <tag>C</tag>
      </tags>
  </entry>
  <entry>
    <title>è®¡ç®—æœºç†è®º</title>
    <url>/2024/12/22/%E5%AF%BC%E8%AE%BA/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%90%86%E8%AE%BA/</url>
    <content><![CDATA[<h2 id="1-è®¡ç®—å…¬å¼"><a href="#1-è®¡ç®—å…¬å¼" class="headerlink" title="1. è®¡ç®—å…¬å¼"></a>1. è®¡ç®—å…¬å¼</h2><p><strong>è®¡ç®—æœºç¡¬ä»¶</strong></p>
<figure class="highlight txt"><table><tr><td class="code"><pre><span class="line">æ€»çº¿å¸¦å®½ = æ€»çº¿å·¥ä½œé¢‘ç‡ * æ€»çº¿ä½å®½ * ä¼ è¾“æ¬¡æ•°/ 8</span><br><span class="line"></span><br><span class="line">å­˜å‚¨å®¹é‡ = æœ«å°¾åœ°å€ - èµ·å§‹åœ°å€ + 1ï¼ˆå•ä½ä¸ºBï¼‰</span><br></pre></td></tr></table></figure>
<p><strong>è®¡ç®—æœºç½‘ç»œ</strong></p>
<figure class="highlight txt"><table><tr><td class="code"><pre><span class="line">&lt;!-- æ—¶å»¶ --&gt;</span><br><span class="line"></span><br><span class="line">å‘é€æ—¶å»¶ = æ•°æ®å¸§é•¿åº¦(bit) / æ•°æ®ä¼ è¾“é€Ÿç‡(bit/s)</span><br><span class="line"></span><br><span class="line">ä¼ æ’­æ—¶å»¶ = ä¿¡é“é•¿åº¦(m) / ç”µç£æ³¢åœ¨ä¿¡é“ä¸Šçš„ä¼ æ’­é€Ÿç‡(m/s)</span><br><span class="line"></span><br><span class="line">æ€»æ—¶å»¶ = å‘é€æ—¶å»¶ + ä¼ æ’­æ—¶å»¶</span><br></pre></td></tr></table></figure>
<p><strong>å¤šåª’ä½“æŠ€æœ¯</strong></p>
<figure class="highlight txt"><table><tr><td class="code"><pre><span class="line">&lt;!-- å­—å½¢ç  --&gt;</span><br><span class="line">ç‚¹é˜µå­—å½¢ç æ‰€å å­—èŠ‚æ•° = (ç‚¹é˜µå­—å½¢ç çš„è¡Œæ•° * ç‚¹é˜µå­—å½¢ç çš„åˆ—æ•°) / 8</span><br><span class="line"></span><br><span class="line">&lt;!-- æ±‰å­—å›½æ ‡ç  --&gt;</span><br><span class="line">å›½æ ‡ç  = æ±‰å­—åŒºä½ç  + 20 20H</span><br><span class="line"></span><br><span class="line">&lt;!-- æ±‰å­—æœºå†…ç  --&gt;</span><br><span class="line">æ±‰å­—æœºå†…ç  = æ±‰å­—å›½æ ‡ç  + 80 80H = æ±‰å­—åŒºä½ç  + A0 A0H</span><br><span class="line"></span><br><span class="line">&lt;!-- å›¾åƒ --&gt;</span><br><span class="line">å›¾åƒæ‰€å å­—èŠ‚æ•° = å›¾åƒåˆ†è¾¨ç‡ * é¢œè‰²æ·±åº¦ / 8</span><br><span class="line"></span><br><span class="line">&lt;!-- å£°éŸ³ è®¡ç®—æ¯ç§’é’Ÿå£°éŸ³æ•°æ®é‡çš„å…¬å¼ --&gt;</span><br><span class="line">æ¯ç§’æ•°æ®é‡(B) = é‡‡æ ·é¢‘ç‡(Hz) * é‡åŒ–ä½æ•°(bit)/8 * å£°é“æ•°</span><br><span class="line"></span><br><span class="line">&lt;!-- æ¨¡æ‹Ÿæ³¢å½¢å£°éŸ³æ•°å­—åŒ–åéŸ³é¢‘æ–‡ä»¶å­˜å‚¨æ•°æ®é‡å…¬å¼ --&gt;</span><br><span class="line">å­˜å‚¨æ•°æ®é‡ = é‡‡æ ·é¢‘ç‡(Hz) * é‡åŒ–ç²¾åº¦/8 * å£°é“æ•° * æ—¶é—´(s)</span><br><span class="line"></span><br><span class="line">&lt;!-- æ¯”ç‰¹ç‡ åŸºæœ¬è®¡ç®—å…¬å¼ --&gt;</span><br><span class="line">æ¯”ç‰¹ç‡(kbps) = æ–‡ä»¶å¤§å°(å­—èŠ‚) * 8 / æ—¶é—´(s) / 1000</span><br><span class="line"></span><br><span class="line">&lt;!-- éŸ³é¢‘æ–‡ä»¶ä¸“ç”¨è®¡ç®—æ–¹æ³• --&gt;</span><br><span class="line">æ¯”ç‰¹ç‡(kbps) = é‡‡æ ·é¢‘ç‡(kHz) * é‡åŒ–ä½æ•°(bit) * å£°é“æ•°</span><br><span class="line"></span><br><span class="line">&lt;!-- è§†é¢‘ æ•°æ®é‡è®¡ç®—å…¬å¼ --&gt;</span><br><span class="line">è§†é¢‘æ–‡ä»¶æ•°æ®é‡ = å¸§é¢‘ * æ¯å¹…å›¾åƒæ•°æ®é‡ * æ—¶é—´ = åˆ†è¾¨ç‡ * é¢œè‰²æ·±åº¦ * å¸§æ•° * æ—¶é—´/8</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>å¯¼è®º</category>
      </categories>
      <tags>
        <tag>è®¡ç®—æœºç†è®º</tag>
      </tags>
  </entry>
  <entry>
    <title>è®¡ç®—æœºç»„æˆåŸç†</title>
    <url>/2025/03/16/%E5%AF%BC%E8%AE%BA/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BB%84%E6%88%90%E5%8E%9F%E7%90%86/</url>
    <content><![CDATA[<p>å¾®æœºå·¥ä½œè¿‡ç¨‹ï¼ˆå¦‚æ‰§è¡ŒæŒ‡ä»¤çš„æµç¨‹ï¼‰ä¸»è¦å±äº <strong>â€œè®¡ç®—æœºç»„æˆåŸç†â€</strong> è¿™ä¸€çŸ¥è¯†ä½“ç³»ï¼Œå…·ä½“æ¶‰åŠä»¥ä¸‹ç»†åˆ†çŸ¥è¯†ç‚¹ï¼š  </p>
<ol>
<li><strong>CPU å·¥ä½œæœºåˆ¶</strong>ï¼šåŒ…æ‹¬ CPU å¦‚ä½•é€šè¿‡å–æŒ‡ä»¤ã€è¯‘ç ã€æ‰§è¡ŒæŒ‡ä»¤çš„å¾ªç¯å®Œæˆä»»åŠ¡ï¼Œå±äº CPU å†…éƒ¨é€»è¾‘ä¸åŠŸèƒ½çš„æ ¸å¿ƒå†…å®¹ã€‚  </li>
<li><strong>æŒ‡ä»¤ç³»ç»Ÿ</strong>ï¼šç ”ç©¶æŒ‡ä»¤çš„æ ¼å¼ã€ç±»å‹ï¼ˆå¦‚ç®—æœ¯è¿ç®—æŒ‡ä»¤ã€é€»è¾‘æŒ‡ä»¤ç­‰ï¼‰ï¼Œä»¥åŠæŒ‡ä»¤åœ¨å†…å­˜å’Œ CPU é—´çš„äº¤äº’è¿‡ç¨‹ã€‚  </li>
<li><strong>è®¡ç®—æœºå·¥ä½œæµç¨‹</strong>ï¼šåœ¨è®¡ç®—æœºåŸºç¡€æˆ–è®¡ç®—æœºç³»ç»Ÿæ¦‚è®ºä¸­ï¼Œä¹Ÿä¼šä»å®è§‚è§’åº¦è®²è§£å¾®æœºâ€œè¾“å…¥â†’å¤„ç†â†’è¾“å‡ºâ€çš„å·¥ä½œæµç¨‹ï¼Œå…¶ä¸­æŒ‡ä»¤æ‰§è¡Œæ˜¯å¤„ç†é˜¶æ®µçš„æ ¸å¿ƒã€‚  </li>
<li><strong>å­˜å‚¨ç³»ç»Ÿä¸æ€»çº¿</strong>ï¼šæ¶‰åŠå†…å­˜ä¸ CPU é€šè¿‡æ€»çº¿äº¤æ¢æŒ‡ä»¤å’Œæ•°æ®çš„æœºåˆ¶ï¼Œå±äºè®¡ç®—æœºç¡¬ä»¶æ¶æ„çš„å…³é”®çŸ¥è¯†ã€‚</li>
</ol>
]]></content>
      <categories>
        <category>å¯¼è®º</category>
      </categories>
      <tags>
        <tag>è®¡ç®—æœºç†è®º</tag>
      </tags>
  </entry>
  <entry>
    <title>è®¡ç®—æœºç½‘ç»œ</title>
    <url>/2025/01/24/%E5%AF%BC%E8%AE%BA/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/</url>
    <content><![CDATA[<h2 id="ä¸€-æ— çº¿å±€åŸŸç½‘"><a href="#ä¸€-æ— çº¿å±€åŸŸç½‘" class="headerlink" title="ä¸€.æ— çº¿å±€åŸŸç½‘"></a>ä¸€.æ— çº¿å±€åŸŸç½‘</h2><h3 id="1-802-11-æ ‡å‡†çš„åŸºæœ¬æ¦‚å¿µ"><a href="#1-802-11-æ ‡å‡†çš„åŸºæœ¬æ¦‚å¿µ" class="headerlink" title="1. 802.11 æ ‡å‡†çš„åŸºæœ¬æ¦‚å¿µ"></a>1. <strong>802.11 æ ‡å‡†çš„åŸºæœ¬æ¦‚å¿µ</strong></h3><ul>
<li>802.11 æ˜¯ IEEE åˆ¶å®šçš„æ— çº¿å±€åŸŸç½‘ï¼ˆWLANï¼‰æ ‡å‡†ã€‚</li>
<li>ä¸»è¦ç”¨é€”ï¼šå®ç°æ— çº¿ç½‘ç»œé€šä¿¡ã€‚</li>
<li>å¸¸è§çš„ 802.11 æ ‡å‡†ï¼š802.11aã€802.11bã€802.11gã€802.11nã€802.11acã€802.11axï¼ˆWi-Fi 6ï¼‰ç­‰ã€‚</li>
</ul>
<hr>
<h3 id="2-å¸¸è§-802-11-æ ‡å‡†çš„ç‰¹ç‚¹"><a href="#2-å¸¸è§-802-11-æ ‡å‡†çš„ç‰¹ç‚¹" class="headerlink" title="2. å¸¸è§ 802.11 æ ‡å‡†çš„ç‰¹ç‚¹"></a>2. <strong>å¸¸è§ 802.11 æ ‡å‡†çš„ç‰¹ç‚¹</strong></h3><table>
<thead>
<tr>
<th>æ ‡å‡†</th>
<th>é¢‘ç‡</th>
<th>æœ€å¤§é€Ÿç‡</th>
<th>ç‰¹ç‚¹</th>
</tr>
</thead>
<tbody><tr>
<td><strong>802.11a</strong></td>
<td>5 GHz</td>
<td>54 Mbps</td>
<td>æŠ—å¹²æ‰°èƒ½åŠ›å¼ºï¼Œä½†è¦†ç›–èŒƒå›´è¾ƒå°ã€‚</td>
</tr>
<tr>
<td><strong>802.11b</strong></td>
<td>2.4 GHz</td>
<td>11 Mbps</td>
<td>è¦†ç›–èŒƒå›´è¾ƒå¤§ï¼Œä½†å®¹æ˜“å—åˆ°å¹²æ‰°ã€‚</td>
</tr>
<tr>
<td><strong>802.11g</strong></td>
<td>2.4 GHz</td>
<td>54 Mbps</td>
<td>å…¼å®¹ 802.11bï¼Œé€Ÿç‡æ›´é«˜ã€‚</td>
</tr>
<tr>
<td><strong>802.11n</strong></td>
<td>2.4 GHz å’Œ 5 GHz</td>
<td>600 Mbps</td>
<td>å¼•å…¥ MIMOï¼ˆå¤šè¾“å…¥å¤šè¾“å‡ºï¼‰æŠ€æœ¯ï¼Œé€Ÿç‡å’Œè¦†ç›–èŒƒå›´æ˜¾è‘—æå‡ã€‚</td>
</tr>
<tr>
<td><strong>802.11ac</strong></td>
<td>5 GHz</td>
<td>1.3 Gbps</td>
<td>æ”¯æŒæ›´å®½çš„é¢‘é“ï¼ˆ80 MHz å’Œ 160 MHzï¼‰ï¼Œé€Ÿç‡æ›´é«˜ã€‚</td>
</tr>
<tr>
<td><strong>802.11axï¼ˆWi-Fi 6ï¼‰</strong></td>
<td>2.4 GHz å’Œ 5 GHz</td>
<td>10 Gbps</td>
<td>å¼•å…¥ OFDMA å’Œ MU-MIMOï¼Œæé«˜ç½‘ç»œæ•ˆç‡å’Œå®¹é‡ã€‚</td>
</tr>
</tbody></table>
<hr>
<h3 id="3-802-11-çš„å…³é”®æŠ€æœ¯"><a href="#3-802-11-çš„å…³é”®æŠ€æœ¯" class="headerlink" title="3. 802.11 çš„å…³é”®æŠ€æœ¯"></a>3. <strong>802.11 çš„å…³é”®æŠ€æœ¯</strong></h3><ul>
<li><strong>MIMOï¼ˆå¤šè¾“å…¥å¤šè¾“å‡ºï¼‰</strong>ï¼šé€šè¿‡å¤šå¤©çº¿æŠ€æœ¯æé«˜ä¼ è¾“é€Ÿç‡å’Œå¯é æ€§ã€‚</li>
<li><strong>OFDMï¼ˆæ­£äº¤é¢‘åˆ†å¤ç”¨ï¼‰</strong>ï¼šå°†ä¿¡å·åˆ†æˆå¤šä¸ªå­è½½æ³¢ä¼ è¾“ï¼Œæé«˜æŠ—å¹²æ‰°èƒ½åŠ›ã€‚</li>
<li><strong>CSMA&#x2F;CAï¼ˆè½½æ³¢ä¾¦å¬å¤šè·¯è®¿é—®&#x2F;å†²çªé¿å…ï¼‰</strong>ï¼š802.11 ä½¿ç”¨çš„ä»‹è´¨è®¿é—®æ§åˆ¶åè®®ï¼Œç”¨äºé¿å…æ•°æ®å†²çªã€‚</li>
<li><strong>é¢‘æ®µ</strong>ï¼š2.4 GHz å’Œ 5 GHz çš„åŒºåˆ«ï¼ˆ2.4 GHz è¦†ç›–èŒƒå›´å¤§ä½†å¹²æ‰°å¤šï¼Œ5 GHz é€Ÿç‡é«˜ä½†è¦†ç›–èŒƒå›´å°ï¼‰ã€‚</li>
</ul>
<hr>
<h3 id="4-802-11-çš„åº”ç”¨åœºæ™¯"><a href="#4-802-11-çš„åº”ç”¨åœºæ™¯" class="headerlink" title="4. 802.11 çš„åº”ç”¨åœºæ™¯"></a>4. <strong>802.11 çš„åº”ç”¨åœºæ™¯</strong></h3><ul>
<li>å®¶åº­æ— çº¿ç½‘ç»œï¼ˆWi-Fiï¼‰ã€‚</li>
<li>ä¼ä¸šæ— çº¿å±€åŸŸç½‘ï¼ˆWLANï¼‰ã€‚</li>
<li>å…¬å…±åœºæ‰€ï¼ˆå¦‚æœºåœºã€å’–å•¡é¦†ï¼‰çš„æ— çº¿è¦†ç›–ã€‚</li>
<li>ç‰©è”ç½‘ï¼ˆIoTï¼‰è®¾å¤‡çš„è¿æ¥ã€‚</li>
</ul>
<hr>
<h3 id="5-802-11-çš„å®‰å…¨æ€§"><a href="#5-802-11-çš„å®‰å…¨æ€§" class="headerlink" title="5. 802.11 çš„å®‰å…¨æ€§"></a>5. <strong>802.11 çš„å®‰å…¨æ€§</strong></h3><ul>
<li><strong>WEPï¼ˆæœ‰çº¿ç­‰æ•ˆåŠ å¯†ï¼‰</strong>ï¼šæ—©æœŸçš„åŠ å¯†åè®®ï¼Œå®‰å…¨æ€§è¾ƒå·®ã€‚</li>
<li><strong>WPAï¼ˆWi-Fi ä¿æŠ¤è®¿é—®ï¼‰</strong>ï¼šæ”¹è¿›çš„åŠ å¯†åè®®ï¼Œå®‰å…¨æ€§æ›´é«˜ã€‚</li>
<li><strong>WPA2&#x2F;WPA3</strong>ï¼šç›®å‰ä¸»æµçš„åŠ å¯†åè®®ï¼Œæä¾›æ›´å¼ºçš„å®‰å…¨æ€§ã€‚</li>
</ul>
<hr>
<h3 id="6-802-11-çš„å¸¸è§é—®é¢˜"><a href="#6-802-11-çš„å¸¸è§é—®é¢˜" class="headerlink" title="6. 802.11 çš„å¸¸è§é—®é¢˜"></a>6. <strong>802.11 çš„å¸¸è§é—®é¢˜</strong></h3><ul>
<li>å¹²æ‰°é—®é¢˜ï¼š2.4 GHz é¢‘æ®µå®¹æ˜“å—åˆ°å…¶ä»–è®¾å¤‡ï¼ˆå¦‚å¾®æ³¢ç‚‰ã€è“ç‰™è®¾å¤‡ï¼‰çš„å¹²æ‰°ã€‚</li>
<li>è¦†ç›–èŒƒå›´ï¼š5 GHz é¢‘æ®µè¦†ç›–èŒƒå›´è¾ƒå°ï¼Œä½†é€Ÿç‡æ›´é«˜ã€‚</li>
<li>å…¼å®¹æ€§ï¼šä¸åŒ 802.11 æ ‡å‡†ä¹‹é—´çš„å…¼å®¹æ€§ï¼ˆå¦‚ 802.11n å…¼å®¹ 802.11a&#x2F;b&#x2F;gï¼‰ã€‚</li>
</ul>
<hr>
<h3 id="7-802-11-çš„æ¼”è¿›"><a href="#7-802-11-çš„æ¼”è¿›" class="headerlink" title="7. 802.11 çš„æ¼”è¿›"></a>7. <strong>802.11 çš„æ¼”è¿›</strong></h3><ul>
<li>ä» 802.11a&#x2F;b&#x2F;g åˆ° 802.11n&#x2F;ac&#x2F;axï¼Œé€Ÿç‡å’Œæ•ˆç‡ä¸æ–­æå‡ã€‚</li>
<li>Wi-Fi 6ï¼ˆ802.11axï¼‰æ˜¯ç›®å‰æœ€æ–°çš„æ ‡å‡†ï¼Œæ”¯æŒæ›´é«˜çš„é€Ÿç‡å’Œæ›´å¤šçš„è®¾å¤‡è¿æ¥ã€‚</li>
</ul>
<hr>
<h3 id="8-çŸ¥è¯†æ±‡æ€»"><a href="#8-çŸ¥è¯†æ±‡æ€»" class="headerlink" title="8. çŸ¥è¯†æ±‡æ€»"></a>8. çŸ¥è¯†æ±‡æ€»</h3><ol>
<li>æ— çº¿å±€åŸŸç½‘ç¡¬ä»¶è®¾å¤‡ä¸»è¦åŒ…æ‹¬ï¼š<strong>æ— çº¿ç½‘å¡ï¼Œæ— çº¿æ¥å…¥ç‚¹ï¼ˆAPï¼‰ï¼Œæ— çº¿å¤©çº¿ï¼Œæ— çº¿ç½‘æ¡¥ï¼Œæ— çº¿è·¯ç”±å™¨ä¸æ— çº¿ç½‘å…³</strong></li>
<li>ç»„å»ºæ— çº¿å±€åŸŸç½‘çš„å…³é”®è®¾å¤‡æ˜¯ <strong>æ— çº¿ç½‘å¡ã€æ— çº¿æ¥å…¥ç‚¹ï¼ˆAPï¼‰ã€æ— çº¿è·¯ç”±å’Œæ— çº¿å¤©çº¿</strong>ã€‚</li>
<li><strong>æ— çº¿AP</strong> æ˜¯æ— çº¿å±€åŸŸç½‘ä¸­è´Ÿè´£æ•°æ®æ¥æ”¶å’Œè½¬å‘çš„è®¾å¤‡ã€‚</li>
<li>æ— çº¿å±€åŸŸç½‘å—ç¯å¢ƒï¼ˆæ¯”å¦‚å¤©æ°”ã€å»ºç­‘ç‰©ç­‰ï¼‰å¹²æ‰°ã€‚è€Œæœ‰çº¿ç½‘ä¼šå—åˆ°ä¿¡å·ä¼ è¾“å¤ªè¿œå‡å¼±ï¼Œ<br>æœ‰æ—¶å€™éœ€è¦ä¸­ç»§æ”¾å¤§åå†è¿›è¡Œä¼ è¾“ï¼Œå°±æ˜¯å…‰çº¤ä¹Ÿæ˜¯æœ‰ç‰©ç†ä¼ è¾“é™åˆ¶çš„ã€‚</li>
</ol>
<h3 id="9-Ad-Hoc-æ¨¡å¼"><a href="#9-Ad-Hoc-æ¨¡å¼" class="headerlink" title="9. Ad-Hoc æ¨¡å¼"></a>9. Ad-Hoc æ¨¡å¼</h3><ul>
<li>Ad-Hoc æ¨¡å¼æ˜¯ä¸€ç§ç‰¹æ®Šçš„æ— çº¿å±€åŸŸç½‘æ¨¡å¼ï¼Œå®ƒå…è®¸è®¾å¤‡åœ¨æ²¡æœ‰æ¥å…¥ç‚¹çš„æƒ…å†µä¸‹ç›´æ¥è¿æ¥åˆ°å…¶ä»–è®¾å¤‡ã€‚</li>
<li>åœ¨ Ad-Hoc æ¨¡å¼ä¸‹ï¼Œè®¾å¤‡ä¹‹é—´é€šè¿‡ç›´æ¥é€šä¿¡æ¥å»ºç«‹ç½‘ç»œã€‚</li>
<li>Ad-Hoc æ¨¡å¼é€‚ç”¨äºå°å‹ç½‘ç»œï¼Œå¦‚å®¶åº­æˆ–åŠå…¬å®¤å†…çš„ä¸´æ—¶ç½‘ç»œã€‚</li>
<li>Ad-Hoc æ¨¡å¼ä¸éœ€è¦æ¥å…¥ç‚¹ï¼Œå› æ­¤è®¾å¤‡ä¹‹é—´å¯ä»¥ç›´æ¥é€šä¿¡ï¼Œæ— éœ€é€šè¿‡æ¥å…¥ç‚¹è¿›è¡Œä¸­ç»§ã€‚</li>
<li>Ad-Hoc æ¨¡å¼é€‚ç”¨äºå°å‹ç½‘ç»œï¼Œå¦‚å®¶åº­æˆ–åŠå…¬å®¤å†…çš„ä¸´æ—¶ç½‘ç»œã€‚</li>
<li>Ad-Hoc æ— æ³•è¿æ¥åˆ°äº’è”ç½‘ï¼Œå› ä¸ºäº’è”ç½‘éœ€è¦æ¥å…¥ç‚¹ï¼ˆAPï¼‰è¿›è¡Œä¸­ç»§ã€‚</li>
</ul>
<h3 id="10-Infrastructure-æ¨¡å¼"><a href="#10-Infrastructure-æ¨¡å¼" class="headerlink" title="10. Infrastructure æ¨¡å¼"></a>10. Infrastructure æ¨¡å¼</h3><ul>
<li><b style="background-color: red">å¤§éƒ¨åˆ†æ— çº¿å±€åŸŸç½‘</b> ä½¿ç”¨ Infrastructure æ¨¡å¼ã€‚</li>
<li>Infrastructure æ¨¡å¼æ˜¯ä¸€ç§å¸¸è§çš„æ— çº¿å±€åŸŸç½‘æ¨¡å¼ï¼Œå®ƒä½¿ç”¨æ¥å…¥ç‚¹ï¼ˆAPï¼‰æ¥å»ºç«‹ç½‘ç»œã€‚</li>
<li>åœ¨ Infrastructure æ¨¡å¼ä¸‹ï¼Œè®¾å¤‡é€šè¿‡æ¥å…¥ç‚¹è¿æ¥åˆ°ç½‘ç»œï¼Œç„¶åé€šè¿‡æ¥å…¥ç‚¹è¿æ¥åˆ°äº’è”ç½‘ã€‚</li>
<li>Infrastructure æ¨¡å¼é€‚ç”¨äºå¤§å‹ç½‘ç»œï¼Œå¦‚ä¼ä¸šæˆ–å­¦æ ¡ã€‚</li>
<li>Infrastructure æ¨¡å¼éœ€è¦æ¥å…¥ç‚¹ï¼ˆAPï¼‰æ¥å»ºç«‹ç½‘ç»œï¼Œå› æ­¤è®¾å¤‡ä¹‹é—´ä¸èƒ½ç›´æ¥é€šä¿¡ã€‚</li>
<li>Infrastructure æ¨¡å¼å¯ä»¥è¿æ¥åˆ°äº’è”ç½‘ï¼Œå› ä¸ºæ¥å…¥ç‚¹ï¼ˆAPï¼‰å¯ä»¥æä¾›äº’è”ç½‘è¿æ¥ã€‚</li>
</ul>
<h3 id="11-æ— çº¿ç½‘å¡æ¥å£ç±»å‹"><a href="#11-æ— çº¿ç½‘å¡æ¥å£ç±»å‹" class="headerlink" title="11. æ— çº¿ç½‘å¡æ¥å£ç±»å‹"></a>11. æ— çº¿ç½‘å¡æ¥å£ç±»å‹</h3><ul>
<li><strong>PCI æ¥å£</strong>ï¼šç”¨äºè¿æ¥åˆ°ä¸»æ¿çš„ PCI æ’æ§½ï¼Œé€‚ç”¨äºé«˜æ€§èƒ½éœ€æ±‚ã€‚</li>
<li><strong>USB æ¥å£</strong>ï¼šç”¨äºè¿æ¥åˆ°è®¡ç®—æœºçš„ USB ç«¯å£ï¼Œé€‚ç”¨äºä¾¿æºæ€§å’Œæ˜“ç”¨æ€§ã€‚</li>
<li><strong>PCMCIA æ¥å£</strong>ï¼šç”¨äºè¿æ¥åˆ°ç¬”è®°æœ¬ç”µè„‘çš„ PCMCIA æ’æ§½ï¼Œé€‚ç”¨äºç¬”è®°æœ¬ç”µè„‘ã€‚</li>
</ul>
<hr>
<h2 id="äºŒ-SSID"><a href="#äºŒ-SSID" class="headerlink" title="äºŒ.SSID"></a>äºŒ.SSID</h2><p>ä»¥ä¸‹æ˜¯å…³äº <strong>BSSID</strong>ã€<strong>ESSID</strong>ã€<strong>PSSID</strong> å’Œ <strong>SSID</strong> çš„æ•´ç†è¡¨æ ¼ï¼Œå¸®åŠ©æ‚¨æ¸…æ™°ç†è§£è¿™äº›æ¦‚å¿µçš„åŒºåˆ«ä¸è”ç³»ï¼š</p>
<table>
<thead>
<tr>
<th><strong>æ¦‚å¿µ</strong></th>
<th><strong>å…¨ç§°</strong></th>
<th><strong>å®šä¹‰</strong></th>
<th><strong>æ ¼å¼</strong></th>
<th><strong>ä½œç”¨</strong></th>
<th><strong>åº”ç”¨åœºæ™¯</strong></th>
</tr>
</thead>
<tbody><tr>
<td><strong>SSID</strong></td>
<td>Service Set Identifier</td>
<td>æ— çº¿ç½‘ç»œçš„åç§°ï¼Œç”¨äºæ ‡è¯†ä¸€ä¸ªæ— çº¿å±€åŸŸç½‘ï¼ˆWLANï¼‰ã€‚</td>
<td>æœ€å¤š 32 ä¸ªå­—ç¬¦çš„å­—ç¬¦ä¸²</td>
<td>ç”¨æˆ·é€šè¿‡ SSID é€‰æ‹©å¹¶è¿æ¥åˆ°ç‰¹å®šçš„æ— çº¿ç½‘ç»œã€‚</td>
<td>å®¶åº­ã€ä¼ä¸šã€å…¬å…±åœºæ‰€</td>
</tr>
<tr>
<td><strong>BSSID</strong></td>
<td>Basic Service Set Identifier</td>
<td>æ— çº¿æ¥å…¥ç‚¹ï¼ˆAPï¼‰çš„ MAC åœ°å€ï¼Œç”¨äºå”¯ä¸€æ ‡è¯†ä¸€ä¸ªåŸºæœ¬æœåŠ¡é›†ï¼ˆBSSï¼‰ã€‚</td>
<td>48 ä½çš„ MAC åœ°å€</td>
<td>åœ¨ç½‘ç»œä¸­åŒºåˆ†ä¸åŒçš„æ¥å…¥ç‚¹ï¼ˆå°¤å…¶æ˜¯åœ¨å¤šä¸ª AP ä½¿ç”¨ç›¸åŒ SSID çš„æƒ…å†µä¸‹ï¼‰ã€‚</td>
<td>æ— çº¿ç½‘ç»œä¸­çš„å•ä¸ª AP æ ‡è¯†</td>
</tr>
<tr>
<td><strong>ESSID</strong></td>
<td>Extended Service Set Identifier</td>
<td>æ‰©å±•æœåŠ¡é›†ï¼ˆESSï¼‰çš„æ ‡è¯†ç¬¦ï¼Œç”¨äºæ ‡è¯†ç”±å¤šä¸ª BSS ç»„æˆçš„æ— çº¿ç½‘ç»œã€‚</td>
<td>é€šå¸¸ä¸ SSID ç›¸åŒ</td>
<td>åœ¨å¤šä¸ª AP ç»„æˆçš„ç½‘ç»œä¸­ï¼ŒESSID ç”¨äºæ ‡è¯†æ•´ä¸ªç½‘ç»œï¼Œæ”¯æŒæ— ç¼æ¼«æ¸¸ã€‚</td>
<td>ä¼ä¸šã€æ ¡å›­ç­‰å¤§å‹æ— çº¿ç½‘ç»œ</td>
</tr>
<tr>
<td><strong>PSSID</strong></td>
<td>Private Service Set Identifier</td>
<td>ç§æœ‰æœåŠ¡é›†æ ‡è¯†ç¬¦ï¼Œé€šå¸¸ç”¨äºä¼ä¸šå†…éƒ¨æˆ–ç‰¹å®šåœºæ™¯ä¸‹çš„æ— çº¿ç½‘ç»œã€‚</td>
<td>è‡ªå®šä¹‰å­—ç¬¦ä¸²</td>
<td>æä¾›æ›´é«˜çš„å®‰å…¨æ€§å’Œéšç§ä¿æŠ¤ï¼Œé€šå¸¸ä¸å¯¹å¤–å¹¿æ’­ã€‚</td>
<td>ä¼ä¸šå†…éƒ¨ç½‘ç»œã€è®¿å®¢ç½‘ç»œ</td>
</tr>
</tbody></table>
<hr>
<h3 id="è¡¥å……è¯´æ˜"><a href="#è¡¥å……è¯´æ˜" class="headerlink" title="è¡¥å……è¯´æ˜"></a><strong>è¡¥å……è¯´æ˜</strong></h3><ol>
<li><p><strong>SSID ä¸ BSSID çš„å…³ç³»</strong>ï¼š</p>
<ul>
<li>ä¸€ä¸ª <strong>SSID</strong> å¯ä»¥å¯¹åº”å¤šä¸ª <strong>BSSID</strong>ï¼ˆä¾‹å¦‚ï¼Œåœ¨ä¼ä¸šç½‘ç»œä¸­ï¼Œå¤šä¸ª AP ä½¿ç”¨ç›¸åŒçš„ SSIDï¼Œä½†æ¯ä¸ª AP çš„ BSSID ä¸åŒï¼‰ã€‚</li>
<li><strong>SSID</strong> æ˜¯ç”¨æˆ·å¯è§çš„ç½‘ç»œåç§°ï¼Œè€Œ <strong>BSSID</strong> æ˜¯ç½‘ç»œå†…éƒ¨çš„æ ‡è¯†ç¬¦ã€‚</li>
</ul>
</li>
<li><p><strong>ESSID çš„ä½œç”¨</strong>ï¼š</p>
<ul>
<li>åœ¨ç”±å¤šä¸ª AP ç»„æˆçš„ç½‘ç»œä¸­ï¼Œ<strong>ESSID</strong> ç”¨äºæ ‡è¯†æ•´ä¸ªç½‘ç»œï¼Œç”¨æˆ·å¯ä»¥åœ¨ä¸åŒ AP ä¹‹é—´æ— ç¼æ¼«æ¸¸ã€‚</li>
</ul>
</li>
<li><p><strong>PSSID çš„ç‰¹ç‚¹</strong>ï¼š</p>
<ul>
<li><strong>PSSID</strong> é€šå¸¸ç”¨äºå¯¹å®‰å…¨æ€§è¦æ±‚è¾ƒé«˜çš„åœºæ™¯ï¼Œå¦‚ä¼ä¸šå†…éƒ¨ç½‘ç»œæˆ–è®¿å®¢ç½‘ç»œã€‚</li>
</ul>
</li>
</ol>
<hr>
<h2 id="ä¸‰-æ— çº¿ç½‘å¡"><a href="#ä¸‰-æ— çº¿ç½‘å¡" class="headerlink" title="ä¸‰.æ— çº¿ç½‘å¡"></a>ä¸‰.æ— çº¿ç½‘å¡</h2><p>ä»¥ä¸‹æ˜¯æ— çº¿ç½‘å¡ç±»å‹çš„æ•´ç†è¡¨æ ¼ï¼š</p>
<table>
<thead>
<tr>
<th><strong>ç±»å‹</strong></th>
<th><strong>æ¥å£&#x2F;è¿æ¥æ–¹å¼</strong></th>
<th><strong>é€‚ç”¨è®¾å¤‡</strong></th>
<th><strong>ç‰¹ç‚¹</strong></th>
</tr>
</thead>
<tbody><tr>
<td><strong>PCI&#x2F;PCIeæ— çº¿ç½‘å¡</strong></td>
<td>PCI&#x2F;PCIeæ’æ§½</td>
<td>å°å¼æœº</td>
<td>æ€§èƒ½å¼ºï¼Œé€‚åˆå›ºå®šä½¿ç”¨</td>
</tr>
<tr>
<td><strong>USBæ— çº¿ç½‘å¡</strong></td>
<td>USBæ¥å£</td>
<td>å°å¼æœºã€ç¬”è®°æœ¬</td>
<td>ä¾¿æºï¼Œå®‰è£…ç®€å•</td>
</tr>
<tr>
<td><strong>Mini PCIe&#x2F;M.2æ— çº¿ç½‘å¡</strong></td>
<td>Mini PCIe&#x2F;M.2æ’æ§½</td>
<td>ç¬”è®°æœ¬ã€å°å‹è®¾å¤‡</td>
<td>ä½“ç§¯å°ï¼Œé›†æˆåº¦é«˜</td>
</tr>
<tr>
<td><strong>PCMCIA&#x2F;CardBusæ— çº¿ç½‘å¡</strong></td>
<td>PCMCIA&#x2F;CardBusæ’æ§½</td>
<td>è€å¼ç¬”è®°æœ¬</td>
<td>è€æ—§æ ‡å‡†ï¼Œé€æ¸æ·˜æ±°</td>
</tr>
<tr>
<td><strong>ExpressCardæ— çº¿ç½‘å¡</strong></td>
<td>ExpressCardæ’æ§½</td>
<td>æ”¯æŒExpressCardçš„ç¬”è®°æœ¬</td>
<td>ä¼ è¾“é€Ÿåº¦å¿«ï¼Œé€æ¸è¢«æ·˜æ±°</td>
</tr>
<tr>
<td><strong>SDIOæ— çº¿ç½‘å¡</strong></td>
<td>SDIOæ¥å£</td>
<td>åµŒå…¥å¼è®¾å¤‡ã€ä¾¿æºè®¾å¤‡</td>
<td>ä¸»è¦ç”¨äºå°å‹æˆ–åµŒå…¥å¼è®¾å¤‡</td>
</tr>
</tbody></table>
<h3 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h3><ul>
<li><strong>å°å¼æœº</strong>ï¼šPCI&#x2F;PCIeã€USB  </li>
<li><strong>ç¬”è®°æœ¬</strong>ï¼šMini PCIe&#x2F;M.2ã€USB  </li>
<li><strong>è€æ—§è®¾å¤‡</strong>ï¼šPCMCIA&#x2F;CardBusã€ExpressCard  </li>
<li><strong>åµŒå…¥å¼è®¾å¤‡</strong>ï¼šSDIO</li>
</ul>
<h2 id="å››-æœ‰çº¿å±€åŸŸç½‘"><a href="#å››-æœ‰çº¿å±€åŸŸç½‘" class="headerlink" title="å››.æœ‰çº¿å±€åŸŸç½‘"></a>å››.æœ‰çº¿å±€åŸŸç½‘</h2><h3 id="1-äºŒå±‚äº¤æ¢æœºä¸ä¸‰å±‚äº¤æ¢æœºå¯¹æ¯”"><a href="#1-äºŒå±‚äº¤æ¢æœºä¸ä¸‰å±‚äº¤æ¢æœºå¯¹æ¯”" class="headerlink" title="1. äºŒå±‚äº¤æ¢æœºä¸ä¸‰å±‚äº¤æ¢æœºå¯¹æ¯”"></a>1. äºŒå±‚äº¤æ¢æœºä¸ä¸‰å±‚äº¤æ¢æœºå¯¹æ¯”</h3><table>
<thead>
<tr>
<th><strong>å¯¹æ¯”ç»´åº¦</strong></th>
<th><strong>äºŒå±‚äº¤æ¢æœº</strong></th>
<th><strong>ä¸‰å±‚äº¤æ¢æœº</strong></th>
</tr>
</thead>
<tbody><tr>
<td><strong>OSIå±‚çº§</strong></td>
<td>æ•°æ®é“¾è·¯å±‚ï¼ˆç¬¬äºŒå±‚ï¼‰</td>
<td>ç½‘ç»œå±‚ï¼ˆç¬¬ä¸‰å±‚ï¼‰</td>
</tr>
<tr>
<td><strong>æ ¸å¿ƒåŠŸèƒ½</strong></td>
<td>åŸºäºMACåœ°å€è½¬å‘æ•°æ®å¸§</td>
<td>åŸºäºIPåœ°å€å’ŒMACåœ°å€è½¬å‘æ•°æ®åŒ…ï¼ˆå…¼å…·äº¤æ¢å’Œè·¯ç”±åŠŸèƒ½ï¼‰</td>
</tr>
<tr>
<td><strong>è½¬å‘ä¾æ®</strong></td>
<td>MACåœ°å€è¡¨ï¼ˆå­¦ä¹ ã€è¿‡æ»¤ã€è½¬å‘ï¼‰</td>
<td>è·¯ç”±è¡¨ï¼ˆé™æ€&#x2F;åŠ¨æ€è·¯ç”±åè®®ï¼‰ + MACåœ°å€è¡¨</td>
</tr>
<tr>
<td><strong>æ˜¯å¦æ”¯æŒè·¯ç”±</strong></td>
<td>ä¸æ”¯æŒ</td>
<td>æ”¯æŒ</td>
</tr>
<tr>
<td><strong>VLANé—´é€šä¿¡</strong></td>
<td>éœ€å€ŸåŠ©å¤–éƒ¨è·¯ç”±å™¨</td>
<td>å¯ç›´æ¥é€šè¿‡è·¯ç”±æ¨¡å—å®ç°VLANé—´é€šä¿¡</td>
</tr>
<tr>
<td><strong>ç½‘ç»œèŒƒå›´</strong></td>
<td>åŒä¸€å±€åŸŸç½‘ï¼ˆåŒä¸€å­ç½‘ï¼‰</td>
<td>è·¨å­ç½‘ã€è·¨VLANçš„å±€åŸŸç½‘æˆ–å¹¿åŸŸç½‘</td>
</tr>
<tr>
<td><strong>æ€§èƒ½ç‰¹ç‚¹</strong></td>
<td>é«˜é€Ÿè½¬å‘ï¼ˆçº¯ç¡¬ä»¶äº¤æ¢ï¼‰</td>
<td>é«˜é€Ÿäº¤æ¢+è·¯ç”±ï¼ˆASICèŠ¯ç‰‡åŠ é€Ÿè·¯ç”±ï¼‰</td>
</tr>
<tr>
<td><strong>åº”ç”¨åœºæ™¯</strong></td>
<td>å°å‹å±€åŸŸç½‘æ¥å…¥å±‚ï¼ˆå¦‚åŠå…¬å®¤ã€å®¿èˆï¼‰</td>
<td>ä¼ä¸šæ ¸å¿ƒå±‚&#x2F;æ±‡èšå±‚ï¼ˆéœ€è·¯ç”±åŠŸèƒ½çš„å¤æ‚ç½‘ç»œï¼‰</td>
</tr>
<tr>
<td><strong>é…ç½®å¤æ‚åº¦</strong></td>
<td>ç®€å•ï¼ˆä»…éœ€é…ç½®VLANã€ç«¯å£å®‰å…¨ç­‰ï¼‰</td>
<td>è¾ƒå¤æ‚ï¼ˆéœ€é…ç½®è·¯ç”±åè®®ã€ACLã€QoSç­‰ï¼‰</td>
</tr>
<tr>
<td><strong>æˆæœ¬</strong></td>
<td>è¾ƒä½</td>
<td>è¾ƒé«˜</td>
</tr>
<tr>
<td><strong>å…¸å‹åè®®æ”¯æŒ</strong></td>
<td>STPã€VLANã€802.1Q</td>
<td>OSPFã€RIPã€ACLã€NATç­‰</td>
</tr>
<tr>
<td><strong>è®¾å¤‡ç¤ºä¾‹</strong></td>
<td>æ™®é€šä¼ä¸šæ¥å…¥å±‚äº¤æ¢æœºï¼ˆå¦‚Huawei S2700ï¼‰</td>
<td>ä¼ä¸šçº§æ ¸å¿ƒäº¤æ¢æœºï¼ˆå¦‚Huawei S5700ï¼‰</td>
</tr>
<tr>
<td><strong>é…ç½®DHCP</strong></td>
<td>ä¸æ”¯æŒ</td>
<td>æ”¯æŒ</td>
</tr>
</tbody></table>
<hr>
<p><strong>è¡¥å……è¯´æ˜</strong>ï¼š  </p>
<ol>
<li>äºŒå±‚äº¤æ¢æœºåªèƒ½è¯†åˆ«æ•°æ®å¸§ä¸­çš„MACåœ°å€ï¼Œç”¨äºåœ¨åŒä¸€å±€åŸŸç½‘å†…è¿›è¡Œæ•°æ®å¸§çš„è½¬å‘ã€‚ä¸‰å±‚äº¤æ¢æœºæ—¢å¯ä»¥è¯†åˆ«æ•°æ®å¸§ä¸­çš„MACåœ°å€ï¼Œä¹Ÿå¯ä»¥è¯†åˆ«æ•°æ®åŒ…ä¸­çš„IPåœ°å€ï¼Œç”¨äºåœ¨ä¸åŒå­ç½‘æˆ–VLANä¹‹é—´è¿›è¡Œæ•°æ®åŒ…çš„è½¬å‘ã€‚</li>
</ol>
<h2 id="äº”-é›†çº¿å™¨"><a href="#äº”-é›†çº¿å™¨" class="headerlink" title="äº”.é›†çº¿å™¨"></a>äº”.é›†çº¿å™¨</h2><ol>
<li>ç‹¬ç«‹å¼é›†çº¿å™¨ï¼ˆIndependent Hubï¼‰<br>ç‹¬ç«‹å¼é›†çº¿å™¨æ˜¯æœ€å¸¸è§çš„é›†çº¿å™¨ç±»å‹ï¼Œé€šå¸¸æ˜¯ä¸€ä¸ªå¸¦æœ‰å¤šä¸ªç«¯å£çš„å•ä¸ªç›’å­å¼è®¾å¤‡ã€‚å®ƒå¯ä»¥é€šè¿‡æ™®é€šç«¯å£ç”¨åŒç»çº¿è¿æ¥ï¼Œæˆ–è€…é€šè¿‡10Base-5åŒè½´ç”µç¼†è¿æ¥ï¼Œä»¥å®ç°æ‰©å±•ã€‚ç‹¬ç«‹å¼é›†çº¿å™¨çš„ä¼˜ç‚¹åŒ…æ‹¬ä½æˆæœ¬ã€ä¾¿äºæŸ¥æ‰¾æ•…éšœå’Œç®¡ç†ï¼Œé€‚åˆå°å‹å±€åŸŸç½‘ã€‚ä½†å…¶æ€§èƒ½ç›¸å¯¹è¾ƒä½ï¼Œå°¤å…¶æ˜¯åœ¨é€Ÿåº¦æ–¹é¢ã€‚</li>
<li>å †å å¼é›†çº¿å™¨ï¼ˆStackable Hubï¼‰<br>å †å å¼é›†çº¿å™¨å¯ä»¥é€šè¿‡ä¸“ç”¨çš„å †å ç«¯å£ï¼ˆå¦‚â€œUPâ€å’Œâ€œDOWNâ€ç«¯å£ï¼‰å°†å¤šä¸ªé›†çº¿å™¨è¿æ¥åœ¨ä¸€èµ·ï¼Œå½¢æˆä¸€ä¸ªé€»è¾‘ä¸Šçš„å•ä¸€è®¾å¤‡ã€‚è¿™ç§è¿æ¥æ–¹å¼ä¸ä¼šå ç”¨æ™®é€šç«¯å£ï¼Œå¹¶ä¸”å¯ä»¥å®ç°ç»Ÿä¸€ç®¡ç†ã€‚å †å å¼é›†çº¿å™¨ä¾¿äºç½‘ç»œæ‰©å……ï¼Œé€‚åˆå¯¹ç«¯å£æ•°é‡æœ‰è¾ƒé«˜è¦æ±‚çš„å¤§å‹ç½‘ç»œã€‚å…¶ä¼˜ç‚¹åŒ…æ‹¬æ–¹ä¾¿ç®¡ç†ã€æ‰©å±•æ€§å¼ºï¼Œä¸”ä¸å—ä¼ ç»Ÿç½‘ç»œæ‹“æ‰‘è§„åˆ™ï¼ˆå¦‚5-4-3è§„åˆ™ï¼‰çš„é™åˆ¶ã€‚</li>
<li>æ¨¡å—åŒ–é›†çº¿å™¨ï¼ˆModular Hubï¼‰<br>æ¨¡å—åŒ–é›†çº¿å™¨é…æœ‰æœºæ¶æˆ–å¡ç®±ï¼Œå¸¦æœ‰å¤šä¸ªå¡æ§½ï¼Œæ¯ä¸ªæ§½å¯ä»¥æ’å…¥ä¸€å—é€šä¿¡å¡ï¼Œæ¯å—é€šä¿¡å¡ç›¸å½“äºä¸€ä¸ªç‹¬ç«‹çš„é›†çº¿å™¨ã€‚æ¨¡å—åŒ–é›†çº¿å™¨çš„ç«¯å£é€šè¿‡åº•æ¿è¿›è¡Œäº’è¿ï¼Œæ”¯æŒçµæ´»çš„æ‰©å±•å’Œç®¡ç†ã€‚å®ƒé€‚ç”¨äºè¾ƒå¤§çš„ç½‘ç»œç¯å¢ƒï¼Œèƒ½å¤Ÿæä¾›æ›´é«˜çš„é€šä¿¡æ•ˆç‡å’Œæ›´å¤æ‚çš„ç½‘ç»œç®¡ç†åŠŸèƒ½ã€‚<span style="background-color:red;">å¯é æ€§æœ€é«˜åŒæ—¶ä»·æ ¼æœ€è´µ</span></li>
</ol>
<h2 id="å…­-ç½‘ç»œæ‹“æ‰‘ç»“æ„"><a href="#å…­-ç½‘ç»œæ‹“æ‰‘ç»“æ„" class="headerlink" title="å…­. ç½‘ç»œæ‹“æ‰‘ç»“æ„"></a>å…­. ç½‘ç»œæ‹“æ‰‘ç»“æ„</h2><ol>
<li>æ˜Ÿå‹æ‹“æ‰‘ç»“æ„ï¼ˆStar Topologyï¼‰<br>æ˜Ÿå‹æ‹“æ‰‘ç»“æ„æ˜¯ä¸€ç§ä»¥ä¸­å¤®èŠ‚ç‚¹ä¸ºä¸­å¿ƒï¼Œæ‰€æœ‰å…¶ä»–èŠ‚ç‚¹éƒ½è¿æ¥åˆ°ä¸­å¤®èŠ‚ç‚¹çš„ç½‘ç»œæ‹“æ‰‘ç»“æ„ã€‚æ¯ä¸ªèŠ‚ç‚¹éƒ½é€šè¿‡å•ç‹¬çš„çº¿è·¯è¿æ¥åˆ°ä¸­å¤®èŠ‚ç‚¹ï¼Œå½¢æˆä¸€ä¸ªè¾å°„çŠ¶çš„ç½‘ç»œç»“æ„ã€‚è¿™ç§æ‹“æ‰‘ç»“æ„å…·æœ‰æ˜“äºç®¡ç†å’Œæ•…éšœéš”ç¦»çš„ä¼˜ç‚¹ï¼Œå› ä¸ºå¦‚æœä¸­å¤®èŠ‚ç‚¹å‘ç”Ÿæ•…éšœï¼Œæ•´ä¸ªç½‘ç»œä»ç„¶å¯ä»¥ç»§ç»­è¿è¡Œã€‚åŒæ—¶ï¼Œæ˜Ÿå‹æ‹“æ‰‘ç»“æ„ä¹Ÿä¾¿äºæ‰©å±•ï¼Œåªéœ€æ·»åŠ æ›´å¤šçš„èŠ‚ç‚¹å’Œçº¿è·¯å³å¯ã€‚ç„¶è€Œï¼Œå¦‚æœä¸­å¤®èŠ‚ç‚¹å‘ç”Ÿæ•…éšœï¼Œæ•´ä¸ªç½‘ç»œå°†æ— æ³•è¿è¡Œï¼Œå› æ­¤éœ€è¦é«˜å¯é æ€§çš„ä¸­å¤®èŠ‚ç‚¹ã€‚</li>
<li>ç¯å‹æ‹“æ‰‘ç»“æ„ï¼ˆRing Topologyï¼‰<br>ç¯å‹æ‹“æ‰‘ç»“æ„æ˜¯ä¸€ç§æ‰€æœ‰èŠ‚ç‚¹éƒ½è¿æ¥æˆä¸€ä¸ªé—­åˆç¯è·¯çš„ç½‘ç»œæ‹“æ‰‘ç»“æ„ã€‚æ•°æ®æ²¿ç€ç¯è·¯ä»ä¸€ä¸ªèŠ‚ç‚¹ä¼ è¾“åˆ°ä¸‹ä¸€ä¸ªèŠ‚ç‚¹ï¼Œç›´åˆ°åˆ°è¾¾ç›®æ ‡èŠ‚ç‚¹ã€‚è¿™ç§æ‹“æ‰‘ç»“æ„å…·æœ‰å»¶è¿Ÿç¨³å®šã€æ˜“äºå®‰è£…å’Œç»´æŠ¤çš„ä¼˜ç‚¹ã€‚ç„¶è€Œï¼Œç¯å‹æ‹“æ‰‘ç»“æ„åœ¨èŠ‚ç‚¹æ•°é‡è¾ƒå¤šæ—¶ï¼Œ<br>çº¿è·¯æ•°é‡ä¹Ÿä¼šå¢åŠ ï¼Œå¯¼è‡´æˆæœ¬è¾ƒé«˜ã€‚æ­¤å¤–ï¼Œå¦‚æœç¯ä¸­çš„æŸä¸ªèŠ‚ç‚¹å‘ç”Ÿæ•…éšœï¼Œæ•´ä¸ªç½‘ç»œå°†æ— æ³•è¿è¡Œï¼Œå› æ­¤éœ€è¦é«˜å¯é æ€§çš„èŠ‚ç‚¹ã€‚<strong>é€‚ç”¨äºä¸æ‰©å±•çš„å±€åŸŸç½‘ï¼Œå®¹æ˜“å®‰è£…å’Œç›‘æ§ï¼Œä¼ è¾“æœ€å¤§å»¶è¿Ÿæ˜¯å›ºå®šçš„ï¼Œä¼ è¾“æ§åˆ¶æœºåˆ¶ç®€å•ï¼Œå®ç”¨æ€§å¼º</strong>ã€‚</li>
<li>æ€»çº¿å‹æ‹“æ‰‘ç»“æ„ï¼ˆBus Topologyï¼‰<br>æ€»çº¿å‹æ‹“æ‰‘ç»“æ„æ˜¯ä¸€ç§æ‰€æœ‰èŠ‚ç‚¹éƒ½è¿æ¥åˆ°ä¸€ä¸ªå…¬å…±ä¼ è¾“çº¿è·¯ï¼ˆç§°ä¸ºæ€»çº¿ï¼‰çš„ç½‘ç»œæ‹“æ‰‘ç»“æ„ã€‚æ•°æ®æ²¿ç€æ€»çº¿ä»ä¸€ä¸ªèŠ‚ç‚¹ä¼ è¾“åˆ°å¦ä¸€ä¸ªèŠ‚ç‚¹ï¼Œç›´åˆ°åˆ°è¾¾ç›®æ ‡èŠ‚ç‚¹ã€‚è¿™ç§æ‹“æ‰‘ç»“æ„å…·æœ‰æ˜“äºå®‰è£…å’Œç»´æŠ¤çš„ä¼˜ç‚¹ã€‚ç„¶è€Œï¼Œå¦‚æœæ€»çº¿å‘ç”Ÿæ•…éšœï¼Œæ•´ä¸ªç½‘ç»œå°†æ— æ³•è¿è¡Œï¼Œå› æ­¤éœ€è¦é«˜å¯é æ€§çš„æ€»çº¿ã€‚æ­¤å¤–ï¼Œæ€»çº¿å‹æ‹“æ‰‘ç»“æ„åœ¨èŠ‚ç‚¹æ•°é‡è¾ƒå¤šæ—¶ï¼Œçº¿è·¯æ•°é‡ä¹Ÿä¼šå¢åŠ ï¼Œå¯¼è‡´æˆæœ¬è¾ƒé«˜ã€‚åŒæ—¶ï¼Œæ€»çº¿å‹æ‹“æ‰‘ç»“æ„åœ¨æ•°æ®ä¼ è¾“è¿‡ç¨‹ä¸­å¯èƒ½ä¼šå‡ºç°å†²çªï¼Œå› æ­¤éœ€è¦é‡‡ç”¨CSMA&#x2F;CDï¼ˆCarrier Sense Multiple Access with Collision Detectionï¼‰ç­‰æœºåˆ¶æ¥é¿å…å†²çªã€‚<strong>é€‚ç”¨äº200å°ä»¥å†…çš„å°å‹ç½‘ç»œ</strong>ã€‚</li>
<li>ç½‘çŠ¶æ‹“æ‰‘ç»“æ„ï¼ˆMesh Topologyï¼‰<br>ç½‘çŠ¶æ‹“æ‰‘ç»“æ„æ˜¯ä¸€ç§æ‰€æœ‰èŠ‚ç‚¹éƒ½ç›¸äº’è¿æ¥çš„ç½‘ç»œæ‹“æ‰‘ç»“æ„ã€‚æ¯ä¸ªèŠ‚ç‚¹éƒ½ä¸å…¶ä»–èŠ‚ç‚¹é€šè¿‡å•ç‹¬çš„çº¿è·¯è¿æ¥ï¼Œå½¢æˆä¸€ä¸ªå¤æ‚çš„ç½‘ç»œç»“æ„ã€‚è¿™ç§æ‹“æ‰‘ç»“æ„å…·æœ‰é«˜å¯é æ€§å’Œå®¹é”™æ€§çš„ä¼˜ç‚¹ï¼Œå› ä¸ºå³ä½¿æŸä¸ªèŠ‚ç‚¹å‘ç”Ÿæ•…éšœï¼Œç½‘ç»œä»ç„¶å¯ä»¥é€šè¿‡å…¶ä»–è·¯å¾„è¿›è¡Œé€šä¿¡ã€‚ç„¶è€Œï¼Œç½‘çŠ¶æ‹“æ‰‘ç»“æ„åœ¨èŠ‚ç‚¹æ•°é‡è¾ƒå¤šæ—¶ï¼Œçº¿è·¯æ•°é‡ä¹Ÿä¼šå¢åŠ ï¼Œå¯¼è‡´æˆæœ¬è¾ƒé«˜ã€‚æ­¤å¤–ï¼Œç½‘çŠ¶æ‹“æ‰‘ç»“æ„åœ¨æ•°æ®ä¼ è¾“è¿‡ç¨‹ä¸­å¯èƒ½ä¼šå‡ºç°å†²çªï¼Œå› æ­¤éœ€è¦é‡‡ç”¨CSMA&#x2F;CDç­‰æœºåˆ¶æ¥é¿å…å†²çªã€‚</li>
</ol>
]]></content>
      <categories>
        <category>å¯¼è®º</category>
      </categories>
      <tags>
        <tag>è®¡ç®—æœºç†è®º</tag>
      </tags>
  </entry>
  <entry>
    <title>å¦‚ä½•åœ¨ macOS å’Œ Ubuntu ä¸Šå®‰è£… tealdeer â€” å¿«é€ŸæŸ¥çœ‹å‘½ä»¤å¸®åŠ©</title>
    <url>/2024/12/29/%E5%B7%A5%E5%85%B7/%E5%BF%AB%E9%80%9F%E6%9F%A5%E7%9C%8B%E5%91%BD%E4%BB%A4%E5%B8%AE%E5%8A%A9/</url>
    <content><![CDATA[<p>åœ¨ Linux å’Œ macOS ä¸Šï¼Œtealdeer æ˜¯ä¸€ä¸ªåŸºäº tldrï¼ˆç®€åŒ–ç‰ˆæ‰‹å†Œé¡µï¼‰é¡¹ç›®çš„å‘½ä»¤è¡Œå·¥å…·ï¼Œå®ƒè®©ç”¨æˆ·èƒ½å¤Ÿå¿«é€ŸæŸ¥æ‰¾å’ŒæŸ¥çœ‹å‘½ä»¤çš„ç®€åŒ–å¸®åŠ©æ–‡æ¡£ã€‚è¿™å¯¹äºç»å¸¸ä½¿ç”¨å‘½ä»¤è¡Œçš„å¼€å‘è€…å’Œç³»ç»Ÿç®¡ç†å‘˜æ¥è¯´ï¼Œæ˜¯ä¸€ä¸ªæå…¶æœ‰ç”¨çš„å·¥å…·ã€‚æœ¬æ–‡å°†ä»‹ç»å¦‚ä½•åœ¨ macOS å’Œ Ubuntu ä¸Šå®‰è£… tealdeerï¼Œå¹¶åˆ†äº«å‡ ç§ä¸åŒçš„å®‰è£…æ–¹æ³•ã€‚</p>
<h2 id="ä»€ä¹ˆæ˜¯-tealdeerï¼Ÿ"><a href="#ä»€ä¹ˆæ˜¯-tealdeerï¼Ÿ" class="headerlink" title="ä»€ä¹ˆæ˜¯ tealdeerï¼Ÿ"></a>ä»€ä¹ˆæ˜¯ tealdeerï¼Ÿ</h2><p>tealdeer æ˜¯ä¸€ä¸ªå‘½ä»¤è¡Œå·¥å…·ï¼Œç”¨äºå±•ç¤º tldrï¼ˆç®€åŒ–çš„æ‰‹å†Œé¡µï¼‰é¡¹ç›®ä¸­çš„ç®€åŒ–å‘½ä»¤æ–‡æ¡£ã€‚ä¸ä¼ ç»Ÿçš„ man å‘½ä»¤ç›¸æ¯”ï¼Œtealdeer æä¾›äº†æ›´ä¸ºç®€æ´ã€æ˜“æ‡‚çš„å‘½ä»¤ç”¨æ³•å’Œç¤ºä¾‹ï¼Œè®©ç”¨æˆ·å¯ä»¥æ›´å¿«é€Ÿåœ°äº†è§£å‘½ä»¤çš„åŠŸèƒ½ã€‚æ— è®ºæ˜¯ Linux ç³»ç»Ÿç®¡ç†å‘˜è¿˜æ˜¯ macOS å¼€å‘è€…ï¼Œéƒ½å¯ä»¥é€šè¿‡ tealdeer æå‡æ•ˆç‡ï¼Œå‡å°‘æŸ¥æ‰¾å¤æ‚æ‰‹å†Œé¡µçš„æ—¶é—´ã€‚</p>
<h2 id="ä¸ºä»€ä¹ˆä½¿ç”¨-tealdeerï¼Ÿ"><a href="#ä¸ºä»€ä¹ˆä½¿ç”¨-tealdeerï¼Ÿ" class="headerlink" title="ä¸ºä»€ä¹ˆä½¿ç”¨ tealdeerï¼Ÿ"></a>ä¸ºä»€ä¹ˆä½¿ç”¨ tealdeerï¼Ÿ</h2><ul>
<li><strong>ç®€åŒ–å‘½ä»¤æ–‡æ¡£</strong>ï¼štealdeer æä¾›ç®€çŸ­çš„å‘½ä»¤ç”¨æ³•ï¼Œå¹¶é™„æœ‰å¸¸ç”¨çš„ç¤ºä¾‹å’Œå‚æ•°ï¼Œæå¤§ç®€åŒ–äº†å‘½ä»¤çš„ç†è§£ã€‚</li>
<li><strong>å¿«é€ŸæŸ¥æ‰¾</strong>ï¼šé€šè¿‡ tldr æ–‡æ¡£ï¼Œä¸ç”¨ç¿»é˜…é•¿ç¯‡çš„ man é¡µï¼Œå°±å¯ä»¥ç«‹åˆ»è·å¾—æ‰€éœ€çš„å‘½ä»¤ä½¿ç”¨ä¿¡æ¯ã€‚</li>
<li><strong>æ”¯æŒå¤šç§å¹³å°</strong>ï¼štealdeer å¯ä»¥åœ¨ macOSã€Linux ç­‰å¤šä¸ªå¹³å°ä¸Šä½¿ç”¨ï¼Œå¸®åŠ©è·¨å¹³å°å¼€å‘è€…ä¿æŒä¸€è‡´çš„å·¥ä½œæµã€‚</li>
</ul>
<p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°†ä»‹ç»å¦‚ä½•åœ¨ macOS å’Œ Ubuntu ä¸Šå®‰è£… tealdeerã€‚</p>
<hr>
<h2 id="åœ¨-macOS-ä¸Šå®‰è£…-tealdeer"><a href="#åœ¨-macOS-ä¸Šå®‰è£…-tealdeer" class="headerlink" title="åœ¨ macOS ä¸Šå®‰è£… tealdeer"></a>åœ¨ macOS ä¸Šå®‰è£… tealdeer</h2><h3 id="1-é€šè¿‡-Homebrew-å®‰è£…"><a href="#1-é€šè¿‡-Homebrew-å®‰è£…" class="headerlink" title="1. é€šè¿‡ Homebrew å®‰è£…"></a>1. <strong>é€šè¿‡ Homebrew å®‰è£…</strong></h3><p>å¦‚æœä½ åœ¨ macOS ä¸Šä½¿ç”¨ Homebrew åŒ…ç®¡ç†å™¨ï¼Œé‚£ä¹ˆå®‰è£… tealdeer å°†å˜å¾—éå¸¸ç®€å•ã€‚</p>
<h4 id="æ­¥éª¤ï¼š"><a href="#æ­¥éª¤ï¼š" class="headerlink" title="æ­¥éª¤ï¼š"></a>æ­¥éª¤ï¼š</h4><ol>
<li><p>æ‰“å¼€ç»ˆç«¯ã€‚</p>
</li>
<li><p>ä½¿ç”¨ Homebrew å®‰è£… tealdeerï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">brew install tealdeer</span><br></pre></td></tr></table></figure>
</li>
<li><p>å®‰è£…å®Œæˆåï¼Œè¿è¡Œä»¥ä¸‹å‘½ä»¤æ›´æ–° tldr ç¼“å­˜ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">tldr --update</span><br></pre></td></tr></table></figure>
</li>
<li><p>æµ‹è¯•å®‰è£…ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">tldr <span class="built_in">ls</span></span><br></pre></td></tr></table></figure></li>
</ol>
<h3 id="2-é€šè¿‡-Cargo-å®‰è£…ï¼ˆéœ€è¦-Rust-ç¯å¢ƒï¼‰"><a href="#2-é€šè¿‡-Cargo-å®‰è£…ï¼ˆéœ€è¦-Rust-ç¯å¢ƒï¼‰" class="headerlink" title="2. é€šè¿‡ Cargo å®‰è£…ï¼ˆéœ€è¦ Rust ç¯å¢ƒï¼‰"></a>2. <strong>é€šè¿‡ Cargo å®‰è£…ï¼ˆéœ€è¦ Rust ç¯å¢ƒï¼‰</strong></h3><p>å¦‚æœä½ å·²ç»åœ¨ macOS ä¸Šå®‰è£…äº† Rust å’Œ cargoï¼ˆRust çš„åŒ…ç®¡ç†å™¨ï¼‰ï¼Œå¯ä»¥ç›´æ¥é€šè¿‡ cargo å®‰è£… tealdeerã€‚</p>
<h4 id="æ­¥éª¤ï¼š-1"><a href="#æ­¥éª¤ï¼š-1" class="headerlink" title="æ­¥éª¤ï¼š"></a>æ­¥éª¤ï¼š</h4><ol>
<li><p>é¦–å…ˆï¼Œç¡®ä¿ä½ å·²ç»å®‰è£…äº† Rustï¼ˆå¦‚æœæ²¡æœ‰ï¼Œå¯ä»¥ä» <a class="link"   href="https://www.rust-lang.org/learn/get-started" >Rust å®˜ç½‘<i class="fas fa-external-link-alt"></i></a> å®‰è£…ï¼‰ã€‚</p>
</li>
<li><p>ä½¿ç”¨ Cargo å®‰è£… tealdeerï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">cargo install tealdeer</span><br></pre></td></tr></table></figure>
</li>
<li><p>å®Œæˆå®‰è£…åï¼ŒåŒæ ·æ‰§è¡Œæ›´æ–°ç¼“å­˜ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">tldr --update</span><br></pre></td></tr></table></figure>
</li>
<li><p>æµ‹è¯•å®‰è£…ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">tldr <span class="built_in">ls</span></span><br></pre></td></tr></table></figure></li>
</ol>
<h3 id="3-é€šè¿‡-GitHub-Releases-æ‰‹åŠ¨å®‰è£…"><a href="#3-é€šè¿‡-GitHub-Releases-æ‰‹åŠ¨å®‰è£…" class="headerlink" title="3. é€šè¿‡ GitHub Releases æ‰‹åŠ¨å®‰è£…"></a>3. <strong>é€šè¿‡ GitHub Releases æ‰‹åŠ¨å®‰è£…</strong></h3><p>å¦‚æœä½ ä¸æƒ³ä½¿ç”¨ Homebrew æˆ– Cargoï¼Œä½ å¯ä»¥é€‰æ‹©ç›´æ¥ä» GitHub ä¸‹è½½äºŒè¿›åˆ¶æ–‡ä»¶å¹¶æ‰‹åŠ¨å®‰è£…ã€‚</p>
<h4 id="æ­¥éª¤ï¼š-2"><a href="#æ­¥éª¤ï¼š-2" class="headerlink" title="æ­¥éª¤ï¼š"></a>æ­¥éª¤ï¼š</h4><ol>
<li><p>è®¿é—® <a class="link"   href="https://github.com/dbrgn/tealdeer/releases" >tealdeer GitHub Releases é¡µé¢<i class="fas fa-external-link-alt"></i></a>ã€‚</p>
</li>
<li><p>ä¸‹è½½é€‚åˆ macOS çš„é¢„ç¼–è¯‘äºŒè¿›åˆ¶æ–‡ä»¶ï¼ˆé€šå¸¸æ˜¯ tealdeer-x86_64-apple-darwin.tar.gzï¼‰ã€‚</p>
</li>
<li><p>è§£å‹ä¸‹è½½çš„æ–‡ä»¶ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"> tar -xvf tealdeer-x86_64-apple-darwin.tar.gz</span><br><span class="line">```  </span><br><span class="line">   </span><br><span class="line">4. å°† tealdeer å¯æ‰§è¡Œæ–‡ä»¶ç§»åŠ¨åˆ° /usr/local/bin/ï¼Œä½¿å…¶å¯ä»¥å…¨å±€è®¿é—®ï¼š</span><br><span class="line">```  bash</span><br><span class="line">   <span class="built_in">sudo</span> <span class="built_in">mv</span> tealdeer /usr/local/bin/</span><br></pre></td></tr></table></figure>
</li>
<li><p>æ›´æ–°ç¼“å­˜ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">tldr --update</span><br></pre></td></tr></table></figure></li>
</ol>
<hr>
<h2 id="åœ¨-Ubuntu-ä¸Šå®‰è£…-tealdeer"><a href="#åœ¨-Ubuntu-ä¸Šå®‰è£…-tealdeer" class="headerlink" title="åœ¨ Ubuntu ä¸Šå®‰è£… tealdeer"></a>åœ¨ Ubuntu ä¸Šå®‰è£… tealdeer</h2><p>åœ¨ Ubuntu ä¸Šå®‰è£… tealdeer çš„æ–¹æ³•å’Œ macOS ç±»ä¼¼ï¼Œä»¥ä¸‹æ˜¯å‡ ç§å¸¸ç”¨çš„å®‰è£…æ–¹å¼ã€‚</p>
<h3 id="1-é€šè¿‡-APT-å®‰è£…ï¼ˆé€‚ç”¨äºè¾ƒæ–°çš„-Ubuntu-ç³»ç»Ÿï¼‰"><a href="#1-é€šè¿‡-APT-å®‰è£…ï¼ˆé€‚ç”¨äºè¾ƒæ–°çš„-Ubuntu-ç³»ç»Ÿï¼‰" class="headerlink" title="1. é€šè¿‡ APT å®‰è£…ï¼ˆé€‚ç”¨äºè¾ƒæ–°çš„ Ubuntu ç³»ç»Ÿï¼‰"></a>1. <strong>é€šè¿‡ APT å®‰è£…ï¼ˆé€‚ç”¨äºè¾ƒæ–°çš„ Ubuntu ç³»ç»Ÿï¼‰</strong></h3><p>Ubuntu ä¸Šçš„æœ€æ–°ç‰ˆæœ¬æ”¯æŒé€šè¿‡ APT å®‰è£… tealdeerï¼Œä½†éœ€è¦é¢å¤–çš„ PPAï¼ˆä¸ªäººåŒ…å­˜æ¡£ï¼‰ã€‚ä¸è¿‡ï¼Œtealdeer å¹¶æ²¡æœ‰å®˜æ–¹çš„ Ubuntu ä»“åº“ï¼Œå› æ­¤ä½ éœ€è¦ä»ç¬¬ä¸‰æ–¹ PPA å®‰è£…ã€‚</p>
<h4 id="æ­¥éª¤ï¼š-3"><a href="#æ­¥éª¤ï¼š-3" class="headerlink" title="æ­¥éª¤ï¼š"></a>æ­¥éª¤ï¼š</h4><ol>
<li><p>é¦–å…ˆï¼Œæ·»åŠ  PPA ä»“åº“ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">sudo</span> add-apt-repository ppa:dbrgn/tealdeer</span><br></pre></td></tr></table></figure></li>
<li><p>æ›´æ–°ä½ çš„åŒ…åˆ—è¡¨ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">sudo</span> apt update</span><br></pre></td></tr></table></figure>
</li>
<li><p>å®‰è£… tealdeerï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">sudo</span> apt install tealdeer</span><br></pre></td></tr></table></figure>
</li>
<li><p>æ›´æ–°ç¼“å­˜ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">tldr --update</span><br></pre></td></tr></table></figure></li>
</ol>
<h3 id="2-é€šè¿‡-Snap-å®‰è£…"><a href="#2-é€šè¿‡-Snap-å®‰è£…" class="headerlink" title="2. é€šè¿‡ Snap å®‰è£…"></a>2. <strong>é€šè¿‡ Snap å®‰è£…</strong></h3><p>Ubuntu æ”¯æŒ Snap åŒ…ç®¡ç†ç³»ç»Ÿï¼Œä½ å¯ä»¥ç›´æ¥é€šè¿‡ snap å®‰è£… tealdeerã€‚è¿™ç§æ–¹æ³•é€‚ç”¨äºæ”¯æŒ Snap çš„å¤§å¤šæ•° Linux å‘è¡Œç‰ˆã€‚</p>
<h4 id="æ­¥éª¤ï¼š-4"><a href="#æ­¥éª¤ï¼š-4" class="headerlink" title="æ­¥éª¤ï¼š"></a>æ­¥éª¤ï¼š</h4><ol>
<li><p>å®‰è£… tealdeerï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">sudo</span> snap install tealdeer</span><br></pre></td></tr></table></figure>
</li>
<li><p>æ›´æ–°ç¼“å­˜ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">tldr --update</span><br></pre></td></tr></table></figure></li>
</ol>
<h3 id="3-æ‰‹åŠ¨å®‰è£…ï¼ˆä»-GitHub-Releasesï¼‰"><a href="#3-æ‰‹åŠ¨å®‰è£…ï¼ˆä»-GitHub-Releasesï¼‰" class="headerlink" title="3. æ‰‹åŠ¨å®‰è£…ï¼ˆä» GitHub Releasesï¼‰"></a>3. <strong>æ‰‹åŠ¨å®‰è£…ï¼ˆä» GitHub Releasesï¼‰</strong></h3><p>å¦‚æœä½ ä¸æƒ³ä¾èµ– Snap æˆ– APTï¼Œä½ å¯ä»¥ç›´æ¥ä» GitHub Releases é¡µé¢ä¸‹è½½é¢„ç¼–è¯‘çš„äºŒè¿›åˆ¶æ–‡ä»¶ã€‚</p>
<h4 id="æ­¥éª¤ï¼š-5"><a href="#æ­¥éª¤ï¼š-5" class="headerlink" title="æ­¥éª¤ï¼š"></a>æ­¥éª¤ï¼š</h4><ol>
<li><p>è®¿é—® <a class="link"   href="https://github.com/dbrgn/tealdeer/releases" >tealdeer GitHub Releases é¡µé¢<i class="fas fa-external-link-alt"></i></a>ã€‚</p>
</li>
<li><p>ä¸‹è½½é€‚åˆ Linux ç³»ç»Ÿçš„ .tar.gz æ–‡ä»¶ï¼ˆé€šå¸¸æ˜¯ tealdeer-x86_64-unknown-linux-gnu.tar.gzï¼‰ã€‚</p>
</li>
<li><p>è§£å‹ä¸‹è½½çš„æ–‡ä»¶ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">tar -xvf tealdeer-x86_64-unknown-linux-gnu.tar.gz</span><br></pre></td></tr></table></figure></li>
<li><p>å°† tealdeer å¯æ‰§è¡Œæ–‡ä»¶ç§»åŠ¨åˆ° &#x2F;usr&#x2F;local&#x2F;bin&#x2F;ï¼Œä½¿å…¶å¯ä»¥å…¨å±€è®¿é—®ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">sudo</span> <span class="built_in">mv</span> tealdeer /usr/local/bin/</span><br></pre></td></tr></table></figure>
</li>
<li><p>æ›´æ–°ç¼“å­˜ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">tldr --update</span><br></pre></td></tr></table></figure></li>
</ol>
<h3 id="4-é€šè¿‡-Cargo-å®‰è£…ï¼ˆéœ€è¦-Rust-ç¯å¢ƒï¼‰"><a href="#4-é€šè¿‡-Cargo-å®‰è£…ï¼ˆéœ€è¦-Rust-ç¯å¢ƒï¼‰" class="headerlink" title="4. é€šè¿‡ Cargo å®‰è£…ï¼ˆéœ€è¦ Rust ç¯å¢ƒï¼‰"></a>4. <strong>é€šè¿‡ Cargo å®‰è£…ï¼ˆéœ€è¦ Rust ç¯å¢ƒï¼‰</strong></h3><p>ä¸ macOS ç±»ä¼¼ï¼Œå¦‚æœä½ å·²ç»åœ¨ Ubuntu ä¸Šå®‰è£…äº† Rustï¼Œä½ å¯ä»¥é€šè¿‡ Cargo å®‰è£… tealdeerã€‚</p>
<h4 id="æ­¥éª¤ï¼š-6"><a href="#æ­¥éª¤ï¼š-6" class="headerlink" title="æ­¥éª¤ï¼š"></a>æ­¥éª¤ï¼š</h4><ol>
<li><p>å®‰è£… tealdeerï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">cargo install tealdeer</span><br></pre></td></tr></table></figure>
</li>
<li><p>æ›´æ–°ç¼“å­˜ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">tldr --update</span><br></pre></td></tr></table></figure></li>
</ol>
<hr>
<h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>tealdeer æ˜¯ä¸€ä¸ªå¼ºå¤§çš„å‘½ä»¤è¡Œå·¥å…·ï¼Œæä¾›ç®€æ´çš„å‘½ä»¤æ–‡æ¡£ï¼Œå¸®åŠ©ç”¨æˆ·å¿«é€ŸæŸ¥æ‰¾å’Œä½¿ç”¨ Linux å‘½ä»¤ã€‚æ— è®ºæ˜¯ macOS è¿˜æ˜¯ Ubuntuï¼Œå®‰è£… tealdeer éƒ½éå¸¸ç®€å•ï¼Œä½ å¯ä»¥é€šè¿‡å¤šç§æ–¹å¼è¿›è¡Œå®‰è£…ï¼š</p>
<ul>
<li><strong>macOS</strong>ï¼šé€šè¿‡ Homebrewã€Cargo æˆ–æ‰‹åŠ¨ä¸‹è½½äºŒè¿›åˆ¶æ–‡ä»¶å®‰è£…ã€‚</li>
<li><strong>Ubuntu</strong>ï¼šé€šè¿‡ APTã€Snapã€Cargo æˆ–æ‰‹åŠ¨å®‰è£…ã€‚</li>
</ul>
<p>é€šè¿‡ä¸Šè¿°æ–¹æ³•ï¼Œä½ å¯ä»¥è½»æ¾åœ°åœ¨ä½ çš„ macOS æˆ– Ubuntu ç³»ç»Ÿä¸­å®‰è£…å¹¶ä½¿ç”¨ tealdeerï¼Œæé«˜å‘½ä»¤è¡Œæ“ä½œçš„æ•ˆç‡ã€‚</p>
<p>å¸Œæœ›è¿™ç¯‡æ–‡ç« èƒ½å¸®åŠ©ä½ é¡ºåˆ©å®‰è£… tealdeerï¼å¦‚æœæœ‰ä»»ä½•é—®é¢˜ï¼Œæ¬¢è¿ç•™è¨€è®¨è®ºã€‚</p>
]]></content>
      <categories>
        <category>å·¥å…·</category>
      </categories>
      <tags>
        <tag>å·¥å…·</tag>
      </tags>
  </entry>
  <entry>
    <title>Cè¯­è¨€æ•°æ®ç»“æ„</title>
    <url>/2024/12/25/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/C%E8%AF%AD%E8%A8%80%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/</url>
    <content><![CDATA[<h1 id="Cè¯­è¨€æ’åºç®—æ³•"><a href="#Cè¯­è¨€æ’åºç®—æ³•" class="headerlink" title="Cè¯­è¨€æ’åºç®—æ³•"></a>Cè¯­è¨€æ’åºç®—æ³•</h1><h2 id="1-é€‰æ‹©æ’åº"><a href="#1-é€‰æ‹©æ’åº" class="headerlink" title="1. é€‰æ‹©æ’åº"></a>1. é€‰æ‹©æ’åº</h2><ol>
<li>å‡åºå³ï¼Œå°†ç¬¬ä¸€ä¸ªå…ƒç´ ä¸å…¶ä»–è¿›è¡Œæ¯”è¾ƒï¼Œè¦æ¯”ç¬¬ä¸€ä¸ªå…ƒç´ å°çš„å°±äº¤æ¢ï¼Œç¬¬ä¸€è½®ä¹‹åä¼šå¾—åˆ°æœ€å°å…ƒç´ ï¼Œç¬¬äºŒè½®ä¼šç¬¬äºŒä¸ªå…ƒç´ ä¸å…¶ä»–è¿›è¡Œæ¯”è¾ƒï¼Œå°çš„å°±äº¤æ¢ï¼Œè‡³åˆ°æœ€åä¸€è½®æ¯”è¾ƒäº¤æ¢ç»“æŸä¹‹åå°±æ’åºå®Œåœ¨ã€‚</li>
<li>é™åºå³ï¼Œæ¯æ¬¡éƒ½æ‰¾å¤§çš„ã€‚<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="type">void</span> <span class="title function_">select_sort</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">int</span> number_list[] = &#123;<span class="number">88</span>,<span class="number">10</span>,<span class="number">99</span>,<span class="number">50</span>,<span class="number">30</span>,<span class="number">100</span>,<span class="number">57</span>,<span class="number">67</span>,<span class="number">29</span>&#125;;</span><br><span class="line">    <span class="comment">// è·å–æ•°ç»„é•¿åº¦</span></span><br><span class="line">    <span class="type">int</span> length =  <span class="keyword">sizeof</span>(number_list)/ <span class="keyword">sizeof</span>(number_list[<span class="number">0</span>]);</span><br><span class="line">    <span class="comment">// åˆ›å»ºä¸´æ—¶å˜é‡</span></span><br><span class="line">    <span class="type">int</span> tmp1;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>;i &lt; length - <span class="number">1</span>; i ++) &#123; <span class="comment">// æ¯”è¾ƒè½®æ•°</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> j = i + <span class="number">1</span>; j &lt;= length - <span class="number">1</span>;j ++ ) &#123; <span class="comment">// æ¯æ¬¡æ¯”è¾ƒçš„æ•°ç»„</span></span><br><span class="line">            <span class="comment">// è¿›è¡Œæ¯”è¾ƒï¼Œå‡åºæ’åº</span></span><br><span class="line">            <span class="keyword">if</span> (number_list[i] &gt; number_list[j]) &#123;</span><br><span class="line">                tmp1 = number_list[i];</span><br><span class="line">                number_list[i] = number_list[j];</span><br><span class="line">                number_list[j] = tmp1;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> k = <span class="number">0</span>; k &lt; length;k ++) &#123;</span><br><span class="line">        <span class="comment">// æ¯ä¸‰ä¸ªå…ƒç´ æ¢è¡Œ</span></span><br><span class="line">        <span class="keyword">if</span> (k != <span class="number">0</span> &amp;&amp; k % <span class="number">3</span> == <span class="number">0</span> ) &#123;</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;\n&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%d &quot;</span>,number_list[k]);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ol>
<h2 id="2-å†’æ³¡æ’åº"><a href="#2-å†’æ³¡æ’åº" class="headerlink" title="2. å†’æ³¡æ’åº"></a>2. å†’æ³¡æ’åº</h2><ol>
<li>å‡åºï¼Œåˆ™ä»å‰é¢å¾€åå¼€å§‹ï¼Œä¾æ­¤æ¯”è¾ƒç›¸é‚»çš„ä¸¤ä¸ªå…ƒç´ çš„å¤§å°ï¼Œè¾ƒå¤§çš„ä¸‹æ²‰ï¼Œè¾ƒå°çš„ä¸Šå‡ã€‚ç¬¬ä¸€è½®è¿‡<br>åï¼Œæœ€å¤§çš„å…ƒç´ å°±æ”¾åœ¨æœ€åä¸€ä½äº†ã€‚ç¬¬äºŒè½®è¿‡åï¼Œæ¬¡å¤§çš„å…ƒç´ å°±æ”¾åœ¨å€’æ•°ç¬¬äºŒä½äº†ï¼Œä¹‹åä¾æ­¤ç±»æ¨ã€‚</li>
<li>é™åºï¼Œåˆ™ä»å‰é¢å¾€åå¼€å§‹ï¼Œä¾æ­¤æ¯”è¾ƒç›¸é‚»çš„ä¸¤ä¸ªå…ƒç´ çš„å¤§å°ï¼Œè¾ƒå°çš„ä¸‹æ²‰ï¼Œè¾ƒå¤§çš„ä¸Šå‡ã€‚ç¬¬ä¸€è½®è¿‡<br>åï¼Œæœ€å°çš„å…ƒç´ å°±æ”¾åœ¨æœ€åä¸€ä½äº†ã€‚ç¬¬äºŒè½®è¿‡åï¼Œæ¬¡å°çš„å…ƒç´ å°±æ”¾åœ¨å€’æ•°ç¬¬äºŒä½äº†ï¼Œä¹‹åä¾æ­¤ç±»æ¨ã€‚</li>
</ol>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="type">void</span> <span class="title function_">bubble_sort</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">int</span> number_list[] = &#123;<span class="number">88</span>,<span class="number">10</span>,<span class="number">99</span>,<span class="number">50</span>,<span class="number">30</span>,<span class="number">100</span>,<span class="number">57</span>,<span class="number">67</span>,<span class="number">29</span>&#125;;</span><br><span class="line">    <span class="comment">// è·å–æ•°ç»„é•¿åº¦</span></span><br><span class="line">    <span class="type">int</span> length =  <span class="keyword">sizeof</span>(number_list)/ <span class="keyword">sizeof</span>(number_list[<span class="number">0</span>]);</span><br><span class="line">    <span class="comment">// åˆ›å»ºä¸´æ—¶å˜é‡</span></span><br><span class="line">    <span class="type">int</span> tmp1;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>;i &lt; length - <span class="number">1</span>;i ++) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>;j &lt; length - j - <span class="number">1</span>;j ++) &#123;</span><br><span class="line">            <span class="keyword">if</span> (number_list[j]&gt;number_list[j+<span class="number">1</span>]) &#123;</span><br><span class="line">                <span class="comment">// äº¤æ¢æ•°æ®</span></span><br><span class="line">                tmp1 = number_list[j];</span><br><span class="line">                number_list[j] = number_list[j + <span class="number">1</span>];</span><br><span class="line">                number_list[j + <span class="number">1</span>] = tmp1;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> k = <span class="number">0</span>; k &lt; length;k ++) &#123;</span><br><span class="line">        <span class="comment">// æ¯ä¸‰ä¸ªå…ƒç´ æ¢è¡Œ</span></span><br><span class="line">        <span class="keyword">if</span> (k != <span class="number">0</span> &amp;&amp; k % <span class="number">3</span> == <span class="number">0</span> ) &#123;</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;\n&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%d &quot;</span>,number_list[k]);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="3-å¿«é€Ÿæ’åºæ³•"><a href="#3-å¿«é€Ÿæ’åºæ³•" class="headerlink" title="3.å¿«é€Ÿæ’åºæ³•"></a>3.å¿«é€Ÿæ’åºæ³•</h2><p>é€šè¿‡ä¸€è¶Ÿæ’åºå°†è¦æ’åºçš„æ•°æ®åˆ†å‰²æˆç‹¬ç«‹çš„ä¸¤éƒ¨åˆ†ï¼Œå…¶ä¸­ä¸€éƒ¨åˆ†çš„æ‰€æœ‰æ•°æ®éƒ½æ¯”å¦å¤–ä¸€éƒ¨åˆ†çš„æ‰€æœ‰æ•°æ®éƒ½<br>è¦å°ï¼Œç„¶åå†æŒ‰æ­¤æ–¹æ³•å¯¹è¿™ä¸¤éƒ¨åˆ†æ•°æ®åˆ†åˆ«è¿›è¡Œå¿«é€Ÿæ’åºï¼Œæ•´ä¸ªæ’åºè¿‡ç¨‹å¯ä»¥é€’å½’è¿›è¡Œï¼Œä»¥æ­¤è¾¾åˆ°æ•´ä¸ªæ•°<br>æ®å˜æˆæœ‰åºåºåˆ—ã€‚</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="type">int</span> <span class="title function_">run1224</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">int</span> a[] = &#123;<span class="number">88</span>,<span class="number">10</span>,<span class="number">99</span>,<span class="number">50</span>,<span class="number">30</span>,<span class="number">100</span>,<span class="number">57</span>,<span class="number">67</span>,<span class="number">29</span>&#125;;</span><br><span class="line">    <span class="type">int</span> len = <span class="keyword">sizeof</span>(a)/ <span class="keyword">sizeof</span>(a[<span class="number">0</span>]);</span><br><span class="line">    quick_sort(a,<span class="number">0</span>,len<span class="number">-1</span>);</span><br><span class="line">    printList(a,len);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * å¿«é€Ÿæ’åº</span></span><br><span class="line"><span class="comment"> * @param a æ•°ç»„</span></span><br><span class="line"><span class="comment"> * @param low åŸºå‡†å€¼</span></span><br><span class="line"><span class="comment"> * @param high æœ€åä¸€ä¸ªå…ƒç´ ç´¢å¼•</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">quick_sort</span><span class="params">(<span class="type">int</span>* a,<span class="type">const</span> <span class="type">int</span> low,<span class="type">const</span> <span class="type">int</span> high)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (low &lt; high) &#123; <span class="comment">// åŸºå‡†å€¼å°äºæœ€åä¸€ä¸ªå…ƒç´ ç´¢å¼•</span></span><br><span class="line">        <span class="type">int</span> h = high; <span class="comment">// åˆ›å»ºåˆ—è¡¨æœ€åä¸€ä¸ªå…ƒç´ ç´¢å¼•å¤‡ä»½</span></span><br><span class="line">        <span class="type">int</span> j;</span><br><span class="line">        <span class="comment">// åˆå§‹å˜é‡jä¸ºåŸºå‡†å€¼ï¼Œå°äºåˆ—è¡¨æœ€å¤§ç´¢å¼•</span></span><br><span class="line">        <span class="keyword">for</span> (j = low;j &lt; h;j++) &#123;</span><br><span class="line">            <span class="comment">// å¦‚æœ a[j] ä¸ªå…ƒç´ å¤§äºåŸºå‡†å€¼ï¼Œè¿›å…¥ä¸‹ä¸ªå¾ªç¯</span></span><br><span class="line">            <span class="keyword">if</span> (a[j] &gt; a[low]) &#123;</span><br><span class="line">                <span class="comment">// ç¡®ä¿jå°äºåˆ—è¡¨æœ€å¤§ç´¢å¼•</span></span><br><span class="line">                <span class="keyword">for</span> (; h &gt; j; h --) &#123;</span><br><span class="line">                    <span class="comment">// å¦‚æœæœ€åä¸€ä¸ªå…ƒç´ ï¼Œå°äºåŸºå‡†å€¼ï¼Œåˆ™è¿›è¡Œäº¤æ¢</span></span><br><span class="line">                    <span class="keyword">if</span> (a[h] &lt; a[low]) &#123;</span><br><span class="line">                        <span class="comment">/**</span></span><br><span class="line"><span class="comment">                         * è¿›è¡Œå…ƒç´ äº¤æ¢ï¼Œåˆ—å¦‚å½“å‰ a[h] = 29,a[low] = 88,a[j] = 99</span></span><br><span class="line"><span class="comment">                         * a[j] = a[j] + a[h] = 128</span></span><br><span class="line"><span class="comment">                         * a[h] = a[j] - a[h] = 99</span></span><br><span class="line"><span class="comment">                         * a[j] = a[j] - a[h] = 29</span></span><br><span class="line"><span class="comment">                         */</span></span><br><span class="line">                        a[j] += a[h];</span><br><span class="line">                        a[h] = a[j] - a[h];</span><br><span class="line">                        a[j]-=a[h];</span><br><span class="line">                        <span class="keyword">break</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (a[low] &gt; a[h]) &#123;</span><br><span class="line">            a[low] += a[h];</span><br><span class="line">            a[h] = a[low] - a[h];</span><br><span class="line">            a[low] -= a[h];</span><br><span class="line">        &#125;</span><br><span class="line">        quick_sort(a,low,h<span class="number">-1</span>);</span><br><span class="line">        quick_sort(a,h,high);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// å‡½æ•°å£°æ˜ï¼Œéœ€è¦ä¼ é€’æ•°ç»„å’Œæ•°ç»„çš„é•¿åº¦</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">printList</span><span class="params">(<span class="type">int</span> *a, <span class="type">int</span> len)</span> &#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; len; i++) &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%d &quot;</span>, a[i]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;\n&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="4-ç›´æ¥æ’å…¥æ’åºæ³•"><a href="#4-ç›´æ¥æ’å…¥æ’åºæ³•" class="headerlink" title="4. ç›´æ¥æ’å…¥æ’åºæ³•"></a>4. ç›´æ¥æ’å…¥æ’åºæ³•</h2><p>æ¯ä¸€æ­¥å°†ä¸€ä¸ªå¾…æ’åºçš„å…ƒç´ ,æŒ‰å…¶æ’åºç çš„å¤§å°,æ’å…¥åˆ°å‰é¢å·²ç»æ’å¥½åºçš„ä¸€ç»„å…ƒç´ çš„é€‚å½“ä½ç½®ä¸Šå»,ç›´åˆ°å…ƒç´ <br>å…¨éƒ¨æ’å…¥ä¸ºæ­¢ã€‚</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="comment">// ç›´æ¥æ’å…¥å‡åºæ’åº</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">direct_insert_sort_asc</span><span class="params">(<span class="type">int</span> *number_list,<span class="type">int</span> len)</span> &#123;</span><br><span class="line">    <span class="type">int</span> temp;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>;i &lt;= len - <span class="number">1</span>;i ++) &#123;</span><br><span class="line">        temp = number_list[i];</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> j = i - <span class="number">1</span>;j &gt;= <span class="number">0</span>;j--) &#123;</span><br><span class="line">            <span class="keyword">if</span> (number_list[j] &gt; temp) &#123;</span><br><span class="line">                number_list[j+<span class="number">1</span>] = number_list[j];</span><br><span class="line">                number_list[j] = temp;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    printList(number_list,len);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç›´æ¥æ’å…¥é™åºæ’åº</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">direct_insert_sort_desc</span><span class="params">(<span class="type">int</span> *number_list, <span class="type">int</span> len)</span> &#123;</span><br><span class="line">    <span class="type">int</span> temp;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt; len; i++) &#123; <span class="comment">// ä»ç¬¬äºŒä¸ªå…ƒç´ å¼€å§‹</span></span><br><span class="line">        temp = number_list[i];</span><br><span class="line">        <span class="type">int</span> j;</span><br><span class="line">        <span class="keyword">for</span> (j = i - <span class="number">1</span>; j &gt;= <span class="number">0</span> &amp;&amp; number_list[j] &lt; temp; j--) &#123; <span class="comment">// æ¯”è¾ƒæ¡ä»¶æ”¹ä¸ºå°äº</span></span><br><span class="line">            number_list[j + <span class="number">1</span>] = number_list[j]; <span class="comment">// å°†å…ƒç´ å‘åç§»åŠ¨</span></span><br><span class="line">        &#125;</span><br><span class="line">        number_list[j + <span class="number">1</span>] = temp; <span class="comment">// æ’å…¥æ­£ç¡®çš„ä½ç½®</span></span><br><span class="line">    &#125;</span><br><span class="line">    printList(number_list, len); <span class="comment">// æ‰“å°æ’åºåçš„åˆ—è¡¨</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="Cè¯­è¨€æŸ¥æ‰¾æ³•"><a href="#Cè¯­è¨€æŸ¥æ‰¾æ³•" class="headerlink" title="Cè¯­è¨€æŸ¥æ‰¾æ³•"></a>Cè¯­è¨€æŸ¥æ‰¾æ³•</h1><h2 id="1-é¡ºåºæŸ¥æ‰¾æ³•"><a href="#1-é¡ºåºæŸ¥æ‰¾æ³•" class="headerlink" title="1. é¡ºåºæŸ¥æ‰¾æ³•"></a>1. é¡ºåºæŸ¥æ‰¾æ³•</h2><p>é¡ºåºæŸ¥æ‰¾åˆç§°çº¿æ€§æŸ¥æ‰¾ï¼Œæ˜¯æœ€åŸºæœ¬çš„æŸ¥æ‰¾æ–¹æ³•ã€‚å®ƒçš„æŸ¥æ‰¾è¿‡ç¨‹ä¸ºï¼šä»ç¬¬ä¸€ä¸ªå…ƒç´ èµ·ï¼Œé€ä¸ªä¸å¾…æŸ¥å…ƒç´ æ¯”è¾ƒï¼Œ<br>è‹¥ä¸å¾…æŸ¥å…ƒç´ ç›¸ç­‰ï¼Œåˆ™æŸ¥æ‰¾æˆåŠŸï¼Œè¿”å›å¾…æŸ¥å…ƒç´ åœ¨æŸ¥æ‰¾è¡¨ä¸­çš„ä½ç½®ï¼›è‹¥ä¸å¾…æŸ¥å…ƒç´ ä¸ç­‰ï¼Œåˆ™ç»§ç»­ä¸<br>æŸ¥æ‰¾è¡¨ä¸­çš„ä¸‹ä¸€ä¸ªå…ƒç´ æ¯”è¾ƒï¼Œç›´åˆ°æŸ¥æ‰¾ç»“æŸä¸ºæ­¢ã€‚</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="comment">// é¡ºåºæŸ¥æ‰¾</span></span><br><span class="line"><span class="type">int</span> <span class="title function_">sequential_search</span><span class="params">(<span class="type">int</span> *number_list,<span class="type">int</span> len,<span class="type">int</span> key)</span> &#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>;i &lt; len;i ++) &#123;</span><br><span class="line">        <span class="keyword">if</span> (number_list[i] == key) &#123;</span><br><span class="line">            <span class="keyword">return</span> i;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="2-äºŒåˆ†æŸ¥æ‰¾æ³•"><a href="#2-äºŒåˆ†æŸ¥æ‰¾æ³•" class="headerlink" title="2. äºŒåˆ†æŸ¥æ‰¾æ³•"></a>2. äºŒåˆ†æŸ¥æ‰¾æ³•</h2><p>äºŒåˆ†æŸ¥æ‰¾æ³•ï¼ˆBinary Searchï¼‰åˆç§°æŠ˜åŠæŸ¥æ‰¾æ³•ï¼Œå®ƒæ˜¯ä¸€ç§åœ¨æœ‰åºæ•°ç»„ä¸­æŸ¥æ‰¾ç‰¹å®šå…ƒç´ çš„æœç´¢ç®—æ³•ã€‚äºŒåˆ†æŸ¥æ‰¾<br>æ³•çš„åŸºæœ¬æ€æƒ³æ˜¯å°†å¾…æŸ¥å…ƒç´ ä¸æ•°ç»„çš„ä¸­é—´å…ƒç´ è¿›è¡Œæ¯”è¾ƒï¼Œå¦‚æœç›¸ç­‰ï¼Œåˆ™è¿”å›ä¸­é—´å…ƒç´ çš„ç´¢å¼•ï¼›å¦‚æœå¾…æŸ¥å…ƒç´ <br>å°äºä¸­é—´å…ƒç´ ï¼Œåˆ™åœ¨æ•°ç»„çš„å·¦åŠéƒ¨åˆ†ç»§ç»­æŸ¥æ‰¾ï¼›å¦‚æœå¾…æŸ¥å…ƒç´ å¤§äºä¸­é—´å…ƒç´ ï¼Œåˆ™åœ¨æ•°ç»„çš„å³åŠéƒ¨åˆ†ç»§ç»­æŸ¥æ‰¾ã€‚é‡å¤è¿™ä¸ªè¿‡ç¨‹ï¼Œç›´åˆ°æ‰¾åˆ°å¾…æŸ¥å…ƒç´ æˆ–æŸ¥æ‰¾èŒƒå›´ä¸ºç©ºã€‚</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="comment">// äºŒåˆ†æŸ¥æ‰¾</span></span><br><span class="line"><span class="type">int</span> <span class="title function_">binary_search</span><span class="params">(<span class="type">int</span> *number_list,<span class="type">int</span> len,<span class="type">int</span> key)</span> &#123;</span><br><span class="line">    <span class="type">int</span> low = <span class="number">0</span>;</span><br><span class="line">    <span class="type">int</span> high = len - <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">while</span> (low &lt;= high) &#123;</span><br><span class="line">        <span class="type">int</span> mid = (low + high) / <span class="number">2</span>; <span class="comment">// è®¡ç®—ä¸­é—´å…ƒç´ çš„ç´¢å¼•</span></span><br><span class="line">        <span class="keyword">if</span> (number_list[mid] == key) &#123;</span><br><span class="line">            <span class="keyword">return</span> mid; <span class="comment">// æ‰¾åˆ°å…ƒç´ ï¼Œè¿”å›ç´¢å¼•</span></span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (number_list[mid] &gt; key) &#123;</span><br><span class="line">            high = mid - <span class="number">1</span>; <span class="comment">// åœ¨å·¦åŠéƒ¨åˆ†ç»§ç»­æŸ¥æ‰¾</span></span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            low = mid + <span class="number">1</span>; <span class="comment">// åœ¨å³åŠéƒ¨åˆ†ç»§ç»­æŸ¥æ‰¾</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">-1</span>; <span class="comment">// æœªæ‰¾åˆ°å…ƒç´ ï¼Œè¿”å›-1</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="Cè¯­è¨€æ ˆ"><a href="#Cè¯­è¨€æ ˆ" class="headerlink" title="Cè¯­è¨€æ ˆ"></a>Cè¯­è¨€æ ˆ</h1><p>æ ˆæ˜¯ä¸€ç§åè¿›å…ˆå‡ºï¼ˆLIFOï¼‰çš„æ•°æ®ç»“æ„ï¼Œå®ƒåªå…è®¸åœ¨ä¸€ç«¯è¿›è¡Œæ’å…¥å’Œåˆ é™¤æ“ä½œã€‚æ ˆçš„åŸºæœ¬æ“ä½œåŒ…æ‹¬å‹æ ˆï¼ˆPushï¼‰å’Œå¼¹æ ˆï¼ˆPopï¼‰ã€‚</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> MAX_SIZE 100</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> &#123;</span></span><br><span class="line">    <span class="type">int</span> data[MAX_SIZE];</span><br><span class="line">    <span class="type">int</span> top;</span><br><span class="line">&#125; Stack;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">initStack</span><span class="params">(Stack *s)</span> &#123;</span><br><span class="line">    s-&gt;top = <span class="number">-1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">isEmpty</span><span class="params">(Stack *s)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> s-&gt;top == <span class="number">-1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">isFull</span><span class="params">(Stack *s)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> s-&gt;top == MAX_SIZE - <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">push</span><span class="params">(Stack *s, <span class="type">int</span> value)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (isFull(s)) &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;Stack is full.\n&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    s-&gt;data[++s-&gt;top] = value;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">pop</span><span class="params">(Stack *s)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (isEmpty(s)) &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;Stack is empty.\n&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> s-&gt;data[s-&gt;top--];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span> &#123;</span><br><span class="line">    Stack s; initStack(&amp;s);</span><br><span class="line">&#125;</span><br><span class="line">    push(&amp;s, <span class="number">1</span>);</span><br><span class="line">    push(&amp;s, <span class="number">2</span>);</span><br><span class="line">    push(&amp;s, <span class="number">3</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>, pop(&amp;s)); <span class="comment">// è¾“å‡º 3</span></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>, pop(&amp;s)); <span class="comment">// è¾“å‡º 2</span></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>, pop(&amp;s)); <span class="comment">// è¾“å‡º 1</span></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>, pop(&amp;s)); <span class="comment">// è¾“å‡º &quot;Stack is empty.&quot;</span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="Cè¯­è¨€é˜Ÿåˆ—"><a href="#Cè¯­è¨€é˜Ÿåˆ—" class="headerlink" title="Cè¯­è¨€é˜Ÿåˆ—"></a>Cè¯­è¨€é˜Ÿåˆ—</h1><p>é˜Ÿåˆ—æ˜¯ä¸€ç§å…ˆè¿›å…ˆå‡ºï¼ˆFIFOï¼‰çš„æ•°æ®ç»“æ„ï¼Œå®ƒåªå…è®¸åœ¨ä¸€ç«¯è¿›è¡Œæ’å…¥æ“ä½œï¼Œåœ¨å¦ä¸€ç«¯è¿›è¡Œåˆ é™¤æ“ä½œã€‚é˜Ÿåˆ—çš„åŸºæœ¬æ“ä½œåŒ…æ‹¬å…¥é˜Ÿï¼ˆEnqueueï¼‰å’Œå‡ºé˜Ÿï¼ˆDequeueï¼‰ã€‚</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> MAX_SIZE 100</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> &#123;</span></span><br><span class="line">    <span class="type">int</span> data[MAX_SIZE];</span><br><span class="line">    <span class="type">int</span> front;</span><br><span class="line">    <span class="type">int</span> rear;</span><br><span class="line">&#125; Queue;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">initQueue</span><span class="params">(Queue *q)</span> &#123;</span><br><span class="line">    q-&gt;front = <span class="number">0</span>;</span><br><span class="line">    q-&gt;rear = <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">isEmpty</span><span class="params">(Queue *q)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> q-&gt;front == q-&gt;rear;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">isFull</span><span class="params">(Queue *q)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> (q-&gt;rear + <span class="number">1</span>) % MAX_SIZE == q-&gt;front;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">enqueue</span><span class="params">(Queue *q, <span class="type">int</span> value)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (isFull(q)) &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;Queue is full.\n&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    q-&gt;data[q-&gt;rear] = value;</span><br><span class="line">    q-&gt;rear = (q-&gt;rear + <span class="number">1</span>) % MAX_SIZE;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">dequeue</span><span class="params">(Queue *q)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (isEmpty(q)) &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;Queue is empty.\n&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">int</span> value = q-&gt;data[q-&gt;front];</span><br><span class="line">    q-&gt;front = (q-&gt;front + <span class="number">1</span>) % MAX_SIZE;</span><br><span class="line">    <span class="keyword">return</span> value;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span> &#123;</span><br><span class="line">    Queue q; initQueue(&amp;q);</span><br><span class="line">    enqueue(&amp;q, <span class="number">1</span>);</span><br><span class="line">    enqueue(&amp;q, <span class="number">2</span>);</span><br><span class="line">    enqueue(&amp;q, <span class="number">3</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>, dequeue(&amp;q)); <span class="comment">// è¾“å‡º 1</span></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>, dequeue(&amp;q)); <span class="comment">// è¾“å‡º 2</span></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>, dequeue(&amp;q)); <span class="comment">// è¾“å‡º 3</span></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>, dequeue(&amp;q)); <span class="comment">// è¾“å‡º &quot;Queue is empty.&quot;</span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="Cè¯­è¨€é“¾è¡¨"><a href="#Cè¯­è¨€é“¾è¡¨" class="headerlink" title="Cè¯­è¨€é“¾è¡¨"></a>Cè¯­è¨€é“¾è¡¨</h1><p>é“¾è¡¨æ˜¯ä¸€ç§åŠ¨æ€æ•°æ®ç»“æ„ï¼Œå®ƒç”±ä¸€ç³»åˆ—èŠ‚ç‚¹ç»„æˆï¼Œæ¯ä¸ªèŠ‚ç‚¹åŒ…å«æ•°æ®å’ŒæŒ‡å‘ä¸‹ä¸€ä¸ªèŠ‚ç‚¹çš„æŒ‡é’ˆã€‚é“¾è¡¨çš„åŸºæœ¬æ“ä½œåŒ…æ‹¬æ’å…¥ã€åˆ é™¤å’ŒæŸ¥æ‰¾ã€‚</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">Node</span> &#123;</span></span><br><span class="line">    <span class="type">int</span> data;</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">Node</span> *<span class="title">next</span>;</span></span><br><span class="line">&#125; Node;</span><br><span class="line"></span><br><span class="line">Node *<span class="title function_">createNode</span><span class="params">(<span class="type">int</span> data)</span> &#123;</span><br><span class="line">    Node *node = (Node *)<span class="built_in">malloc</span>(<span class="keyword">sizeof</span>(Node));</span><br><span class="line">    node-&gt;data = data;</span><br><span class="line">    node-&gt;next = <span class="literal">NULL</span>;</span><br><span class="line">    <span class="keyword">return</span> node;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">insertNode</span><span class="params">(Node **head, <span class="type">int</span> data)</span> &#123;</span><br><span class="line">    Node *node = createNode(data);</span><br><span class="line">    node-&gt;next = *head;</span><br><span class="line">    *head = node;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">deleteNode</span><span class="params">(Node **head, <span class="type">int</span> data)</span> &#123;</span><br><span class="line">    Node *temp = *head;</span><br><span class="line">    Node *prev = <span class="literal">NULL</span>;</span><br><span class="line">    <span class="keyword">while</span> (temp != <span class="literal">NULL</span> &amp;&amp; temp-&gt;data != data) &#123;</span><br><span class="line">        prev = temp;</span><br><span class="line">        temp = temp-&gt;next;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (temp == <span class="literal">NULL</span>) &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;Node with data %d not found.\n&quot;</span>, data);</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (prev == <span class="literal">NULL</span>) &#123;</span><br><span class="line">        *head = temp-&gt;next;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        prev-&gt;next = temp-&gt;next;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">free</span>(temp);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">printList</span><span class="params">(Node *head)</span> &#123;</span><br><span class="line">    Node *temp = head;</span><br><span class="line">    <span class="keyword">while</span> (temp != <span class="literal">NULL</span>) &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%d &quot;</span>, temp-&gt;data);</span><br><span class="line">        temp = temp-&gt;next;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;\n&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span> &#123;</span><br><span class="line">    Node *head = <span class="literal">NULL</span>;</span><br><span class="line">    insertNode(&amp;head, <span class="number">3</span>);</span><br><span class="line">    insertNode(&amp;head, <span class="number">2</span>);</span><br><span class="line">    insertNode(&amp;head, <span class="number">1</span>);</span><br><span class="line">    printList(head); <span class="comment">// è¾“å‡º 1 2 3</span></span><br><span class="line">    deleteNode(&amp;head, <span class="number">2</span>);</span><br><span class="line">    printList(head); <span class="comment">// è¾“å‡º 1 3</span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="Cè¯­è¨€æ ‘"><a href="#Cè¯­è¨€æ ‘" class="headerlink" title="Cè¯­è¨€æ ‘"></a>Cè¯­è¨€æ ‘</h1><p>æ ‘æ˜¯ä¸€ç§éçº¿æ€§æ•°æ®ç»“æ„ï¼Œå®ƒç”±ä¸€ç³»åˆ—èŠ‚ç‚¹ç»„æˆï¼Œæ¯ä¸ªèŠ‚ç‚¹åŒ…å«æ•°æ®å’ŒæŒ‡å‘å­èŠ‚ç‚¹çš„æŒ‡é’ˆã€‚æ ‘çš„åŸºæœ¬æ“ä½œåŒ…æ‹¬æ’å…¥ã€åˆ é™¤å’ŒæŸ¥æ‰¾ã€‚</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">Node</span> &#123;</span></span><br><span class="line">    <span class="type">int</span> data;</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">Node</span> *<span class="title">left</span>;</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">Node</span> *<span class="title">right</span>;</span></span><br><span class="line">&#125; Node;</span><br><span class="line"></span><br><span class="line">Node *<span class="title function_">createNode</span><span class="params">(<span class="type">int</span> data)</span> &#123;</span><br><span class="line">    Node *node = (Node *)<span class="built_in">malloc</span>(<span class="keyword">sizeof</span>(Node));</span><br><span class="line">    node-&gt;data = data;</span><br><span class="line">    node-&gt;left = <span class="literal">NULL</span>;</span><br><span class="line">    node-&gt;right = <span class="literal">NULL</span>;</span><br><span class="line">    <span class="keyword">return</span> node;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">insertNode</span><span class="params">(Node **root, <span class="type">int</span> data)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (*root == <span class="literal">NULL</span>) &#123;</span><br><span class="line">        *root = createNode(data);</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (data &lt; (*root)-&gt;data) &#123;</span><br><span class="line">        insertNode(&amp;(*root)-&gt;left, data);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        insertNode(&amp;(*root)-&gt;right, data);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">deleteNode</span><span class="params">(Node **root, <span class="type">int</span> data)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (*root == <span class="literal">NULL</span>) &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;Node with data %d not found.\n&quot;</span>, data);</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (data &lt; (*root)-&gt;data) &#123;</span><br><span class="line">        deleteNode(&amp;(*root)-&gt;left, data);</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (data &gt; (*root)-&gt;data) &#123;</span><br><span class="line">        deleteNode(&amp;(*root)-&gt;right, data);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> ((*root)-&gt;left == <span class="literal">NULL</span> &amp;&amp; (*root)-&gt;right == <span class="literal">NULL</span>) &#123;</span><br><span class="line">            <span class="built_in">free</span>(*root);</span><br><span class="line">            *root = <span class="literal">NULL</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> ((*root)-&gt;left == <span class="literal">NULL</span>) &#123;</span><br><span class="line">            Node *temp = *root;</span><br><span class="line">            *root = (*root)-&gt;right;</span><br><span class="line">            <span class="built_in">free</span>(temp);</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> ((*root)-&gt;right == <span class="literal">NULL</span>) &#123;</span><br><span class="line">            Node *temp = *root;</span><br><span class="line">            *root = (*root)-&gt;left;</span><br><span class="line">            <span class="built_in">free</span>(temp);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            Node *temp = findMinNode((*root)-&gt;right);</span><br><span class="line">            (*root)-&gt;data = temp-&gt;data;</span><br><span class="line">            deleteNode(&amp;(*root)-&gt;right, temp-&gt;data);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Node *<span class="title function_">findMinNode</span><span class="params">(Node *root)</span> &#123;</span><br><span class="line">    Node *temp = root;</span><br><span class="line">    <span class="keyword">while</span> (temp-&gt;left != <span class="literal">NULL</span>) &#123;</span><br><span class="line">        temp = temp-&gt;left;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> temp;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">printTree</span><span class="params">(Node *root)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (root == <span class="literal">NULL</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    printTree(root-&gt;left);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%d &quot;</span>, root-&gt;data);</span><br><span class="line">    printTree(root-&gt;right);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span> &#123;</span><br><span class="line">    Node *root = <span class="literal">NULL</span>;</span><br><span class="line">    insertNode(&amp;root, <span class="number">5</span>);</span><br><span class="line">    insertNode(&amp;root, <span class="number">3</span>);</span><br><span class="line">    insertNode(&amp;root, <span class="number">7</span>);</span><br><span class="line">    insertNode(&amp;root, <span class="number">2</span>);</span><br><span class="line">    insertNode(&amp;root, <span class="number">4</span>);</span><br><span class="line">    insertNode(&amp;root, <span class="number">6</span>);</span><br><span class="line">    insertNode(&amp;root, <span class="number">8</span>);</span><br><span class="line">    printTree(root); <span class="comment">// è¾“å‡º 2 3 4 5 6 7 8</span></span><br><span class="line">    deleteNode(&amp;root, <span class="number">4</span>);</span><br><span class="line">    printTree(root); <span class="comment">// è¾“å‡º 2 3 5 6 7 8</span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="Cè¯­è¨€å›¾"><a href="#Cè¯­è¨€å›¾" class="headerlink" title="Cè¯­è¨€å›¾"></a>Cè¯­è¨€å›¾</h1><p>å›¾æ˜¯ä¸€ç§éçº¿æ€§æ•°æ®ç»“æ„ï¼Œå®ƒç”±ä¸€ç³»åˆ—èŠ‚ç‚¹å’Œè¾¹ç»„æˆï¼Œæ¯ä¸ªèŠ‚ç‚¹å¯ä»¥ä¸å¤šä¸ªèŠ‚ç‚¹ç›¸è¿ã€‚å›¾çš„åŸºæœ¬æ“ä½œåŒ…æ‹¬æ’å…¥ã€åˆ é™¤å’ŒæŸ¥æ‰¾ã€‚</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">Node</span> &#123;</span></span><br><span class="line">    <span class="type">int</span> data;</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">Node</span> *<span class="title">next</span>;</span></span><br><span class="line">&#125; Node;</span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">Graph</span> &#123;</span></span><br><span class="line">    <span class="type">int</span> numVertices;</span><br><span class="line">    Node **adjLists;</span><br><span class="line">&#125; Graph;</span><br><span class="line"></span><br><span class="line">Node *<span class="title function_">createNode</span><span class="params">(<span class="type">int</span> data)</span> &#123;</span><br><span class="line">        </span><br><span class="line">    Node *node = (Node *)<span class="built_in">malloc</span>(<span class="keyword">sizeof</span>(Node));</span><br><span class="line">    node-&gt;data = data;</span><br><span class="line">    node-&gt;next = <span class="literal">NULL</span>;</span><br><span class="line">    <span class="keyword">return</span> node;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Graph *<span class="title function_">createGraph</span><span class="params">(<span class="type">int</span> numVertices)</span> &#123;</span><br><span class="line">    Graph *graph = (Graph *)<span class="built_in">malloc</span>(<span class="keyword">sizeof</span>(Graph));</span><br><span class="line">    graph-&gt;numVertices = numVertices;</span><br><span class="line">    graph-&gt;adjLists = (Node **)<span class="built_in">malloc</span>(numVertices * <span class="keyword">sizeof</span>(Node *));</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; numVertices; i++) &#123;</span><br><span class="line">        graph-&gt;adjLists[i] = <span class="literal">NULL</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> graph;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">addEdge</span><span class="params">(Graph *graph, <span class="type">int</span> src, <span class="type">int</span> dest)</span> &#123;</span><br><span class="line">    Node *newNode = createNode(dest);</span><br><span class="line">    newNode-&gt;next = graph-&gt;adjLists[src];</span><br><span class="line">    graph-&gt;adjLists[src] = newNode;</span><br><span class="line"></span><br><span class="line">    newNode = createNode(src);</span><br><span class="line">    newNode-&gt;next = graph-&gt;adjLists[dest];</span><br><span class="line">    graph-&gt;adjLists[dest] = newNode;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">printGraph</span><span class="params">(Graph *graph)</span> &#123;</span><br><span class="line">    <span class="type">int</span> v;</span><br><span class="line">    <span class="keyword">for</span> (v = <span class="number">0</span>; v &lt; graph-&gt;numVertices; v++) &#123;</span><br><span class="line">        Node *temp = graph-&gt;adjLists[v];</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;\n Adjacency list of vertex %d\n &quot;</span>, v);</span><br><span class="line">        <span class="keyword">while</span> (temp) &#123;</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;%d -&gt; &quot;</span>, temp-&gt;data);</span><br><span class="line">            temp = temp-&gt;next;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;\n&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span> &#123;</span><br><span class="line">    Graph *graph = createGraph(<span class="number">5</span>);</span><br><span class="line">    addEdge(graph, <span class="number">0</span>, <span class="number">1</span>);</span><br><span class="line">    addEdge(graph, <span class="number">0</span>, <span class="number">4</span>);</span><br><span class="line">    addEdge(graph, <span class="number">1</span>, <span class="number">2</span>);</span><br><span class="line">    addEdge(graph, <span class="number">1</span>, <span class="number">3</span>);</span><br><span class="line">    addEdge(graph, <span class="number">1</span>, <span class="number">4</span>);</span><br><span class="line">    addEdge(graph, <span class="number">2</span>, <span class="number">3</span>);</span><br><span class="line">    addEdge(graph, <span class="number">3</span>, <span class="number">4</span>);</span><br><span class="line">    printGraph(graph);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="Cè¯­è¨€å †"><a href="#Cè¯­è¨€å †" class="headerlink" title="Cè¯­è¨€å †"></a>Cè¯­è¨€å †</h1><p>å †æ˜¯ä¸€ç§ç‰¹æ®Šçš„æ ‘å½¢æ•°æ®ç»“æ„ï¼Œå®ƒæ»¡è¶³å †å±æ€§ï¼Œå³æ¯ä¸ªèŠ‚ç‚¹çš„å€¼éƒ½å¤§äºæˆ–ç­‰äºï¼ˆæˆ–å°äºæˆ–ç­‰äºï¼‰å…¶å­èŠ‚ç‚¹çš„å€¼ã€‚å †çš„åŸºæœ¬æ“ä½œåŒ…æ‹¬æ’å…¥ã€åˆ é™¤å’ŒæŸ¥æ‰¾ã€‚</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">Heap</span> &#123;</span></span><br><span class="line">    <span class="type">int</span> *<span class="built_in">array</span>;</span><br><span class="line">    <span class="type">int</span> capacity;</span><br><span class="line">    <span class="type">int</span> size;</span><br><span class="line">&#125; Heap;</span><br><span class="line"></span><br><span class="line">Heap *<span class="title function_">createHeap</span><span class="params">(<span class="type">int</span> capacity)</span> &#123;</span><br><span class="line">    Heap *heap = (Heap *)<span class="built_in">malloc</span>(<span class="keyword">sizeof</span>(Heap));</span><br><span class="line">    heap-&gt;<span class="built_in">array</span> = (<span class="type">int</span> *)<span class="built_in">malloc</span>(capacity * <span class="keyword">sizeof</span>(<span class="type">int</span>));</span><br><span class="line">    heap-&gt;capacity = capacity;</span><br><span class="line">    heap-&gt;size = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">return</span> heap;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">insert</span><span class="params">(Heap *heap, <span class="type">int</span> data)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (heap-&gt;size == heap-&gt;capacity) &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;Heap is full\n&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        heap-&gt;<span class="built_in">array</span>[heap-&gt;size] = data;</span><br><span class="line">        heap-&gt;size++;</span><br><span class="line">        <span class="type">int</span> child = heap-&gt;size - <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">while</span> (child &gt; <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="type">int</span> parent = (child - <span class="number">1</span>) / <span class="number">2</span>;</span><br><span class="line">            <span class="keyword">if</span> (heap-&gt;<span class="built_in">array</span>[child] &lt; heap-&gt;<span class="built_in">array</span>[parent]) &#123;</span><br><span class="line">                <span class="type">int</span> temp = heap-&gt;<span class="built_in">array</span>[child];</span><br><span class="line">                heap-&gt;<span class="built_in">array</span>[child] = heap-&gt;<span class="built_in">array</span>[parent];</span><br><span class="line">                heap-&gt;<span class="built_in">array</span>[parent] = temp;</span><br><span class="line">            &#125;</span><br><span class="line">            child = parent;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">delete</span><span class="params">(Heap *heap)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (heap-&gt;size == <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;Heap is empty\n&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        heap-&gt;<span class="built_in">array</span>[<span class="number">0</span>] = heap-&gt;<span class="built_in">array</span>[heap-&gt;size - <span class="number">1</span>];</span><br><span class="line">        heap-&gt;size--;</span><br><span class="line">        <span class="type">int</span> parent = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">while</span> (parent &lt; heap-&gt;size) &#123;</span><br><span class="line">            <span class="type">int</span> leftChild = <span class="number">2</span> * parent + <span class="number">1</span>; <span class="comment">// left child</span></span><br><span class="line">            <span class="type">int</span> rightChild = <span class="number">2</span> * parent + <span class="number">2</span>; <span class="comment">// right child</span></span><br><span class="line">            <span class="type">int</span> min = parent;</span><br><span class="line">            <span class="keyword">if</span> (leftChild &lt; heap-&gt;size &amp;&amp; heap-&gt;<span class="built_in">array</span>[leftChild] &lt; heap-&gt;<span class="built_in">array</span>[min]) &#123;</span><br><span class="line">                min = leftChild;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (rightChild &lt; heap-&gt;size &amp;&amp; heap-&gt;<span class="built_in">array</span>[rightChild] &lt; heap-&gt;<span class="built_in">array</span>[min]) &#123;</span><br><span class="line">                </span><br><span class="line">                min = rightChild;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (min != parent) &#123;</span><br><span class="line">                <span class="type">int</span> temp = heap-&gt;<span class="built_in">array</span>[min];</span><br><span class="line">                heap-&gt;<span class="built_in">array</span>[min] = heap-&gt;<span class="built_in">array</span>[parent];</span><br><span class="line">                heap-&gt;<span class="built_in">array</span>[parent] = temp;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            parent = min;</span><br><span class="line">            &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">printHeap</span><span class="params">(Heap *heap)</span> &#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; heap-&gt;size; i++) &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%d &quot;</span>, heap-&gt;<span class="built_in">array</span>[i]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;\n&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span> &#123;</span><br><span class="line">    Heap *heap = createHeap(<span class="number">10</span>);</span><br><span class="line">    insert(heap, <span class="number">10</span>);</span><br><span class="line">    insert(heap, <span class="number">20</span>);</span><br><span class="line">    insert(heap, <span class="number">30</span>);</span><br><span class="line">    insert(heap, <span class="number">40</span>);</span><br><span class="line">    insert(heap, <span class="number">50</span>);</span><br><span class="line">    printHeap(heap);</span><br><span class="line">    delete(heap);</span><br><span class="line">    printHeap(heap);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>æ•°æ®ç»“æ„</category>
      </categories>
      <tags>
        <tag>C</tag>
      </tags>
  </entry>
  <entry>
    <title>åŸºäº RTSP åè®®ä¸ WebRTC-Streamer å®ç°æµ·åº·æ‘„åƒå¤´è§†é¢‘æµçš„ç½‘é¡µå®æ—¶æ’­æ”¾</title>
    <url>/2025/10/24/%E7%BD%91%E7%BB%9C%E5%8D%8F%E8%AE%AE%E4%B8%8E%E6%B5%81%E5%AA%92%E4%BD%93/%E5%9F%BA%E4%BA%8E-RTSP-%E5%8D%8F%E8%AE%AE%E4%B8%8E-WebRTC-Streamer-%E5%AE%9E%E7%8E%B0%E6%B5%B7%E5%BA%B7%E6%91%84%E5%83%8F%E5%A4%B4%E8%A7%86%E9%A2%91%E6%B5%81%E7%9A%84%E7%BD%91%E9%A1%B5%E5%AE%9E%E6%97%B6%E6%92%AD%E6%94%BE/</url>
    <content><![CDATA[<h3 id="ä¸€ã€å‰è¨€"><a href="#ä¸€ã€å‰è¨€" class="headerlink" title="ä¸€ã€å‰è¨€"></a>ä¸€ã€å‰è¨€</h3><p>æœ€è¿‘åœ¨åšä¸€ä¸ªå®‰é˜²ç›‘æ§é¡¹ç›®æ—¶ï¼Œé‡åˆ°äº†ä¸€ä¸ªå¸¸è§çš„æŠ€æœ¯éš¾é¢˜ï¼šå¦‚ä½•åœ¨ç½‘é¡µä¸Šå®æ—¶æ’­æ”¾æµ·åº·æ‘„åƒå¤´çš„è§†é¢‘æµï¼Ÿå¤§å®¶éƒ½çŸ¥é“ï¼Œæµ·åº·ç­‰ä¸»æµæ‘„åƒå¤´é€šå¸¸ä½¿ç”¨ RTSP åè®®è¾“å‡ºè§†é¢‘ï¼Œä½†æµè§ˆå™¨å¹¶ä¸æ”¯æŒç›´æ¥æ’­æ”¾ RTSP æµï¼Œè¿™ç»™ Web ç«¯é›†æˆå¸¦æ¥äº†å¾ˆå¤§æŒ‘æˆ˜ã€‚</p>
<p>ç»è¿‡å¤šæ¬¡å°è¯•å’Œè¸©å‘ï¼Œæˆ‘å‘ç° WebRTC-Streamer æ˜¯ä¸€ä¸ªéå¸¸è½»é‡çº§ä¸”é«˜æ•ˆçš„è§£å†³æ–¹æ¡ˆã€‚å®ƒèƒ½å°† RTSP æµå®æ—¶è½¬æ¢ä¸ºæµè§ˆå™¨æ”¯æŒçš„ WebRTC æµï¼Œå®ç°æ¯«ç§’çº§å»¶è¿Ÿçš„è§†é¢‘æ’­æ”¾ã€‚ä»Šå¤©å°±æŠŠæ•´ä¸ªå®ç°è¿‡ç¨‹å’Œç»éªŒåˆ†äº«ç»™å¤§å®¶ï¼Œå¸Œæœ›èƒ½å¸®åŠ©åˆ°æœ‰ç±»ä¼¼éœ€æ±‚çš„å¼€å‘è€…ã€‚</p>
<hr>
<h3 id="äºŒã€æ ¸å¿ƒåŸç†è§£æ"><a href="#äºŒã€æ ¸å¿ƒåŸç†è§£æ" class="headerlink" title="äºŒã€æ ¸å¿ƒåŸç†è§£æ"></a>äºŒã€æ ¸å¿ƒåŸç†è§£æ</h3><h4 id="1-RTSP-åè®®ç®€ä»‹"><a href="#1-RTSP-åè®®ç®€ä»‹" class="headerlink" title="1. RTSP åè®®ç®€ä»‹"></a>1. RTSP åè®®ç®€ä»‹</h4><p>å…ˆç®€å•è¯´ä¸€ä¸‹ RTSP åè®®ã€‚RTSPï¼ˆReal Time Streaming Protocolï¼‰æ˜¯ä¸“é—¨ä¸ºå®æ—¶æµåª’ä½“è®¾è®¡çš„æ§åˆ¶åè®®ï¼Œæµ·åº·ã€å¤§åç­‰ä¸»æµå®‰é˜²è®¾å¤‡éƒ½é»˜è®¤æ”¯æŒã€‚æˆ‘ä»¬å¹³æ—¶è®¿é—®æ‘„åƒå¤´æ—¶ï¼Œå¸¸ç”¨çš„ RTSP URL æ ¼å¼æ˜¯è¿™æ ·çš„ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">rtsp://ç”¨æˆ·å:å¯†ç @æ‘„åƒå¤´IP:554/Streaming/Channels/101</span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œæœ‰ä¸ªå°ç»†èŠ‚éœ€è¦æ³¨æ„ï¼šURL ä¸­çš„æ•°å­—ç»„åˆå¾ˆå…³é”®ï¼Œ<code>101</code> ä»£è¡¨ä¸»ç æµï¼ˆé«˜æ¸…ï¼‰ï¼Œè€Œ <code>102</code> åˆ™ä»£è¡¨å­ç æµï¼ˆæ ‡æ¸…ï¼‰ã€‚åœ¨å®é™…åº”ç”¨ä¸­ï¼Œå¦‚æœç½‘ç»œå¸¦å®½æœ‰é™ï¼Œå¯ä»¥è€ƒè™‘ä½¿ç”¨å­ç æµæ¥ä¿è¯æµç•…åº¦ã€‚</p>
<p>RTSP æœ€å¤§çš„ä¼˜åŠ¿æ˜¯å»¶è¿Ÿä½ï¼Œä½†å®ƒçš„ç¼ºç‚¹ä¹Ÿå¾ˆæ˜æ˜¾â€”â€”æµè§ˆå™¨å¹¶ä¸æ”¯æŒç›´æ¥æ’­æ”¾ï¼Œè¿™ä¹Ÿæ˜¯æˆ‘ä»¬éœ€è¦ WebRTC-Streamer çš„åŸå› ã€‚</p>
<h4 id="2-WebRTC-åè®®ç®€ä»‹"><a href="#2-WebRTC-åè®®ç®€ä»‹" class="headerlink" title="2. WebRTC åè®®ç®€ä»‹"></a>2. WebRTC åè®®ç®€ä»‹</h4><p>WebRTCï¼ˆWeb Real-Time Communicationï¼‰ç›¸ä¿¡å¤§å®¶éƒ½ä¸é™Œç”Ÿï¼Œå®ƒæ˜¯æµè§ˆå™¨åŸç”Ÿæ”¯æŒçš„å®æ—¶é€šä¿¡æŠ€æœ¯ã€‚åœ¨å®é™…ä½¿ç”¨ä¸­ï¼Œæˆ‘å‘ç° WebRTC æœ‰å‡ ä¸ªéå¸¸çªå‡ºçš„ä¼˜åŠ¿ï¼š</p>
<ul>
<li>å®Œå…¨ä¸éœ€è¦å®‰è£…ä»»ä½•æ’ä»¶ï¼Œæ‰€æœ‰ç°ä»£æµè§ˆå™¨éƒ½åŸç”Ÿæ”¯æŒ</li>
<li>å»¶è¿Ÿæä½ï¼Œå®é™…æµ‹è¯•ä¸­é€šå¸¸èƒ½æ§åˆ¶åœ¨ 500ms ä»¥å†…</li>
<li>å†…ç½®äº† NAT ç©¿é€åŠŸèƒ½ï¼Œè¿™å¯¹äºå¤æ‚ç½‘ç»œç¯å¢ƒä¸‹çš„éƒ¨ç½²éå¸¸å‹å¥½</li>
<li>æ”¯æŒç«¯åˆ°ç«¯åŠ å¯†ï¼Œå®‰å…¨æ€§æœ‰ä¿éšœ</li>
</ul>
<p>æ­£æ˜¯è¿™äº›ç‰¹æ€§ï¼Œè®© WebRTC æˆä¸ºäº†æµè§ˆå™¨å®æ—¶è§†é¢‘æ’­æ”¾çš„ç†æƒ³é€‰æ‹©ã€‚</p>
<h4 id="3-WebRTC-Streamer-ä½œç”¨"><a href="#3-WebRTC-Streamer-ä½œç”¨" class="headerlink" title="3. WebRTC-Streamer ä½œç”¨"></a>3. WebRTC-Streamer ä½œç”¨</h4><p>WebRTC-Streamer æ˜¯æ•´ä¸ªè§£å†³æ–¹æ¡ˆçš„æ ¸å¿ƒï¼Œå®ƒå°±åƒä¸€ä¸ªã€Œç¿»è¯‘å®˜ã€ï¼Œåœ¨ RTSP å’Œ WebRTC ä¹‹é—´æ¶èµ·äº†ä¸€åº§æ¡¥æ¢ã€‚æˆ‘åœ¨é¡¹ç›®ä¸­ä½¿ç”¨åå‘ç°ï¼Œå®ƒçš„è®¾è®¡éå¸¸å·§å¦™ï¼š</p>
<ul>
<li>é¦–å…ˆï¼Œå®ƒèƒ½æ¥æ”¶æ¥è‡ªæ‘„åƒå¤´çš„ RTSP æµï¼ˆå®é™…ä¸Šå®ƒè¿˜æ”¯æŒ RTMPã€HTTP ç­‰å¤šç§åè®®ï¼‰</li>
<li>ç„¶åï¼Œå®ƒä¼šæ™ºèƒ½åœ°è¿›è¡Œè½¬å°è£…å¤„ç†ï¼Œå°½å¯èƒ½é¿å…å…¨é‡è½¬ç ï¼ˆè¿™å¯¹æ€§èƒ½å½±å“å¾ˆå¤§ï¼‰</li>
<li>æœ€åï¼Œå®ƒé€šè¿‡ WebRTC åè®®å°†è§†é¢‘æµè¾“å‡ºç»™æµè§ˆå™¨</li>
<li>åŒæ—¶ï¼Œå®ƒè¿˜å†…ç½®äº† WebSocket ä¿¡ä»¤æœåŠ¡ï¼Œè®©å‰ç«¯å¯ä»¥æ–¹ä¾¿åœ°æ§åˆ¶è§†é¢‘æµ</li>
</ul>
<p>è¿™æ ·ä¸€æ¥ï¼Œå°±å½¢æˆäº†ä¸€æ¡å®Œæ•´çš„ä¼ è¾“é“¾è·¯ï¼šæ‘„åƒå¤´ â†’ WebRTC-Streamer â†’ æµè§ˆå™¨ï¼Œå®ç°äº†ä»ä¸“ä¸šå®‰é˜²è®¾å¤‡åˆ° Web å‰ç«¯çš„æ— ç¼è¡”æ¥ã€‚</p>
<hr>
<h3 id="ä¸‰ã€éƒ¨ç½²ç¯å¢ƒå‡†å¤‡"><a href="#ä¸‰ã€éƒ¨ç½²ç¯å¢ƒå‡†å¤‡" class="headerlink" title="ä¸‰ã€éƒ¨ç½²ç¯å¢ƒå‡†å¤‡"></a>ä¸‰ã€éƒ¨ç½²ç¯å¢ƒå‡†å¤‡</h3><h4 id="1-å‰ç½®æ¡ä»¶"><a href="#1-å‰ç½®æ¡ä»¶" class="headerlink" title="1. å‰ç½®æ¡ä»¶"></a>1. å‰ç½®æ¡ä»¶</h4><p>åœ¨å¼€å§‹ä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦å‡†å¤‡ä»¥ä¸‹ç¯å¢ƒï¼š</p>
<ul>
<li>ä¸€å°æ”¯æŒ RTSP åè®®çš„æµ·åº·æ‘„åƒå¤´ï¼ˆç¡®ä¿ RTSP åŠŸèƒ½å·²å¼€å¯ï¼‰</li>
<li>ä¸€å°æœåŠ¡å™¨æˆ–æœ¬åœ°ç”µè„‘ï¼ˆç”¨äºéƒ¨ç½² WebRTC-Streamerï¼‰</li>
<li>Docker ç¯å¢ƒï¼ˆå¼ºçƒˆæ¨èï¼Œèƒ½æå¤§ç®€åŒ–éƒ¨ç½²æµç¨‹ï¼‰</li>
</ul>
<h4 id="2-è·å–æ‘„åƒå¤´-RTSP-åœ°å€"><a href="#2-è·å–æ‘„åƒå¤´-RTSP-åœ°å€" class="headerlink" title="2. è·å–æ‘„åƒå¤´ RTSP åœ°å€"></a>2. è·å–æ‘„åƒå¤´ RTSP åœ°å€</h4><p>è¿™ä¸€æ­¥å¾ˆå…³é”®ï¼Œå¾ˆå¤šæœ‹å‹åœ¨è¿™é‡Œé‡åˆ°é—®é¢˜ã€‚é¦–å…ˆï¼Œç™»å½•æµ·åº·æ‘„åƒå¤´çš„ç®¡ç†åå°ï¼Œè¿›å…¥ã€Œç½‘ç»œè®¾ç½® â†’ é«˜çº§è®¾ç½® â†’ ç«¯å£ã€ï¼Œç¡®è®¤ RTSP ç«¯å£æ˜¯å¦ä¸ºé»˜è®¤çš„ 554ï¼ˆå¤§å¤šæ•°æƒ…å†µä¸‹éƒ½æ˜¯ï¼‰ã€‚</p>
<p>ç„¶åï¼Œæ ¹æ®æ‘„åƒå¤´çš„ç”¨æˆ·åã€å¯†ç å’Œ IP åœ°å€ï¼ŒæŒ‰ç…§æ ¼å¼æ‹¼æ¥ RTSP URLï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">rtsp://admin:12345@192.168.1.64:554/Streaming/Channels/101</span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œè¦æ³¨æ„ï¼Œä¸åŒå‹å·çš„æµ·åº·æ‘„åƒå¤´å¯èƒ½ URL æ ¼å¼ç•¥æœ‰ä¸åŒã€‚å¦‚æœé‡åˆ°è¿æ¥é—®é¢˜ï¼Œå¯ä»¥æŸ¥é˜…å¯¹åº”å‹å·çš„å®˜æ–¹æ–‡æ¡£ã€‚</p>
<hr>
<h3 id="å››ã€ä½¿ç”¨-WebRTC-Streamer-è½¬æ¨-RTSP-æµ"><a href="#å››ã€ä½¿ç”¨-WebRTC-Streamer-è½¬æ¨-RTSP-æµ" class="headerlink" title="å››ã€ä½¿ç”¨ WebRTC-Streamer è½¬æ¨ RTSP æµ"></a>å››ã€ä½¿ç”¨ WebRTC-Streamer è½¬æ¨ RTSP æµ</h3><h4 id="1-æ‹‰å–é•œåƒå¹¶è¿è¡Œ"><a href="#1-æ‹‰å–é•œåƒå¹¶è¿è¡Œ" class="headerlink" title="1. æ‹‰å–é•œåƒå¹¶è¿è¡Œ"></a>1. æ‹‰å–é•œåƒå¹¶è¿è¡Œ</h4><p>ä½¿ç”¨ Docker éƒ¨ç½²æ˜¯æœ€ç®€ä¾¿çš„æ–¹å¼ï¼Œä¸€è¡Œå‘½ä»¤å°±èƒ½æå®šï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">docker run -d \</span><br><span class="line">  --name webrtc-streamer \</span><br><span class="line">  -p 8000:8000 \</span><br><span class="line">  -e RTSP_URL=<span class="string">&quot;rtsp://admin:12345@192.168.1.64:554/Streaming/Channels/101&quot;</span> \</span><br><span class="line">  mpromonet/webrtc-streamer</span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œç”¨çš„æ˜¯å®˜æ–¹ç»´æŠ¤çš„ <code>mpromonet/webrtc-streamer</code> é•œåƒï¼Œæ”¯æŒå¤šç§æ“ä½œç³»ç»Ÿå’Œç¡¬ä»¶å¹³å°ï¼Œç¨³å®šæ€§å’Œå…¼å®¹æ€§éƒ½å¾ˆä¸é”™ã€‚å¯åŠ¨åï¼ŒæœåŠ¡ä¼šé»˜è®¤ç›‘å¬ 8000 ç«¯å£ã€‚</p>
<h4 id="2-éªŒè¯æœåŠ¡"><a href="#2-éªŒè¯æœåŠ¡" class="headerlink" title="2. éªŒè¯æœåŠ¡"></a>2. éªŒè¯æœåŠ¡</h4><p>éƒ¨ç½²å®Œæˆåï¼Œæˆ‘ä»¬éœ€è¦éªŒè¯æœåŠ¡æ˜¯å¦æ­£å¸¸è¿è¡Œã€‚æ‰“å¼€æµè§ˆå™¨ï¼Œè®¿é—®ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">http://&lt;ä½ çš„æœåŠ¡å™¨IP&gt;:8000</span><br></pre></td></tr></table></figure>

<p>å¦‚æœä¸€åˆ‡é¡ºåˆ©ï¼Œä½ ä¼šçœ‹åˆ° WebRTC-Streamer çš„é»˜è®¤æ’­æ”¾é¡µé¢ã€‚åœ¨é¡µé¢çš„è¾“å…¥æ¡†ä¸­ï¼Œä½ å¯ä»¥æ‰‹åŠ¨è¾“å…¥ RTSP åœ°å€ï¼Œæˆ–è€…å¦‚æœä¹‹å‰åœ¨å¯åŠ¨å®¹å™¨æ—¶å·²ç»é€šè¿‡ç¯å¢ƒå˜é‡æŒ‡å®šäº† RTSP URLï¼Œç³»ç»Ÿå¯èƒ½ä¼šè‡ªåŠ¨è¯†åˆ«å¹¶æ˜¾ç¤ºå¯¹åº”çš„æµã€‚ç‚¹å‡»æ’­æ”¾æŒ‰é’®ï¼Œå°±èƒ½çœ‹åˆ°æ‘„åƒå¤´çš„å®æ—¶ç”»é¢äº†ã€‚</p>
<hr>
<h3 id="äº”ã€å‰ç«¯ç½‘é¡µåµŒå…¥-WebRTC-æ’­æ”¾"><a href="#äº”ã€å‰ç«¯ç½‘é¡µåµŒå…¥-WebRTC-æ’­æ”¾" class="headerlink" title="äº”ã€å‰ç«¯ç½‘é¡µåµŒå…¥ WebRTC æ’­æ”¾"></a>äº”ã€å‰ç«¯ç½‘é¡µåµŒå…¥ WebRTC æ’­æ”¾</h3><p>åœ¨å®é™…é¡¹ç›®ä¸­ï¼Œæˆ‘ä»¬é€šå¸¸éœ€è¦å°†è§†é¢‘æ’­æ”¾åŠŸèƒ½é›†æˆåˆ°è‡ªå·±çš„ç³»ç»Ÿä¸­ã€‚WebRTC-Streamer æä¾›äº†ç®€æ´çš„ HTTP APIï¼Œå¯ä»¥å¾ˆæ–¹ä¾¿åœ°åµŒå…¥åˆ°æˆ‘ä»¬çš„å‰ç«¯é¡µé¢ã€‚</p>
<p>ä¸‹é¢æ˜¯ä¸€ä¸ªæˆ‘åœ¨é¡¹ç›®ä¸­ä½¿ç”¨è¿‡çš„é›†æˆç¤ºä¾‹ï¼Œå·²ç»è¿‡ä¼˜åŒ–å¹¶æ·»åŠ äº†å®Œå–„çš„é”™è¯¯å¤„ç†å’Œç”¨æˆ·ä½“éªŒè®¾è®¡ï¼š</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;zh-CN&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;viewport&quot;</span> <span class="attr">content</span>=<span class="string">&quot;width=device-width, initial-scale=1.0&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">title</span>&gt;</span>æµ·åº·è§†é¢‘å®æ—¶é¢„è§ˆ<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;./webrtcstreamer.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="language-css"></span></span><br><span class="line"><span class="language-css">    * &#123;</span></span><br><span class="line"><span class="language-css">      <span class="attribute">margin</span>: <span class="number">0</span>;</span></span><br><span class="line"><span class="language-css">      <span class="attribute">padding</span>: <span class="number">0</span>;</span></span><br><span class="line"><span class="language-css">      <span class="attribute">box-sizing</span>: border-box;</span></span><br><span class="line"><span class="language-css">    &#125;</span></span><br><span class="line"><span class="language-css">    </span></span><br><span class="line"><span class="language-css">    <span class="selector-tag">body</span> &#123;</span></span><br><span class="line"><span class="language-css">      <span class="attribute">font-family</span>: <span class="string">&#x27;Microsoft YaHei&#x27;</span>, Arial, sans-serif;</span></span><br><span class="line"><span class="language-css">      <span class="attribute">background-color</span>: <span class="number">#f5f5f5</span>;</span></span><br><span class="line"><span class="language-css">      <span class="attribute">color</span>: <span class="number">#333</span>;</span></span><br><span class="line"><span class="language-css">      <span class="attribute">line-height</span>: <span class="number">1.6</span>;</span></span><br><span class="line"><span class="language-css">      <span class="attribute">padding</span>: <span class="number">20px</span>;</span></span><br><span class="line"><span class="language-css">      <span class="attribute">min-height</span>: <span class="number">100vh</span>;</span></span><br><span class="line"><span class="language-css">      <span class="attribute">display</span>: flex;</span></span><br><span class="line"><span class="language-css">      <span class="attribute">flex-direction</span>: column;</span></span><br><span class="line"><span class="language-css">      <span class="attribute">align-items</span>: center;</span></span><br><span class="line"><span class="language-css">    &#125;</span></span><br><span class="line"><span class="language-css">    </span></span><br><span class="line"><span class="language-css">    <span class="selector-class">.container</span> &#123;</span></span><br><span class="line"><span class="language-css">      <span class="attribute">width</span>: <span class="number">100%</span>;</span></span><br><span class="line"><span class="language-css">      <span class="attribute">max-width</span>: <span class="number">800px</span>;</span></span><br><span class="line"><span class="language-css">      <span class="attribute">background</span>: white;</span></span><br><span class="line"><span class="language-css">      <span class="attribute">border-radius</span>: <span class="number">12px</span>;</span></span><br><span class="line"><span class="language-css">      <span class="attribute">box-shadow</span>: <span class="number">0</span> <span class="number">4px</span> <span class="number">20px</span> <span class="built_in">rgba</span>(<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0.1</span>);</span></span><br><span class="line"><span class="language-css">      <span class="attribute">overflow</span>: hidden;</span></span><br><span class="line"><span class="language-css">    &#125;</span></span><br><span class="line"><span class="language-css">    </span></span><br><span class="line"><span class="language-css">    <span class="selector-class">.header</span> &#123;</span></span><br><span class="line"><span class="language-css">      <span class="attribute">background</span>: <span class="built_in">linear-gradient</span>(<span class="number">135deg</span>, <span class="number">#1e88e5</span>, <span class="number">#2196f3</span>);</span></span><br><span class="line"><span class="language-css">      <span class="attribute">color</span>: white;</span></span><br><span class="line"><span class="language-css">      <span class="attribute">padding</span>: <span class="number">20px</span>;</span></span><br><span class="line"><span class="language-css">      <span class="attribute">text-align</span>: center;</span></span><br><span class="line"><span class="language-css">    &#125;</span></span><br><span class="line"><span class="language-css">    </span></span><br><span class="line"><span class="language-css">    <span class="selector-class">.header</span> <span class="selector-tag">h1</span> &#123;</span></span><br><span class="line"><span class="language-css">      <span class="attribute">font-size</span>: <span class="number">1.8rem</span>;</span></span><br><span class="line"><span class="language-css">      <span class="attribute">font-weight</span>: <span class="number">500</span>;</span></span><br><span class="line"><span class="language-css">      <span class="attribute">margin</span>: <span class="number">0</span>;</span></span><br><span class="line"><span class="language-css">    &#125;</span></span><br><span class="line"><span class="language-css">    </span></span><br><span class="line"><span class="language-css">    <span class="selector-class">.video-container</span> &#123;</span></span><br><span class="line"><span class="language-css">      <span class="attribute">position</span>: relative;</span></span><br><span class="line"><span class="language-css">      <span class="attribute">width</span>: <span class="number">100%</span>;</span></span><br><span class="line"><span class="language-css">      <span class="attribute">padding-top</span>: <span class="number">56.25%</span>; <span class="comment">/* 16:9 Aspect Ratio */</span></span></span><br><span class="line"><span class="language-css">      <span class="attribute">background</span>: <span class="number">#000</span>;</span></span><br><span class="line"><span class="language-css">      <span class="attribute">overflow</span>: hidden;</span></span><br><span class="line"><span class="language-css">    &#125;</span></span><br><span class="line"><span class="language-css">    </span></span><br><span class="line"><span class="language-css">    <span class="selector-id">#video</span> &#123;</span></span><br><span class="line"><span class="language-css">      <span class="attribute">position</span>: absolute;</span></span><br><span class="line"><span class="language-css">      <span class="attribute">top</span>: <span class="number">0</span>;</span></span><br><span class="line"><span class="language-css">      <span class="attribute">left</span>: <span class="number">0</span>;</span></span><br><span class="line"><span class="language-css">      <span class="attribute">width</span>: <span class="number">100%</span>;</span></span><br><span class="line"><span class="language-css">      <span class="attribute">height</span>: <span class="number">100%</span>;</span></span><br><span class="line"><span class="language-css">      <span class="attribute">object-fit</span>: contain;</span></span><br><span class="line"><span class="language-css">    &#125;</span></span><br><span class="line"><span class="language-css">    </span></span><br><span class="line"><span class="language-css">    <span class="selector-class">.status-overlay</span> &#123;</span></span><br><span class="line"><span class="language-css">      <span class="attribute">position</span>: absolute;</span></span><br><span class="line"><span class="language-css">      <span class="attribute">top</span>: <span class="number">10px</span>;</span></span><br><span class="line"><span class="language-css">      <span class="attribute">right</span>: <span class="number">10px</span>;</span></span><br><span class="line"><span class="language-css">      <span class="attribute">padding</span>: <span class="number">8px</span> <span class="number">12px</span>;</span></span><br><span class="line"><span class="language-css">      <span class="attribute">border-radius</span>: <span class="number">4px</span>;</span></span><br><span class="line"><span class="language-css">      <span class="attribute">font-size</span>: <span class="number">0.9rem</span>;</span></span><br><span class="line"><span class="language-css">      <span class="attribute">font-weight</span>: <span class="number">500</span>;</span></span><br><span class="line"><span class="language-css">      <span class="attribute">background</span>: <span class="built_in">rgba</span>(<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0.7</span>);</span></span><br><span class="line"><span class="language-css">      <span class="attribute">color</span>: white;</span></span><br><span class="line"><span class="language-css">      <span class="attribute">z-index</span>: <span class="number">10</span>;</span></span><br><span class="line"><span class="language-css">      <span class="attribute">display</span>: flex;</span></span><br><span class="line"><span class="language-css">      <span class="attribute">align-items</span>: center;</span></span><br><span class="line"><span class="language-css">      <span class="attribute">gap</span>: <span class="number">8px</span>;</span></span><br><span class="line"><span class="language-css">    &#125;</span></span><br><span class="line"><span class="language-css">    </span></span><br><span class="line"><span class="language-css">    <span class="selector-class">.status-indicator</span> &#123;</span></span><br><span class="line"><span class="language-css">      <span class="attribute">width</span>: <span class="number">8px</span>;</span></span><br><span class="line"><span class="language-css">      <span class="attribute">height</span>: <span class="number">8px</span>;</span></span><br><span class="line"><span class="language-css">      <span class="attribute">border-radius</span>: <span class="number">50%</span>;</span></span><br><span class="line"><span class="language-css">      <span class="attribute">animation</span>: pulse <span class="number">2s</span> infinite;</span></span><br><span class="line"><span class="language-css">    &#125;</span></span><br><span class="line"><span class="language-css">    </span></span><br><span class="line"><span class="language-css">    <span class="selector-class">.status-indicator</span><span class="selector-class">.connected</span> &#123;</span></span><br><span class="line"><span class="language-css">      <span class="attribute">background</span>: <span class="number">#4caf50</span>;</span></span><br><span class="line"><span class="language-css">    &#125;</span></span><br><span class="line"><span class="language-css">    </span></span><br><span class="line"><span class="language-css">    <span class="selector-class">.status-indicator</span><span class="selector-class">.disconnected</span> &#123;</span></span><br><span class="line"><span class="language-css">      <span class="attribute">background</span>: <span class="number">#f44336</span>;</span></span><br><span class="line"><span class="language-css">    &#125;</span></span><br><span class="line"><span class="language-css">    </span></span><br><span class="line"><span class="language-css">    <span class="selector-class">.status-indicator</span><span class="selector-class">.connecting</span> &#123;</span></span><br><span class="line"><span class="language-css">      <span class="attribute">background</span>: <span class="number">#ff9800</span>;</span></span><br><span class="line"><span class="language-css">    &#125;</span></span><br><span class="line"><span class="language-css">    </span></span><br><span class="line"><span class="language-css">    <span class="keyword">@keyframes</span> pulse &#123;</span></span><br><span class="line"><span class="language-css">      <span class="number">0%</span> &#123;</span></span><br><span class="line"><span class="language-css">        <span class="attribute">opacity</span>: <span class="number">1</span>;</span></span><br><span class="line"><span class="language-css">      &#125;</span></span><br><span class="line"><span class="language-css">      <span class="number">50%</span> &#123;</span></span><br><span class="line"><span class="language-css">        <span class="attribute">opacity</span>: <span class="number">0.6</span>;</span></span><br><span class="line"><span class="language-css">      &#125;</span></span><br><span class="line"><span class="language-css">      <span class="number">100%</span> &#123;</span></span><br><span class="line"><span class="language-css">        <span class="attribute">opacity</span>: <span class="number">1</span>;</span></span><br><span class="line"><span class="language-css">      &#125;</span></span><br><span class="line"><span class="language-css">    &#125;</span></span><br><span class="line"><span class="language-css">    </span></span><br><span class="line"><span class="language-css">    <span class="selector-class">.controls</span> &#123;</span></span><br><span class="line"><span class="language-css">      <span class="attribute">padding</span>: <span class="number">20px</span>;</span></span><br><span class="line"><span class="language-css">      <span class="attribute">display</span>: flex;</span></span><br><span class="line"><span class="language-css">      <span class="attribute">flex-wrap</span>: wrap;</span></span><br><span class="line"><span class="language-css">      <span class="attribute">gap</span>: <span class="number">12px</span>;</span></span><br><span class="line"><span class="language-css">      <span class="attribute">justify-content</span>: center;</span></span><br><span class="line"><span class="language-css">      <span class="attribute">background</span>: <span class="number">#fafafa</span>;</span></span><br><span class="line"><span class="language-css">      <span class="attribute">border-top</span>: <span class="number">1px</span> solid <span class="number">#eee</span>;</span></span><br><span class="line"><span class="language-css">    &#125;</span></span><br><span class="line"><span class="language-css">    </span></span><br><span class="line"><span class="language-css">    <span class="selector-tag">button</span> &#123;</span></span><br><span class="line"><span class="language-css">      <span class="attribute">padding</span>: <span class="number">10px</span> <span class="number">20px</span>;</span></span><br><span class="line"><span class="language-css">      <span class="attribute">border</span>: none;</span></span><br><span class="line"><span class="language-css">      <span class="attribute">border-radius</span>: <span class="number">6px</span>;</span></span><br><span class="line"><span class="language-css">      <span class="attribute">font-size</span>: <span class="number">0.95rem</span>;</span></span><br><span class="line"><span class="language-css">      <span class="attribute">font-weight</span>: <span class="number">500</span>;</span></span><br><span class="line"><span class="language-css">      <span class="attribute">cursor</span>: pointer;</span></span><br><span class="line"><span class="language-css">      <span class="attribute">transition</span>: all <span class="number">0.3s</span> ease;</span></span><br><span class="line"><span class="language-css">      <span class="attribute">display</span>: flex;</span></span><br><span class="line"><span class="language-css">      <span class="attribute">align-items</span>: center;</span></span><br><span class="line"><span class="language-css">      <span class="attribute">gap</span>: <span class="number">8px</span>;</span></span><br><span class="line"><span class="language-css">    &#125;</span></span><br><span class="line"><span class="language-css">    </span></span><br><span class="line"><span class="language-css">    <span class="selector-class">.btn-primary</span> &#123;</span></span><br><span class="line"><span class="language-css">      <span class="attribute">background</span>: <span class="number">#2196f3</span>;</span></span><br><span class="line"><span class="language-css">      <span class="attribute">color</span>: white;</span></span><br><span class="line"><span class="language-css">    &#125;</span></span><br><span class="line"><span class="language-css">    </span></span><br><span class="line"><span class="language-css">    <span class="selector-class">.btn-primary</span><span class="selector-pseudo">:hover</span><span class="selector-pseudo">:not</span>(<span class="selector-pseudo">:disabled</span>) &#123;</span></span><br><span class="line"><span class="language-css">      <span class="attribute">background</span>: <span class="number">#1976d2</span>;</span></span><br><span class="line"><span class="language-css">      <span class="attribute">transform</span>: <span class="built_in">translateY</span>(-<span class="number">1px</span>);</span></span><br><span class="line"><span class="language-css">      <span class="attribute">box-shadow</span>: <span class="number">0</span> <span class="number">4px</span> <span class="number">8px</span> <span class="built_in">rgba</span>(<span class="number">33</span>, <span class="number">150</span>, <span class="number">243</span>, <span class="number">0.3</span>);</span></span><br><span class="line"><span class="language-css">    &#125;</span></span><br><span class="line"><span class="language-css">    </span></span><br><span class="line"><span class="language-css">    <span class="selector-class">.btn-danger</span> &#123;</span></span><br><span class="line"><span class="language-css">      <span class="attribute">background</span>: <span class="number">#f44336</span>;</span></span><br><span class="line"><span class="language-css">      <span class="attribute">color</span>: white;</span></span><br><span class="line"><span class="language-css">    &#125;</span></span><br><span class="line"><span class="language-css">    </span></span><br><span class="line"><span class="language-css">    <span class="selector-class">.btn-danger</span><span class="selector-pseudo">:hover</span><span class="selector-pseudo">:not</span>(<span class="selector-pseudo">:disabled</span>) &#123;</span></span><br><span class="line"><span class="language-css">      <span class="attribute">background</span>: <span class="number">#d32f2f</span>;</span></span><br><span class="line"><span class="language-css">      <span class="attribute">transform</span>: <span class="built_in">translateY</span>(-<span class="number">1px</span>);</span></span><br><span class="line"><span class="language-css">      <span class="attribute">box-shadow</span>: <span class="number">0</span> <span class="number">4px</span> <span class="number">8px</span> <span class="built_in">rgba</span>(<span class="number">244</span>, <span class="number">67</span>, <span class="number">54</span>, <span class="number">0.3</span>);</span></span><br><span class="line"><span class="language-css">    &#125;</span></span><br><span class="line"><span class="language-css">    </span></span><br><span class="line"><span class="language-css">    <span class="selector-tag">button</span><span class="selector-pseudo">:disabled</span> &#123;</span></span><br><span class="line"><span class="language-css">      <span class="attribute">opacity</span>: <span class="number">0.6</span>;</span></span><br><span class="line"><span class="language-css">      <span class="attribute">cursor</span>: not-allowed;</span></span><br><span class="line"><span class="language-css">      <span class="attribute">transform</span>: none;</span></span><br><span class="line"><span class="language-css">    &#125;</span></span><br><span class="line"><span class="language-css">    </span></span><br><span class="line"><span class="language-css">    <span class="selector-class">.info</span> &#123;</span></span><br><span class="line"><span class="language-css">      <span class="attribute">padding</span>: <span class="number">20px</span>;</span></span><br><span class="line"><span class="language-css">      <span class="attribute">font-size</span>: <span class="number">0.9rem</span>;</span></span><br><span class="line"><span class="language-css">      <span class="attribute">color</span>: <span class="number">#666</span>;</span></span><br><span class="line"><span class="language-css">      <span class="attribute">background</span>: <span class="number">#f9f9f9</span>;</span></span><br><span class="line"><span class="language-css">      <span class="attribute">border-top</span>: <span class="number">1px</span> solid <span class="number">#eee</span>;</span></span><br><span class="line"><span class="language-css">    &#125;</span></span><br><span class="line"><span class="language-css">    </span></span><br><span class="line"><span class="language-css">    <span class="selector-class">.info</span> <span class="selector-tag">h3</span> &#123;</span></span><br><span class="line"><span class="language-css">      <span class="attribute">color</span>: <span class="number">#333</span>;</span></span><br><span class="line"><span class="language-css">      <span class="attribute">margin-bottom</span>: <span class="number">10px</span>;</span></span><br><span class="line"><span class="language-css">      <span class="attribute">font-size</span>: <span class="number">1.1rem</span>;</span></span><br><span class="line"><span class="language-css">    &#125;</span></span><br><span class="line"><span class="language-css">    </span></span><br><span class="line"><span class="language-css">    <span class="selector-class">.info</span> <span class="selector-tag">p</span> &#123;</span></span><br><span class="line"><span class="language-css">      <span class="attribute">margin-bottom</span>: <span class="number">8px</span>;</span></span><br><span class="line"><span class="language-css">      <span class="attribute">word-break</span>: break-all;</span></span><br><span class="line"><span class="language-css">    &#125;</span></span><br><span class="line"><span class="language-css">    </span></span><br><span class="line"><span class="language-css">    <span class="selector-class">.loading-overlay</span> &#123;</span></span><br><span class="line"><span class="language-css">      <span class="attribute">position</span>: absolute;</span></span><br><span class="line"><span class="language-css">      <span class="attribute">top</span>: <span class="number">0</span>;</span></span><br><span class="line"><span class="language-css">      <span class="attribute">left</span>: <span class="number">0</span>;</span></span><br><span class="line"><span class="language-css">      <span class="attribute">width</span>: <span class="number">100%</span>;</span></span><br><span class="line"><span class="language-css">      <span class="attribute">height</span>: <span class="number">100%</span>;</span></span><br><span class="line"><span class="language-css">      <span class="attribute">background</span>: <span class="built_in">rgba</span>(<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0.7</span>);</span></span><br><span class="line"><span class="language-css">      <span class="attribute">display</span>: flex;</span></span><br><span class="line"><span class="language-css">      <span class="attribute">flex-direction</span>: column;</span></span><br><span class="line"><span class="language-css">      <span class="attribute">justify-content</span>: center;</span></span><br><span class="line"><span class="language-css">      <span class="attribute">align-items</span>: center;</span></span><br><span class="line"><span class="language-css">      <span class="attribute">color</span>: white;</span></span><br><span class="line"><span class="language-css">      <span class="attribute">z-index</span>: <span class="number">5</span>;</span></span><br><span class="line"><span class="language-css">    &#125;</span></span><br><span class="line"><span class="language-css">    </span></span><br><span class="line"><span class="language-css">    <span class="selector-class">.spinner</span> &#123;</span></span><br><span class="line"><span class="language-css">      <span class="attribute">width</span>: <span class="number">40px</span>;</span></span><br><span class="line"><span class="language-css">      <span class="attribute">height</span>: <span class="number">40px</span>;</span></span><br><span class="line"><span class="language-css">      <span class="attribute">border</span>: <span class="number">3px</span> solid <span class="built_in">rgba</span>(<span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">0.3</span>);</span></span><br><span class="line"><span class="language-css">      <span class="attribute">border-radius</span>: <span class="number">50%</span>;</span></span><br><span class="line"><span class="language-css">      <span class="attribute">border-top-color</span>: white;</span></span><br><span class="line"><span class="language-css">      <span class="attribute">animation</span>: spin <span class="number">1s</span> ease-in-out infinite;</span></span><br><span class="line"><span class="language-css">      <span class="attribute">margin-bottom</span>: <span class="number">15px</span>;</span></span><br><span class="line"><span class="language-css">    &#125;</span></span><br><span class="line"><span class="language-css">    </span></span><br><span class="line"><span class="language-css">    <span class="keyword">@keyframes</span> spin &#123;</span></span><br><span class="line"><span class="language-css">      <span class="selector-tag">to</span> &#123; <span class="attribute">transform</span>: <span class="built_in">rotate</span>(<span class="number">360deg</span>); &#125;</span></span><br><span class="line"><span class="language-css">    &#125;</span></span><br><span class="line"><span class="language-css">    </span></span><br><span class="line"><span class="language-css">    <span class="keyword">@media</span> (<span class="attribute">max-width</span>: <span class="number">768px</span>) &#123;</span></span><br><span class="line"><span class="language-css">      <span class="selector-tag">body</span> &#123;</span></span><br><span class="line"><span class="language-css">        <span class="attribute">padding</span>: <span class="number">10px</span>;</span></span><br><span class="line"><span class="language-css">      &#125;</span></span><br><span class="line"><span class="language-css">      </span></span><br><span class="line"><span class="language-css">      <span class="selector-class">.header</span> <span class="selector-tag">h1</span> &#123;</span></span><br><span class="line"><span class="language-css">        <span class="attribute">font-size</span>: <span class="number">1.5rem</span>;</span></span><br><span class="line"><span class="language-css">      &#125;</span></span><br><span class="line"><span class="language-css">      </span></span><br><span class="line"><span class="language-css">      <span class="selector-class">.controls</span> &#123;</span></span><br><span class="line"><span class="language-css">        <span class="attribute">flex-direction</span>: column;</span></span><br><span class="line"><span class="language-css">      &#125;</span></span><br><span class="line"><span class="language-css">      </span></span><br><span class="line"><span class="language-css">      <span class="selector-tag">button</span> &#123;</span></span><br><span class="line"><span class="language-css">        <span class="attribute">width</span>: <span class="number">100%</span>;</span></span><br><span class="line"><span class="language-css">        <span class="attribute">justify-content</span>: center;</span></span><br><span class="line"><span class="language-css">      &#125;</span></span><br><span class="line"><span class="language-css">    &#125;</span></span><br><span class="line"><span class="language-css">  </span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;container&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;header&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">h1</span>&gt;</span>æµ·åº·è§†é¢‘å®æ—¶é¢„è§ˆ<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;video-container&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">video</span> <span class="attr">id</span>=<span class="string">&quot;video&quot;</span> <span class="attr">autoplay</span> <span class="attr">playsinline</span>&gt;</span><span class="tag">&lt;/<span class="name">video</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;loadingOverlay&quot;</span> <span class="attr">class</span>=<span class="string">&quot;loading-overlay&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;spinner&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span>&gt;</span>æ­£åœ¨è¿æ¥è§†é¢‘æµ...<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;statusOverlay&quot;</span> <span class="attr">class</span>=<span class="string">&quot;status-overlay&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;statusIndicator&quot;</span> <span class="attr">class</span>=<span class="string">&quot;status-indicator connecting&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">span</span> <span class="attr">id</span>=<span class="string">&quot;statusText&quot;</span>&gt;</span>è¿æ¥ä¸­...<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;controls&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">button</span> <span class="attr">id</span>=<span class="string">&quot;connectBtn&quot;</span> <span class="attr">class</span>=<span class="string">&quot;btn-primary&quot;</span> <span class="attr">disabled</span>&gt;</span></span><br><span class="line">        ğŸ”„ é‡æ–°è¿æ¥</span><br><span class="line">      <span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">button</span> <span class="attr">id</span>=<span class="string">&quot;disconnectBtn&quot;</span> <span class="attr">class</span>=<span class="string">&quot;btn-danger&quot;</span> <span class="attr">disabled</span>&gt;</span></span><br><span class="line">        â¹ï¸ æ–­å¼€è¿æ¥</span><br><span class="line">      <span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;info&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">h3</span>&gt;</span>è¿æ¥ä¿¡æ¯<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">p</span>&gt;</span><span class="tag">&lt;<span class="name">strong</span>&gt;</span>WebRTC æœåŠ¡åœ°å€:<span class="tag">&lt;/<span class="name">strong</span>&gt;</span> <span class="tag">&lt;<span class="name">span</span> <span class="attr">id</span>=<span class="string">&quot;wsUrlDisplay&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">p</span>&gt;</span><span class="tag">&lt;<span class="name">strong</span>&gt;</span>RTSP æ‘„åƒå¤´åœ°å€:<span class="tag">&lt;/<span class="name">strong</span>&gt;</span> <span class="tag">&lt;<span class="name">span</span> <span class="attr">id</span>=<span class="string">&quot;rtspUrlDisplay&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="comment">// DOM å…ƒç´ å¼•ç”¨</span></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">const</span> videoElement = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;video&#x27;</span>);</span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">const</span> loadingOverlay = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;loadingOverlay&#x27;</span>);</span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">const</span> statusOverlay = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;statusOverlay&#x27;</span>);</span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">const</span> statusIndicator = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;statusIndicator&#x27;</span>);</span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">const</span> statusText = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;statusText&#x27;</span>);</span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">const</span> connectBtn = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;connectBtn&#x27;</span>);</span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">const</span> disconnectBtn = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;disconnectBtn&#x27;</span>);</span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">const</span> wsUrlDisplay = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;wsUrlDisplay&#x27;</span>);</span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">const</span> rtspUrlDisplay = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;rtspUrlDisplay&#x27;</span>);</span></span><br><span class="line"><span class="language-javascript">    </span></span><br><span class="line"><span class="language-javascript">    <span class="comment">// é…ç½®ä¿¡æ¯</span></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">const</span> wsUrl = <span class="string">&quot;http://192.168.0.109:8000&quot;</span>;</span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">const</span> rtspUrl = <span class="string">&quot;rtsp://admin:1212121@192.168.0.207:554/cam/realmonitor?channel=1&amp;subtype=0&quot;</span>;</span></span><br><span class="line"><span class="language-javascript">    </span></span><br><span class="line"><span class="language-javascript">    <span class="comment">// æ˜¾ç¤ºè¿æ¥ä¿¡æ¯ï¼ˆéšè—æ•æ„Ÿä¿¡æ¯ï¼‰</span></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">const</span> sanitizedRtspUrl = rtspUrl.<span class="title function_">replace</span>(<span class="regexp">/admin:[^@]+@/</span>, <span class="string">&#x27;admin:****@&#x27;</span>);</span></span><br><span class="line"><span class="language-javascript">    wsUrlDisplay.<span class="property">textContent</span> = wsUrl;</span></span><br><span class="line"><span class="language-javascript">    rtspUrlDisplay.<span class="property">textContent</span> = sanitizedRtspUrl;</span></span><br><span class="line"><span class="language-javascript">    </span></span><br><span class="line"><span class="language-javascript">    <span class="comment">// WebRTC å®ä¾‹</span></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">let</span> ws = <span class="literal">null</span>;</span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">let</span> reconnectAttempts = <span class="number">0</span>;</span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">const</span> maxReconnectAttempts = <span class="number">3</span>;</span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">let</span> isConnecting = <span class="literal">false</span>;</span></span><br><span class="line"><span class="language-javascript">    </span></span><br><span class="line"><span class="language-javascript">    <span class="comment">// æ›´æ–°çŠ¶æ€æ˜¾ç¤º</span></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">function</span> <span class="title function_">updateStatus</span>(<span class="params">status</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">switch</span>(status) &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">case</span> <span class="string">&#x27;connecting&#x27;</span>:</span></span><br><span class="line"><span class="language-javascript">          statusIndicator.<span class="property">className</span> = <span class="string">&#x27;status-indicator connecting&#x27;</span>;</span></span><br><span class="line"><span class="language-javascript">          statusText.<span class="property">textContent</span> = <span class="string">&#x27;è¿æ¥ä¸­...&#x27;</span>;</span></span><br><span class="line"><span class="language-javascript">          loadingOverlay.<span class="property">style</span>.<span class="property">display</span> = <span class="string">&#x27;flex&#x27;</span>;</span></span><br><span class="line"><span class="language-javascript">          connectBtn.<span class="property">disabled</span> = <span class="literal">true</span>;</span></span><br><span class="line"><span class="language-javascript">          disconnectBtn.<span class="property">disabled</span> = <span class="literal">true</span>;</span></span><br><span class="line"><span class="language-javascript">          <span class="keyword">break</span>;</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">case</span> <span class="string">&#x27;connected&#x27;</span>:</span></span><br><span class="line"><span class="language-javascript">          statusIndicator.<span class="property">className</span> = <span class="string">&#x27;status-indicator connected&#x27;</span>;</span></span><br><span class="line"><span class="language-javascript">          statusText.<span class="property">textContent</span> = <span class="string">&#x27;å·²è¿æ¥&#x27;</span>;</span></span><br><span class="line"><span class="language-javascript">          loadingOverlay.<span class="property">style</span>.<span class="property">display</span> = <span class="string">&#x27;none&#x27;</span>;</span></span><br><span class="line"><span class="language-javascript">          connectBtn.<span class="property">disabled</span> = <span class="literal">false</span>;</span></span><br><span class="line"><span class="language-javascript">          disconnectBtn.<span class="property">disabled</span> = <span class="literal">false</span>;</span></span><br><span class="line"><span class="language-javascript">          reconnectAttempts = <span class="number">0</span>;</span></span><br><span class="line"><span class="language-javascript">          <span class="keyword">break</span>;</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">case</span> <span class="string">&#x27;disconnected&#x27;</span>:</span></span><br><span class="line"><span class="language-javascript">          statusIndicator.<span class="property">className</span> = <span class="string">&#x27;status-indicator disconnected&#x27;</span>;</span></span><br><span class="line"><span class="language-javascript">          statusText.<span class="property">textContent</span> = <span class="string">&#x27;å·²æ–­å¼€&#x27;</span>;</span></span><br><span class="line"><span class="language-javascript">          loadingOverlay.<span class="property">style</span>.<span class="property">display</span> = <span class="string">&#x27;none&#x27;</span>;</span></span><br><span class="line"><span class="language-javascript">          connectBtn.<span class="property">disabled</span> = <span class="literal">false</span>;</span></span><br><span class="line"><span class="language-javascript">          disconnectBtn.<span class="property">disabled</span> = <span class="literal">true</span>;</span></span><br><span class="line"><span class="language-javascript">          <span class="keyword">break</span>;</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">case</span> <span class="string">&#x27;error&#x27;</span>:</span></span><br><span class="line"><span class="language-javascript">          statusIndicator.<span class="property">className</span> = <span class="string">&#x27;status-indicator disconnected&#x27;</span>;</span></span><br><span class="line"><span class="language-javascript">          statusText.<span class="property">textContent</span> = <span class="string">&#x27;è¿æ¥é”™è¯¯&#x27;</span>;</span></span><br><span class="line"><span class="language-javascript">          loadingOverlay.<span class="property">style</span>.<span class="property">display</span> = <span class="string">&#x27;none&#x27;</span>;</span></span><br><span class="line"><span class="language-javascript">          connectBtn.<span class="property">disabled</span> = <span class="literal">false</span>;</span></span><br><span class="line"><span class="language-javascript">          disconnectBtn.<span class="property">disabled</span> = <span class="literal">true</span>;</span></span><br><span class="line"><span class="language-javascript">          <span class="keyword">break</span>;</span></span><br><span class="line"><span class="language-javascript">      &#125;</span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript">    </span></span><br><span class="line"><span class="language-javascript">    <span class="comment">// è¿æ¥è§†é¢‘æµ</span></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">function</span> <span class="title function_">connectStream</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">if</span> (isConnecting || (ws &amp;&amp; ws.<span class="property">connected</span>)) <span class="keyword">return</span>;</span></span><br><span class="line"><span class="language-javascript">      </span></span><br><span class="line"><span class="language-javascript">      isConnecting = <span class="literal">true</span>;</span></span><br><span class="line"><span class="language-javascript">      <span class="title function_">updateStatus</span>(<span class="string">&#x27;connecting&#x27;</span>);</span></span><br><span class="line"><span class="language-javascript">      </span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">try</span> &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="comment">// é”€æ¯æ—§å®ä¾‹</span></span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">if</span> (ws) &#123;</span></span><br><span class="line"><span class="language-javascript">          ws.<span class="title function_">disconnect</span>();</span></span><br><span class="line"><span class="language-javascript">          ws = <span class="literal">null</span>;</span></span><br><span class="line"><span class="language-javascript">        &#125;</span></span><br><span class="line"><span class="language-javascript">        </span></span><br><span class="line"><span class="language-javascript">        <span class="comment">// åˆ›å»ºæ–°å®ä¾‹å¹¶è¿æ¥</span></span></span><br><span class="line"><span class="language-javascript">        ws = <span class="keyword">new</span> <span class="title class_">WebRtcStreamer</span>(videoElement, wsUrl);</span></span><br><span class="line"><span class="language-javascript">        </span></span><br><span class="line"><span class="language-javascript">        <span class="comment">// é‡å†™ onEvent æ–¹æ³•æ¥å¤„ç†è¿æ¥äº‹ä»¶</span></span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">const</span> originalOnEvent = ws.<span class="property">onEvent</span>;</span></span><br><span class="line"><span class="language-javascript">        ws.<span class="property">onEvent</span> = <span class="keyword">function</span>(<span class="params">event</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">          <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;WebRTC Event:&#x27;</span>, event);</span></span><br><span class="line"><span class="language-javascript">          </span></span><br><span class="line"><span class="language-javascript">          <span class="keyword">if</span> (event === <span class="string">&#x27;initialized&#x27;</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;WebRTC åˆå§‹åŒ–å®Œæˆ&#x27;</span>);</span></span><br><span class="line"><span class="language-javascript">          &#125; <span class="keyword">else</span> <span class="keyword">if</span> (event === <span class="string">&#x27;play&#x27;</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;è§†é¢‘æ’­æ”¾å¼€å§‹&#x27;</span>);</span></span><br><span class="line"><span class="language-javascript">            <span class="title function_">updateStatus</span>(<span class="string">&#x27;connected&#x27;</span>);</span></span><br><span class="line"><span class="language-javascript">          &#125; <span class="keyword">else</span> <span class="keyword">if</span> (event === <span class="string">&#x27;disconnected&#x27;</span> || event === <span class="string">&#x27;stopped&#x27;</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;è§†é¢‘è¿æ¥æ–­å¼€&#x27;</span>);</span></span><br><span class="line"><span class="language-javascript">            <span class="title function_">updateStatus</span>(<span class="string">&#x27;disconnected&#x27;</span>);</span></span><br><span class="line"><span class="language-javascript">          &#125; <span class="keyword">else</span> <span class="keyword">if</span> (event === <span class="string">&#x27;error&#x27;</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">&#x27;è§†é¢‘è¿æ¥é”™è¯¯&#x27;</span>);</span></span><br><span class="line"><span class="language-javascript">            <span class="title function_">updateStatus</span>(<span class="string">&#x27;error&#x27;</span>);</span></span><br><span class="line"><span class="language-javascript">            <span class="title function_">handleReconnect</span>();</span></span><br><span class="line"><span class="language-javascript">          &#125;</span></span><br><span class="line"><span class="language-javascript">          </span></span><br><span class="line"><span class="language-javascript">          <span class="comment">// è°ƒç”¨åŸå§‹æ–¹æ³•</span></span></span><br><span class="line"><span class="language-javascript">          <span class="keyword">if</span> (originalOnEvent) &#123;</span></span><br><span class="line"><span class="language-javascript">            originalOnEvent.<span class="title function_">call</span>(<span class="variable language_">this</span>, event);</span></span><br><span class="line"><span class="language-javascript">          &#125;</span></span><br><span class="line"><span class="language-javascript">          </span></span><br><span class="line"><span class="language-javascript">          isConnecting = <span class="literal">false</span>;</span></span><br><span class="line"><span class="language-javascript">        &#125;;</span></span><br><span class="line"><span class="language-javascript">        </span></span><br><span class="line"><span class="language-javascript">        <span class="comment">// è¿æ¥ RTSP æµ</span></span></span><br><span class="line"><span class="language-javascript">        ws.<span class="title function_">connect</span>(rtspUrl);</span></span><br><span class="line"><span class="language-javascript">        </span></span><br><span class="line"><span class="language-javascript">        <span class="comment">// è®¾ç½®è¶…æ—¶å¤„ç†</span></span></span><br><span class="line"><span class="language-javascript">        <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-javascript">          <span class="keyword">if</span> (isConnecting) &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">&#x27;è¿æ¥è¶…æ—¶&#x27;</span>);</span></span><br><span class="line"><span class="language-javascript">            <span class="title function_">updateStatus</span>(<span class="string">&#x27;error&#x27;</span>);</span></span><br><span class="line"><span class="language-javascript">            isConnecting = <span class="literal">false</span>;</span></span><br><span class="line"><span class="language-javascript">            <span class="title function_">handleReconnect</span>();</span></span><br><span class="line"><span class="language-javascript">          &#125;</span></span><br><span class="line"><span class="language-javascript">        &#125;, <span class="number">15000</span>);</span></span><br><span class="line"><span class="language-javascript">        </span></span><br><span class="line"><span class="language-javascript">      &#125; <span class="keyword">catch</span> (error) &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">&#x27;è¿æ¥è¿‡ç¨‹ä¸­å‘ç”Ÿé”™è¯¯:&#x27;</span>, error);</span></span><br><span class="line"><span class="language-javascript">        <span class="title function_">updateStatus</span>(<span class="string">&#x27;error&#x27;</span>);</span></span><br><span class="line"><span class="language-javascript">        isConnecting = <span class="literal">false</span>;</span></span><br><span class="line"><span class="language-javascript">        <span class="title function_">handleReconnect</span>();</span></span><br><span class="line"><span class="language-javascript">      &#125;</span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript">    </span></span><br><span class="line"><span class="language-javascript">    <span class="comment">// æ–­å¼€è§†é¢‘æµ</span></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">function</span> <span class="title function_">disconnectStream</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">try</span> &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">if</span> (ws) &#123;</span></span><br><span class="line"><span class="language-javascript">          ws.<span class="title function_">disconnect</span>();</span></span><br><span class="line"><span class="language-javascript">          <span class="title function_">updateStatus</span>(<span class="string">&#x27;disconnected&#x27;</span>);</span></span><br><span class="line"><span class="language-javascript">        &#125;</span></span><br><span class="line"><span class="language-javascript">      &#125; <span class="keyword">catch</span> (error) &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">&#x27;æ–­å¼€è¿æ¥æ—¶å‘ç”Ÿé”™è¯¯:&#x27;</span>, error);</span></span><br><span class="line"><span class="language-javascript">      &#125;</span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript">    </span></span><br><span class="line"><span class="language-javascript">    <span class="comment">// å¤„ç†è‡ªåŠ¨é‡è¿</span></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">function</span> <span class="title function_">handleReconnect</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">if</span> (reconnectAttempts &lt; maxReconnectAttempts) &#123;</span></span><br><span class="line"><span class="language-javascript">        reconnectAttempts++;</span></span><br><span class="line"><span class="language-javascript">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`å°è¯•é‡æ–°è¿æ¥ (<span class="subst">$&#123;reconnectAttempts&#125;</span>/<span class="subst">$&#123;maxReconnectAttempts&#125;</span>)...`</span>);</span></span><br><span class="line"><span class="language-javascript">        <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-javascript">          <span class="title function_">connectStream</span>();</span></span><br><span class="line"><span class="language-javascript">        &#125;, <span class="number">3000</span> * reconnectAttempts); <span class="comment">// é€’å¢å»¶è¿Ÿæ—¶é—´</span></span></span><br><span class="line"><span class="language-javascript">      &#125;</span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript">    </span></span><br><span class="line"><span class="language-javascript">    <span class="comment">// äº‹ä»¶ç›‘å¬å™¨</span></span></span><br><span class="line"><span class="language-javascript">    connectBtn.<span class="title function_">addEventListener</span>(<span class="string">&#x27;click&#x27;</span>, connectStream);</span></span><br><span class="line"><span class="language-javascript">    disconnectBtn.<span class="title function_">addEventListener</span>(<span class="string">&#x27;click&#x27;</span>, disconnectStream);</span></span><br><span class="line"><span class="language-javascript">    </span></span><br><span class="line"><span class="language-javascript">    <span class="comment">// é¡µé¢åŠ è½½æ—¶è¿æ¥è§†é¢‘</span></span></span><br><span class="line"><span class="language-javascript">    <span class="variable language_">window</span>.<span class="title function_">addEventListener</span>(<span class="string">&#x27;load&#x27;</span>, connectStream);</span></span><br><span class="line"><span class="language-javascript">    </span></span><br><span class="line"><span class="language-javascript">    <span class="comment">// é¡µé¢å…³é—­å‰æ–­å¼€è¿æ¥</span></span></span><br><span class="line"><span class="language-javascript">    <span class="variable language_">window</span>.<span class="title function_">addEventListener</span>(<span class="string">&#x27;beforeunload&#x27;</span>, disconnectStream);</span></span><br><span class="line"><span class="language-javascript">    </span></span><br><span class="line"><span class="language-javascript">    <span class="comment">// ç›‘å¬è§†é¢‘é”™è¯¯äº‹ä»¶</span></span></span><br><span class="line"><span class="language-javascript">    videoElement.<span class="title function_">addEventListener</span>(<span class="string">&#x27;error&#x27;</span>, <span class="function">(<span class="params">e</span>) =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">&#x27;è§†é¢‘å…ƒç´ é”™è¯¯:&#x27;</span>, e);</span></span><br><span class="line"><span class="language-javascript">      <span class="title function_">updateStatus</span>(<span class="string">&#x27;error&#x27;</span>);</span></span><br><span class="line"><span class="language-javascript">      <span class="title function_">handleReconnect</span>();</span></span><br><span class="line"><span class="language-javascript">    &#125;);</span></span><br><span class="line"><span class="language-javascript">  </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>å°†ä¸Šé¢çš„ä»£ç ä¿å­˜ä¸º HTML æ–‡ä»¶ï¼Œå¹¶ç¡®ä¿ <code>webrtcstreamer.js</code> æ–‡ä»¶åœ¨åŒä¸€ç›®å½•ä¸‹ï¼Œç„¶ååœ¨æµè§ˆå™¨ä¸­æ‰“å¼€ï¼Œå°±èƒ½çœ‹åˆ°å¸¦æœ‰çŠ¶æ€æŒ‡ç¤ºå’Œæ§åˆ¶æŒ‰é’®çš„è§†é¢‘æ’­æ”¾é¡µé¢äº†ã€‚é¡µé¢ä¼šè‡ªåŠ¨è¿æ¥åˆ°é…ç½®çš„æ‘„åƒå¤´ï¼Œå¹¶æ˜¾ç¤ºå®æ—¶ç”»é¢ã€‚</p>
<h2 id=""><a href="#" class="headerlink" title=""></a><img  
                       lazyload
                       alt="image"
                       data-src="/images/webrtc.png"
                        alt="WebRTC è§†é¢‘æ’­æ”¾æ•ˆæœ"
                 ></h2><h3 id="å…­ã€è¿›é˜¶åº”ç”¨ä¸ä¼˜åŒ–"><a href="#å…­ã€è¿›é˜¶åº”ç”¨ä¸ä¼˜åŒ–" class="headerlink" title="å…­ã€è¿›é˜¶åº”ç”¨ä¸ä¼˜åŒ–"></a>å…­ã€è¿›é˜¶åº”ç”¨ä¸ä¼˜åŒ–</h3><h4 id="1-å¤šæ‘„åƒå¤´æ¥å…¥"><a href="#1-å¤šæ‘„åƒå¤´æ¥å…¥" class="headerlink" title="1. å¤šæ‘„åƒå¤´æ¥å…¥"></a>1. å¤šæ‘„åƒå¤´æ¥å…¥</h4><p>åœ¨å®é™…é¡¹ç›®ä¸­ï¼Œæˆ‘ä»¬ç»å¸¸éœ€è¦åŒæ—¶ç®¡ç†å¤šä¸ªæ‘„åƒå¤´ã€‚WebRTC-Streamer æ”¯æŒé€šè¿‡ç¯å¢ƒå˜é‡é…ç½®å¤šä¸ª RTSP æµï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">docker run -d -p 8000:8000 \</span><br><span class="line">  -e RTSP_URL_1=<span class="string">&quot;rtsp://admin:pass@192.168.1.64:554/Streaming/Channels/101&quot;</span> \</span><br><span class="line">  -e RTSP_URL_2=<span class="string">&quot;rtsp://admin:pass@192.168.1.65:554/Streaming/Channels/101&quot;</span> \</span><br><span class="line">  mpromonet/webrtc-streamer</span><br></pre></td></tr></table></figure>

<p>åœ¨å‰ç«¯ï¼Œæˆ‘ä»¬å¯ä»¥æ·»åŠ ä¸€ä¸ªæ‘„åƒå¤´é€‰æ‹©å™¨ï¼Œè®©ç”¨æˆ·å¯ä»¥æ–¹ä¾¿åœ°åˆ‡æ¢ä¸åŒçš„è§†é¢‘æµã€‚æˆ‘åœ¨é¡¹ç›®ä¸­è¿˜å®ç°äº†ç”»é¢åˆ†å‰²åŠŸèƒ½ï¼Œæ”¯æŒåŒæ—¶æ˜¾ç¤º 4 è·¯æˆ– 9 è·¯æ‘„åƒå¤´ç”»é¢ï¼Œè¿™æ ·ç›‘æ§æ•ˆç‡ä¼šå¤§å¤§æé«˜ã€‚</p>
<h4 id="2-å»¶è¿Ÿä¼˜åŒ–å»ºè®®"><a href="#2-å»¶è¿Ÿä¼˜åŒ–å»ºè®®" class="headerlink" title="2. å»¶è¿Ÿä¼˜åŒ–å»ºè®®"></a>2. å»¶è¿Ÿä¼˜åŒ–å»ºè®®</h4><p>åœ¨å®æ—¶ç›‘æ§åœºæ™¯ä¸­ï¼Œå»¶è¿Ÿæ˜¯ä¸€ä¸ªå…³é”®æŒ‡æ ‡ã€‚ç»è¿‡å®é™…æµ‹è¯•ï¼Œæˆ‘æ€»ç»“äº†å‡ ä¸ªæœ‰æ•ˆçš„ä¼˜åŒ–å»ºè®®ï¼š</p>
<ul>
<li><strong>ä½¿ç”¨å­ç æµ</strong>ï¼šå¯¹äºæ™®é€šç›‘æ§åœºæ™¯ï¼Œä½¿ç”¨å­ç æµï¼ˆå°† URL ä¸­çš„ <code>101</code> æ”¹ä¸º <code>102</code>ï¼‰å¯ä»¥åœ¨ä¿è¯åŸºæœ¬ç”»é¢è´¨é‡çš„åŒæ—¶ï¼Œæ˜¾è‘—é™ä½å¸¦å®½å ç”¨å’Œå»¶è¿Ÿ</li>
<li><strong>ä¼˜åŒ–ç½‘ç»œç¯å¢ƒ</strong>ï¼šç¡®ä¿æ‘„åƒå¤´å’Œ WebRTC-Streamer æœåŠ¡å™¨åœ¨åŒä¸€ä¸ªå±€åŸŸç½‘å†…ï¼Œå‡å°‘ç½‘ç»œè·³è½¬</li>
<li><strong>è°ƒæ•´æœåŠ¡å™¨é…ç½®</strong>ï¼šå¦‚æœæœåŠ¡å™¨æ€§èƒ½å…è®¸ï¼Œå¯ä»¥é€‚å½“è°ƒæ•´ WebRTC-Streamer çš„ç¼“å­˜å‚æ•°</li>
<li><strong>é¿å…è½¬ç </strong>ï¼šå°½é‡ä¿æŒè§†é¢‘ç¼–ç æ ¼å¼çš„å…¼å®¹æ€§ï¼Œè®© WebRTC-Streamer åªåšè½¬å°è£…è€Œä¸è¿›è¡Œè½¬ç ï¼Œè¿™æ ·èƒ½å¤§å¤§å‡å°‘å»¶è¿Ÿ</li>
</ul>
<p>åœ¨æˆ‘çš„é¡¹ç›®ä¸­ï¼Œé€šè¿‡è¿™äº›ä¼˜åŒ–ï¼Œè§†é¢‘å»¶è¿Ÿå¯ä»¥ç¨³å®šæ§åˆ¶åœ¨ 300ms ä»¥å†…ã€‚</p>
<h4 id="3-HTTPS-ä¸è¿œç¨‹è®¿é—®"><a href="#3-HTTPS-ä¸è¿œç¨‹è®¿é—®" class="headerlink" title="3. HTTPS ä¸è¿œç¨‹è®¿é—®"></a>3. HTTPS ä¸è¿œç¨‹è®¿é—®</h4><p>è¿™é‡Œæœ‰ä¸ªé‡è¦çš„å®‰å…¨é™åˆ¶éœ€è¦æ³¨æ„ï¼šWebRTC å¿…é¡»åœ¨å®‰å…¨ä¸Šä¸‹æ–‡ï¼ˆHTTPS æˆ– localhostï¼‰ä¸­æ‰èƒ½æ­£å¸¸å·¥ä½œã€‚å¦‚æœéœ€è¦è¿œç¨‹è®¿é—®ï¼Œæˆ‘ä»¬éœ€è¦é…ç½® HTTPSã€‚</p>
<p>æˆ‘çš„åšæ³•æ˜¯ä½¿ç”¨ Nginx ä½œä¸ºåå‘ä»£ç†ï¼Œå¹¶é…ç½® SSL è¯ä¹¦ï¼š</p>
<figure class="highlight nginx"><table><tr><td class="code"><pre><span class="line"><span class="section">server</span> &#123;</span><br><span class="line">    <span class="attribute">listen</span> <span class="number">443</span> ssl;</span><br><span class="line">    <span class="attribute">server_name</span> example.com;</span><br><span class="line">    </span><br><span class="line">    <span class="attribute">ssl_certificate</span> /path/to/cert.pem;</span><br><span class="line">    <span class="attribute">ssl_certificate_key</span> /path/to/key.pem;</span><br><span class="line">    </span><br><span class="line">    <span class="section">location</span> / &#123;</span><br><span class="line">        <span class="attribute">proxy_pass</span> http://localhost:8000;</span><br><span class="line">        <span class="attribute">proxy_http_version</span> <span class="number">1</span>.<span class="number">1</span>;</span><br><span class="line">        <span class="attribute">proxy_set_header</span> Upgrade <span class="variable">$http_upgrade</span>;</span><br><span class="line">        <span class="attribute">proxy_set_header</span> Connection <span class="string">&#x27;upgrade&#x27;</span>;</span><br><span class="line">        <span class="attribute">proxy_set_header</span> Host <span class="variable">$host</span>;</span><br><span class="line">        <span class="attribute">proxy_cache_bypass</span> <span class="variable">$http_upgrade</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¿™æ ·é…ç½®åï¼Œç”¨æˆ·å°±å¯ä»¥é€šè¿‡ HTTPS å®‰å…¨åœ°è¿œç¨‹è®¿é—®è§†é¢‘ç›‘æ§ç³»ç»Ÿäº†ã€‚</p>
<hr>
<h3 id="ä¸ƒã€æ€»ç»“"><a href="#ä¸ƒã€æ€»ç»“" class="headerlink" title="ä¸ƒã€æ€»ç»“"></a>ä¸ƒã€æ€»ç»“</h3><p>ç»è¿‡è¿™æ¬¡é¡¹ç›®å®è·µï¼Œæˆ‘å‘ç° WebRTC-Streamer ç¡®å®æ˜¯è¿æ¥å®‰é˜²æ‘„åƒå¤´å’Œ Web å‰ç«¯çš„ç†æƒ³æ¡¥æ¢ã€‚æ•´ä¸ªæ–¹æ¡ˆå…·æœ‰ä»¥ä¸‹ä¼˜åŠ¿ï¼š</p>
<ul>
<li><strong>å…¼å®¹æ€§å¥½</strong>ï¼šå‡ ä¹æ”¯æŒæ‰€æœ‰ä¸»æµæµè§ˆå™¨ï¼Œæ— éœ€å®‰è£…ä»»ä½•æ’ä»¶</li>
<li><strong>å»¶è¿Ÿæä½</strong>ï¼šé€šè¿‡åˆç†ä¼˜åŒ–ï¼Œå»¶è¿Ÿå¯ä»¥æ§åˆ¶åœ¨å‡ ç™¾æ¯«ç§’å†…</li>
<li><strong>éƒ¨ç½²ç®€å•</strong>ï¼šä½¿ç”¨ Docker å¯ä»¥å¿«é€Ÿéƒ¨ç½²ï¼Œå¤§å¤§é™ä½äº†è¿ç»´æˆæœ¬</li>
<li><strong>æ‰©å±•æ€§å¼º</strong>ï¼šæ”¯æŒå¤šæ‘„åƒå¤´æ¥å…¥ï¼Œå¯ä»¥æ ¹æ®å®é™…éœ€æ±‚çµæ´»æ‰©å±•</li>
</ul>
<p>è¿™ç§æ–¹æ¡ˆåœ¨å¾ˆå¤šåœºæ™¯ä¸‹éƒ½èƒ½å‘æŒ¥ä½œç”¨ï¼Œæ¯”å¦‚ï¼š</p>
<ul>
<li>ç‰©è”ç½‘è®¾å¤‡çš„è§†é¢‘ç›‘æ§ä¸­å¿ƒ</li>
<li>æ™ºæ…§å›­åŒºçš„å¯è§†åŒ–å¤§å±å±•ç¤º</li>
<li>å·¥å‚æˆ–å·¥åœ°çš„è¿œç¨‹å·¡æ£€ç³»ç»Ÿ</li>
<li>é›¶å”®åº—é“ºçš„å®æ—¶å®¢æµåˆ†æ</li>
</ul>
<p>å¦‚æœä½ ä¹Ÿåœ¨åšç±»ä¼¼çš„é¡¹ç›®ï¼Œä¸å¦¨è¯•è¯•è¿™ä¸ªæ–¹æ¡ˆï¼Œç›¸ä¿¡ä¼šç»™ä½ å¸¦æ¥ä¸é”™çš„æ•ˆæœã€‚</p>
<hr>
<h3 id="å…«ã€å‚è€ƒèµ„æ–™"><a href="#å…«ã€å‚è€ƒèµ„æ–™" class="headerlink" title="å…«ã€å‚è€ƒèµ„æ–™"></a>å…«ã€å‚è€ƒèµ„æ–™</h3><p>åœ¨å®ç°è¿™ä¸ªæ–¹æ¡ˆçš„è¿‡ç¨‹ä¸­ï¼Œæˆ‘æŸ¥é˜…äº†ä¸å°‘èµ„æ–™ï¼Œè¿™é‡Œåˆ†äº«ç»™å¤§å®¶ï¼š</p>
<ul>
<li><a class="link"   href="https://github.com/mpromonet/webrtc-streamer" >WebRTC-Streamer å®˜æ–¹ä»“åº“<i class="fas fa-external-link-alt"></i></a> - åŒ…å«æœ€æ–°çš„ä»£ç å’Œè¯¦ç»†æ–‡æ¡£</li>
<li><a class="link"   href="https://www.hikvision.com/cn/support/Downloads/TechnicalDocuments/" >æµ·åº·å¨è§†è®¾å¤‡ç½‘ç»œSDKä½¿ç”¨æ‰‹å†Œ<i class="fas fa-external-link-alt"></i></a></li>
<li><a class="link"   href="https://webrtc.org/start/" >WebRTC å®˜æ–¹æ–‡æ¡£<i class="fas fa-external-link-alt"></i></a></li>
<li><a class="link"   href="https://docs.docker.com/" >Docker å®˜æ–¹æ–‡æ¡£<i class="fas fa-external-link-alt"></i></a></li>
</ul>
]]></content>
      <categories>
        <category>ç½‘ç»œåè®®ä¸æµåª’ä½“</category>
      </categories>
      <tags>
        <tag>RTSP</tag>
      </tags>
  </entry>
  <entry>
    <title>SQLåŸºç¡€</title>
    <url>/2023/07/22/%E6%95%B0%E6%8D%AE%E5%BA%93/SQL%E5%9F%BA%E7%A1%80/</url>
    <content><![CDATA[<h3 id="SQLè¯­æ³•æ€»ç»“"><a href="#SQLè¯­æ³•æ€»ç»“" class="headerlink" title="SQLè¯­æ³•æ€»ç»“"></a>SQLè¯­æ³•æ€»ç»“</h3><h3 id="å¸¸ç”¨æŒ‡ä»¤"><a href="#å¸¸ç”¨æŒ‡ä»¤" class="headerlink" title="å¸¸ç”¨æŒ‡ä»¤"></a>å¸¸ç”¨æŒ‡ä»¤</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">dror database if <span class="keyword">exists</span> xx; åˆ é™¤æ•°æ®åº“</span><br><span class="line"><span class="keyword">show</span> databases;              å±•ç¤ºæ‰€æœ‰æ•°æ®åº“</span><br><span class="line">use xxx                      è¿›å…¥æŒ‡å®šçš„æ•°æ®åº“</span><br><span class="line"><span class="keyword">show</span> tables;                 å±•ç¤ºæ‰€æœ‰è¡¨</span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> xxxx;          å±•ç¤ºè¡¨ä¸­çš„å†…å®¹</span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">DISTINCT</span> country <span class="keyword">FROM</span> Websites; è¿”å›è¡¨ä¸­ä¸åŒçš„å€¼</span><br><span class="line"> <span class="keyword">describe</span> <span class="keyword">user</span>;              æŸ¥çœ‹è¡¨æ ¼æ•°æ®ç»“æ„</span><br><span class="line"><span class="keyword">desc</span> <span class="keyword">user</span>;                   æŸ¥çœ‹è¡¨æ ¼å»ºæ„ ç®€å†™</span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> diaochabiao <span class="keyword">where</span> sixth<span class="operator">=</span><span class="string">&#x27;ç”·&#x27;</span>; <span class="string">&#x27;where&#x27;</span>ä½œä¸ºæ¡ä»¶ç­›é€‰æ•°æ®</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">USER</span> <span class="string">&#x27;username&#x27;</span>@<span class="string">&#x27;host&#x27;</span> IDENTIFIED <span class="keyword">BY</span> <span class="string">&#x27;password&#x27;</span>; åˆ›å»ºç”¨æˆ·å‘½ä»¤</span><br><span class="line"># æ•°æ®åº“å¤‡ä»½<span class="keyword">sql</span>æ–‡ä»¶å‘½ä»¤</span><br><span class="line">mysqldump  <span class="operator">-</span>u  root  <span class="operator">-</span>p123456  <span class="comment">--databases æ•°æ®åº“åç§° -r å¤‡ä»½æ–‡ä»¶è·¯å¾„</span></span><br><span class="line"># æ•°æ®åº“å¯¼å…¥<span class="keyword">sql</span>æ–‡ä»¶å‘½ä»¤</span><br><span class="line">source name.sql</span><br></pre></td></tr></table></figure>
<h3 id="ALTER-è¯­æ³•"><a href="#ALTER-è¯­æ³•" class="headerlink" title="ALTER è¯­æ³•"></a>ALTER è¯­æ³•</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> è¡¨å <span class="keyword">DROP</span> [<span class="keyword">COLUMN</span>] å­—æ®µå ;åˆ é™¤å­—æ®µ</span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> è¡¨å <span class="keyword">ADD</span> [<span class="keyword">COLUMN</span>] å­—æ®µå å­—æ®µç±»å‹ æ˜¯å¦å¯ä¸ºç©º COMMENT <span class="string">&#x27;æ³¨é‡Š&#x27;</span> AFTER æŒ‡å®šæŸå­—æ®µ ; åœ¨æŒ‡å®šä½ç½®æ’å…¥æ–°å­—æ®µ</span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> è¡¨å COMMENT <span class="string">&#x27;æ–°æ³¨é‡Š&#x27;</span>; ä¿®æ”¹æ³¨é‡Š</span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> æ—§è¡¨å RENAME <span class="keyword">TO</span> æ–°è¡¨å ; ä¿®æ”¹è¡¨å</span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> è¡¨å MODIFY [<span class="keyword">COLUMN</span>] å­—æ®µå æ–°æ•°æ®ç±»å‹ æ–°ç±»å‹é•¿åº¦  æ–°é»˜è®¤å€¼  æ–°æ³¨é‡Š;</span><br></pre></td></tr></table></figure>
<h3 id="SQL-ORDER-BY-è¯­æ³•"><a href="#SQL-ORDER-BY-è¯­æ³•" class="headerlink" title="SQL ORDER BY è¯­æ³•"></a>SQL ORDER BY è¯­æ³•</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> column1, column2, ...</span><br><span class="line"><span class="keyword">FROM</span> table_name</span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> column1, column2, ... <span class="keyword">ASC</span><span class="operator">|</span><span class="keyword">DESC</span>;</span><br></pre></td></tr></table></figure>
<ul>
<li>column1, column2, â€¦ï¼šè¦æ’åºçš„å­—æ®µåç§°ï¼Œå¯ä»¥ä¸ºå¤šä¸ªå­—æ®µã€‚</li>
<li>ASCï¼šè¡¨ç¤ºæŒ‰å‡åºæ’åºã€‚</li>
<li>DESCï¼šè¡¨ç¤ºæŒ‰é™åºæ’åºã€‚</li>
</ul>
<h3 id="SQL-INSERT-INTO-è¯­å¥"><a href="#SQL-INSERT-INTO-è¯­å¥" class="headerlink" title="SQL INSERT INTO è¯­å¥"></a>SQL INSERT INTO è¯­å¥</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> table_name (column1,column2,column3,...)</span><br><span class="line"><span class="keyword">VALUES</span> (value1,value2,value3,...);</span><br></pre></td></tr></table></figure>
<ul>
<li>table_nameï¼šéœ€è¦æ’å…¥æ–°è®°å½•çš„è¡¨åã€‚</li>
<li>column1, column2, â€¦ï¼šéœ€è¦æ’å…¥çš„å­—æ®µåã€‚</li>
<li>value1, value2, â€¦ï¼šéœ€è¦æ’å…¥çš„å­—æ®µå€¼</li>
</ul>
<h3 id="SQL-UPDATE-è¯­å¥"><a href="#SQL-UPDATE-è¯­å¥" class="headerlink" title="SQL UPDATE è¯­å¥"></a>SQL UPDATE è¯­å¥</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">UPDATE</span> table_name</span><br><span class="line"><span class="keyword">SET</span> column1 <span class="operator">=</span> value1, column2 <span class="operator">=</span> value2, ...</span><br><span class="line"><span class="keyword">WHERE</span> <span class="keyword">condition</span>;        </span><br></pre></td></tr></table></figure>
<ul>
<li>table_nameï¼šè¦ä¿®æ”¹çš„è¡¨åç§°ã€‚</li>
<li>column1, column2, â€¦ï¼šè¦ä¿®æ”¹çš„å­—æ®µåç§°ï¼Œå¯ä»¥ä¸ºå¤šä¸ªå­—æ®µã€‚</li>
<li>value1, value2, â€¦ï¼šè¦ä¿®æ”¹çš„å€¼ï¼Œå¯ä»¥ä¸ºå¤šä¸ªå€¼ã€‚</li>
<li>conditionï¼šä¿®æ”¹æ¡ä»¶ï¼Œç”¨äºæŒ‡å®šå“ªäº›æ•°æ®è¦ä¿®æ”¹ã€‚</li>
</ul>
<h3 id="SQL-DELETE-è¯­å¥"><a href="#SQL-DELETE-è¯­å¥" class="headerlink" title="SQL DELETE è¯­å¥"></a>SQL DELETE è¯­å¥</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">DELETE</span> <span class="keyword">FROM</span> table_name</span><br><span class="line"><span class="keyword">WHERE</span> <span class="keyword">condition</span>;</span><br></pre></td></tr></table></figure>
<ul>
<li>table_nameï¼šè¦åˆ é™¤çš„è¡¨åç§°ã€‚</li>
<li>conditionï¼šåˆ é™¤æ¡ä»¶ï¼Œç”¨äºæŒ‡å®šå“ªäº›æ•°æ®è¦åˆ é™¤ã€‚</li>
</ul>
<h4 id="åˆ é™¤æ‰€æœ‰æ•°æ®"><a href="#åˆ é™¤æ‰€æœ‰æ•°æ®" class="headerlink" title="åˆ é™¤æ‰€æœ‰æ•°æ®"></a>åˆ é™¤æ‰€æœ‰æ•°æ®</h4><p>DELETE FROM table_name;</p>
<h3 id="MySQL-SELECT-LIMIT"><a href="#MySQL-SELECT-LIMIT" class="headerlink" title="MySQL SELECT LIMIT"></a>MySQL SELECT LIMIT</h3><p>ç”¨äºè§„å®šè¦è¿”å›çš„è®°å½•çš„æ•°ç›®</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> Websites LIMIT <span class="number">2</span>;</span><br></pre></td></tr></table></figure>
<h3 id="LIKE"><a href="#LIKE" class="headerlink" title="LIKE"></a>LIKE</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="operator">*</span></span><br><span class="line"><span class="keyword">from</span> diaochabiao</span><br><span class="line"><span class="keyword">where</span> name <span class="keyword">Like</span> <span class="string">&#x27;l%&#x27;</span>;</span><br></pre></td></tr></table></figure>
<ul>
<li>%l ä»¥â€™lâ€™ç»“å°¾æ‰€æœ‰é¡¹</li>
<li>%l% åŒ…å«â€™lâ€™çš„æ‰€æœ‰é¡¹<br>æ³¨é‡Šï¼šä»diaochabiaoä¸­æ‰¾å‡ºnameåˆ—ä¸­ä»¥â€™lâ€™å¼€å¤´çš„æ‰€æœ‰é¡¹</li>
</ul>
<h3 id="SQL-charlist-é€šé…ç¬¦"><a href="#SQL-charlist-é€šé…ç¬¦" class="headerlink" title="SQL [charlist] é€šé…ç¬¦"></a>SQL [charlist] é€šé…ç¬¦</h3><p>MySQL ä¸­ä½¿ç”¨ REGEXP æˆ– NOT REGEXP è¿ç®—ç¬¦ (æˆ– RLIKE å’Œ NOT RLIKE) æ¥æ“ä½œæ­£åˆ™è¡¨è¾¾å¼</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> diaochabiao</span><br><span class="line"><span class="keyword">WHERE</span> name REGEXP <span class="string">&#x27;^[^A-H]&#x27;</span>;</span><br></pre></td></tr></table></figure>
<h3 id="SQL-IN-æ“ä½œç¬¦"><a href="#SQL-IN-æ“ä½œç¬¦" class="headerlink" title="SQL IN æ“ä½œç¬¦"></a>SQL IN æ“ä½œç¬¦</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> column1, column2, ...</span><br><span class="line"><span class="keyword">FROM</span> table_name</span><br><span class="line"><span class="keyword">WHERE</span> <span class="keyword">column</span> <span class="keyword">IN</span> (value1, value2, ...);</span><br></pre></td></tr></table></figure>
<ul>
<li>column1, column2, â€¦ï¼šè¦é€‰æ‹©çš„å­—æ®µåç§°ï¼Œå¯ä»¥ä¸ºå¤šä¸ªå­—æ®µã€‚å¦‚æœä¸æŒ‡å®šå­—æ®µåç§°ï¼Œåˆ™ä¼šé€‰æ‹©æ‰€æœ‰å­—æ®µã€‚</li>
<li>table_nameï¼šè¦æŸ¥è¯¢çš„è¡¨åç§°ã€‚</li>
<li>columnï¼šè¦æŸ¥è¯¢çš„å­—æ®µåç§°ã€‚</li>
<li>value1, value2, â€¦ï¼šè¦æŸ¥è¯¢çš„å€¼ï¼Œå¯ä»¥ä¸ºå¤šä¸ªå€¼<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> diaochabiao</span><br><span class="line">    <span class="operator">-</span><span class="operator">&gt;</span> <span class="keyword">WHERE</span> BrithYear <span class="keyword">IN</span> (<span class="string">&#x27;2002&#x27;</span>,<span class="string">&#x27;2003&#x27;</span>);</span><br><span class="line"><span class="operator">+</span><span class="comment">----+------+-----------+-------+</span></span><br><span class="line"><span class="operator">|</span> id <span class="operator">|</span> Name <span class="operator">|</span> BrithYear <span class="operator">|</span> sixth <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----+------+-----------+-------+</span></span><br><span class="line"><span class="operator">|</span>  <span class="number">1</span> <span class="operator">|</span> ljn  <span class="operator">|</span>      <span class="number">2002</span> <span class="operator">|</span> ç”·    <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>  <span class="number">2</span> <span class="operator">|</span> ljh  <span class="operator">|</span>      <span class="number">2003</span> <span class="operator">|</span> å¥³    <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----+------+-----------+-------+</span></span><br><span class="line"><span class="number">2</span> <span class="keyword">rows</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure></li>
</ul>
<h3 id="SQL-BETWEEN-æ“ä½œç¬¦"><a href="#SQL-BETWEEN-æ“ä½œç¬¦" class="headerlink" title="SQL BETWEEN æ“ä½œç¬¦"></a>SQL BETWEEN æ“ä½œç¬¦</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> column1, column2, ...</span><br><span class="line"><span class="keyword">FROM</span> table_name</span><br><span class="line"><span class="keyword">WHERE</span> <span class="keyword">column</span> <span class="keyword">BETWEEN</span> value1 <span class="keyword">AND</span> value2;</span><br></pre></td></tr></table></figure>
<ul>
<li>column1, column2, â€¦ï¼šè¦é€‰æ‹©çš„å­—æ®µåç§°ï¼Œå¯ä»¥ä¸ºå¤šä¸ªå­—æ®µã€‚å¦‚æœä¸æŒ‡å®šå­—æ®µåç§°ï¼Œåˆ™ä¼šé€‰æ‹©æ‰€æœ‰å­—æ®µã€‚</li>
<li>table_nameï¼šè¦æŸ¥è¯¢çš„è¡¨åç§°ã€‚</li>
<li>columnï¼šè¦æŸ¥è¯¢çš„å­—æ®µåç§°ã€‚</li>
<li>value1ï¼šèŒƒå›´çš„èµ·å§‹å€¼ã€‚</li>
<li>value2ï¼šèŒƒå›´çš„ç»“æŸå€¼ã€‚</li>
</ul>
<h4 id="å®åˆ—"><a href="#å®åˆ—" class="headerlink" title="å®åˆ—"></a>å®åˆ—</h4><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> diaochabiao</span><br><span class="line">    <span class="operator">-</span><span class="operator">&gt;</span>  <span class="keyword">WHERE</span> id <span class="keyword">BETWEEN</span> <span class="number">3</span> <span class="keyword">AND</span> <span class="number">5</span>;</span><br><span class="line"><span class="operator">+</span><span class="comment">----+------+-----------+-------+</span></span><br><span class="line"><span class="operator">|</span> id <span class="operator">|</span> Name <span class="operator">|</span> BrithYear <span class="operator">|</span> sixth <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----+------+-----------+-------+</span></span><br><span class="line"><span class="operator">|</span>  <span class="number">4</span> <span class="operator">|</span> lhh  <span class="operator">|</span>      <span class="number">2005</span> <span class="operator">|</span> å¥³    <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>  <span class="number">5</span> <span class="operator">|</span> <span class="keyword">NULL</span> <span class="operator">|</span>      <span class="keyword">NULL</span> <span class="operator">|</span> <span class="keyword">NULL</span>  <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----+------+-----------+-------+</span></span><br><span class="line"><span class="number">2</span> <span class="keyword">rows</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure>
<h4 id="å¸¦æœ‰-IN-çš„-BETWEEN-æ“ä½œç¬¦å®ä¾‹"><a href="#å¸¦æœ‰-IN-çš„-BETWEEN-æ“ä½œç¬¦å®ä¾‹" class="headerlink" title="å¸¦æœ‰ IN çš„ BETWEEN æ“ä½œç¬¦å®ä¾‹"></a>å¸¦æœ‰ IN çš„ BETWEEN æ“ä½œç¬¦å®ä¾‹</h4><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> diaochabiao</span><br><span class="line">    <span class="operator">-</span><span class="operator">&gt;</span> <span class="keyword">WHERE</span> (id <span class="keyword">BETWEEN</span> <span class="number">3</span> <span class="keyword">AND</span> <span class="number">5</span>)</span><br><span class="line">    <span class="operator">-</span><span class="operator">&gt;</span> <span class="keyword">AND</span> sixth <span class="keyword">NOT</span> <span class="keyword">IN</span> (<span class="string">&#x27;NULL&#x27;</span>);</span><br><span class="line"><span class="operator">+</span><span class="comment">----+------+-----------+-------+</span></span><br><span class="line"><span class="operator">|</span> id <span class="operator">|</span> Name <span class="operator">|</span> BrithYear <span class="operator">|</span> sixth <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----+------+-----------+-------+</span></span><br><span class="line"><span class="operator">|</span>  <span class="number">4</span> <span class="operator">|</span> lhh  <span class="operator">|</span>      <span class="number">2005</span> <span class="operator">|</span> å¥³    <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----+------+-----------+-------+</span></span><br><span class="line"><span class="number">1</span> <span class="type">row</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.01</span> sec)</span><br></pre></td></tr></table></figure>
<h3 id="SQL-åˆ«å"><a href="#SQL-åˆ«å" class="headerlink" title="SQL åˆ«å"></a>SQL åˆ«å</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">select</span> name,concat(BrithYear,sixth)</span><br><span class="line">    <span class="operator">-</span><span class="operator">&gt;</span> <span class="keyword">AS</span> bs <span class="keyword">from</span> diaochabiao;</span><br><span class="line"><span class="operator">+</span><span class="comment">------+--------+</span></span><br><span class="line"><span class="operator">|</span> name <span class="operator">|</span> bs     <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">------+--------+</span></span><br><span class="line"><span class="operator">|</span> ljn  <span class="operator">|</span> <span class="number">2002</span>ç”· <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> ljh  <span class="operator">|</span> <span class="number">2003</span>å¥³ <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> lhh  <span class="operator">|</span> <span class="number">2005</span>å¥³ <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="keyword">NULL</span> <span class="operator">|</span> <span class="keyword">NULL</span>   <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="keyword">NULL</span> <span class="operator">|</span> <span class="keyword">NULL</span>   <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="keyword">NULL</span> <span class="operator">|</span> <span class="keyword">NULL</span>   <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="keyword">NULL</span> <span class="operator">|</span> <span class="keyword">NULL</span>   <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="keyword">NULL</span> <span class="operator">|</span> <span class="keyword">NULL</span>   <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="keyword">NULL</span> <span class="operator">|</span> <span class="keyword">NULL</span>   <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="keyword">NULL</span> <span class="operator">|</span> <span class="keyword">NULL</span>   <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">------+--------+</span></span><br><span class="line"><span class="number">10</span> <span class="keyword">rows</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.01</span> sec)</span><br></pre></td></tr></table></figure>
<h3 id="SQL-è¿æ¥-JOIN"><a href="#SQL-è¿æ¥-JOIN" class="headerlink" title="SQL è¿æ¥(JOIN)"></a>SQL è¿æ¥(JOIN)</h3><p>SQL JOIN å­å¥ç”¨äºæŠŠæ¥è‡ªä¸¤ä¸ªæˆ–å¤šä¸ªè¡¨çš„è¡Œç»“åˆèµ·æ¥ï¼ŒåŸºäºè¿™äº›è¡¨ä¹‹é—´çš„å…±åŒå­—æ®µã€‚<br>æœ€å¸¸è§çš„ JOIN ç±»å‹ï¼šSQL INNER JOINï¼ˆç®€å•çš„ JOINï¼‰ã€‚ SQL INNER JOIN ä»å¤šä¸ªè¡¨ä¸­è¿”å›æ»¡è¶³ JOIN æ¡ä»¶çš„æ‰€æœ‰è¡Œã€‚</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> column1, column2, ...</span><br><span class="line"><span class="keyword">FROM</span> table1</span><br><span class="line"><span class="keyword">JOIN</span> table2 <span class="keyword">ON</span> <span class="keyword">condition</span>;</span><br></pre></td></tr></table></figure>
<ul>
<li>column1, column2, â€¦ï¼šè¦é€‰æ‹©çš„å­—æ®µåç§°ï¼Œå¯ä»¥ä¸ºå¤šä¸ªå­—æ®µã€‚å¦‚æœä¸æŒ‡å®šå­—æ®µåç§°ï¼Œåˆ™ä¼šé€‰æ‹©æ‰€æœ‰å­—æ®µã€‚</li>
<li>table1ï¼šè¦è¿æ¥çš„ç¬¬ä¸€ä¸ªè¡¨ã€‚</li>
<li>table2ï¼šè¦è¿æ¥çš„ç¬¬äºŒä¸ªè¡¨ã€‚</li>
<li>conditionï¼šè¿æ¥æ¡ä»¶ï¼Œç”¨äºæŒ‡å®šè¿æ¥æ–¹å¼ã€‚</li>
</ul>
<h4 id="ä¸åŒçš„-SQL-JOIN"><a href="#ä¸åŒçš„-SQL-JOIN" class="headerlink" title="ä¸åŒçš„ SQL JOIN"></a>ä¸åŒçš„ SQL JOIN</h4><ul>
<li>INNER JOINï¼šå¦‚æœè¡¨ä¸­æœ‰è‡³å°‘ä¸€ä¸ªåŒ¹é…ï¼Œåˆ™è¿”å›è¡Œ</li>
<li>LEFT JOINï¼šå³ä½¿å³è¡¨ä¸­æ²¡æœ‰åŒ¹é…ï¼Œä¹Ÿä»å·¦è¡¨è¿”å›æ‰€æœ‰çš„è¡Œ</li>
<li>RIGHT JOINï¼šå³ä½¿å·¦è¡¨ä¸­æ²¡æœ‰åŒ¹é…ï¼Œä¹Ÿä»å³è¡¨è¿”å›æ‰€æœ‰çš„è¡Œ</li>
<li>FULL JOINï¼šåªè¦å…¶ä¸­ä¸€ä¸ªè¡¨ä¸­å­˜åœ¨åŒ¹é…ï¼Œåˆ™è¿”å›è¡Œ<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> newlist;</span><br><span class="line"><span class="operator">+</span><span class="comment">---------------------+---------+</span></span><br><span class="line"><span class="operator">|</span> <span class="type">date</span>                <span class="operator">|</span> shenfen <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">---------------------+---------+</span></span><br><span class="line"><span class="operator">|</span> <span class="number">2022</span><span class="number">-12</span><span class="number">-22</span> <span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span> <span class="operator">|</span> <span class="number">2222222</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">2023</span><span class="number">-12</span><span class="number">-21</span> <span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span> <span class="operator">|</span>    <span class="number">2222</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="keyword">NULL</span>                <span class="operator">|</span>    <span class="keyword">NULL</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="keyword">NULL</span>                <span class="operator">|</span>    <span class="keyword">NULL</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="keyword">NULL</span>                <span class="operator">|</span>    <span class="keyword">NULL</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="keyword">NULL</span>                <span class="operator">|</span>    <span class="keyword">NULL</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="keyword">NULL</span>                <span class="operator">|</span>    <span class="keyword">NULL</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">---------------------+---------+</span></span><br><span class="line"><span class="number">7</span> <span class="keyword">rows</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> diaochabiao;</span><br><span class="line"><span class="operator">+</span><span class="comment">----+------+-----------+-------+</span></span><br><span class="line"><span class="operator">|</span> id <span class="operator">|</span> Name <span class="operator">|</span> BrithYear <span class="operator">|</span> sixth <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----+------+-----------+-------+</span></span><br><span class="line"><span class="operator">|</span>  <span class="number">1</span> <span class="operator">|</span> ljn  <span class="operator">|</span>      <span class="number">2002</span> <span class="operator">|</span> ç”·    <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>  <span class="number">2</span> <span class="operator">|</span> ljh  <span class="operator">|</span>      <span class="number">2003</span> <span class="operator">|</span> å¥³    <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>  <span class="number">3</span> <span class="operator">|</span> lhh  <span class="operator">|</span>      <span class="number">2005</span> <span class="operator">|</span> å¥³    <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>  <span class="number">4</span> <span class="operator">|</span> <span class="keyword">NULL</span> <span class="operator">|</span>      <span class="keyword">NULL</span> <span class="operator">|</span> <span class="keyword">NULL</span>  <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----+------+-----------+-------+</span></span><br><span class="line"><span class="number">4</span> <span class="keyword">rows</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure></li>
</ul>
<h3 id="INNER-JOIN"><a href="#INNER-JOIN" class="headerlink" title="INNER JOIN"></a>INNER JOIN</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> newlist</span><br><span class="line">    <span class="operator">-</span><span class="operator">&gt;</span> <span class="keyword">inner</span> <span class="keyword">join</span> diaochabiao</span><br><span class="line">    <span class="operator">-</span><span class="operator">&gt;</span> <span class="keyword">on</span> newlist.id <span class="operator">=</span> diaochabiao.id;</span><br><span class="line"><span class="operator">+</span><span class="comment">----+---------------------+---------+----+------+-----------+-------+</span></span><br><span class="line"><span class="operator">|</span> id <span class="operator">|</span> <span class="type">date</span>                <span class="operator">|</span> shenfen <span class="operator">|</span> id <span class="operator">|</span> Name <span class="operator">|</span> BrithYear <span class="operator">|</span> sixth <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----+---------------------+---------+----+------+-----------+-------+</span></span><br><span class="line"><span class="operator">|</span>  <span class="number">1</span> <span class="operator">|</span> <span class="number">2022</span><span class="number">-12</span><span class="number">-22</span> <span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span> <span class="operator">|</span> <span class="number">2222222</span> <span class="operator">|</span>  <span class="number">1</span> <span class="operator">|</span> ljn  <span class="operator">|</span>      <span class="number">2002</span> <span class="operator">|</span> ç”·    <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>  <span class="number">2</span> <span class="operator">|</span> <span class="number">2023</span><span class="number">-12</span><span class="number">-21</span> <span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span> <span class="operator">|</span>    <span class="number">2222</span> <span class="operator">|</span>  <span class="number">2</span> <span class="operator">|</span> ljh  <span class="operator">|</span>      <span class="number">2003</span> <span class="operator">|</span> å¥³    <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>  <span class="number">3</span> <span class="operator">|</span> <span class="keyword">NULL</span>                <span class="operator">|</span>    <span class="keyword">NULL</span> <span class="operator">|</span>  <span class="number">3</span> <span class="operator">|</span> lhh  <span class="operator">|</span>      <span class="number">2005</span> <span class="operator">|</span> å¥³    <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----+---------------------+---------+----+------+-----------+-------+</span></span><br><span class="line"><span class="number">3</span> <span class="keyword">rows</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure>
<p>æ³¨é‡Šï¼šINNER JOIN å…³é”®å­—åœ¨è¡¨ä¸­å­˜åœ¨è‡³å°‘ä¸€ä¸ªåŒ¹é…æ—¶è¿”å›è¡Œã€‚å¦‚æœ â€œdiaochabiaoâ€ è¡¨ä¸­çš„è¡Œåœ¨ â€œnewlistâ€ ä¸­æ²¡æœ‰åŒ¹é…ï¼Œåˆ™ä¸ä¼šåˆ—å‡ºè¿™äº›è¡Œã€‚</p>
<h3 id="LEFT-JOIN"><a href="#LEFT-JOIN" class="headerlink" title="LEFT JOIN"></a>LEFT JOIN</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> newlist</span><br><span class="line">    <span class="operator">-</span><span class="operator">&gt;</span> <span class="keyword">left</span> <span class="keyword">join</span> diaochabiao</span><br><span class="line">    <span class="operator">-</span><span class="operator">&gt;</span> <span class="keyword">on</span> newlist.id <span class="operator">=</span> diaochabiao.id;</span><br><span class="line"><span class="operator">+</span><span class="comment">----+---------------------+---------+------+------+-----------+-------+</span></span><br><span class="line"><span class="operator">|</span> id <span class="operator">|</span> <span class="type">date</span>                <span class="operator">|</span> shenfen <span class="operator">|</span> id   <span class="operator">|</span> Name <span class="operator">|</span> BrithYear <span class="operator">|</span> sixth <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----+---------------------+---------+------+------+-----------+-------+</span></span><br><span class="line"><span class="operator">|</span>  <span class="number">1</span> <span class="operator">|</span> <span class="number">2022</span><span class="number">-12</span><span class="number">-22</span> <span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span> <span class="operator">|</span> <span class="number">2222222</span> <span class="operator">|</span>    <span class="number">1</span> <span class="operator">|</span> ljn  <span class="operator">|</span>      <span class="number">2002</span> <span class="operator">|</span> ç”·    <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>  <span class="number">2</span> <span class="operator">|</span> <span class="number">2023</span><span class="number">-12</span><span class="number">-21</span> <span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span> <span class="operator">|</span>    <span class="number">2222</span> <span class="operator">|</span>    <span class="number">2</span> <span class="operator">|</span> ljh  <span class="operator">|</span>      <span class="number">2003</span> <span class="operator">|</span> å¥³    <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>  <span class="number">3</span> <span class="operator">|</span> <span class="keyword">NULL</span>                <span class="operator">|</span>    <span class="keyword">NULL</span> <span class="operator">|</span>    <span class="number">3</span> <span class="operator">|</span> lhh  <span class="operator">|</span>      <span class="number">2005</span> <span class="operator">|</span> å¥³    <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>  <span class="number">4</span> <span class="operator">|</span> <span class="keyword">NULL</span>                <span class="operator">|</span>    <span class="keyword">NULL</span> <span class="operator">|</span> <span class="keyword">NULL</span> <span class="operator">|</span> <span class="keyword">NULL</span> <span class="operator">|</span>      <span class="keyword">NULL</span> <span class="operator">|</span> <span class="keyword">NULL</span>  <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>  <span class="number">5</span> <span class="operator">|</span> <span class="keyword">NULL</span>                <span class="operator">|</span>    <span class="keyword">NULL</span> <span class="operator">|</span> <span class="keyword">NULL</span> <span class="operator">|</span> <span class="keyword">NULL</span> <span class="operator">|</span>      <span class="keyword">NULL</span> <span class="operator">|</span> <span class="keyword">NULL</span>  <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>  <span class="number">6</span> <span class="operator">|</span> <span class="keyword">NULL</span>                <span class="operator">|</span>    <span class="keyword">NULL</span> <span class="operator">|</span> <span class="keyword">NULL</span> <span class="operator">|</span> <span class="keyword">NULL</span> <span class="operator">|</span>      <span class="keyword">NULL</span> <span class="operator">|</span> <span class="keyword">NULL</span>  <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>  <span class="number">7</span> <span class="operator">|</span> <span class="keyword">NULL</span>                <span class="operator">|</span>    <span class="keyword">NULL</span> <span class="operator">|</span> <span class="keyword">NULL</span> <span class="operator">|</span> <span class="keyword">NULL</span> <span class="operator">|</span>      <span class="keyword">NULL</span> <span class="operator">|</span> <span class="keyword">NULL</span>  <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----+---------------------+---------+------+------+-----------+-------+</span></span><br><span class="line"><span class="number">7</span> <span class="keyword">rows</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure>
<h3 id="RIGHT-JOIN"><a href="#RIGHT-JOIN" class="headerlink" title="RIGHT JOIN"></a>RIGHT JOIN</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> diaochabiao</span><br><span class="line">    <span class="operator">-</span><span class="operator">&gt;</span> <span class="keyword">right</span> <span class="keyword">join</span> newlist</span><br><span class="line">    <span class="operator">-</span><span class="operator">&gt;</span> <span class="keyword">on</span> diaochabiao.id <span class="operator">=</span> newlist.id</span><br><span class="line">    <span class="operator">-</span><span class="operator">&gt;</span> ;</span><br><span class="line"><span class="operator">+</span><span class="comment">------+------+-----------+-------+----+---------------------+---------+</span></span><br><span class="line"><span class="operator">|</span> id   <span class="operator">|</span> Name <span class="operator">|</span> BrithYear <span class="operator">|</span> sixth <span class="operator">|</span> id <span class="operator">|</span> <span class="type">date</span>                <span class="operator">|</span> shenfen <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">------+------+-----------+-------+----+---------------------+---------+</span></span><br><span class="line"><span class="operator">|</span>    <span class="number">1</span> <span class="operator">|</span> ljn  <span class="operator">|</span>      <span class="number">2002</span> <span class="operator">|</span> ç”·    <span class="operator">|</span>  <span class="number">1</span> <span class="operator">|</span> <span class="number">2022</span><span class="number">-12</span><span class="number">-22</span> <span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span> <span class="operator">|</span> <span class="number">2222222</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>    <span class="number">2</span> <span class="operator">|</span> ljh  <span class="operator">|</span>      <span class="number">2003</span> <span class="operator">|</span> å¥³    <span class="operator">|</span>  <span class="number">2</span> <span class="operator">|</span> <span class="number">2023</span><span class="number">-12</span><span class="number">-21</span> <span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span> <span class="operator">|</span>    <span class="number">2222</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>    <span class="number">3</span> <span class="operator">|</span> lhh  <span class="operator">|</span>      <span class="number">2005</span> <span class="operator">|</span> å¥³    <span class="operator">|</span>  <span class="number">3</span> <span class="operator">|</span> <span class="keyword">NULL</span>                <span class="operator">|</span>    <span class="keyword">NULL</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="keyword">NULL</span> <span class="operator">|</span> <span class="keyword">NULL</span> <span class="operator">|</span>      <span class="keyword">NULL</span> <span class="operator">|</span> <span class="keyword">NULL</span>  <span class="operator">|</span>  <span class="number">4</span> <span class="operator">|</span> <span class="keyword">NULL</span>                <span class="operator">|</span>    <span class="keyword">NULL</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="keyword">NULL</span> <span class="operator">|</span> <span class="keyword">NULL</span> <span class="operator">|</span>      <span class="keyword">NULL</span> <span class="operator">|</span> <span class="keyword">NULL</span>  <span class="operator">|</span>  <span class="number">5</span> <span class="operator">|</span> <span class="keyword">NULL</span>                <span class="operator">|</span>    <span class="keyword">NULL</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="keyword">NULL</span> <span class="operator">|</span> <span class="keyword">NULL</span> <span class="operator">|</span>      <span class="keyword">NULL</span> <span class="operator">|</span> <span class="keyword">NULL</span>  <span class="operator">|</span>  <span class="number">6</span> <span class="operator">|</span> <span class="keyword">NULL</span>                <span class="operator">|</span>    <span class="keyword">NULL</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="keyword">NULL</span> <span class="operator">|</span> <span class="keyword">NULL</span> <span class="operator">|</span>      <span class="keyword">NULL</span> <span class="operator">|</span> <span class="keyword">NULL</span>  <span class="operator">|</span>  <span class="number">7</span> <span class="operator">|</span> <span class="keyword">NULL</span>                <span class="operator">|</span>    <span class="keyword">NULL</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">------+------+-----------+-------+----+---------------------+---------+</span></span><br><span class="line"><span class="number">7</span> <span class="keyword">rows</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure>
<p>æ³¨é‡Šï¼šRIGHT JOIN å…³é”®å­—ä»å³è¡¨ï¼ˆaccess_logï¼‰è¿”å›æ‰€æœ‰çš„è¡Œï¼Œå³ä½¿å·¦è¡¨ï¼ˆWebsitesï¼‰ä¸­æ²¡æœ‰åŒ¹é…ã€‚</p>
<h3 id="SQL-UNION-æ“ä½œç¬¦"><a href="#SQL-UNION-æ“ä½œç¬¦" class="headerlink" title="SQL UNION æ“ä½œç¬¦"></a>SQL UNION æ“ä½œç¬¦</h3><p>SQL UNION æ“ä½œç¬¦åˆå¹¶ä¸¤ä¸ªæˆ–å¤šä¸ª SELECT è¯­å¥çš„ç»“æœã€‚<br>è¯·æ³¨æ„ï¼ŒUNION å†…éƒ¨çš„æ¯ä¸ª SELECT è¯­å¥å¿…é¡»æ‹¥æœ‰ç›¸åŒæ•°é‡çš„åˆ—ã€‚åˆ—ä¹Ÿå¿…é¡»æ‹¥æœ‰ç›¸ä¼¼çš„æ•°æ®ç±»å‹ã€‚åŒæ—¶ï¼Œæ¯ä¸ª SELECT è¯­å¥ä¸­çš„åˆ—çš„é¡ºåºå¿…é¡»ç›¸åŒã€‚</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> column_name(s) <span class="keyword">FROM</span> table1</span><br><span class="line"><span class="keyword">UNION</span></span><br><span class="line"><span class="keyword">SELECT</span> column_name(s) <span class="keyword">FROM</span> table2;</span><br></pre></td></tr></table></figure>
<p>æ³¨é‡Šï¼šé»˜è®¤åœ°ï¼ŒUNION æ“ä½œç¬¦é€‰å–ä¸åŒçš„å€¼ã€‚å¦‚æœå…è®¸é‡å¤çš„å€¼ï¼Œè¯·ä½¿ç”¨ UNION ALLã€‚</p>
<h4 id="å®åˆ—-1"><a href="#å®åˆ—-1" class="headerlink" title="å®åˆ—"></a>å®åˆ—</h4><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">select</span> country <span class="keyword">from</span> diaochabiao</span><br><span class="line">    <span class="operator">-</span><span class="operator">&gt;</span> <span class="keyword">union</span></span><br><span class="line">    <span class="operator">-</span><span class="operator">&gt;</span> <span class="keyword">select</span> country <span class="keyword">from</span> newlist;</span><br><span class="line"><span class="operator">+</span><span class="comment">---------+</span></span><br><span class="line"><span class="operator">|</span> country <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">---------+</span></span><br><span class="line"><span class="operator">|</span> US      <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> CN      <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> UT      <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>         <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">---------+</span></span><br><span class="line"><span class="number">4</span> <span class="keyword">rows</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure>
<h3 id="SQL-UNION-ALL-è¯­æ³•"><a href="#SQL-UNION-ALL-è¯­æ³•" class="headerlink" title="SQL UNION ALL è¯­æ³•"></a>SQL UNION ALL è¯­æ³•</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> column_name(s) <span class="keyword">FROM</span> table1</span><br><span class="line"><span class="keyword">UNION</span> <span class="keyword">ALL</span></span><br><span class="line"><span class="keyword">SELECT</span> column_name(s) <span class="keyword">FROM</span> table2;</span><br></pre></td></tr></table></figure>
<p>æ³¨é‡Šï¼šUNION ç»“æœé›†ä¸­çš„åˆ—åæ€»æ˜¯ç­‰äº UNION ä¸­ç¬¬ä¸€ä¸ª SELECT è¯­å¥ä¸­çš„åˆ—åã€‚</p>
<h4 id="å®ä¾‹"><a href="#å®ä¾‹" class="headerlink" title="å®ä¾‹"></a>å®ä¾‹</h4><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">select</span> country <span class="keyword">from</span> diaochabiao</span><br><span class="line">    <span class="operator">-</span><span class="operator">&gt;</span> <span class="keyword">union</span> <span class="keyword">all</span></span><br><span class="line">    <span class="operator">-</span><span class="operator">&gt;</span> <span class="keyword">select</span> country <span class="keyword">from</span> newlist;</span><br><span class="line"><span class="operator">+</span><span class="comment">---------+</span></span><br><span class="line"><span class="operator">|</span> country <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">---------+</span></span><br><span class="line"><span class="operator">|</span> US      <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> CN      <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> UT      <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> CN      <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> US      <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>         <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>         <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>         <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>         <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>         <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">---------+</span></span><br><span class="line"><span class="number">10</span> <span class="keyword">rows</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure>
<h3 id="SQL-SELECT-INTO-è¯­å¥"><a href="#SQL-SELECT-INTO-è¯­å¥" class="headerlink" title="SQL SELECT INTO è¯­å¥"></a>SQL SELECT INTO è¯­å¥</h3><p>é€šè¿‡ SQLï¼Œæ‚¨å¯ä»¥ä»ä¸€ä¸ªè¡¨å¤åˆ¶ä¿¡æ¯åˆ°å¦ä¸€ä¸ªè¡¨ã€‚</p>
<p>SELECT INTO è¯­å¥ä»ä¸€ä¸ªè¡¨å¤åˆ¶æ•°æ®ï¼Œç„¶åæŠŠæ•°æ®æ’å…¥åˆ°å¦ä¸€ä¸ªæ–°è¡¨ä¸­ã€‚</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span></span><br><span class="line"><span class="keyword">INTO</span> newtable [<span class="keyword">IN</span> externaldb]</span><br><span class="line"><span class="keyword">FROM</span> table1;</span><br></pre></td></tr></table></figure>
<h3 id="SQL-INSERT-INTO-SELECT-è¯­å¥"><a href="#SQL-INSERT-INTO-SELECT-è¯­å¥" class="headerlink" title="SQL INSERT INTO SELECT è¯­å¥"></a>SQL INSERT INTO SELECT è¯­å¥</h3><p>INSERT INTO SELECT è¯­å¥ä»ä¸€ä¸ªè¡¨å¤åˆ¶æ•°æ®ï¼Œç„¶åæŠŠæ•°æ®æ’å…¥åˆ°ä¸€ä¸ªå·²å­˜åœ¨çš„è¡¨ä¸­ã€‚ç›®æ ‡è¡¨ä¸­ä»»ä½•å·²å­˜åœ¨çš„è¡Œéƒ½ä¸ä¼šå—å½±å“ã€‚</p>
<h4 id="è¯­æ³•"><a href="#è¯­æ³•" class="headerlink" title="è¯­æ³•"></a>è¯­æ³•</h4><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> table2</span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> table1;</span><br></pre></td></tr></table></figure>
<h4 id="å®åˆ—-2"><a href="#å®åˆ—-2" class="headerlink" title="å®åˆ—"></a>å®åˆ—</h4><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> persons;</span><br><span class="line"><span class="operator">+</span><span class="comment">----------+-----------+---------+</span></span><br><span class="line"><span class="operator">|</span> personID <span class="operator">|</span> FristName <span class="operator">|</span> country <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----------+-----------+---------+</span></span><br><span class="line"><span class="operator">|</span>        <span class="number">1</span> <span class="operator">|</span> ljn       <span class="operator">|</span> cn      <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----------+-----------+---------+</span></span><br><span class="line"><span class="number">1</span> <span class="type">row</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">insert</span> <span class="keyword">into</span> persons(FristName,country)</span><br><span class="line">    <span class="operator">-</span><span class="operator">&gt;</span> <span class="keyword">select</span> name,country <span class="keyword">from</span> diaochabiao;</span><br><span class="line">Query OK, <span class="number">3</span> <span class="keyword">rows</span> affected (<span class="number">0.01</span> sec)</span><br><span class="line">Records: <span class="number">3</span>  Duplicates: <span class="number">0</span>  Warnings: <span class="number">0</span></span><br><span class="line"></span><br><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> persons;</span><br><span class="line"><span class="operator">+</span><span class="comment">----------+-----------+---------+</span></span><br><span class="line"><span class="operator">|</span> personID <span class="operator">|</span> FristName <span class="operator">|</span> country <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----------+-----------+---------+</span></span><br><span class="line"><span class="operator">|</span>        <span class="number">1</span> <span class="operator">|</span> ljn       <span class="operator">|</span> cn      <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>        <span class="number">2</span> <span class="operator">|</span> ljn       <span class="operator">|</span> US      <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>        <span class="number">3</span> <span class="operator">|</span> ljh       <span class="operator">|</span> CN      <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>        <span class="number">4</span> <span class="operator">|</span> lhh       <span class="operator">|</span> UT      <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----------+-----------+---------+</span></span><br><span class="line"><span class="number">4</span> <span class="keyword">rows</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>æ•°æ®åº“</category>
      </categories>
      <tags>
        <tag>sql</tag>
      </tags>
  </entry>
  <entry>
    <title>Dockerå¸¸ç”¨æŒ‡ä»¤</title>
    <url>/2024/08/28/%E8%BF%90%E7%BB%B4/docker/Docker%E5%B8%B8%E7%94%A8%E6%8C%87%E4%BB%A4/</url>
    <content><![CDATA[<blockquote><p>å£°æ˜: æœ¬æ–‡ç¯å¢ƒå‡é‡‡ç”¨ubuntu:20.04</p>
</blockquote>
<h3 id="DockeræœåŠ¡å¯åœ"><a href="#DockeræœåŠ¡å¯åœ" class="headerlink" title="DockeræœåŠ¡å¯åœ"></a>DockeræœåŠ¡å¯åœ</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">systemctl start docker <span class="comment">#å¯åŠ¨docker</span></span><br><span class="line">systemctl status docker <span class="comment">#æŸ¥çœ‹æœåŠ¡çŠ¶æ€</span></span><br><span class="line">systemctl stop docker <span class="comment">#åœæ­¢</span></span><br><span class="line">systemctl restart docker <span class="comment">#é‡å¯docker</span></span><br><span class="line">systemctl <span class="built_in">enable</span> docker <span class="comment">#å¼€æœºå¯åŠ¨</span></span><br></pre></td></tr></table></figure>

<h3 id="Dockeré•œåƒå‘½ä»¤"><a href="#Dockeré•œåƒå‘½ä»¤" class="headerlink" title="Dockeré•œåƒå‘½ä»¤"></a>Dockeré•œåƒå‘½ä»¤</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">docker rmi docker images -q  <span class="comment">#åˆ é™¤æ‰€æœ‰é•œåƒ</span></span><br><span class="line">docker image <span class="built_in">rm</span> &lt;é•œåƒåç§°æˆ–ID&gt; <span class="comment">#åˆ é™¤å•ä¸ªé•œåƒå‘½ä»¤</span></span><br><span class="line">docker image <span class="built_in">rm</span> -f &lt;é•œåƒåç§°æˆ–ID&gt; <span class="comment">#å¼ºåˆ¶åˆ é™¤é•œåƒå‘½ä»¤</span></span><br><span class="line">docker images -q name <span class="comment">#æŸ¥çœ‹é•œåƒæ˜¯å¦å­˜åœ¨</span></span><br><span class="line">docker build -f BackFile -t back:v1 <span class="comment">#æŒ‡å®šdockerfileåç§°</span></span><br></pre></td></tr></table></figure>

<h3 id="Dockerå®¹å™¨å‘½ä»¤"><a href="#Dockerå®¹å™¨å‘½ä»¤" class="headerlink" title="Dockerå®¹å™¨å‘½ä»¤"></a>Dockerå®¹å™¨å‘½ä»¤</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">docker ps -a <span class="comment">#æŸ¥çœ‹å†å²å®¹å™¨</span></span><br><span class="line">docker <span class="built_in">kill</span> -s KILL name <span class="comment">#å‘å®¹å™¨å‘é€ä¸€ä¸ªä¿¡å·æ€æ­»å®¹å™¨</span></span><br><span class="line">docker <span class="built_in">exec</span> -it name /bin/bash <span class="comment">#åˆ†é…ä¸€ä¸ªç»ˆç«¯ç»™å®¹å™¨ï¼Œè¿›å…¥å®¹å™¨</span></span><br><span class="line">docker <span class="built_in">export</span> 1e560fca3906 &gt; ubuntu.tar <span class="comment">#å¯¼å‡ºå®¹å™¨ 1e560fca3906 å¿«ç…§åˆ°æœ¬åœ°æ–‡ä»¶ ubuntu.tarã€‚</span></span><br><span class="line">docker stop name <span class="comment">#åœæ­¢å®¹å™¨</span></span><br><span class="line">docker <span class="built_in">rm</span> name <span class="comment">#åˆ é™¤å®¹å™¨</span></span><br><span class="line">docker <span class="built_in">rm</span> -f 1e560fca3906 <span class="comment">#åˆ é™¤å®¹å™¨</span></span><br><span class="line">docker <span class="built_in">rm</span> docker ps -aq <span class="comment">#åˆ é™¤æ‰€æœ‰å®¹å™¨</span></span><br><span class="line">docker inspect name <span class="comment">#æŸ¥çœ‹å®¹å™¨ä¿¡æ¯c</span></span><br><span class="line">docker stop $(docker ps -a -q) <span class="comment">#åœæ­¢æ‰€æœ‰å®¹å™¨</span></span><br><span class="line">docker <span class="built_in">rm</span> $(docker ps -a -q) <span class="comment">#åˆ é™¤æ‰€æœ‰å®¹å™¨</span></span><br><span class="line"><span class="comment">#åœæ­¢å¹¶åˆ é™¤æ‰€æœ‰å®¹å™¨</span></span><br><span class="line">docker stop $(docker ps -a -q) &amp;&amp; docker <span class="built_in">rm</span> $(docker ps -a -q)</span><br><span class="line">docker <span class="built_in">exec</span> -it myMysql mysql -u root -p123456 <span class="comment">#è¿›å…¥mysqlæ§åˆ¶å°</span></span><br><span class="line">docker update --restart=always &lt;å®¹å™¨åç§°&gt; <span class="comment">#å®¹å™¨è‡ªå¯åŠ¨</span></span><br><span class="line">docker inspect &lt;å®¹å™¨å&gt;| grep RestartPolicy <span class="comment">#éªŒè¯æ˜¯å¦ç”Ÿæ•ˆ</span></span><br></pre></td></tr></table></figure>

<h3 id="Dockerå®¹å™¨çš„æ•°æ®å·"><a href="#Dockerå®¹å™¨çš„æ•°æ®å·" class="headerlink" title="Dockerå®¹å™¨çš„æ•°æ®å·"></a>Dockerå®¹å™¨çš„æ•°æ®å·</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">docker run ....-v å®¿ä¸»æœºç›®å½•ï¼ˆæ–‡ä»¶ï¼‰:å®¹å™¨å†…ç›®å½•ï¼ˆæ–‡ä»¶ï¼‰...</span><br><span class="line"><span class="comment">#åˆ—</span></span><br><span class="line">docker run -it --name=c1 -v /root/data:/root/data_container centos:7</span><br><span class="line">docker volume <span class="built_in">ls</span> <span class="comment">#æŸ¥çœ‹æ•°æ®å·</span></span><br><span class="line">docker inspect name <span class="comment">#æŸ¥çœ‹æ•°æ®å·ä¿¡æ¯</span></span><br></pre></td></tr></table></figure>

<h3 id="Dockerå¤åˆ¶ä¸»æœºæ–‡ä»¶å‘½ä»¤"><a href="#Dockerå¤åˆ¶ä¸»æœºæ–‡ä»¶å‘½ä»¤" class="headerlink" title="Dockerå¤åˆ¶ä¸»æœºæ–‡ä»¶å‘½ä»¤"></a>Dockerå¤åˆ¶ä¸»æœºæ–‡ä»¶å‘½ä»¤</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">docker <span class="built_in">cp</span> &lt;host_path&gt; &lt;container_name_or_id&gt;:&lt;container_path&gt;</span><br><span class="line">docker <span class="built_in">cp</span> /home/user/data/. my-container:/app/data/</span><br></pre></td></tr></table></figure>

<h3 id="Dockerç«¯å£æ˜ å°„"><a href="#Dockerç«¯å£æ˜ å°„" class="headerlink" title="Dockerç«¯å£æ˜ å°„"></a>Dockerç«¯å£æ˜ å°„</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">docker run -it -p [å®¿ä¸»æœºç«¯å£]:[ä¸»æœºç«¯å£] --name [åç§°] [é•œåƒåç§°]</span><br><span class="line">docker run --name myMysql -p 23306:3306 -e MYSQL_ROOT_PASSWORD=123456 -d mysql:5.7</span><br></pre></td></tr></table></figure>

<h3 id="MYSQLåˆ›å»ºä¸€ä¸ªå®¹å™¨"><a href="#MYSQLåˆ›å»ºä¸€ä¸ªå®¹å™¨" class="headerlink" title="MYSQLåˆ›å»ºä¸€ä¸ªå®¹å™¨"></a>MYSQLåˆ›å»ºä¸€ä¸ªå®¹å™¨</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">docker run -<span class="built_in">id</span> \</span><br><span class="line">&gt; -p 3307:3306 \</span><br><span class="line">&gt; --name=c_mysql \</span><br><span class="line">&gt; -v <span class="variable">$PWD</span>/conf:/etc/mysql/conf.d \</span><br><span class="line">&gt; -v <span class="variable">$PWD</span>/logs:/logs \</span><br><span class="line">&gt; -v <span class="variable">$PWD</span>/data:/var/lib/mysql \</span><br><span class="line">&gt; -e MYSQL_ROOT_PASSWORD=123456 \</span><br><span class="line">&gt; mysql:latest</span><br><span class="line"><span class="comment"># æŒ‡å®šmysqlå®¹å™¨æ•°æ®åº“å­—ç¬¦é›†</span></span><br><span class="line">docker run --name myMysql -p 23306:3306 -e MYSQL_ROOT_PASSWORD=123456 -e MYSQL_DATABASE=health -e MYSQL_CHARSET=utf8 -d mysql:5.7</span><br></pre></td></tr></table></figure>

<h3 id="DockerFile"><a href="#DockerFile" class="headerlink" title="DockerFile"></a>DockerFile</h3><p><a class="link"   href="https://www.runoob.com/docker/docker-dockerfile.html" >dockerfileå¸¸ç”¨æŒ‡ä»¤<i class="fas fa-external-link-alt"></i></a></p>
<ul>
<li>åˆ›å»ºé•œåƒæŒ‡ä»¤</li>
</ul>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">docker build -t myubuntu:01 .</span><br><span class="line">docker build -t é•œåƒå:ç‰ˆæœ¬å· DockerFileæ‰€åœ¨çš„æ–‡ä»¶ç›®å½•</span><br></pre></td></tr></table></figure>

<ul>
<li>ç¼–å†™Dockerfileæ–‡ä»¶</li>
</ul>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">FROM centos  <span class="comment"># æŒ‡å®šé•œåƒæ¥æº</span></span><br><span class="line">WORKDIR /app <span class="comment"># æŒ‡å®šåç»­æŒ‡ä»¤å·¥ä½œç›®å½•</span></span><br><span class="line">COPY src/ /app <span class="comment"># å°†å®¿ä¸»æœºæ–‡ä»¶å¤åˆ¶åˆ°å®¹å™¨ä¸­</span></span><br><span class="line">RUN <span class="built_in">echo</span> 321 &gt;&gt; 1.txt <span class="comment"># åœ¨æ„å»ºå®¹å™¨è¿‡ç¨‹ä¸­æ‰§è¡Œå‘½ä»¤</span></span><br><span class="line">CMD <span class="built_in">tail</span> -f 1.txt <span class="comment"># æŒ‡å®šåˆ›å»ºå®¹å™¨æ—¶çš„é»˜è®¤å‘½ä»¤</span></span><br></pre></td></tr></table></figure>

<h3 id="Dockeræ„å»ºé•œåƒå‘½ä»¤"><a href="#Dockeræ„å»ºé•œåƒå‘½ä»¤" class="headerlink" title="Dockeræ„å»ºé•œåƒå‘½ä»¤"></a>Dockeræ„å»ºé•œåƒå‘½ä»¤</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">docker build -t [name] . <span class="comment">#dockerfileæ–‡ä»¶ä½ç½®</span></span><br></pre></td></tr></table></figure>

<h3 id="Docker-composeé…ç½®æ–‡ä»¶"><a href="#Docker-composeé…ç½®æ–‡ä»¶" class="headerlink" title="Docker-composeé…ç½®æ–‡ä»¶"></a>Docker-composeé…ç½®æ–‡ä»¶</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># ä»£è¡¨docker-composeé¡¹ç›®ç‰ˆæœ¬å·</span></span><br><span class="line">version: <span class="string">&quot;3.8&quot;</span></span><br><span class="line">services:</span><br><span class="line">  tomcat:</span><br><span class="line">     container_name: tomcat00 <span class="comment">#ä»£è¡¨ç»™å®¹å™¨æŒ‡å®šä¸€ä¸ªåç§°</span></span><br><span class="line">     image: tomcat:latest</span><br><span class="line">     ports:</span><br><span class="line">        - 8080:8080</span><br><span class="line">  tomcat01:</span><br><span class="line">    image: tomcat:latest</span><br><span class="line">    ports:</span><br><span class="line">        - 8081:8081</span><br><span class="line">  redis:</span><br><span class="line">    image: redis:5.0</span><br><span class="line">    ports:</span><br><span class="line">      - <span class="string">&quot;6380:6379&quot;</span></span><br><span class="line">  mysql:</span><br><span class="line">    image: mysql:latest</span><br><span class="line">    ports:</span><br><span class="line">      - <span class="string">&quot;3307:3306&quot;</span></span><br><span class="line">    environment: <span class="comment">#ä»£è¡¨å½“å‰å®¹å™¨å¯åŠ¨ç¯å¢ƒ</span></span><br><span class="line">      - <span class="string">&quot;MYSQL_ROOT_PASSWORD=12345678&quot;</span></span><br><span class="line">    volumes:  <span class="comment">#ä»£è¡¨å½“å‰å®¹å™¨å’Œå®¿ä¸»æœºæŒ‡å®šæ•°æ®å·</span></span><br><span class="line">      - /root/mysqldata1:/var/lib/mysql</span><br><span class="line">volumes:</span><br><span class="line">  mysqlData: <span class="comment">#å£°æ˜åˆ«åæ•°æ®å·</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ul>
<li>å¯åŠ¨docker-compose</li>
</ul>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">docker-compose up <span class="comment">#æŒ‡å®šè¿™ä¸ªå‘½ä»¤å¿…é¡»åœ¨dokcer-compose.ymlæ–‡ä»¶é…å€¼æ–‡ä»¶ç›®å½•</span></span><br><span class="line">docker-compose down <span class="comment">#æ¸…é™¤ç¼“å­˜</span></span><br><span class="line">docker-compose down --rmi all <span class="comment">#ç§»é™¤æ‰€æœ‰é•œåƒ</span></span><br><span class="line">docker-compose build --no-cache name</span><br><span class="line">docker-compose up --force-recreate --build  <span class="comment">#å¼ºåˆ¶é‡æ–°åˆ›å»ºæ‰€æœ‰å®¹å™¨</span></span><br></pre></td></tr></table></figure>

<h3 id="DockerFileå’ŒDocker-composeåŒºåˆ«"><a href="#DockerFileå’ŒDocker-composeåŒºåˆ«" class="headerlink" title="DockerFileå’ŒDocker-composeåŒºåˆ«"></a>DockerFileå’ŒDocker-composeåŒºåˆ«</h3><ul>
<li><strong>Dockerfileï¼š</strong> ç”¨äºå®šä¹‰å¦‚ä½•æ„å»ºå•ä¸ª Docker é•œåƒï¼ŒåŒ…æ‹¬åŸºç¡€é•œåƒã€æ·»åŠ æ–‡ä»¶ã€è¿è¡Œå‘½ä»¤ã€è®¾ç½®ç¯å¢ƒå˜é‡ç­‰ã€‚</li>
<li><strong>docker-composeï¼š</strong> ç”¨äºå®šä¹‰å’Œç®¡ç†å¤šä¸ªç›¸å…³è”çš„ Docker å®¹å™¨ï¼Œä»¥åˆ›å»ºä¸€ä¸ªå®Œæ•´çš„å®¹å™¨åŒ–åº”ç”¨ç¨‹åºã€‚é€šè¿‡ä¸€ä¸ª YAML æ–‡ä»¶é…ç½®å¤šä¸ªå®¹å™¨ã€ç½‘ç»œã€å·ç­‰ï¼Œç®€åŒ–äº†å®¹å™¨ç»„åˆå’Œåè°ƒçš„è¿‡ç¨‹ã€‚</li>
</ul>
<h3 id="Dockeréƒ¨ç½²H2æ•°æ®åº“"><a href="#Dockeréƒ¨ç½²H2æ•°æ®åº“" class="headerlink" title="Dockeréƒ¨ç½²H2æ•°æ®åº“"></a>Dockeréƒ¨ç½²H2æ•°æ®åº“</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment">#æ‹‰å–é•œåƒ</span></span><br><span class="line">docker pull oscarfonts/h2</span><br><span class="line"><span class="comment">#åˆ›å»ºå®¹å™¨</span></span><br><span class="line">docker run -d -p 8082:8082 -p 9092:9092 --name h2-database -e H2_OPTIONS=<span class="string">&#x27;-ifNotExists&#x27;</span> oscarfonts/h2</span><br><span class="line"><span class="comment">#H2_OPTIONS: è¿™æ˜¯ä¸€ä¸ªç¯å¢ƒå˜é‡çš„åç§°ï¼Œå®ƒè¢«H2æ•°æ®åº“é•œåƒç”¨æ¥è¯†åˆ«å¯åŠ¨é€‰é¡¹ã€‚&#x27;-ifNotExists&#x27;: è¿™æ˜¯H2æ•°æ®åº“çš„å¯åŠ¨é€‰é¡¹ï¼Œå‘Šè¯‰H2åœ¨å¯åŠ¨æ—¶æ£€æŸ¥æ•°æ®åº“æ–‡ä»¶æ˜¯å¦å­˜åœ¨ï¼Œå¦‚æœä¸å­˜åœ¨ï¼Œåˆ™åˆ›å»ºä¸€ä¸ªæ–°çš„æ•°æ®åº“ã€‚</span></span><br></pre></td></tr></table></figure>
<h3 id="Dockeråˆ›å»ºRediså®¹å™¨å¹¶æŒ‡å®šç”¨æˆ·åå¯†ç "><a href="#Dockeråˆ›å»ºRediså®¹å™¨å¹¶æŒ‡å®šç”¨æˆ·åå¯†ç " class="headerlink" title="Dockeråˆ›å»ºRediså®¹å™¨å¹¶æŒ‡å®šç”¨æˆ·åå¯†ç "></a>Dockeråˆ›å»ºRediså®¹å™¨å¹¶æŒ‡å®šç”¨æˆ·åå¯†ç </h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">docker run --name myRedis -p 6379:6379 -d redis:alpine --requirepass your_password</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>è¿ç»´</category>
        <category>docker</category>
      </categories>
      <tags>
        <tag>è¿ç»´</tag>
        <tag>docker</tag>
      </tags>
  </entry>
  <entry>
    <title>ä¸€é”®éƒ¨ç½² Elasticsearch å’Œ Kibana</title>
    <url>/2024/12/31/%E8%BF%90%E7%BB%B4/docker/%E4%B8%80%E9%94%AE%E9%83%A8%E7%BD%B2-Elasticsearch-%E5%92%8C-Kibana/</url>
    <content><![CDATA[<h1 id="ä¸€é”®éƒ¨ç½²-Elasticsearch-å’Œ-Kibana"><a href="#ä¸€é”®éƒ¨ç½²-Elasticsearch-å’Œ-Kibana" class="headerlink" title="ä¸€é”®éƒ¨ç½² Elasticsearch å’Œ Kibana"></a>ä¸€é”®éƒ¨ç½² Elasticsearch å’Œ Kibana</h1><p>åœ¨å¼€å‘æˆ–æµ‹è¯•ç¯å¢ƒä¸­ï¼Œå¿«é€Ÿæ­å»º Elasticsearch å’Œ Kibana æ˜¯å¾ˆå¤šå¼€å‘è€…çš„éœ€æ±‚ã€‚é€šè¿‡ Docker Composeï¼Œå¯ä»¥éå¸¸æ–¹ä¾¿åœ°å®ç° Elasticsearch å’Œ Kibana çš„ä¸€é”®éƒ¨ç½²ã€‚æœ¬ç¯‡æ–‡ç« å°†ä»‹ç»å¦‚ä½•ä½¿ç”¨ Docker Compose å¿«é€Ÿéƒ¨ç½² Elasticsearch å’Œ Kibanaã€‚</p>
<h2 id="ä¸ºä»€ä¹ˆä½¿ç”¨-Docker-éƒ¨ç½²ï¼Ÿ"><a href="#ä¸ºä»€ä¹ˆä½¿ç”¨-Docker-éƒ¨ç½²ï¼Ÿ" class="headerlink" title="ä¸ºä»€ä¹ˆä½¿ç”¨ Docker éƒ¨ç½²ï¼Ÿ"></a>ä¸ºä»€ä¹ˆä½¿ç”¨ Docker éƒ¨ç½²ï¼Ÿ</h2><ul>
<li><strong>ç®€åŒ–ç¯å¢ƒé…ç½®</strong>ï¼šæ— éœ€æ‰‹åŠ¨å®‰è£…å’Œé…ç½® Elasticsearch å’Œ Kibanaï¼Œç›´æ¥ä½¿ç”¨å®˜æ–¹é•œåƒå³å¯ã€‚</li>
<li><strong>å¿«é€Ÿå¯åŠ¨å’Œé”€æ¯</strong>ï¼šé€šè¿‡ Docker Composeï¼Œä¸€æ¡å‘½ä»¤å³å¯å¯åŠ¨æˆ–åˆ é™¤æ•´ä¸ªæœåŠ¡é›†ç¾¤ã€‚</li>
<li><strong>ä¸€è‡´æ€§</strong>ï¼šç¡®ä¿å¼€å‘å’Œæµ‹è¯•ç¯å¢ƒä¸ç”Ÿäº§ç¯å¢ƒçš„ä¸€è‡´æ€§ã€‚</li>
</ul>
<h2 id="å‡†å¤‡å·¥ä½œ"><a href="#å‡†å¤‡å·¥ä½œ" class="headerlink" title="å‡†å¤‡å·¥ä½œ"></a>å‡†å¤‡å·¥ä½œ</h2><ol>
<li>ç¡®ä¿å·²ç»å®‰è£…ä»¥ä¸‹å·¥å…·ï¼š<ul>
<li><a class="link"   href="https://www.docker.com/" >Docker<i class="fas fa-external-link-alt"></i></a></li>
<li><a class="link"   href="https://docs.docker.com/compose/" >Docker Compose<i class="fas fa-external-link-alt"></i></a></li>
</ul>
</li>
<li>ç¡®ä¿æœºå™¨æœ‰è¶³å¤Ÿçš„èµ„æºã€‚å»ºè®®è‡³å°‘ 2GB å†…å­˜å¯ç”¨ï¼Œç‰¹åˆ«æ˜¯ Elasticsearch å¯¹å†…å­˜éœ€æ±‚è¾ƒé«˜ã€‚</li>
</ol>
<h2 id="åˆ›å»º-Docker-Compose-é…ç½®æ–‡ä»¶"><a href="#åˆ›å»º-Docker-Compose-é…ç½®æ–‡ä»¶" class="headerlink" title="åˆ›å»º Docker Compose é…ç½®æ–‡ä»¶"></a>åˆ›å»º Docker Compose é…ç½®æ–‡ä»¶</h2><p>åœ¨é¡¹ç›®ç›®å½•ä¸‹ï¼Œæ–°å»ºä¸€ä¸ªæ–‡ä»¶ <code>docker-compose.yml</code>ï¼Œå†…å®¹å¦‚ä¸‹ï¼š</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">version:</span> <span class="string">&#x27;3.7&#x27;</span></span><br><span class="line"><span class="attr">services:</span></span><br><span class="line">  <span class="attr">elasticsearch:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">docker.elastic.co/elasticsearch/elasticsearch:7.17.10</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">elasticsearch</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">discovery.type=single-node</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">ES_JAVA_OPTS=-Xms512m</span> <span class="string">-Xmx512m</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">xpack.security.enabled=false</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">xpack.monitoring.collection.enabled=true</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">es_data:/usr/share/elasticsearch/data</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;9200:9200&quot;</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;9300:9300&quot;</span></span><br><span class="line">    <span class="attr">networks:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">elastic</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">kibana:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">docker.elastic.co/kibana/kibana:7.17.10</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">kibana</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">ELASTICSEARCH_HOSTS=http://elasticsearch:9200</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;5601:5601&quot;</span></span><br><span class="line">    <span class="attr">networks:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">elastic</span></span><br><span class="line"></span><br><span class="line"><span class="attr">volumes:</span></span><br><span class="line">  <span class="attr">es_data:</span></span><br><span class="line">    <span class="attr">driver:</span> <span class="string">local</span></span><br><span class="line"></span><br><span class="line"><span class="attr">networks:</span></span><br><span class="line">  <span class="attr">elastic:</span></span><br><span class="line">    <span class="attr">driver:</span> <span class="string">bridge</span></span><br></pre></td></tr></table></figure>

<h3 id="é…ç½®è§£æ"><a href="#é…ç½®è§£æ" class="headerlink" title="é…ç½®è§£æ"></a>é…ç½®è§£æ</h3><ul>
<li><p><strong>Elasticsearch</strong>:</p>
<ul>
<li><code>discovery.type=single-node</code>ï¼šè®¾ç½®ä¸ºå•èŠ‚ç‚¹æ¨¡å¼ï¼Œé€‚åˆå¼€å‘å’Œæµ‹è¯•ç¯å¢ƒã€‚</li>
<li><code>ES_JAVA_OPTS=-Xms512m -Xmx512m</code>ï¼šåˆ†é… 512MB å†…å­˜ï¼Œå¯ä»¥æ ¹æ®æœºå™¨é…ç½®è°ƒæ•´ã€‚</li>
<li><code>xpack.security.enabled=false</code>ï¼šå…³é—­å®‰å…¨åŠŸèƒ½ï¼Œç®€åŒ–é…ç½®ã€‚</li>
</ul>
</li>
<li><p><strong>Kibana</strong>:</p>
<ul>
<li><code>ELASTICSEARCH_HOSTS=http://elasticsearch:9200</code>ï¼šæŒ‡å®š Elasticsearch çš„åœ°å€ã€‚</li>
</ul>
</li>
<li><p><strong>Volumes</strong>: ä½¿ç”¨æŒä¹…åŒ–å­˜å‚¨ï¼Œç¡®ä¿æ•°æ®åœ¨å®¹å™¨é‡å¯åä¸ä¼šä¸¢å¤±ã€‚</p>
</li>
<li><p><strong>Networks</strong>: å®šä¹‰è‡ªå®šä¹‰ç½‘ç»œï¼Œä¿è¯å®¹å™¨é—´çš„é€šä¿¡ã€‚</p>
</li>
</ul>
<h2 id="å¯åŠ¨æœåŠ¡"><a href="#å¯åŠ¨æœåŠ¡" class="headerlink" title="å¯åŠ¨æœåŠ¡"></a>å¯åŠ¨æœåŠ¡</h2><p>åœ¨ <code>docker-compose.yml</code> æ–‡ä»¶æ‰€åœ¨çš„ç›®å½•ï¼Œè¿è¡Œä»¥ä¸‹å‘½ä»¤ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">docker-compose up -d</span><br></pre></td></tr></table></figure>

<ul>
<li><code>-d</code> å‚æ•°è¡¨ç¤ºä»¥åå°æ¨¡å¼è¿è¡Œã€‚</li>
<li>è¿è¡ŒæˆåŠŸåï¼ŒDocker ä¼šæ‹‰å– Elasticsearch å’Œ Kibana çš„é•œåƒï¼Œå¹¶å¯åŠ¨å¯¹åº”çš„å®¹å™¨ã€‚</li>
</ul>
<h2 id="éªŒè¯éƒ¨ç½²"><a href="#éªŒè¯éƒ¨ç½²" class="headerlink" title="éªŒè¯éƒ¨ç½²"></a>éªŒè¯éƒ¨ç½²</h2><ol>
<li><p><strong>Elasticsearch</strong>:<br>æ‰“å¼€æµè§ˆå™¨ï¼Œè®¿é—® <a class="link"   href="http://localhost:9200/" >http://localhost:9200<i class="fas fa-external-link-alt"></i></a>ã€‚<br>å¦‚æœçœ‹åˆ°ç±»ä¼¼ä»¥ä¸‹å†…å®¹ï¼Œè¯´æ˜ Elasticsearch éƒ¨ç½²æˆåŠŸï¼š</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;name&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;&lt;å®¹å™¨å&gt;&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;cluster_name&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;docker-cluster&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;cluster_uuid&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;...&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;version&quot;</span> <span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;number&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;7.17.10&quot;</span><span class="punctuation">,</span></span><br><span class="line">    ...</span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  ...</span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>Kibana</strong>:<br>æ‰“å¼€æµè§ˆå™¨ï¼Œè®¿é—® <a class="link"   href="http://localhost:5601/" >http://localhost:5601<i class="fas fa-external-link-alt"></i></a>ã€‚<br>å¦‚æœçœ‹åˆ° Kibana çš„ç™»å½•é¡µé¢æˆ–åŠ è½½ç•Œé¢ï¼Œè¯´æ˜ Kibana éƒ¨ç½²æˆåŠŸã€‚</p>
</li>
</ol>
<h2 id="å¸¸è§é—®é¢˜"><a href="#å¸¸è§é—®é¢˜" class="headerlink" title="å¸¸è§é—®é¢˜"></a>å¸¸è§é—®é¢˜</h2><h3 id="1-å®¹å™¨æ— æ³•å¯åŠ¨ï¼Ÿ"><a href="#1-å®¹å™¨æ— æ³•å¯åŠ¨ï¼Ÿ" class="headerlink" title="1. å®¹å™¨æ— æ³•å¯åŠ¨ï¼Ÿ"></a>1. å®¹å™¨æ— æ³•å¯åŠ¨ï¼Ÿ</h3><ul>
<li>æ£€æŸ¥æœºå™¨æ˜¯å¦æœ‰è¶³å¤Ÿçš„å†…å­˜ã€‚Elasticsearch å¯¹å†…å­˜éœ€æ±‚è¾ƒé«˜ï¼Œå¯ä»¥å°è¯•å¢å¤§å†…å­˜åˆ†é…ï¼š<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">environment:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">ES_JAVA_OPTS=-Xms1g</span> <span class="string">-Xmx1g</span></span><br></pre></td></tr></table></figure></li>
</ul>
<h3 id="2-Kibana-æ— æ³•è¿æ¥åˆ°-Elasticsearchï¼Ÿ"><a href="#2-Kibana-æ— æ³•è¿æ¥åˆ°-Elasticsearchï¼Ÿ" class="headerlink" title="2. Kibana æ— æ³•è¿æ¥åˆ° Elasticsearchï¼Ÿ"></a>2. Kibana æ— æ³•è¿æ¥åˆ° Elasticsearchï¼Ÿ</h3><ul>
<li>ç¡®ä¿ <code>ELASTICSEARCH_HOSTS</code> åœ°å€æ­£ç¡®ï¼Œä¸” Elasticsearch å®¹å™¨å·²å¯åŠ¨ã€‚</li>
<li>æ£€æŸ¥ Kibana å’Œ Elasticsearch çš„ç‰ˆæœ¬æ˜¯å¦ä¸€è‡´ã€‚</li>
</ul>
<h3 id="3-æ•°æ®å¦‚ä½•æŒä¹…åŒ–ï¼Ÿ"><a href="#3-æ•°æ®å¦‚ä½•æŒä¹…åŒ–ï¼Ÿ" class="headerlink" title="3. æ•°æ®å¦‚ä½•æŒä¹…åŒ–ï¼Ÿ"></a>3. æ•°æ®å¦‚ä½•æŒä¹…åŒ–ï¼Ÿ</h3><ul>
<li>é»˜è®¤ä½¿ç”¨ Docker çš„ <code>es_data</code> å·æ¥å­˜å‚¨ Elasticsearch æ•°æ®ï¼Œå¯ä»¥é€šè¿‡ä»¥ä¸‹å‘½ä»¤æŸ¥çœ‹å·ï¼š<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">docker volume <span class="built_in">ls</span></span><br></pre></td></tr></table></figure></li>
</ul>
<h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>é€šè¿‡ Docker Composeï¼Œæˆ‘ä»¬å¯ä»¥éå¸¸æ–¹ä¾¿åœ°éƒ¨ç½² Elasticsearch å’Œ Kibanaï¼Œåªéœ€ä¸€æ¡å‘½ä»¤å³å¯å¯åŠ¨æ•´ä¸ªæœåŠ¡é›†ç¾¤ã€‚è¿™ç§æ–¹å¼éå¸¸é€‚åˆå¼€å‘å’Œæµ‹è¯•ç¯å¢ƒï¼Œèƒ½å¤ŸèŠ‚çœå¤§é‡é…ç½®æ—¶é—´ã€‚</p>
<p>å¦‚æœä½ å¯¹è¿™ç¯‡æ–‡ç« æœ‰ä»»ä½•ç–‘é—®æˆ–å»ºè®®ï¼Œæ¬¢è¿åœ¨è¯„è®ºåŒºç•™è¨€ï¼</p>
]]></content>
      <categories>
        <category>è¿ç»´</category>
        <category>docker</category>
      </categories>
  </entry>
  <entry>
    <title>Linuxå¸¸ç”¨å‘½ä»¤</title>
    <url>/2024/08/28/%E8%BF%90%E7%BB%B4/linux/Linux%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4/</url>
    <content><![CDATA[<h3 id="linuxå¸¸ç”¨å‘½ä»¤æ€»ç»“"><a href="#linuxå¸¸ç”¨å‘½ä»¤æ€»ç»“" class="headerlink" title="linuxå¸¸ç”¨å‘½ä»¤æ€»ç»“"></a>linuxå¸¸ç”¨å‘½ä»¤æ€»ç»“</h3><h3 id="æŸ¥çœ‹ç³»ç»Ÿå‘è¡Œç‰ˆæœ¬"><a href="#æŸ¥çœ‹ç³»ç»Ÿå‘è¡Œç‰ˆæœ¬" class="headerlink" title="æŸ¥çœ‹ç³»ç»Ÿå‘è¡Œç‰ˆæœ¬"></a>æŸ¥çœ‹ç³»ç»Ÿå‘è¡Œç‰ˆæœ¬</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">grep -oP <span class="string">&#x27;(?&lt;=^ID=).+&#x27;</span> /etc/os-release</span><br><span class="line">lsb_release -a <span class="comment">#åˆ—å‡ºæ‰€æœ‰ç‰ˆæœ¬ä¿¡æ¯</span></span><br></pre></td></tr></table></figure>

<h3 id="æ‰“åŒ…"><a href="#æ‰“åŒ…" class="headerlink" title="æ‰“åŒ…"></a>æ‰“åŒ…</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">tar -cvf test.tar <span class="built_in">test</span>/ <span class="comment">#tarå‹ç¼©åŒ…å‘½ä»¤</span></span><br><span class="line">unzip example.zip -d /home/user/Downloads <span class="comment">#è§£å‹åˆ°æŒ‡å®šç›®å½•</span></span><br><span class="line">zip -r example.zip example <span class="comment">#å°†æ–‡ä»¶å¤¹å‹ç¼©ä¸ºzipæ–‡ä»¶</span></span><br><span class="line">unzip -l example.zip <span class="comment">#æŸ¥çœ‹å‹ç¼©åŒ…ä¸­æ–‡ä»¶</span></span><br></pre></td></tr></table></figure>

<h3 id="sedå‘½ä»¤"><a href="#sedå‘½ä»¤" class="headerlink" title="sedå‘½ä»¤"></a>sedå‘½ä»¤</h3><h3 id="è¯­æ³•"><a href="#è¯­æ³•" class="headerlink" title="è¯­æ³•"></a>è¯­æ³•</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">sed [-hnV][-e&lt;script&gt;][-f&lt;scriptæ–‡ä»¶&gt;][æ–‡æœ¬æ–‡ä»¶]</span><br></pre></td></tr></table></figure>

<p><strong>å‚æ•°è¯´æ˜</strong>ï¼š</p>
<ul>
<li>-eæˆ–â€“expression&#x3D; ä»¥é€‰é¡¹ä¸­æŒ‡å®šçš„scriptæ¥å¤„ç†è¾“å…¥çš„æ–‡æœ¬æ–‡ä»¶ã€‚</li>
<li>-fæˆ–â€“file&#x3D; ä»¥é€‰é¡¹ä¸­æŒ‡å®šçš„scriptæ–‡ä»¶æ¥å¤„ç†è¾“å…¥çš„æ–‡æœ¬æ–‡ä»¶ã€‚</li>
<li>-hæˆ–â€“help æ˜¾ç¤ºå¸®åŠ©ã€‚</li>
<li>-næˆ–â€“quietæˆ–â€“silent ä»…æ˜¾ç¤ºscriptå¤„ç†åçš„ç»“æœã€‚</li>
<li>-Væˆ–â€“version æ˜¾ç¤ºç‰ˆæœ¬ä¿¡æ¯ã€‚</li>
</ul>
<p><strong>åŠ¨ä½œè¯´æ˜</strong>ï¼š</p>
<ul>
<li>a ï¼šæ–°å¢ï¼Œ a çš„åé¢å¯ä»¥æ¥å­—ä¸²ï¼Œè€Œè¿™äº›å­—ä¸²ä¼šåœ¨æ–°çš„ä¸€è¡Œå‡ºç°(ç›®å‰çš„ä¸‹ä¸€è¡Œ)ï½</li>
<li>c ï¼šå–ä»£ï¼Œ c çš„åé¢å¯ä»¥æ¥å­—ä¸²ï¼Œè¿™äº›å­—ä¸²å¯ä»¥å–ä»£ n1,n2 ä¹‹é—´çš„è¡Œï¼</li>
<li>d ï¼šåˆ é™¤ï¼Œå› ä¸ºæ˜¯åˆ é™¤å•Šï¼Œæ‰€ä»¥ d åé¢é€šå¸¸ä¸æ¥ä»»ä½•ä¸œä¸œï¼›</li>
<li>i ï¼šæ’å…¥ï¼Œ i çš„åé¢å¯ä»¥æ¥å­—ä¸²ï¼Œè€Œè¿™äº›å­—ä¸²ä¼šåœ¨æ–°çš„ä¸€è¡Œå‡ºç°(ç›®å‰çš„ä¸Šä¸€è¡Œ)ï¼›</li>
<li>p ï¼šæ‰“å°ï¼Œäº¦å³å°†æŸä¸ªé€‰æ‹©çš„æ•°æ®å°å‡ºã€‚é€šå¸¸ p ä¼šä¸å‚æ•° sed -n ä¸€èµ·è¿è¡Œï½</li>
<li>s ï¼šå–ä»£ï¼Œå¯ä»¥ç›´æ¥è¿›è¡Œå–ä»£çš„å·¥ä½œå“©ï¼é€šå¸¸è¿™ä¸ª s çš„åŠ¨ä½œå¯ä»¥æ­é…æ­£åˆ™è¡¨è¾¾å¼ï¼ä¾‹å¦‚ 1,20s&#x2F;old&#x2F;new&#x2F;g å°±æ˜¯å•¦ï¼</li>
</ul>
<h3 id="å®ä¾‹"><a href="#å®ä¾‹" class="headerlink" title="å®ä¾‹"></a>å®ä¾‹</h3><p>æˆ‘ä»¬å…ˆåˆ›å»ºä¸€ä¸ª <strong>testFile</strong> æ–‡ä»¶ï¼Œå†…å®¹å¦‚ä¸‹ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ <span class="built_in">cat</span> testFile <span class="comment">#æŸ¥çœ‹testfile ä¸­çš„å†…å®¹  </span></span><br><span class="line">HELLO LINUX!  </span><br><span class="line">Linux is a free unix-type opterating system.  </span><br><span class="line">This is a linux testfile!  </span><br><span class="line">Linux <span class="built_in">test</span> </span><br><span class="line">Google</span><br><span class="line">Taobao</span><br><span class="line">Runoob</span><br><span class="line">Tesetfile</span><br><span class="line">Wiki</span><br></pre></td></tr></table></figure>

<p>åœ¨ç¬¬å››è¡Œå†™å…¥</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">sed -e 4a\newLine testFile </span><br></pre></td></tr></table></figure>

<p>åˆ é™¤1åˆ°3è¡Œ</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">sed <span class="string">&#x27;1,3 d&#x27;</span> testFile</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">root@ubuntu:/# sed <span class="string">&#x27;1,3 d&#x27;</span> testFile </span><br><span class="line">Linux <span class="built_in">test</span> </span><br><span class="line">Google</span><br><span class="line">Taobao</span><br><span class="line">Runoob</span><br><span class="line">Tesetfile</span><br><span class="line">Wiki</span><br></pre></td></tr></table></figure>

<h3 id="æ•°æ®çš„æŸ¥æ‰¾ä¸æ›¿æ¢"><a href="#æ•°æ®çš„æŸ¥æ‰¾ä¸æ›¿æ¢" class="headerlink" title="æ•°æ®çš„æŸ¥æ‰¾ä¸æ›¿æ¢"></a>æ•°æ®çš„æŸ¥æ‰¾ä¸æ›¿æ¢</h3><p>sed çš„æŸ¥æ‰¾ä¸æ›¿æ¢çš„ä¸ <strong>vi</strong> å‘½ä»¤ç±»ä¼¼ï¼Œè¯­æ³•æ ¼å¼å¦‚ä¸‹ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">sed <span class="string">&#x27;s/è¦è¢«å–ä»£çš„å­—ä¸²/æ–°çš„å­—ä¸²/g&#x27;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">root@ubuntu:/# sed <span class="string">&#x27;s/Runoob/test/g&#x27;</span> testFile </span><br><span class="line">HELLO LINUX!  </span><br><span class="line">Linux is a free unix-type opterating system.  </span><br><span class="line">This is a linux testfile!  </span><br><span class="line">Linux <span class="built_in">test</span> </span><br><span class="line">Google</span><br><span class="line">Taobao</span><br><span class="line"><span class="built_in">test</span></span><br><span class="line">Tesetfile</span><br><span class="line">Wiki</span><br></pre></td></tr></table></figure>

<p>å°† testFile æ–‡ä»¶ä¸­æ¯è¡Œç¬¬ä¸€æ¬¡å‡ºç°çš„ oo ç”¨å­—ç¬¦ä¸² kk æ›¿æ¢ï¼Œç„¶åå°†è¯¥æ–‡ä»¶å†…å®¹è¾“å‡ºåˆ°æ ‡å‡†è¾“å‡º:</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">root@ubuntu:/# sed -e <span class="string">&#x27;s/oo/kk/&#x27;</span> testFile</span><br><span class="line">HELLO LINUX!  </span><br><span class="line">Linux is a free unix-type opterating system.  </span><br><span class="line">This is a linux testfile!  </span><br><span class="line">Linux <span class="built_in">test</span> </span><br><span class="line">Gkkgle</span><br><span class="line">Taobao</span><br><span class="line">Runkkb</span><br><span class="line">Tesetfile</span><br><span class="line">Wiki</span><br></pre></td></tr></table></figure>

<p><strong>g</strong> æ ‡è¯†ç¬¦è¡¨ç¤ºå…¨å±€æŸ¥æ‰¾æ›¿æ¢ï¼Œä½¿ sed å¯¹æ–‡ä»¶ä¸­æ‰€æœ‰ç¬¦åˆçš„å­—ç¬¦ä¸²éƒ½è¢«æ›¿æ¢ï¼Œä¿®æ”¹åå†…å®¹ä¼šåˆ°æ ‡å‡†è¾“å‡ºï¼Œä¸ä¼šä¿®æ”¹åŸæ–‡ä»¶ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">root@ubuntu:/# sed -e <span class="string">&#x27;s/oo/kk/g&#x27;</span> testFile </span><br><span class="line">HELLO LINUX!  </span><br><span class="line">Linux is a free unix-type opterating system.  </span><br><span class="line">This is a linux testfile!  </span><br><span class="line">Linux <span class="built_in">test</span> </span><br><span class="line">Gkkgle</span><br><span class="line">Taobao</span><br><span class="line">Runkkb</span><br><span class="line">Tesetfile</span><br><span class="line">Wiki</span><br></pre></td></tr></table></figure>

<p>é€‰é¡¹ <strong>i</strong> ä½¿ sed ä¿®æ”¹æ–‡ä»¶:</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">root@ubuntu:/# sed -i <span class="string">&#x27;s/oo/kk/g&#x27;</span> testFile </span><br><span class="line">root@ubuntu:/# <span class="built_in">cat</span> testFile </span><br><span class="line">HELLO LINUX!  </span><br><span class="line">Linux is a free unix-type opterating system.  </span><br><span class="line">This is a linux testfile!  </span><br><span class="line">Linux <span class="built_in">test</span> </span><br><span class="line">Gkkgle</span><br><span class="line">Taobao</span><br><span class="line">Runkkb</span><br><span class="line">Tesetfile</span><br><span class="line">Wiki</span><br></pre></td></tr></table></figure>

<p>æ›¿æ¢åŸæœ‰çš„å€¼</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">sed -i <span class="string">&#x27;s/password=.*/password=4444/g&#x27;</span> ../testfile.1.ini	</span><br><span class="line">sed -i <span class="string">&quot;s%10.0.0.1:5010%<span class="variable">$&#123;your_fetcher&#125;</span>%g&quot;</span> docs/nginx.conf</span><br></pre></td></tr></table></figure>

<h3 id="ifconfig-å‘½ä»¤"><a href="#ifconfig-å‘½ä»¤" class="headerlink" title="ifconfig å‘½ä»¤"></a>ifconfig å‘½ä»¤</h3><p>å¯åŠ¨ç½‘å¡å‘½ä»¤</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">ifconfig ens33 up</span><br></pre></td></tr></table></figure>

<p>å…³é—­ç½‘å¡å‘½ä»¤</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">ifconfig ens33 down</span><br></pre></td></tr></table></figure>

<h3 id="netstat-å‘½ä»¤"><a href="#netstat-å‘½ä»¤" class="headerlink" title="netstat å‘½ä»¤"></a>netstat å‘½ä»¤</h3><p>è·å–æœåŠ¡ç«¯å£å ç”¨æƒ…å†µ</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">netstat -nlp|grep fisco-bcos</span><br><span class="line">tcp        0      0 0.0.0.0:30501           0.0.0.0:*               LISTEN      5639/fisco-bcos     </span><br><span class="line">tcp        0      0 0.0.0.0:30500           0.0.0.0:*               LISTEN      5637/fisco-bcos     </span><br><span class="line">tcp        0      0 0.0.0.0:20501           0.0.0.0:*               LISTEN      5639/fisco-bcos     </span><br><span class="line">tcp        0      0 0.0.0.0:20500           0.0.0.0:*               LISTEN      5637/fisco-bcos     </span><br><span class="line">tcp        0      0 127.0.0.1:8946          0.0.0.0:*               LISTEN      5639/fisco-bcos     </span><br><span class="line">tcp        0      0 127.0.0.1:8945          0.0.0.0:*               LISTEN      5637/fisco-bcos </span><br></pre></td></tr></table></figure>

<p>è·å–æœåŠ¡ç«¯å£å ç”¨æ•°é‡</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">netstat -nlp|grep fisco-bcos|<span class="built_in">wc</span> -l</span><br></pre></td></tr></table></figure>

<h3 id="pså‘½ä»¤"><a href="#pså‘½ä»¤" class="headerlink" title="pså‘½ä»¤"></a>pså‘½ä»¤</h3><p>æ£€æŸ¥æœåŠ¡è¿›ç¨‹</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">ps -ef | grep -v grep | grep fisco-bcos</span><br></pre></td></tr></table></figure>

<p>æ£€æŸ¥æœåŠ¡è¿›ç¨‹æ•°é‡</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">ps -ef | grep -v grep | grep fisco-bcos | <span class="built_in">wc</span> -l</span><br></pre></td></tr></table></figure>

<h3 id="æŸ¥çœ‹å½“å‰æ—¶é—´æˆ³"><a href="#æŸ¥çœ‹å½“å‰æ—¶é—´æˆ³" class="headerlink" title="æŸ¥çœ‹å½“å‰æ—¶é—´æˆ³"></a>æŸ¥çœ‹å½“å‰æ—¶é—´æˆ³</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">date</span> +%s</span><br></pre></td></tr></table></figure>
<ul>
<li>æ—¶é—´æˆ³è½¬æ—¥æœŸ<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">date</span> -d @1699319273</span><br></pre></td></tr></table></figure></li>
</ul>
<h3 id="æŸ¥çœ‹å¹¶æ€æ­»æœåŠ¡è¿›ç¨‹"><a href="#æŸ¥çœ‹å¹¶æ€æ­»æœåŠ¡è¿›ç¨‹" class="headerlink" title="æŸ¥çœ‹å¹¶æ€æ­»æœåŠ¡è¿›ç¨‹"></a>æŸ¥çœ‹å¹¶æ€æ­»æœåŠ¡è¿›ç¨‹</h3><ul>
<li>æŸ¥çœ‹è¿›ç¨‹<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">netstat -anp|grep server_ctl</span><br></pre></td></tr></table></figure></li>
<li>æ€æ­»æ‰€æœ‰å…³äºserver_ctlçš„è¿›ç¨‹<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">pkill -f server_ctl</span><br></pre></td></tr></table></figure></li>
</ul>
<h3 id="nohupåå°è¿è¡ŒæœåŠ¡ä¿å­˜æ—¥å¿—"><a href="#nohupåå°è¿è¡ŒæœåŠ¡ä¿å­˜æ—¥å¿—" class="headerlink" title="nohupåå°è¿è¡ŒæœåŠ¡ä¿å­˜æ—¥å¿—"></a>nohupåå°è¿è¡ŒæœåŠ¡ä¿å­˜æ—¥å¿—</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">nohup</span> ./my_service.sh &gt; log.txt 2&gt;&amp;1 &amp;</span><br></pre></td></tr></table></figure>
<h3 id="æ–‡ä»¶å†…å®¹æ’åºï¼Œå»é‡ç»Ÿè®¡æ•°é‡"><a href="#æ–‡ä»¶å†…å®¹æ’åºï¼Œå»é‡ç»Ÿè®¡æ•°é‡" class="headerlink" title="æ–‡ä»¶å†…å®¹æ’åºï¼Œå»é‡ç»Ÿè®¡æ•°é‡"></a>æ–‡ä»¶å†…å®¹æ’åºï¼Œå»é‡ç»Ÿè®¡æ•°é‡</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">sort</span> test.txt | <span class="built_in">uniq</span> -c | <span class="built_in">sort</span> -n</span><br></pre></td></tr></table></figure>
<ul>
<li>è¾“å‡º<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[root@iZj6c6hk0w19ob8g31qessZ ~]# <span class="built_in">sort</span> test.txt | <span class="built_in">uniq</span> -c | <span class="built_in">sort</span> -n</span><br><span class="line">      4 ccc</span><br><span class="line">      5 bbb</span><br><span class="line">      6 aaa</span><br></pre></td></tr></table></figure></li>
</ul>
<h3 id="æŸ¥çœ‹æ–‡ä»¶å†…å®¹æ˜¯å¦ä¸ºç©ºï¼Œå¹¶æˆªå–ç¬¬ä¸€ä¸ªæ•°æ®"><a href="#æŸ¥çœ‹æ–‡ä»¶å†…å®¹æ˜¯å¦ä¸ºç©ºï¼Œå¹¶æˆªå–ç¬¬ä¸€ä¸ªæ•°æ®" class="headerlink" title="æŸ¥çœ‹æ–‡ä»¶å†…å®¹æ˜¯å¦ä¸ºç©ºï¼Œå¹¶æˆªå–ç¬¬ä¸€ä¸ªæ•°æ®"></a>æŸ¥çœ‹æ–‡ä»¶å†…å®¹æ˜¯å¦ä¸ºç©ºï¼Œå¹¶æˆªå–ç¬¬ä¸€ä¸ªæ•°æ®</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">wc</span> -l test.txt | awk <span class="string">&#x27;&#123;print $1&#125;&#x27;</span></span><br></pre></td></tr></table></figure>
<ul>
<li>è¾“å‡º<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[root@iZj6c6hk0w19ob8g31qessZ ~]# <span class="built_in">wc</span> -l test.txt | awk <span class="string">&#x27;&#123;print&#125;&#x27;</span></span><br><span class="line">15 test.txt</span><br><span class="line">[root@iZj6c6hk0w19ob8g31qessZ ~]# <span class="built_in">wc</span> -l test.txt | awk <span class="string">&#x27;&#123;print $1&#125;&#x27;</span></span><br><span class="line">15</span><br></pre></td></tr></table></figure></li>
</ul>
<h3 id="mysql-å‘½ä»¤è¡Œæ“ä½œæ•°æ®åº“"><a href="#mysql-å‘½ä»¤è¡Œæ“ä½œæ•°æ®åº“" class="headerlink" title="mysql å‘½ä»¤è¡Œæ“ä½œæ•°æ®åº“"></a>mysql å‘½ä»¤è¡Œæ“ä½œæ•°æ®åº“</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">mysql -u root -p123456 -e <span class="string">&quot;CREATE DATABASE webasestat;&quot;</span></span><br></pre></td></tr></table></figure>
<h3 id="History-æ¸…é™¤å†å²è®°å½•"><a href="#History-æ¸…é™¤å†å²è®°å½•" class="headerlink" title="History æ¸…é™¤å†å²è®°å½•"></a>History æ¸…é™¤å†å²è®°å½•</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">rm</span> -rf ~/.bash_history</span><br><span class="line"><span class="built_in">history</span> -c</span><br></pre></td></tr></table></figure>
<h3 id="ä¿®æ”¹ç”¨æˆ·å¯†ç "><a href="#ä¿®æ”¹ç”¨æˆ·å¯†ç " class="headerlink" title="ä¿®æ”¹ç”¨æˆ·å¯†ç "></a>ä¿®æ”¹ç”¨æˆ·å¯†ç </h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">sudo</span> passwdd &lt;ç”¨æˆ·å&gt;</span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>è¿ç»´</category>
        <category>linux</category>
      </categories>
      <tags>
        <tag>linux</tag>
      </tags>
  </entry>
  <entry>
    <title>Parallel Ubuntu initramfs çš„ç´§æ€¥ä¿®å¤æ¨¡å¼å¦‚ä½•å¤„ç†</title>
    <url>/2025/09/24/%E8%BF%90%E7%BB%B4/linux/Parallel-Ubuntu-initramfs-%E7%9A%84%E7%B4%A7%E6%80%A5%E4%BF%AE%E5%A4%8D%E6%A8%A1%E5%BC%8F%E5%A6%82%E4%BD%95%E5%A4%84%E7%90%86/</url>
    <content><![CDATA[<p><img  
                       lazyload
                       alt="image"
                       data-src="/images/linux-initramfs.png"
                        alt="alt text"
                 ></p>
<h2 id="ä»€ä¹ˆæ˜¯-initramfs-ç´§æ€¥ä¿®å¤æ¨¡å¼"><a href="#ä»€ä¹ˆæ˜¯-initramfs-ç´§æ€¥ä¿®å¤æ¨¡å¼" class="headerlink" title="ä»€ä¹ˆæ˜¯ initramfs ç´§æ€¥ä¿®å¤æ¨¡å¼"></a>ä»€ä¹ˆæ˜¯ initramfs ç´§æ€¥ä¿®å¤æ¨¡å¼</h2><p>å½“ Ubuntu ç³»ç»Ÿå¯åŠ¨è¿‡ç¨‹ä¸­é‡åˆ°æ–‡ä»¶ç³»ç»Ÿé”™è¯¯æˆ–ç£ç›˜é—®é¢˜æ—¶ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨è¿›å…¥ initramfs ç´§æ€¥ä¿®å¤æ¨¡å¼ã€‚è¿™æ˜¯ä¸€ä¸ªæœ€å°åŒ–çš„æ ¹æ–‡ä»¶ç³»ç»Ÿï¼Œç”¨äºåœ¨ç³»ç»Ÿæ— æ³•æ­£å¸¸å¯åŠ¨æ—¶è¿›è¡Œæ•…éšœæ’é™¤å’Œä¿®å¤ã€‚</p>
<h3 id="å¸¸è§è§¦å‘åŸå› "><a href="#å¸¸è§è§¦å‘åŸå› " class="headerlink" title="å¸¸è§è§¦å‘åŸå› "></a>å¸¸è§è§¦å‘åŸå› </h3><ul>
<li>æ–‡ä»¶ç³»ç»ŸæŸåæˆ–å‡ºç°é”™è¯¯</li>
<li>ç£ç›˜ç©ºé—´ä¸è¶³</li>
<li>ç¡¬ç›˜ç‰©ç†æ•…éšœ</li>
<li>ä¸æ­£å¸¸å…³æœºå¯¼è‡´çš„æ–‡ä»¶ç³»ç»Ÿä¸ä¸€è‡´</li>
<li><code>/etc/fstab</code> é…ç½®é”™è¯¯</li>
<li>å†…æ ¸æ¨¡å—åŠ è½½å¤±è´¥</li>
</ul>
<h2 id="è¿›å…¥ç´§æ€¥ä¿®å¤æ¨¡å¼çš„è¡¨ç°"><a href="#è¿›å…¥ç´§æ€¥ä¿®å¤æ¨¡å¼çš„è¡¨ç°" class="headerlink" title="è¿›å…¥ç´§æ€¥ä¿®å¤æ¨¡å¼çš„è¡¨ç°"></a>è¿›å…¥ç´§æ€¥ä¿®å¤æ¨¡å¼çš„è¡¨ç°</h2><p>å½“ç³»ç»Ÿè¿›å…¥ initramfs æ¨¡å¼æ—¶ï¼Œä½ ä¼šçœ‹åˆ°ç±»ä¼¼ä»¥ä¸‹çš„æç¤ºï¼š</p>
<figure class="highlight text"><table><tr><td class="code"><pre><span class="line">BusyBox v1.30.1 (Ubuntu 1:1.30.1-4ubuntu6.3) built-in shell (ash)</span><br><span class="line">Enter &#x27;help&#x27; for a list of built-in commands.</span><br><span class="line"></span><br><span class="line">(initramfs) </span><br></pre></td></tr></table></figure>

<h2 id="å¿«é€Ÿä¿®å¤æ–¹æ³•"><a href="#å¿«é€Ÿä¿®å¤æ–¹æ³•" class="headerlink" title="å¿«é€Ÿä¿®å¤æ–¹æ³•"></a>å¿«é€Ÿä¿®å¤æ–¹æ³•</h2><h3 id="1-æ–‡ä»¶ç³»ç»Ÿæ£€æŸ¥å’Œä¿®å¤"><a href="#1-æ–‡ä»¶ç³»ç»Ÿæ£€æŸ¥å’Œä¿®å¤" class="headerlink" title="1. æ–‡ä»¶ç³»ç»Ÿæ£€æŸ¥å’Œä¿®å¤"></a>1. æ–‡ä»¶ç³»ç»Ÿæ£€æŸ¥å’Œä¿®å¤</h3><p>æœ€å¸¸ç”¨çš„ä¿®å¤å‘½ä»¤æ˜¯ä½¿ç”¨ <code>fsck</code> å¯¹æ–‡ä»¶ç³»ç»Ÿè¿›è¡Œæ£€æŸ¥å’Œä¿®å¤ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">fsck -y /dev/sda2</span><br></pre></td></tr></table></figure>

<p>å‚æ•°è¯´æ˜ï¼š</p>
<ul>
<li><code>-y</code>ï¼šå¯¹æ‰€æœ‰è¯¢é—®è‡ªåŠ¨å›ç­” â€œyesâ€ï¼Œè‡ªåŠ¨ä¿®å¤å‘ç°çš„é”™è¯¯</li>
<li><code>/dev/sda2</code>ï¼šéœ€è¦æ£€æŸ¥çš„åˆ†åŒºï¼Œé€šå¸¸æ˜¯æ ¹åˆ†åŒº</li>
</ul>
<h3 id="2-ç¡®è®¤ä¿®å¤ç»“æœ"><a href="#2-ç¡®è®¤ä¿®å¤ç»“æœ" class="headerlink" title="2. ç¡®è®¤ä¿®å¤ç»“æœ"></a>2. ç¡®è®¤ä¿®å¤ç»“æœ</h3><p>ä¿®å¤å®Œæˆåï¼Œä½ ä¼šçœ‹åˆ°ç±»ä¼¼ä»¥ä¸‹è¾“å‡ºï¼š</p>
<figure class="highlight text"><table><tr><td class="code"><pre><span class="line">fsck from util-linux 2.39.3</span><br><span class="line">e2fsck 1.46.2 (28-Feb-2021)</span><br><span class="line">/dev/sda2: clean, 1234/567890 files, 123456/2345678 blocks</span><br></pre></td></tr></table></figure>

<p>è¾“å‡ºè¯´æ˜ï¼š</p>
<ul>
<li><code>clean</code>ï¼šè¡¨ç¤ºæ–‡ä»¶ç³»ç»Ÿå·²ç»å¹²å‡€ï¼Œæ²¡æœ‰é”™è¯¯</li>
<li><code>files</code>ï¼šæ˜¾ç¤ºå·²ä½¿ç”¨çš„ inode æ•°é‡</li>
<li><code>blocks</code>ï¼šæ˜¾ç¤ºå·²ä½¿ç”¨çš„æ•°æ®å—æ•°é‡</li>
</ul>
<h3 id="3-é€€å‡ºå¹¶é‡å¯"><a href="#3-é€€å‡ºå¹¶é‡å¯" class="headerlink" title="3. é€€å‡ºå¹¶é‡å¯"></a>3. é€€å‡ºå¹¶é‡å¯</h3><p>ä¿®å¤å®Œæˆåï¼Œä½¿ç”¨ä»¥ä¸‹å‘½ä»¤é€€å‡ºå¹¶é‡å¯ç³»ç»Ÿï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">exit</span></span><br></pre></td></tr></table></figure>

<h2 id="è¿›é˜¶æ•…éšœæ’é™¤"><a href="#è¿›é˜¶æ•…éšœæ’é™¤" class="headerlink" title="è¿›é˜¶æ•…éšœæ’é™¤"></a>è¿›é˜¶æ•…éšœæ’é™¤</h2><h3 id="æ£€æŸ¥ç£ç›˜åˆ†åŒº"><a href="#æ£€æŸ¥ç£ç›˜åˆ†åŒº" class="headerlink" title="æ£€æŸ¥ç£ç›˜åˆ†åŒº"></a>æ£€æŸ¥ç£ç›˜åˆ†åŒº</h3><p>å¦‚æœä¸ç¡®å®šå“ªä¸ªåˆ†åŒºæ˜¯æ ¹åˆ†åŒºï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æŸ¥çœ‹ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">blkid</span><br><span class="line"><span class="comment"># æˆ–è€…</span></span><br><span class="line">fdisk -l</span><br></pre></td></tr></table></figure>

<h3 id="æŒ‚è½½æ–‡ä»¶ç³»ç»Ÿè¿›è¡Œæ‰‹åŠ¨ä¿®å¤"><a href="#æŒ‚è½½æ–‡ä»¶ç³»ç»Ÿè¿›è¡Œæ‰‹åŠ¨ä¿®å¤" class="headerlink" title="æŒ‚è½½æ–‡ä»¶ç³»ç»Ÿè¿›è¡Œæ‰‹åŠ¨ä¿®å¤"></a>æŒ‚è½½æ–‡ä»¶ç³»ç»Ÿè¿›è¡Œæ‰‹åŠ¨ä¿®å¤</h3><p>æœ‰æ—¶éœ€è¦æŒ‚è½½æ–‡ä»¶ç³»ç»Ÿè¿›è¡Œæ›´è¯¦ç»†çš„æ£€æŸ¥ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># åˆ›å»ºæŒ‚è½½ç‚¹</span></span><br><span class="line"><span class="built_in">mkdir</span> /mnt/root</span><br><span class="line"></span><br><span class="line"><span class="comment"># æŒ‚è½½æ ¹åˆ†åŒº</span></span><br><span class="line">mount /dev/sda2 /mnt/root</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ£€æŸ¥å…³é”®æ–‡ä»¶</span></span><br><span class="line"><span class="built_in">ls</span> -la /mnt/root/etc/</span><br><span class="line"><span class="built_in">cat</span> /mnt/root/etc/fstab</span><br><span class="line"></span><br><span class="line"><span class="comment"># å¸è½½</span></span><br><span class="line">umount /mnt/root</span><br></pre></td></tr></table></figure>

<h3 id="ä¿®å¤ç‰¹å®šç±»å‹çš„æ–‡ä»¶ç³»ç»Ÿ"><a href="#ä¿®å¤ç‰¹å®šç±»å‹çš„æ–‡ä»¶ç³»ç»Ÿ" class="headerlink" title="ä¿®å¤ç‰¹å®šç±»å‹çš„æ–‡ä»¶ç³»ç»Ÿ"></a>ä¿®å¤ç‰¹å®šç±»å‹çš„æ–‡ä»¶ç³»ç»Ÿ</h3><p>ä¸åŒçš„æ–‡ä»¶ç³»ç»Ÿä½¿ç”¨ä¸åŒçš„æ£€æŸ¥å·¥å…·ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># ext2/ext3/ext4 æ–‡ä»¶ç³»ç»Ÿ</span></span><br><span class="line">fsck.ext4 -y /dev/sda2</span><br><span class="line"></span><br><span class="line"><span class="comment"># XFS æ–‡ä»¶ç³»ç»Ÿ</span></span><br><span class="line">xfs_repair /dev/sda2</span><br><span class="line"></span><br><span class="line"><span class="comment"># NTFS æ–‡ä»¶ç³»ç»Ÿ</span></span><br><span class="line">ntfsfix /dev/sda2</span><br></pre></td></tr></table></figure>

<h2 id="é¢„é˜²æªæ–½"><a href="#é¢„é˜²æªæ–½" class="headerlink" title="é¢„é˜²æªæ–½"></a>é¢„é˜²æªæ–½</h2><h3 id="1-å®šæœŸæ£€æŸ¥æ–‡ä»¶ç³»ç»Ÿ"><a href="#1-å®šæœŸæ£€æŸ¥æ–‡ä»¶ç³»ç»Ÿ" class="headerlink" title="1. å®šæœŸæ£€æŸ¥æ–‡ä»¶ç³»ç»Ÿ"></a>1. å®šæœŸæ£€æŸ¥æ–‡ä»¶ç³»ç»Ÿ</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># å®šæœŸè¿è¡Œæ–‡ä»¶ç³»ç»Ÿæ£€æŸ¥ï¼ˆåœ¨ç»´æŠ¤æ—¶é—´ï¼‰</span></span><br><span class="line"><span class="built_in">sudo</span> fsck -f /dev/sda2</span><br></pre></td></tr></table></figure>

<h3 id="2-ç›‘æ§ç£ç›˜å¥åº·çŠ¶æ€"><a href="#2-ç›‘æ§ç£ç›˜å¥åº·çŠ¶æ€" class="headerlink" title="2. ç›‘æ§ç£ç›˜å¥åº·çŠ¶æ€"></a>2. ç›‘æ§ç£ç›˜å¥åº·çŠ¶æ€</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># å®‰è£…å¹¶ä½¿ç”¨ smartmontools</span></span><br><span class="line"><span class="built_in">sudo</span> apt install smartmontools</span><br><span class="line"><span class="built_in">sudo</span> smartctl -a /dev/sda</span><br></pre></td></tr></table></figure>

<h3 id="3-æ­£ç¡®å…³æœº"><a href="#3-æ­£ç¡®å…³æœº" class="headerlink" title="3. æ­£ç¡®å…³æœº"></a>3. æ­£ç¡®å…³æœº</h3><p>é¿å…å¼ºåˆ¶æ–­ç”µï¼Œå§‹ç»ˆä½¿ç”¨æ­£ç¡®çš„å…³æœºå‘½ä»¤ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">sudo</span> shutdown -h now</span><br><span class="line"><span class="comment"># æˆ–è€…</span></span><br><span class="line"><span class="built_in">sudo</span> reboot</span><br></pre></td></tr></table></figure>

<h3 id="4-å¤‡ä»½é‡è¦æ•°æ®"><a href="#4-å¤‡ä»½é‡è¦æ•°æ®" class="headerlink" title="4. å¤‡ä»½é‡è¦æ•°æ®"></a>4. å¤‡ä»½é‡è¦æ•°æ®</h3><p>å®šæœŸå¤‡ä»½é‡è¦æ•°æ®ï¼Œä»¥é˜²æ­¢æ•°æ®ä¸¢å¤±ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># ä½¿ç”¨ rsync è¿›è¡Œå¢é‡å¤‡ä»½</span></span><br><span class="line">rsync -av --delete /home/user/ /backup/user/</span><br></pre></td></tr></table></figure>

<h2 id="å¸¸è§é—®é¢˜å’Œè§£å†³æ–¹æ¡ˆ"><a href="#å¸¸è§é—®é¢˜å’Œè§£å†³æ–¹æ¡ˆ" class="headerlink" title="å¸¸è§é—®é¢˜å’Œè§£å†³æ–¹æ¡ˆ"></a>å¸¸è§é—®é¢˜å’Œè§£å†³æ–¹æ¡ˆ</h2><h3 id="Q-fsck-ä¿®å¤åä»ç„¶è¿›å…¥-initramfs-æ¨¡å¼"><a href="#Q-fsck-ä¿®å¤åä»ç„¶è¿›å…¥-initramfs-æ¨¡å¼" class="headerlink" title="Q: fsck ä¿®å¤åä»ç„¶è¿›å…¥ initramfs æ¨¡å¼"></a>Q: fsck ä¿®å¤åä»ç„¶è¿›å…¥ initramfs æ¨¡å¼</h3><p><strong>A:</strong> å¯èƒ½çš„åŸå› å’Œè§£å†³æ–¹æ¡ˆï¼š</p>
<ol>
<li>æ£€æŸ¥ <code>/etc/fstab</code> æ–‡ä»¶æ˜¯å¦æ­£ç¡®</li>
<li>éªŒè¯åˆ†åŒº UUID æ˜¯å¦åŒ¹é…</li>
<li>æ£€æŸ¥æ˜¯å¦æœ‰ç¡¬ä»¶æ•…éšœ</li>
</ol>
<h3 id="Q-ä¿®å¤è¿‡ç¨‹ä¸­å‡ºç°å¤§é‡é”™è¯¯"><a href="#Q-ä¿®å¤è¿‡ç¨‹ä¸­å‡ºç°å¤§é‡é”™è¯¯" class="headerlink" title="Q: ä¿®å¤è¿‡ç¨‹ä¸­å‡ºç°å¤§é‡é”™è¯¯"></a>Q: ä¿®å¤è¿‡ç¨‹ä¸­å‡ºç°å¤§é‡é”™è¯¯</h3><p><strong>A:</strong> å»ºè®®ï¼š</p>
<ol>
<li>ä¸è¦ä½¿ç”¨ <code>-y</code> å‚æ•°ï¼Œæ‰‹åŠ¨ç¡®è®¤æ¯ä¸ªä¿®å¤æ“ä½œ</li>
<li>å…ˆè¿›è¡Œåªè¯»æ£€æŸ¥ï¼š<code>fsck -n /dev/sda2</code></li>
<li>å¦‚æœé”™è¯¯è¿‡å¤šï¼Œè€ƒè™‘æ•°æ®æ¢å¤åé‡æ–°å®‰è£…ç³»ç»Ÿ</li>
</ol>
<h3 id="Q-æ‰¾ä¸åˆ°æ­£ç¡®çš„è®¾å¤‡åˆ†åŒº"><a href="#Q-æ‰¾ä¸åˆ°æ­£ç¡®çš„è®¾å¤‡åˆ†åŒº" class="headerlink" title="Q: æ‰¾ä¸åˆ°æ­£ç¡®çš„è®¾å¤‡åˆ†åŒº"></a>Q: æ‰¾ä¸åˆ°æ­£ç¡®çš„è®¾å¤‡åˆ†åŒº</h3><p><strong>A:</strong> ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤å®šä½ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># æŸ¥çœ‹æ‰€æœ‰åˆ†åŒº</span></span><br><span class="line">lsblk</span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥çœ‹åˆ†åŒºUUIDå’Œæ–‡ä»¶ç³»ç»Ÿç±»å‹</span></span><br><span class="line">blkid</span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥çœ‹å½“å‰æŒ‚è½½æƒ…å†µ</span></span><br><span class="line">mount | grep <span class="string">&quot;/&quot;</span></span><br></pre></td></tr></table></figure>

<h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>initramfs ç´§æ€¥ä¿®å¤æ¨¡å¼æ˜¯ Ubuntu ç³»ç»Ÿçš„é‡è¦å®‰å…¨æœºåˆ¶ï¼Œå½“é‡åˆ°æ–‡ä»¶ç³»ç»Ÿé—®é¢˜æ—¶ï¼š</p>
<ol>
<li><strong>ä¿æŒå†·é™</strong>ï¼šè¿™æ˜¯å¯ä»¥ä¿®å¤çš„å¸¸è§é—®é¢˜</li>
<li><strong>ä½¿ç”¨ fsck</strong>ï¼šå¤§å¤šæ•°é—®é¢˜å¯ä»¥é€šè¿‡ <code>fsck -y /dev/sda2</code> è§£å†³</li>
<li><strong>éªŒè¯ä¿®å¤</strong>ï¼šç¡®è®¤çœ‹åˆ° â€œcleanâ€ çŠ¶æ€åå†é‡å¯</li>
<li><strong>é¢„é˜²ä¸ºä¸»</strong>ï¼šå®šæœŸç»´æŠ¤å’Œæ­£ç¡®ä½¿ç”¨ç³»ç»Ÿå¯ä»¥é¿å…å¤§å¤šæ•°é—®é¢˜</li>
</ol>
<p>é€šè¿‡æ­£ç¡®çš„æ•…éšœæ’é™¤æ­¥éª¤ï¼Œå¤§å¤šæ•° initramfs ç›¸å…³é—®é¢˜éƒ½å¯ä»¥å¾—åˆ°æœ‰æ•ˆè§£å†³ï¼Œç¡®ä¿ç³»ç»Ÿå¿«é€Ÿæ¢å¤æ­£å¸¸è¿è¡Œã€‚</p>
]]></content>
      <categories>
        <category>è¿ç»´</category>
        <category>linux</category>
      </categories>
      <tags>
        <tag>linux</tag>
        <tag>ubuntu</tag>
        <tag>initramfs</tag>
        <tag>æ•…éšœä¿®å¤</tag>
        <tag>æ–‡ä»¶ç³»ç»Ÿ</tag>
      </tags>
  </entry>
  <entry>
    <title>centosé…ç½®é™æ€IP</title>
    <url>/2024/12/21/%E8%BF%90%E7%BB%B4/linux/centos%E9%85%8D%E7%BD%AE%E9%9D%99%E6%80%81IP/</url>
    <content><![CDATA[<h2 id="1-é€šè¿‡ä¿®æ”¹é…ç½®æ–‡ä»¶ä¿®æ”¹"><a href="#1-é€šè¿‡ä¿®æ”¹é…ç½®æ–‡ä»¶ä¿®æ”¹" class="headerlink" title="1. é€šè¿‡ä¿®æ”¹é…ç½®æ–‡ä»¶ä¿®æ”¹"></a>1. é€šè¿‡ä¿®æ”¹é…ç½®æ–‡ä»¶ä¿®æ”¹</h2><h3 id="1-1-ä¿®æ”¹é…ç½®æ–‡ä»¶"><a href="#1-1-ä¿®æ”¹é…ç½®æ–‡ä»¶" class="headerlink" title="1.1 ä¿®æ”¹é…ç½®æ–‡ä»¶"></a>1.1 ä¿®æ”¹é…ç½®æ–‡ä»¶</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">vi /etc/sysconfig/network-scripts/ifcfg-ens33</span><br></pre></td></tr></table></figure>

<h3 id="1-2-ä¿®æ”¹é…ç½®æ–‡ä»¶å†…å®¹"><a href="#1-2-ä¿®æ”¹é…ç½®æ–‡ä»¶å†…å®¹" class="headerlink" title="1.2 ä¿®æ”¹é…ç½®æ–‡ä»¶å†…å®¹"></a>1.2 ä¿®æ”¹é…ç½®æ–‡ä»¶å†…å®¹</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">TYPE=Ethernet</span><br><span class="line">PROXY_METHOD=none</span><br><span class="line">BROWSER_ONLY=no</span><br><span class="line">BOOTPROTO=<span class="string">&quot;static&quot;</span></span><br><span class="line">DEFROUTE=<span class="built_in">yes</span></span><br><span class="line">IPV4_FAILURE_FATAL=no</span><br><span class="line">IPV6INIT=<span class="built_in">yes</span></span><br><span class="line">IPV6_AUTOCONF=<span class="built_in">yes</span></span><br><span class="line">IPV6_DEFROUTE=<span class="built_in">yes</span></span><br><span class="line">IPV6_FAILURE_FATAL=no</span><br><span class="line">IPV6_ADDR_GEN_MODE=stable-privacy</span><br><span class="line">NAME=ens33</span><br><span class="line">UUID=4efeb675-1c50-4de3-9605-3d9019109eb9</span><br><span class="line">DEVICE=ens33</span><br><span class="line">ONBOOT=<span class="built_in">yes</span></span><br><span class="line"><span class="comment"># æ·»åŠ ä»¥ä¸‹å†…å®¹</span></span><br><span class="line">IPADDR=192.168.1.13</span><br><span class="line">NETMASK=255.255.255.0</span><br><span class="line">GATEWAY=192.168.1.1</span><br><span class="line">DNS1=8.8.8.8</span><br><span class="line">PREFIX=24</span><br></pre></td></tr></table></figure>
<p>:wq ä¿å­˜å¹¶é€€å‡º</p>
<h3 id="1-3-é‡å¯ç½‘ç»œæœåŠ¡"><a href="#1-3-é‡å¯ç½‘ç»œæœåŠ¡" class="headerlink" title="1.3 é‡å¯ç½‘ç»œæœåŠ¡"></a>1.3 é‡å¯ç½‘ç»œæœåŠ¡</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">service network restart</span><br></pre></td></tr></table></figure>
<h3 id="1-4-æŸ¥çœ‹IPåœ°å€"><a href="#1-4-æŸ¥çœ‹IPåœ°å€" class="headerlink" title="1.4 æŸ¥çœ‹IPåœ°å€"></a>1.4 æŸ¥çœ‹IPåœ°å€</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">ip addr</span><br></pre></td></tr></table></figure>
<p>æˆåŠŸä¹‹åå¯ä»¥çœ‹åˆ°</p>
<p><img  
                       lazyload
                       alt="image"
                       data-src="/images/ipaddr.png"
                        alt="alt text"
                 ></p>
<h2 id="2-é€šè¿‡nmtuiä¿®æ”¹"><a href="#2-é€šè¿‡nmtuiä¿®æ”¹" class="headerlink" title="2. é€šè¿‡nmtuiä¿®æ”¹"></a>2. é€šè¿‡nmtuiä¿®æ”¹</h2><h3 id="2-1-æ‰“å¼€nmtui"><a href="#2-1-æ‰“å¼€nmtui" class="headerlink" title="2.1 æ‰“å¼€nmtui"></a>2.1 æ‰“å¼€nmtui</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">nmtui</span><br></pre></td></tr></table></figure>
<p>ç‚¹å‡»ç¼–è¾‘è¿æ¥</p>
<p><img  
                       lazyload
                       alt="image"
                       data-src="/images/editconn.jpeg"
                        alt="alt text"
                 ></p>
<p>é€‰æ‹©ens33ç½‘å¡ï¼Œç‚¹å‡»ç¼–è¾‘<br><img  
                       lazyload
                       alt="image"
                       data-src="/images/editconn2.jpeg"
                        alt="alt text"
                 ></p>
<p>ä¿®æ”¹ç½‘ç»œè¿æ¥ä¿¡æ¯<br><img  
                       lazyload
                       alt="image"
                       data-src="/images/changenetwork.jpeg"
                        alt="alt text"
                 ></p>
<p>ä¿®æ”¹å®Œæ¯•ä¹‹åï¼Œç‚¹å‡»OKå®Œæˆ,ç„¶åBack</p>
<p>é€‰ä¸­æ¿€æ´»è¿æ¥ï¼Œå›è½¦<br><img  
                       lazyload
                       alt="image"
                       data-src="/images/active.jpeg"
                        alt="alt text"
                 ></p>
<h2 id="3-é€šè¿‡nmcliä¿®æ”¹"><a href="#3-é€šè¿‡nmcliä¿®æ”¹" class="headerlink" title="3. é€šè¿‡nmcliä¿®æ”¹"></a>3. é€šè¿‡nmcliä¿®æ”¹</h2><h3 id="3-1-æŸ¥çœ‹ç½‘å¡ä¿¡æ¯"><a href="#3-1-æŸ¥çœ‹ç½‘å¡ä¿¡æ¯" class="headerlink" title="3.1 æŸ¥çœ‹ç½‘å¡ä¿¡æ¯"></a>3.1 æŸ¥çœ‹ç½‘å¡ä¿¡æ¯</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">nmcli dev status</span><br></pre></td></tr></table></figure>

<h3 id="3-2-ä¿®æ”¹ç½‘å¡ä¿¡æ¯"><a href="#3-2-ä¿®æ”¹ç½‘å¡ä¿¡æ¯" class="headerlink" title="3.2 ä¿®æ”¹ç½‘å¡ä¿¡æ¯"></a>3.2 ä¿®æ”¹ç½‘å¡ä¿¡æ¯</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># è®¾ç½®é™æ€IPåœ°å€</span></span><br><span class="line">nmcli con mod ens33 ipv4.addresses 192.168.1.13/24</span><br><span class="line"></span><br><span class="line"><span class="comment"># è®¾ç½®ç½‘å…³</span></span><br><span class="line">nmcli con mod ens33 ipv4.gateway 192.168.1.1</span><br><span class="line"></span><br><span class="line"><span class="comment"># è®¾ç½®DNSæœåŠ¡å™¨</span></span><br><span class="line">nmcli con mod ens33 ipv4.dns 8.8.8.8</span><br><span class="line"></span><br><span class="line"><span class="comment"># è®¾ç½®IPåœ°å€åˆ†é…æ–¹å¼ä¸ºæ‰‹åŠ¨</span></span><br><span class="line">nmcli con mod ens33 ipv4.method manual</span><br><span class="line"></span><br><span class="line"><span class="comment"># è®¾ç½®DNSæœç´¢åŸŸ</span></span><br><span class="line">nmcli con mod ens33 ipv4.dns-search localdomain</span><br><span class="line"></span><br><span class="line"><span class="comment"># è®¾ç½®è¿æ¥è‡ªåŠ¨è¿æ¥</span></span><br><span class="line">nmcli con mod ens33 connection.autoconnect <span class="built_in">yes</span></span><br></pre></td></tr></table></figure>

<h3 id="3-3-æ¿€æ´»ç½‘å¡"><a href="#3-3-æ¿€æ´»ç½‘å¡" class="headerlink" title="3.3 æ¿€æ´»ç½‘å¡"></a>3.3 æ¿€æ´»ç½‘å¡</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">nmcli con up ens33</span><br></pre></td></tr></table></figure>

<h3 id="3-4-æŸ¥çœ‹ç½‘å¡ä¿¡æ¯"><a href="#3-4-æŸ¥çœ‹ç½‘å¡ä¿¡æ¯" class="headerlink" title="3.4 æŸ¥çœ‹ç½‘å¡ä¿¡æ¯"></a>3.4 æŸ¥çœ‹ç½‘å¡ä¿¡æ¯</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">nmcli con show ens33</span><br></pre></td></tr></table></figure>
<p><img  
                       lazyload
                       alt="image"
                       data-src="/images/showens33.jpeg"
                        alt="alt text"
                 ></p>
]]></content>
      <categories>
        <category>è¿ç»´</category>
        <category>linux</category>
      </categories>
      <tags>
        <tag>linux</tag>
      </tags>
  </entry>
  <entry>
    <title>åŸºäºubuntu20ç¯å¢ƒå®‰è£…</title>
    <url>/2024/08/28/%E8%BF%90%E7%BB%B4/linux/%E5%9F%BA%E4%BA%8Eubuntu20%E7%8E%AF%E5%A2%83%E5%AE%89%E8%A3%85/</url>
    <content><![CDATA[<h3 id="ubuntu20å®‰è£…è¯¦è§£"><a href="#ubuntu20å®‰è£…è¯¦è§£" class="headerlink" title="ubuntu20å®‰è£…è¯¦è§£"></a>ubuntu20å®‰è£…è¯¦è§£</h3><h4 id="1-æ›´æ–°ç³»ç»Ÿè½¯ä»¶åŒ…"><a href="#1-æ›´æ–°ç³»ç»Ÿè½¯ä»¶åŒ…" class="headerlink" title="1.æ›´æ–°ç³»ç»Ÿè½¯ä»¶åŒ…"></a>1.æ›´æ–°ç³»ç»Ÿè½¯ä»¶åŒ…</h4><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">sudo</span> apt update</span><br><span class="line"><span class="built_in">sudo</span> apt upgrade</span><br></pre></td></tr></table></figure>
<h4 id="2-å®‰è£…mysqlæœåŠ¡"><a href="#2-å®‰è£…mysqlæœåŠ¡" class="headerlink" title="2.å®‰è£…mysqlæœåŠ¡"></a>2.å®‰è£…mysqlæœåŠ¡</h4><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">sudo</span> apt install mysql-server</span><br></pre></td></tr></table></figure>
<h4 id="3-é…ç½®mysql-å¯ä»¥ä¿®æ”¹å¯†ç "><a href="#3-é…ç½®mysql-å¯ä»¥ä¿®æ”¹å¯†ç " class="headerlink" title="3.é…ç½®mysql,å¯ä»¥ä¿®æ”¹å¯†ç "></a>3.é…ç½®mysql,å¯ä»¥ä¿®æ”¹å¯†ç </h4><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">sudo</span> mysql_secure_installation</span><br></pre></td></tr></table></figure>
<h4 id="4-è®¾ç½®å¯†ç "><a href="#4-è®¾ç½®å¯†ç " class="headerlink" title="4.è®¾ç½®å¯†ç "></a>4.è®¾ç½®å¯†ç </h4><ol>
<li>æ›´æ”¹å¯†ç é•¿åº¦é™åˆ¶</li>
</ol>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">set</span> <span class="keyword">global</span> validate_password.policy<span class="operator">=</span><span class="number">0</span>;</span><br><span class="line"><span class="keyword">set</span> <span class="keyword">global</span> validate_password.mixed_case_count<span class="operator">=</span><span class="number">0</span>;</span><br><span class="line"><span class="keyword">set</span> <span class="keyword">global</span> validate_password.number_count<span class="operator">=</span><span class="number">0</span>;</span><br><span class="line"><span class="keyword">set</span> <span class="keyword">global</span> validate_password.special_char_count<span class="operator">=</span><span class="number">0</span>;</span><br><span class="line"><span class="keyword">set</span> <span class="keyword">global</span> validate_password.length<span class="operator">=</span><span class="number">6</span>;</span><br><span class="line"><span class="keyword">show</span> variables <span class="keyword">like</span> <span class="string">&#x27;validate_password%&#x27;</span>; #æŸ¥è¯¢æ‰€æœ‰</span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">USER</span> <span class="string">&#x27;root&#x27;</span>@<span class="string">&#x27;localhost&#x27;</span> IDENTIFIED <span class="keyword">WITH</span> mysql_native_password <span class="keyword">BY</span> <span class="string">&#x27;123456&#x27;</span>; #æ›´æ–°å¯†ç </span><br><span class="line">FLUSH PRIVILEGES; #åˆ·æ–°</span><br></pre></td></tr></table></figure>
<p>MySQLçš„rootç”¨æˆ·è¢«é»˜è®¤è®¾ç½®æˆé€šè¿‡auth_socketæ’ä»¶è¿›è¡Œè®¤è¯ï¼Œè€Œä¸æ˜¯é€šè¿‡å¯†ç ã€‚<br><a class="link"   href="https://www.cnblogs.com/tomyyyyy/p/14584379.html" >ä¿®æ”¹åŠ å¯†æ–¹å¼<i class="fas fa-external-link-alt"></i></a></p>
<h4 id="4-å¯åŠ¨mysql"><a href="#4-å¯åŠ¨mysql" class="headerlink" title="4.å¯åŠ¨mysql"></a>4.å¯åŠ¨mysql</h4><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">sudo</span> service mysql start</span><br></pre></td></tr></table></figure>
<h5 id="mysqlå®‰è£…å®Œæˆï¼"><a href="#mysqlå®‰è£…å®Œæˆï¼" class="headerlink" title="mysqlå®‰è£…å®Œæˆï¼"></a>mysqlå®‰è£…å®Œæˆï¼</h5><h3 id="åˆ é™¤mysql"><a href="#åˆ é™¤mysql" class="headerlink" title="åˆ é™¤mysql"></a>åˆ é™¤mysql</h3><h4 id="1-åœæ­¢mysqlæœåŠ¡"><a href="#1-åœæ­¢mysqlæœåŠ¡" class="headerlink" title="1.åœæ­¢mysqlæœåŠ¡"></a>1.åœæ­¢mysqlæœåŠ¡</h4><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">sudo</span> service mysql stop</span><br></pre></td></tr></table></figure>
<h4 id="2-å¸è½½mysqlå®¢æˆ·ç«¯æœåŠ¡å™¨å®‰è£…åŒ…"><a href="#2-å¸è½½mysqlå®¢æˆ·ç«¯æœåŠ¡å™¨å®‰è£…åŒ…" class="headerlink" title="2.å¸è½½mysqlå®¢æˆ·ç«¯æœåŠ¡å™¨å®‰è£…åŒ…"></a>2.å¸è½½mysqlå®¢æˆ·ç«¯æœåŠ¡å™¨å®‰è£…åŒ…</h4><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">sudo</span> apt purge mysql-client mysql-server</span><br></pre></td></tr></table></figure>
<h4 id="3-åˆ é™¤mysqlé…ç½®æ–‡ä»¶å’Œæ•°æ®ç›®å½•"><a href="#3-åˆ é™¤mysqlé…ç½®æ–‡ä»¶å’Œæ•°æ®ç›®å½•" class="headerlink" title="3.åˆ é™¤mysqlé…ç½®æ–‡ä»¶å’Œæ•°æ®ç›®å½•"></a>3.åˆ é™¤mysqlé…ç½®æ–‡ä»¶å’Œæ•°æ®ç›®å½•</h4><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">sudo</span> <span class="built_in">rm</span> -rf /etc/mysql /var/lib/mysql</span><br></pre></td></tr></table></figure>
<h4 id="4-åˆ é™¤æ®‹ç•™çš„mysqlé…ç½®å’Œæ•°æ®æ–‡ä»¶"><a href="#4-åˆ é™¤æ®‹ç•™çš„mysqlé…ç½®å’Œæ•°æ®æ–‡ä»¶" class="headerlink" title="4.åˆ é™¤æ®‹ç•™çš„mysqlé…ç½®å’Œæ•°æ®æ–‡ä»¶"></a>4.åˆ é™¤æ®‹ç•™çš„mysqlé…ç½®å’Œæ•°æ®æ–‡ä»¶</h4><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">sudo</span> apt autoremove</span><br></pre></td></tr></table></figure>
<h4 id="5-æ£€æŸ¥mysqlæ˜¯å¦æˆåŠŸåˆ é™¤"><a href="#5-æ£€æŸ¥mysqlæ˜¯å¦æˆåŠŸåˆ é™¤" class="headerlink" title="5.æ£€æŸ¥mysqlæ˜¯å¦æˆåŠŸåˆ é™¤"></a>5.æ£€æŸ¥mysqlæ˜¯å¦æˆåŠŸåˆ é™¤</h4><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">mysql --version</span><br></pre></td></tr></table></figure>
<h3 id="sshè¿æ¥é—®é¢˜"><a href="#sshè¿æ¥é—®é¢˜" class="headerlink" title="sshè¿æ¥é—®é¢˜"></a>sshè¿æ¥é—®é¢˜</h3><p>ä¸‹è½½</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">sudo</span> apt update</span><br><span class="line"><span class="built_in">sudo</span> apt install openssh-server</span><br></pre></td></tr></table></figure>
<p>å…³é—­é˜²ç«å¢™</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">sudo</span> systemctl stop ufw</span><br></pre></td></tr></table></figure>
<h3 id="å®‰è£…Nginx"><a href="#å®‰è£…Nginx" class="headerlink" title="å®‰è£…Nginx"></a>å®‰è£…Nginx</h3><ol>
<li>åˆ é™¤nginx<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">sudo</span> apt-get remove nginx*</span><br><span class="line"><span class="built_in">sudo</span> apt-get autoremove</span><br></pre></td></tr></table></figure></li>
<li>åˆ›å»ºnginxç›®å½•<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">mkdir</span> /opt/nginx</span><br><span class="line"><span class="built_in">cd</span> /opt/nginx </span><br></pre></td></tr></table></figure>
3.æ‹‰å–nginxåŒ…<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">wget https://nginx.org/download/nginx-1.24.0.tar.gz </span><br></pre></td></tr></table></figure>
4.è§£å‹<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">tar -zxvf nginx-1.24.0.tar.gz</span><br></pre></td></tr></table></figure>
5.è¿›å…¥nginx-1.24.0ç›®å½•è¿›è¡Œé…ç½®<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">cd</span> nginx-1.24.0</span><br><span class="line">./configure --prefix=/usr/local/nginx</span><br></pre></td></tr></table></figure>
<blockquote>
<p>â€“prefix&#x3D;&#x2F;usr&#x2F;local&#x2F;nginxï¼šæŒ‡å®šå®‰è£…ç›®å½•ä¸º&#x2F;usr&#x2F;local&#x2F;nginxã€‚åœ¨ç¼–è¯‘å’Œå®‰è£…å®Œæˆåï¼Œè½¯ä»¶å°†è¢«å®‰è£…åˆ°è¯¥ç›®å½•ä¸‹.<br>â€“with-http_stub_status_moduleï¼šå¯ç”¨ HTTP Stub Status æ¨¡å—ã€‚è¯¥æ¨¡å—æ˜¯ Nginx çš„ä¸€ä¸ªå†…ç½®æ¨¡å—ï¼Œç”¨äºè·å– Nginx æœåŠ¡å™¨çš„çŠ¶æ€ä¿¡æ¯ã€‚<br>â€“with-http_ssl_moduleï¼šå¯ç”¨ HTTP SSL æ¨¡å—ã€‚è¯¥æ¨¡å—ä½¿å¾— Nginx æ”¯æŒé€šè¿‡ HTTPS æä¾›å®‰å…¨çš„åŠ å¯†ä¼ è¾“ã€‚</p>
</blockquote>
</li>
<li>make<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">make </span><br><span class="line">make install</span><br></pre></td></tr></table></figure>
æ­£å¸¸æƒ…å†µçš„ä¿¡æ¯è¾“å‡ºï¼š<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">nginx: the configuration file /usr/local/nginx/conf/nginx.conf syntax is ok</span><br><span class="line">nginx: configuration file /usr/local/nginx/conf/nginx.conf <span class="built_in">test</span> is successful</span><br></pre></td></tr></table></figure></li>
<li>nginxå‡ ä¸ªå¸¸è§å‘½ä»¤<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">/usr/local/nginx/sbin/nginx -s reload            <span class="comment"># é‡æ–°è½½å…¥é…ç½®æ–‡ä»¶</span></span><br><span class="line">/usr/local/nginx/sbin/nginx -s reopen            <span class="comment"># é‡å¯ Nginx</span></span><br><span class="line">/usr/local/nginx/sbin/nginx -s stop              <span class="comment"># åœæ­¢ Nginx</span></span><br><span class="line">ps -ef | grep nginx                              <span class="comment"># æŸ¥çœ‹nginxè¿›ç¨‹</span></span><br></pre></td></tr></table></figure></li>
</ol>
<h3 id="å‘½ä»¤è¡Œå®‰è£…vscode"><a href="#å‘½ä»¤è¡Œå®‰è£…vscode" class="headerlink" title="å‘½ä»¤è¡Œå®‰è£…vscode"></a>å‘½ä»¤è¡Œå®‰è£…vscode</h3><ul>
<li>æ·»åŠ æº<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">curl https://packages.microsoft.com/keys/microsoft.asc | gpg --dearmor &gt; microsoft.gpg</span><br><span class="line"><span class="built_in">sudo</span> <span class="built_in">mv</span> microsoft.gpg /etc/apt/trusted.gpg.d/microsoft.gpg</span><br><span class="line"><span class="built_in">sudo</span> sh -c <span class="string">&#x27;echo &quot;deb [arch=amd64] https://packages.microsoft.com/repos/vscode stable main&quot; &gt; /etc/apt/sources.list.d/vscode.list&#x27;</span></span><br></pre></td></tr></table></figure></li>
<li>æ›´æ–°åŒ…ç¼“å­˜ï¼Œç„¶åå®‰è£…code<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">sudo</span> apt-get update</span><br><span class="line"><span class="built_in">sudo</span> apt-get install code</span><br></pre></td></tr></table></figure></li>
</ul>
<h4 id="å®‰è£…arm64-ç‰ˆvscode"><a href="#å®‰è£…arm64-ç‰ˆvscode" class="headerlink" title="å®‰è£…arm64 ç‰ˆvscode"></a>å®‰è£…arm64 ç‰ˆvscode</h4><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">sudo</span> apt update</span><br><span class="line"><span class="built_in">sudo</span> apt install software-properties-common apt-transport-https wget</span><br><span class="line">wget -qO- https://packages.microsoft.com/keys/microsoft.asc | gpg --dearmor &gt; packages.microsoft.gpg</span><br><span class="line"><span class="built_in">sudo</span> install -o root -g root -m 644 packages.microsoft.gpg /usr/share/keyrings/</span><br><span class="line"><span class="built_in">rm</span> packages.microsoft.gpg</span><br><span class="line"><span class="built_in">sudo</span> sh -c <span class="string">&#x27;echo &quot;deb [arch=arm64 signed-by=/usr/share/keyrings/packages.microsoft.gpg] https://packages.microsoft.com/repos/code stable main&quot; &gt; /etc/apt/sources.list.d/vscode.list&#x27;</span></span><br><span class="line"><span class="built_in">sudo</span> apt update</span><br><span class="line"><span class="built_in">sudo</span> apt install code</span><br></pre></td></tr></table></figure>

<h3 id="å®‰è£…Golang"><a href="#å®‰è£…Golang" class="headerlink" title="å®‰è£…Golang"></a>å®‰è£…Golang</h3><ol>
<li>ä»¥1.20.2ç‰ˆæœ¬ä¸ºä¾‹<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">wget https://golang.google.cn/dl/go1.20.2.linux-amd64.tar.gz</span><br></pre></td></tr></table></figure></li>
<li>è§£å‹æ–‡ä»¶<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">tar -zxf go1.20.2.linux-amd64.tar.gz</span><br></pre></td></tr></table></figure></li>
<li>é…ç½®ç¯å¢ƒå˜é‡<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">vim /etc/profile</span><br><span class="line"><span class="comment"># /usr/local/go/bin ä¸ºgoå®‰è£…ç›®å½•çš„binç›®å½•,ç³»ç»Ÿæ‰€æœ‰è´¦æˆ·å¯ä»¥ä½¿ç”¨binä¸‹çš„å‘½ä»¤è¿›è¡Œæ‰§è¡Œ</span></span><br><span class="line"><span class="built_in">export</span> PATH=<span class="variable">$PATH</span>:/usr/local/go/bin</span><br><span class="line"><span class="comment"># /home/go/go ä¸ºgoå·¥ä½œç©ºé—´çš„ç›®å½•,å¯è‡ªè¡Œä¿®æ”¹</span></span><br><span class="line"><span class="built_in">export</span> GOPATH=/home/go/go </span><br><span class="line"><span class="comment"># /usr/local/go ä¸ºgoçš„å®‰è£…ç›®å½•</span></span><br><span class="line"><span class="built_in">export</span> GOROOT=/usr/local/go</span><br><span class="line"><span class="built_in">source</span> /etc/profile</span><br></pre></td></tr></table></figure></li>
<li>GOè®¾ç½®ä»£ç†ç¯å¢ƒå˜é‡<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">go <span class="built_in">env</span> -w GOPROXY=https://goproxy.cn,direct</span><br></pre></td></tr></table></figure></li>
</ol>
]]></content>
      <categories>
        <category>è¿ç»´</category>
        <category>linux</category>
      </categories>
      <tags>
        <tag>linux</tag>
      </tags>
  </entry>
  <entry>
    <title>kafka</title>
    <url>/2024/10/02/%E5%BE%AE%E6%9C%8D%E5%8A%A1/%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97/kafka/kafka/</url>
    <content><![CDATA[<h2 id="Kafka-ä¸€é”®éƒ¨ç½²"><a href="#Kafka-ä¸€é”®éƒ¨ç½²" class="headerlink" title="Kafka ä¸€é”®éƒ¨ç½²"></a>Kafka ä¸€é”®éƒ¨ç½²</h2><h3 id="docker-compose-éƒ¨ç½²kafka-å¯è§†åŒ–ç•Œé¢"><a href="#docker-compose-éƒ¨ç½²kafka-å¯è§†åŒ–ç•Œé¢" class="headerlink" title="docker-compose éƒ¨ç½²kafka+å¯è§†åŒ–ç•Œé¢"></a>docker-compose éƒ¨ç½²kafka+å¯è§†åŒ–ç•Œé¢</h3><figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">version:</span> <span class="string">&#x27;3.8&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="attr">services:</span></span><br><span class="line">  <span class="attr">zookeeper:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">bitnami/zookeeper</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="attr">ALLOW_ANONYMOUS_LOGIN:</span> <span class="string">&quot;yes&quot;</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;2181:2181&quot;</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">kafka:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">bitnami/kafka</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="comment"># KRaft settings</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">KAFKA_CFG_NODE_ID=0</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">KAFKA_CFG_PROCESS_ROLES=controller,broker</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">KAFKA_CFG_CONTROLLER_QUORUM_VOTERS=0@kafka:9093</span></span><br><span class="line">      <span class="comment"># Listeners</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">KAFKA_CFG_LISTENERS=PLAINTEXT://:9092,CONTROLLER://:9093</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">KAFKA_CFG_ADVERTISED_LISTENERS=PLAINTEXT://:9092</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">KAFKA_CFG_LISTENER_SECURITY_PROTOCOL_MAP=CONTROLLER:PLAINTEXT,PLAINTEXT:PLAINTEXT</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">KAFKA_CFG_CONTROLLER_LISTENER_NAMES=CONTROLLER</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">KAFKA_CFG_INTER_BROKER_LISTENER_NAME=PLAINTEXT</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;9092:9092&quot;</span></span><br><span class="line">    <span class="attr">depends_on:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">zookeeper</span></span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>å¾®æœåŠ¡</category>
        <category>æ¶ˆæ¯é˜Ÿåˆ—</category>
      </categories>
      <tags>
        <tag>å¾®æœåŠ¡</tag>
        <tag>æ¶ˆæ¯é˜Ÿåˆ—</tag>
      </tags>
  </entry>
</search>
